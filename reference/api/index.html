<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A universal bridge to connect, map, and automate data transfer between any two REST APIs."><meta name=author content="K. Kartas"><link href=https://kkartas.github.io/APILinker/reference/api/ rel=canonical><link href=../../developer-guide/release-process/ rel=prev><link href=../../citation/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>API Reference - ApiLinker</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#api-reference class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=ApiLinker class="md-header__button md-logo" aria-label=ApiLinker data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ApiLinker </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> API Reference </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/kkartas/APILinker title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> kkartas/APILinker </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../user-guide/configuration/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../developer-guide/architecture/ class=md-tabs__link> Developer Guide </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../citation/ class=md-tabs__link> Citation </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=ApiLinker class="md-nav__button md-logo" aria-label=ApiLinker data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> ApiLinker </label> <div class=md-nav__source> <a href=https://github.com/kkartas/APILinker title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> kkartas/APILinker </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/tutorial/ class=md-nav__link> <span class=md-ellipsis> Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/interactive-tutorial/ class=md-nav__link> <span class=md-ellipsis> Interactive Tutorial </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/authentication/ class=md-nav__link> <span class=md-ellipsis> Authentication </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/mapping/ class=md-nav__link> <span class=md-ellipsis> Mapping & Transformation </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/connectors/ class=md-nav__link> <span class=md-ellipsis> Connectors </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/research-connectors/ class=md-nav__link> <span class=md-ellipsis> Research Connectors </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/secret-management/ class=md-nav__link> <span class=md-ellipsis> Secret Management </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/scheduling/ class=md-nav__link> <span class=md-ellipsis> Scheduling </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/webhooks/ class=md-nav__link> <span class=md-ellipsis> Webhooks </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/error-handling/ class=md-nav__link> <span class=md-ellipsis> Error Handling </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/cookbook/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/comparison/ class=md-nav__link> <span class=md-ellipsis> Comparison </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/core-components/ class=md-nav__link> <span class=md-ellipsis> Core Components </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/plugins/ class=md-nav__link> <span class=md-ellipsis> Plugin System </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/benchmarks/ class=md-nav__link> <span class=md-ellipsis> Benchmarks </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/release-process/ class=md-nav__link> <span class=md-ellipsis> Release Process </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> API Reference </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-classes class=md-nav__link> <span class=md-ellipsis> Core Classes </span> </a> <nav class=md-nav aria-label="Core Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker class=md-nav__link> <span class=md-ellipsis> ApiLinker </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker class=md-nav__link> <span class=md-ellipsis> ApiLinker </span> </a> <nav class=md-nav aria-label=ApiLinker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.ApiLinker.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_source class=md-nav__link> <span class=md-ellipsis> add_source </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_target class=md-nav__link> <span class=md-ellipsis> add_target </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_mapping class=md-nav__link> <span class=md-ellipsis> add_mapping </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.sync class=md-nav__link> <span class=md-ellipsis> sync </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.fetch class=md-nav__link> <span class=md-ellipsis> fetch </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.send class=md-nav__link> <span class=md-ellipsis> send </span> </a> </li> <li class=md-nav__item> <a href=#apiconnector class=md-nav__link> <span class=md-ellipsis> ApiConnector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector class=md-nav__link> <span class=md-ellipsis> ApiConnector </span> </a> <nav class=md-nav aria-label=ApiConnector> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.fetch_data class=md-nav__link> <span class=md-ellipsis> fetch_data </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.send_data class=md-nav__link> <span class=md-ellipsis> send_data </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.stream_sse class=md-nav__link> <span class=md-ellipsis> stream_sse </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.consume_sse class=md-nav__link> <span class=md-ellipsis> consume_sse </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.check_health class=md-nav__link> <span class=md-ellipsis> check_health </span> </a> </li> <li class=md-nav__item> <a href=#fieldmapper class=md-nav__link> <span class=md-ellipsis> FieldMapper </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper class=md-nav__link> <span class=md-ellipsis> FieldMapper </span> </a> <nav class=md-nav aria-label=FieldMapper> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.add_mapping class=md-nav__link> <span class=md-ellipsis> add_mapping </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.transform class=md-nav__link> <span class=md-ellipsis> transform </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.register_transformer class=md-nav__link> <span class=md-ellipsis> register_transformer </span> </a> </li> <li class=md-nav__item> <a href=#monitoring-alerting class=md-nav__link> <span class=md-ellipsis> Monitoring &amp; Alerting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager class=md-nav__link> <span class=md-ellipsis> MonitoringManager </span> </a> <nav class=md-nav aria-label=MonitoringManager> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.register_health_check class=md-nav__link> <span class=md-ellipsis> register_health_check </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.add_rule class=md-nav__link> <span class=md-ellipsis> add_rule </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.add_integration class=md-nav__link> <span class=md-ellipsis> add_integration </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.run_health_checks class=md-nav__link> <span class=md-ellipsis> run_health_checks </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.get_alert_history class=md-nav__link> <span class=md-ellipsis> get_alert_history </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#research-connectors class=md-nav__link> <span class=md-ellipsis> Research Connectors </span> </a> <nav class=md-nav aria-label="Research Connectors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#available-connectors class=md-nav__link> <span class=md-ellipsis> Available Connectors </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../citation/ class=md-nav__link> <span class=md-ellipsis> Citation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-classes class=md-nav__link> <span class=md-ellipsis> Core Classes </span> </a> <nav class=md-nav aria-label="Core Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker class=md-nav__link> <span class=md-ellipsis> ApiLinker </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker class=md-nav__link> <span class=md-ellipsis> ApiLinker </span> </a> <nav class=md-nav aria-label=ApiLinker> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.ApiLinker.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_source class=md-nav__link> <span class=md-ellipsis> add_source </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_target class=md-nav__link> <span class=md-ellipsis> add_target </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.add_mapping class=md-nav__link> <span class=md-ellipsis> add_mapping </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.sync class=md-nav__link> <span class=md-ellipsis> sync </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.fetch class=md-nav__link> <span class=md-ellipsis> fetch </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.ApiLinker.send class=md-nav__link> <span class=md-ellipsis> send </span> </a> </li> <li class=md-nav__item> <a href=#apiconnector class=md-nav__link> <span class=md-ellipsis> ApiConnector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector class=md-nav__link> <span class=md-ellipsis> ApiConnector </span> </a> <nav class=md-nav aria-label=ApiConnector> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.fetch_data class=md-nav__link> <span class=md-ellipsis> fetch_data </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.send_data class=md-nav__link> <span class=md-ellipsis> send_data </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.stream_sse class=md-nav__link> <span class=md-ellipsis> stream_sse </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.consume_sse class=md-nav__link> <span class=md-ellipsis> consume_sse </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.connector.ApiConnector.check_health class=md-nav__link> <span class=md-ellipsis> check_health </span> </a> </li> <li class=md-nav__item> <a href=#fieldmapper class=md-nav__link> <span class=md-ellipsis> FieldMapper </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper class=md-nav__link> <span class=md-ellipsis> FieldMapper </span> </a> <nav class=md-nav aria-label=FieldMapper> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.add_mapping class=md-nav__link> <span class=md-ellipsis> add_mapping </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.transform class=md-nav__link> <span class=md-ellipsis> transform </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.mapper.FieldMapper.register_transformer class=md-nav__link> <span class=md-ellipsis> register_transformer </span> </a> </li> <li class=md-nav__item> <a href=#monitoring-alerting class=md-nav__link> <span class=md-ellipsis> Monitoring &amp; Alerting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager class=md-nav__link> <span class=md-ellipsis> MonitoringManager </span> </a> <nav class=md-nav aria-label=MonitoringManager> <ul class=md-nav__list> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.register_health_check class=md-nav__link> <span class=md-ellipsis> register_health_check </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.add_rule class=md-nav__link> <span class=md-ellipsis> add_rule </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.add_integration class=md-nav__link> <span class=md-ellipsis> add_integration </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.run_health_checks class=md-nav__link> <span class=md-ellipsis> run_health_checks </span> </a> </li> <li class=md-nav__item> <a href=#apilinker.core.monitoring.MonitoringManager.get_alert_history class=md-nav__link> <span class=md-ellipsis> get_alert_history </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#research-connectors class=md-nav__link> <span class=md-ellipsis> Research Connectors </span> </a> <nav class=md-nav aria-label="Research Connectors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#available-connectors class=md-nav__link> <span class=md-ellipsis> Available Connectors </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=api-reference>API Reference</h1> <p>This page provides comprehensive API documentation for all ApiLinker classes and modules.</p> <h2 id=core-classes>Core Classes</h2> <h3 id=apilinker>ApiLinker</h3> <p>Main orchestrator class for API integration workflows.</p> <div class="doc doc-object doc-class"> <h2 id=apilinker.ApiLinker class="doc doc-heading"> <code>apilinker.ApiLinker</code> </h2> <div class="doc doc-contents first"> <p>Main class for connecting, mapping and transferring data between APIs.</p> <p>This class orchestrates the entire process of: 1. Connecting to source and target APIs 2. Fetching data from the source 3. Mapping fields according to configuration 4. Transforming data as needed 5. Sending data to the target 6. Scheduling recurring operations</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>config_path</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Path to YAML/JSON configuration file</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>source_config</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Direct source configuration dictionary</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>target_config</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Direct target configuration dictionary</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>mapping_config</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Direct mapping configuration dictionary</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>schedule_config</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Direct scheduling configuration dictionary</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>log_level</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Logging level (DEBUG, INFO, WARNING, ERROR)</p> </div> </td> <td> <code>&#39;INFO&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>log_file</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Path to log file</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-98>  98</a></span>
<span class=normal><a href=#__codelineno-0-99>  99</a></span>
<span class=normal><a href=#__codelineno-0-100> 100</a></span>
<span class=normal><a href=#__codelineno-0-101> 101</a></span>
<span class=normal><a href=#__codelineno-0-102> 102</a></span>
<span class=normal><a href=#__codelineno-0-103> 103</a></span>
<span class=normal><a href=#__codelineno-0-104> 104</a></span>
<span class=normal><a href=#__codelineno-0-105> 105</a></span>
<span class=normal><a href=#__codelineno-0-106> 106</a></span>
<span class=normal><a href=#__codelineno-0-107> 107</a></span>
<span class=normal><a href=#__codelineno-0-108> 108</a></span>
<span class=normal><a href=#__codelineno-0-109> 109</a></span>
<span class=normal><a href=#__codelineno-0-110> 110</a></span>
<span class=normal><a href=#__codelineno-0-111> 111</a></span>
<span class=normal><a href=#__codelineno-0-112> 112</a></span>
<span class=normal><a href=#__codelineno-0-113> 113</a></span>
<span class=normal><a href=#__codelineno-0-114> 114</a></span>
<span class=normal><a href=#__codelineno-0-115> 115</a></span>
<span class=normal><a href=#__codelineno-0-116> 116</a></span>
<span class=normal><a href=#__codelineno-0-117> 117</a></span>
<span class=normal><a href=#__codelineno-0-118> 118</a></span>
<span class=normal><a href=#__codelineno-0-119> 119</a></span>
<span class=normal><a href=#__codelineno-0-120> 120</a></span>
<span class=normal><a href=#__codelineno-0-121> 121</a></span>
<span class=normal><a href=#__codelineno-0-122> 122</a></span>
<span class=normal><a href=#__codelineno-0-123> 123</a></span>
<span class=normal><a href=#__codelineno-0-124> 124</a></span>
<span class=normal><a href=#__codelineno-0-125> 125</a></span>
<span class=normal><a href=#__codelineno-0-126> 126</a></span>
<span class=normal><a href=#__codelineno-0-127> 127</a></span>
<span class=normal><a href=#__codelineno-0-128> 128</a></span>
<span class=normal><a href=#__codelineno-0-129> 129</a></span>
<span class=normal><a href=#__codelineno-0-130> 130</a></span>
<span class=normal><a href=#__codelineno-0-131> 131</a></span>
<span class=normal><a href=#__codelineno-0-132> 132</a></span>
<span class=normal><a href=#__codelineno-0-133> 133</a></span>
<span class=normal><a href=#__codelineno-0-134> 134</a></span>
<span class=normal><a href=#__codelineno-0-135> 135</a></span>
<span class=normal><a href=#__codelineno-0-136> 136</a></span>
<span class=normal><a href=#__codelineno-0-137> 137</a></span>
<span class=normal><a href=#__codelineno-0-138> 138</a></span>
<span class=normal><a href=#__codelineno-0-139> 139</a></span>
<span class=normal><a href=#__codelineno-0-140> 140</a></span>
<span class=normal><a href=#__codelineno-0-141> 141</a></span>
<span class=normal><a href=#__codelineno-0-142> 142</a></span>
<span class=normal><a href=#__codelineno-0-143> 143</a></span>
<span class=normal><a href=#__codelineno-0-144> 144</a></span>
<span class=normal><a href=#__codelineno-0-145> 145</a></span>
<span class=normal><a href=#__codelineno-0-146> 146</a></span>
<span class=normal><a href=#__codelineno-0-147> 147</a></span>
<span class=normal><a href=#__codelineno-0-148> 148</a></span>
<span class=normal><a href=#__codelineno-0-149> 149</a></span>
<span class=normal><a href=#__codelineno-0-150> 150</a></span>
<span class=normal><a href=#__codelineno-0-151> 151</a></span>
<span class=normal><a href=#__codelineno-0-152> 152</a></span>
<span class=normal><a href=#__codelineno-0-153> 153</a></span>
<span class=normal><a href=#__codelineno-0-154> 154</a></span>
<span class=normal><a href=#__codelineno-0-155> 155</a></span>
<span class=normal><a href=#__codelineno-0-156> 156</a></span>
<span class=normal><a href=#__codelineno-0-157> 157</a></span>
<span class=normal><a href=#__codelineno-0-158> 158</a></span>
<span class=normal><a href=#__codelineno-0-159> 159</a></span>
<span class=normal><a href=#__codelineno-0-160> 160</a></span>
<span class=normal><a href=#__codelineno-0-161> 161</a></span>
<span class=normal><a href=#__codelineno-0-162> 162</a></span>
<span class=normal><a href=#__codelineno-0-163> 163</a></span>
<span class=normal><a href=#__codelineno-0-164> 164</a></span>
<span class=normal><a href=#__codelineno-0-165> 165</a></span>
<span class=normal><a href=#__codelineno-0-166> 166</a></span>
<span class=normal><a href=#__codelineno-0-167> 167</a></span>
<span class=normal><a href=#__codelineno-0-168> 168</a></span>
<span class=normal><a href=#__codelineno-0-169> 169</a></span>
<span class=normal><a href=#__codelineno-0-170> 170</a></span>
<span class=normal><a href=#__codelineno-0-171> 171</a></span>
<span class=normal><a href=#__codelineno-0-172> 172</a></span>
<span class=normal><a href=#__codelineno-0-173> 173</a></span>
<span class=normal><a href=#__codelineno-0-174> 174</a></span>
<span class=normal><a href=#__codelineno-0-175> 175</a></span>
<span class=normal><a href=#__codelineno-0-176> 176</a></span>
<span class=normal><a href=#__codelineno-0-177> 177</a></span>
<span class=normal><a href=#__codelineno-0-178> 178</a></span>
<span class=normal><a href=#__codelineno-0-179> 179</a></span>
<span class=normal><a href=#__codelineno-0-180> 180</a></span>
<span class=normal><a href=#__codelineno-0-181> 181</a></span>
<span class=normal><a href=#__codelineno-0-182> 182</a></span>
<span class=normal><a href=#__codelineno-0-183> 183</a></span>
<span class=normal><a href=#__codelineno-0-184> 184</a></span>
<span class=normal><a href=#__codelineno-0-185> 185</a></span>
<span class=normal><a href=#__codelineno-0-186> 186</a></span>
<span class=normal><a href=#__codelineno-0-187> 187</a></span>
<span class=normal><a href=#__codelineno-0-188> 188</a></span>
<span class=normal><a href=#__codelineno-0-189> 189</a></span>
<span class=normal><a href=#__codelineno-0-190> 190</a></span>
<span class=normal><a href=#__codelineno-0-191> 191</a></span>
<span class=normal><a href=#__codelineno-0-192> 192</a></span>
<span class=normal><a href=#__codelineno-0-193> 193</a></span>
<span class=normal><a href=#__codelineno-0-194> 194</a></span>
<span class=normal><a href=#__codelineno-0-195> 195</a></span>
<span class=normal><a href=#__codelineno-0-196> 196</a></span>
<span class=normal><a href=#__codelineno-0-197> 197</a></span>
<span class=normal><a href=#__codelineno-0-198> 198</a></span>
<span class=normal><a href=#__codelineno-0-199> 199</a></span>
<span class=normal><a href=#__codelineno-0-200> 200</a></span>
<span class=normal><a href=#__codelineno-0-201> 201</a></span>
<span class=normal><a href=#__codelineno-0-202> 202</a></span>
<span class=normal><a href=#__codelineno-0-203> 203</a></span>
<span class=normal><a href=#__codelineno-0-204> 204</a></span>
<span class=normal><a href=#__codelineno-0-205> 205</a></span>
<span class=normal><a href=#__codelineno-0-206> 206</a></span>
<span class=normal><a href=#__codelineno-0-207> 207</a></span>
<span class=normal><a href=#__codelineno-0-208> 208</a></span>
<span class=normal><a href=#__codelineno-0-209> 209</a></span>
<span class=normal><a href=#__codelineno-0-210> 210</a></span>
<span class=normal><a href=#__codelineno-0-211> 211</a></span>
<span class=normal><a href=#__codelineno-0-212> 212</a></span>
<span class=normal><a href=#__codelineno-0-213> 213</a></span>
<span class=normal><a href=#__codelineno-0-214> 214</a></span>
<span class=normal><a href=#__codelineno-0-215> 215</a></span>
<span class=normal><a href=#__codelineno-0-216> 216</a></span>
<span class=normal><a href=#__codelineno-0-217> 217</a></span>
<span class=normal><a href=#__codelineno-0-218> 218</a></span>
<span class=normal><a href=#__codelineno-0-219> 219</a></span>
<span class=normal><a href=#__codelineno-0-220> 220</a></span>
<span class=normal><a href=#__codelineno-0-221> 221</a></span>
<span class=normal><a href=#__codelineno-0-222> 222</a></span>
<span class=normal><a href=#__codelineno-0-223> 223</a></span>
<span class=normal><a href=#__codelineno-0-224> 224</a></span>
<span class=normal><a href=#__codelineno-0-225> 225</a></span>
<span class=normal><a href=#__codelineno-0-226> 226</a></span>
<span class=normal><a href=#__codelineno-0-227> 227</a></span>
<span class=normal><a href=#__codelineno-0-228> 228</a></span>
<span class=normal><a href=#__codelineno-0-229> 229</a></span>
<span class=normal><a href=#__codelineno-0-230> 230</a></span>
<span class=normal><a href=#__codelineno-0-231> 231</a></span>
<span class=normal><a href=#__codelineno-0-232> 232</a></span>
<span class=normal><a href=#__codelineno-0-233> 233</a></span>
<span class=normal><a href=#__codelineno-0-234> 234</a></span>
<span class=normal><a href=#__codelineno-0-235> 235</a></span>
<span class=normal><a href=#__codelineno-0-236> 236</a></span>
<span class=normal><a href=#__codelineno-0-237> 237</a></span>
<span class=normal><a href=#__codelineno-0-238> 238</a></span>
<span class=normal><a href=#__codelineno-0-239> 239</a></span>
<span class=normal><a href=#__codelineno-0-240> 240</a></span>
<span class=normal><a href=#__codelineno-0-241> 241</a></span>
<span class=normal><a href=#__codelineno-0-242> 242</a></span>
<span class=normal><a href=#__codelineno-0-243> 243</a></span>
<span class=normal><a href=#__codelineno-0-244> 244</a></span>
<span class=normal><a href=#__codelineno-0-245> 245</a></span>
<span class=normal><a href=#__codelineno-0-246> 246</a></span>
<span class=normal><a href=#__codelineno-0-247> 247</a></span>
<span class=normal><a href=#__codelineno-0-248> 248</a></span>
<span class=normal><a href=#__codelineno-0-249> 249</a></span>
<span class=normal><a href=#__codelineno-0-250> 250</a></span>
<span class=normal><a href=#__codelineno-0-251> 251</a></span>
<span class=normal><a href=#__codelineno-0-252> 252</a></span>
<span class=normal><a href=#__codelineno-0-253> 253</a></span>
<span class=normal><a href=#__codelineno-0-254> 254</a></span>
<span class=normal><a href=#__codelineno-0-255> 255</a></span>
<span class=normal><a href=#__codelineno-0-256> 256</a></span>
<span class=normal><a href=#__codelineno-0-257> 257</a></span>
<span class=normal><a href=#__codelineno-0-258> 258</a></span>
<span class=normal><a href=#__codelineno-0-259> 259</a></span>
<span class=normal><a href=#__codelineno-0-260> 260</a></span>
<span class=normal><a href=#__codelineno-0-261> 261</a></span>
<span class=normal><a href=#__codelineno-0-262> 262</a></span>
<span class=normal><a href=#__codelineno-0-263> 263</a></span>
<span class=normal><a href=#__codelineno-0-264> 264</a></span>
<span class=normal><a href=#__codelineno-0-265> 265</a></span>
<span class=normal><a href=#__codelineno-0-266> 266</a></span>
<span class=normal><a href=#__codelineno-0-267> 267</a></span>
<span class=normal><a href=#__codelineno-0-268> 268</a></span>
<span class=normal><a href=#__codelineno-0-269> 269</a></span>
<span class=normal><a href=#__codelineno-0-270> 270</a></span>
<span class=normal><a href=#__codelineno-0-271> 271</a></span>
<span class=normal><a href=#__codelineno-0-272> 272</a></span>
<span class=normal><a href=#__codelineno-0-273> 273</a></span>
<span class=normal><a href=#__codelineno-0-274> 274</a></span>
<span class=normal><a href=#__codelineno-0-275> 275</a></span>
<span class=normal><a href=#__codelineno-0-276> 276</a></span>
<span class=normal><a href=#__codelineno-0-277> 277</a></span>
<span class=normal><a href=#__codelineno-0-278> 278</a></span>
<span class=normal><a href=#__codelineno-0-279> 279</a></span>
<span class=normal><a href=#__codelineno-0-280> 280</a></span>
<span class=normal><a href=#__codelineno-0-281> 281</a></span>
<span class=normal><a href=#__codelineno-0-282> 282</a></span>
<span class=normal><a href=#__codelineno-0-283> 283</a></span>
<span class=normal><a href=#__codelineno-0-284> 284</a></span>
<span class=normal><a href=#__codelineno-0-285> 285</a></span>
<span class=normal><a href=#__codelineno-0-286> 286</a></span>
<span class=normal><a href=#__codelineno-0-287> 287</a></span>
<span class=normal><a href=#__codelineno-0-288> 288</a></span>
<span class=normal><a href=#__codelineno-0-289> 289</a></span>
<span class=normal><a href=#__codelineno-0-290> 290</a></span>
<span class=normal><a href=#__codelineno-0-291> 291</a></span>
<span class=normal><a href=#__codelineno-0-292> 292</a></span>
<span class=normal><a href=#__codelineno-0-293> 293</a></span>
<span class=normal><a href=#__codelineno-0-294> 294</a></span>
<span class=normal><a href=#__codelineno-0-295> 295</a></span>
<span class=normal><a href=#__codelineno-0-296> 296</a></span>
<span class=normal><a href=#__codelineno-0-297> 297</a></span>
<span class=normal><a href=#__codelineno-0-298> 298</a></span>
<span class=normal><a href=#__codelineno-0-299> 299</a></span>
<span class=normal><a href=#__codelineno-0-300> 300</a></span>
<span class=normal><a href=#__codelineno-0-301> 301</a></span>
<span class=normal><a href=#__codelineno-0-302> 302</a></span>
<span class=normal><a href=#__codelineno-0-303> 303</a></span>
<span class=normal><a href=#__codelineno-0-304> 304</a></span>
<span class=normal><a href=#__codelineno-0-305> 305</a></span>
<span class=normal><a href=#__codelineno-0-306> 306</a></span>
<span class=normal><a href=#__codelineno-0-307> 307</a></span>
<span class=normal><a href=#__codelineno-0-308> 308</a></span>
<span class=normal><a href=#__codelineno-0-309> 309</a></span>
<span class=normal><a href=#__codelineno-0-310> 310</a></span>
<span class=normal><a href=#__codelineno-0-311> 311</a></span>
<span class=normal><a href=#__codelineno-0-312> 312</a></span>
<span class=normal><a href=#__codelineno-0-313> 313</a></span>
<span class=normal><a href=#__codelineno-0-314> 314</a></span>
<span class=normal><a href=#__codelineno-0-315> 315</a></span>
<span class=normal><a href=#__codelineno-0-316> 316</a></span>
<span class=normal><a href=#__codelineno-0-317> 317</a></span>
<span class=normal><a href=#__codelineno-0-318> 318</a></span>
<span class=normal><a href=#__codelineno-0-319> 319</a></span>
<span class=normal><a href=#__codelineno-0-320> 320</a></span>
<span class=normal><a href=#__codelineno-0-321> 321</a></span>
<span class=normal><a href=#__codelineno-0-322> 322</a></span>
<span class=normal><a href=#__codelineno-0-323> 323</a></span>
<span class=normal><a href=#__codelineno-0-324> 324</a></span>
<span class=normal><a href=#__codelineno-0-325> 325</a></span>
<span class=normal><a href=#__codelineno-0-326> 326</a></span>
<span class=normal><a href=#__codelineno-0-327> 327</a></span>
<span class=normal><a href=#__codelineno-0-328> 328</a></span>
<span class=normal><a href=#__codelineno-0-329> 329</a></span>
<span class=normal><a href=#__codelineno-0-330> 330</a></span>
<span class=normal><a href=#__codelineno-0-331> 331</a></span>
<span class=normal><a href=#__codelineno-0-332> 332</a></span>
<span class=normal><a href=#__codelineno-0-333> 333</a></span>
<span class=normal><a href=#__codelineno-0-334> 334</a></span>
<span class=normal><a href=#__codelineno-0-335> 335</a></span>
<span class=normal><a href=#__codelineno-0-336> 336</a></span>
<span class=normal><a href=#__codelineno-0-337> 337</a></span>
<span class=normal><a href=#__codelineno-0-338> 338</a></span>
<span class=normal><a href=#__codelineno-0-339> 339</a></span>
<span class=normal><a href=#__codelineno-0-340> 340</a></span>
<span class=normal><a href=#__codelineno-0-341> 341</a></span>
<span class=normal><a href=#__codelineno-0-342> 342</a></span>
<span class=normal><a href=#__codelineno-0-343> 343</a></span>
<span class=normal><a href=#__codelineno-0-344> 344</a></span>
<span class=normal><a href=#__codelineno-0-345> 345</a></span>
<span class=normal><a href=#__codelineno-0-346> 346</a></span>
<span class=normal><a href=#__codelineno-0-347> 347</a></span>
<span class=normal><a href=#__codelineno-0-348> 348</a></span>
<span class=normal><a href=#__codelineno-0-349> 349</a></span>
<span class=normal><a href=#__codelineno-0-350> 350</a></span>
<span class=normal><a href=#__codelineno-0-351> 351</a></span>
<span class=normal><a href=#__codelineno-0-352> 352</a></span>
<span class=normal><a href=#__codelineno-0-353> 353</a></span>
<span class=normal><a href=#__codelineno-0-354> 354</a></span>
<span class=normal><a href=#__codelineno-0-355> 355</a></span>
<span class=normal><a href=#__codelineno-0-356> 356</a></span>
<span class=normal><a href=#__codelineno-0-357> 357</a></span>
<span class=normal><a href=#__codelineno-0-358> 358</a></span>
<span class=normal><a href=#__codelineno-0-359> 359</a></span>
<span class=normal><a href=#__codelineno-0-360> 360</a></span>
<span class=normal><a href=#__codelineno-0-361> 361</a></span>
<span class=normal><a href=#__codelineno-0-362> 362</a></span>
<span class=normal><a href=#__codelineno-0-363> 363</a></span>
<span class=normal><a href=#__codelineno-0-364> 364</a></span>
<span class=normal><a href=#__codelineno-0-365> 365</a></span>
<span class=normal><a href=#__codelineno-0-366> 366</a></span>
<span class=normal><a href=#__codelineno-0-367> 367</a></span>
<span class=normal><a href=#__codelineno-0-368> 368</a></span>
<span class=normal><a href=#__codelineno-0-369> 369</a></span>
<span class=normal><a href=#__codelineno-0-370> 370</a></span>
<span class=normal><a href=#__codelineno-0-371> 371</a></span>
<span class=normal><a href=#__codelineno-0-372> 372</a></span>
<span class=normal><a href=#__codelineno-0-373> 373</a></span>
<span class=normal><a href=#__codelineno-0-374> 374</a></span>
<span class=normal><a href=#__codelineno-0-375> 375</a></span>
<span class=normal><a href=#__codelineno-0-376> 376</a></span>
<span class=normal><a href=#__codelineno-0-377> 377</a></span>
<span class=normal><a href=#__codelineno-0-378> 378</a></span>
<span class=normal><a href=#__codelineno-0-379> 379</a></span>
<span class=normal><a href=#__codelineno-0-380> 380</a></span>
<span class=normal><a href=#__codelineno-0-381> 381</a></span>
<span class=normal><a href=#__codelineno-0-382> 382</a></span>
<span class=normal><a href=#__codelineno-0-383> 383</a></span>
<span class=normal><a href=#__codelineno-0-384> 384</a></span>
<span class=normal><a href=#__codelineno-0-385> 385</a></span>
<span class=normal><a href=#__codelineno-0-386> 386</a></span>
<span class=normal><a href=#__codelineno-0-387> 387</a></span>
<span class=normal><a href=#__codelineno-0-388> 388</a></span>
<span class=normal><a href=#__codelineno-0-389> 389</a></span>
<span class=normal><a href=#__codelineno-0-390> 390</a></span>
<span class=normal><a href=#__codelineno-0-391> 391</a></span>
<span class=normal><a href=#__codelineno-0-392> 392</a></span>
<span class=normal><a href=#__codelineno-0-393> 393</a></span>
<span class=normal><a href=#__codelineno-0-394> 394</a></span>
<span class=normal><a href=#__codelineno-0-395> 395</a></span>
<span class=normal><a href=#__codelineno-0-396> 396</a></span>
<span class=normal><a href=#__codelineno-0-397> 397</a></span>
<span class=normal><a href=#__codelineno-0-398> 398</a></span>
<span class=normal><a href=#__codelineno-0-399> 399</a></span>
<span class=normal><a href=#__codelineno-0-400> 400</a></span>
<span class=normal><a href=#__codelineno-0-401> 401</a></span>
<span class=normal><a href=#__codelineno-0-402> 402</a></span>
<span class=normal><a href=#__codelineno-0-403> 403</a></span>
<span class=normal><a href=#__codelineno-0-404> 404</a></span>
<span class=normal><a href=#__codelineno-0-405> 405</a></span>
<span class=normal><a href=#__codelineno-0-406> 406</a></span>
<span class=normal><a href=#__codelineno-0-407> 407</a></span>
<span class=normal><a href=#__codelineno-0-408> 408</a></span>
<span class=normal><a href=#__codelineno-0-409> 409</a></span>
<span class=normal><a href=#__codelineno-0-410> 410</a></span>
<span class=normal><a href=#__codelineno-0-411> 411</a></span>
<span class=normal><a href=#__codelineno-0-412> 412</a></span>
<span class=normal><a href=#__codelineno-0-413> 413</a></span>
<span class=normal><a href=#__codelineno-0-414> 414</a></span>
<span class=normal><a href=#__codelineno-0-415> 415</a></span>
<span class=normal><a href=#__codelineno-0-416> 416</a></span>
<span class=normal><a href=#__codelineno-0-417> 417</a></span>
<span class=normal><a href=#__codelineno-0-418> 418</a></span>
<span class=normal><a href=#__codelineno-0-419> 419</a></span>
<span class=normal><a href=#__codelineno-0-420> 420</a></span>
<span class=normal><a href=#__codelineno-0-421> 421</a></span>
<span class=normal><a href=#__codelineno-0-422> 422</a></span>
<span class=normal><a href=#__codelineno-0-423> 423</a></span>
<span class=normal><a href=#__codelineno-0-424> 424</a></span>
<span class=normal><a href=#__codelineno-0-425> 425</a></span>
<span class=normal><a href=#__codelineno-0-426> 426</a></span>
<span class=normal><a href=#__codelineno-0-427> 427</a></span>
<span class=normal><a href=#__codelineno-0-428> 428</a></span>
<span class=normal><a href=#__codelineno-0-429> 429</a></span>
<span class=normal><a href=#__codelineno-0-430> 430</a></span>
<span class=normal><a href=#__codelineno-0-431> 431</a></span>
<span class=normal><a href=#__codelineno-0-432> 432</a></span>
<span class=normal><a href=#__codelineno-0-433> 433</a></span>
<span class=normal><a href=#__codelineno-0-434> 434</a></span>
<span class=normal><a href=#__codelineno-0-435> 435</a></span>
<span class=normal><a href=#__codelineno-0-436> 436</a></span>
<span class=normal><a href=#__codelineno-0-437> 437</a></span>
<span class=normal><a href=#__codelineno-0-438> 438</a></span>
<span class=normal><a href=#__codelineno-0-439> 439</a></span>
<span class=normal><a href=#__codelineno-0-440> 440</a></span>
<span class=normal><a href=#__codelineno-0-441> 441</a></span>
<span class=normal><a href=#__codelineno-0-442> 442</a></span>
<span class=normal><a href=#__codelineno-0-443> 443</a></span>
<span class=normal><a href=#__codelineno-0-444> 444</a></span>
<span class=normal><a href=#__codelineno-0-445> 445</a></span>
<span class=normal><a href=#__codelineno-0-446> 446</a></span>
<span class=normal><a href=#__codelineno-0-447> 447</a></span>
<span class=normal><a href=#__codelineno-0-448> 448</a></span>
<span class=normal><a href=#__codelineno-0-449> 449</a></span>
<span class=normal><a href=#__codelineno-0-450> 450</a></span>
<span class=normal><a href=#__codelineno-0-451> 451</a></span>
<span class=normal><a href=#__codelineno-0-452> 452</a></span>
<span class=normal><a href=#__codelineno-0-453> 453</a></span>
<span class=normal><a href=#__codelineno-0-454> 454</a></span>
<span class=normal><a href=#__codelineno-0-455> 455</a></span>
<span class=normal><a href=#__codelineno-0-456> 456</a></span>
<span class=normal><a href=#__codelineno-0-457> 457</a></span>
<span class=normal><a href=#__codelineno-0-458> 458</a></span>
<span class=normal><a href=#__codelineno-0-459> 459</a></span>
<span class=normal><a href=#__codelineno-0-460> 460</a></span>
<span class=normal><a href=#__codelineno-0-461> 461</a></span>
<span class=normal><a href=#__codelineno-0-462> 462</a></span>
<span class=normal><a href=#__codelineno-0-463> 463</a></span>
<span class=normal><a href=#__codelineno-0-464> 464</a></span>
<span class=normal><a href=#__codelineno-0-465> 465</a></span>
<span class=normal><a href=#__codelineno-0-466> 466</a></span>
<span class=normal><a href=#__codelineno-0-467> 467</a></span>
<span class=normal><a href=#__codelineno-0-468> 468</a></span>
<span class=normal><a href=#__codelineno-0-469> 469</a></span>
<span class=normal><a href=#__codelineno-0-470> 470</a></span>
<span class=normal><a href=#__codelineno-0-471> 471</a></span>
<span class=normal><a href=#__codelineno-0-472> 472</a></span>
<span class=normal><a href=#__codelineno-0-473> 473</a></span>
<span class=normal><a href=#__codelineno-0-474> 474</a></span>
<span class=normal><a href=#__codelineno-0-475> 475</a></span>
<span class=normal><a href=#__codelineno-0-476> 476</a></span>
<span class=normal><a href=#__codelineno-0-477> 477</a></span>
<span class=normal><a href=#__codelineno-0-478> 478</a></span>
<span class=normal><a href=#__codelineno-0-479> 479</a></span>
<span class=normal><a href=#__codelineno-0-480> 480</a></span>
<span class=normal><a href=#__codelineno-0-481> 481</a></span>
<span class=normal><a href=#__codelineno-0-482> 482</a></span>
<span class=normal><a href=#__codelineno-0-483> 483</a></span>
<span class=normal><a href=#__codelineno-0-484> 484</a></span>
<span class=normal><a href=#__codelineno-0-485> 485</a></span>
<span class=normal><a href=#__codelineno-0-486> 486</a></span>
<span class=normal><a href=#__codelineno-0-487> 487</a></span>
<span class=normal><a href=#__codelineno-0-488> 488</a></span>
<span class=normal><a href=#__codelineno-0-489> 489</a></span>
<span class=normal><a href=#__codelineno-0-490> 490</a></span>
<span class=normal><a href=#__codelineno-0-491> 491</a></span>
<span class=normal><a href=#__codelineno-0-492> 492</a></span>
<span class=normal><a href=#__codelineno-0-493> 493</a></span>
<span class=normal><a href=#__codelineno-0-494> 494</a></span>
<span class=normal><a href=#__codelineno-0-495> 495</a></span>
<span class=normal><a href=#__codelineno-0-496> 496</a></span>
<span class=normal><a href=#__codelineno-0-497> 497</a></span>
<span class=normal><a href=#__codelineno-0-498> 498</a></span>
<span class=normal><a href=#__codelineno-0-499> 499</a></span>
<span class=normal><a href=#__codelineno-0-500> 500</a></span>
<span class=normal><a href=#__codelineno-0-501> 501</a></span>
<span class=normal><a href=#__codelineno-0-502> 502</a></span>
<span class=normal><a href=#__codelineno-0-503> 503</a></span>
<span class=normal><a href=#__codelineno-0-504> 504</a></span>
<span class=normal><a href=#__codelineno-0-505> 505</a></span>
<span class=normal><a href=#__codelineno-0-506> 506</a></span>
<span class=normal><a href=#__codelineno-0-507> 507</a></span>
<span class=normal><a href=#__codelineno-0-508> 508</a></span>
<span class=normal><a href=#__codelineno-0-509> 509</a></span>
<span class=normal><a href=#__codelineno-0-510> 510</a></span>
<span class=normal><a href=#__codelineno-0-511> 511</a></span>
<span class=normal><a href=#__codelineno-0-512> 512</a></span>
<span class=normal><a href=#__codelineno-0-513> 513</a></span>
<span class=normal><a href=#__codelineno-0-514> 514</a></span>
<span class=normal><a href=#__codelineno-0-515> 515</a></span>
<span class=normal><a href=#__codelineno-0-516> 516</a></span>
<span class=normal><a href=#__codelineno-0-517> 517</a></span>
<span class=normal><a href=#__codelineno-0-518> 518</a></span>
<span class=normal><a href=#__codelineno-0-519> 519</a></span>
<span class=normal><a href=#__codelineno-0-520> 520</a></span>
<span class=normal><a href=#__codelineno-0-521> 521</a></span>
<span class=normal><a href=#__codelineno-0-522> 522</a></span>
<span class=normal><a href=#__codelineno-0-523> 523</a></span>
<span class=normal><a href=#__codelineno-0-524> 524</a></span>
<span class=normal><a href=#__codelineno-0-525> 525</a></span>
<span class=normal><a href=#__codelineno-0-526> 526</a></span>
<span class=normal><a href=#__codelineno-0-527> 527</a></span>
<span class=normal><a href=#__codelineno-0-528> 528</a></span>
<span class=normal><a href=#__codelineno-0-529> 529</a></span>
<span class=normal><a href=#__codelineno-0-530> 530</a></span>
<span class=normal><a href=#__codelineno-0-531> 531</a></span>
<span class=normal><a href=#__codelineno-0-532> 532</a></span>
<span class=normal><a href=#__codelineno-0-533> 533</a></span>
<span class=normal><a href=#__codelineno-0-534> 534</a></span>
<span class=normal><a href=#__codelineno-0-535> 535</a></span>
<span class=normal><a href=#__codelineno-0-536> 536</a></span>
<span class=normal><a href=#__codelineno-0-537> 537</a></span>
<span class=normal><a href=#__codelineno-0-538> 538</a></span>
<span class=normal><a href=#__codelineno-0-539> 539</a></span>
<span class=normal><a href=#__codelineno-0-540> 540</a></span>
<span class=normal><a href=#__codelineno-0-541> 541</a></span>
<span class=normal><a href=#__codelineno-0-542> 542</a></span>
<span class=normal><a href=#__codelineno-0-543> 543</a></span>
<span class=normal><a href=#__codelineno-0-544> 544</a></span>
<span class=normal><a href=#__codelineno-0-545> 545</a></span>
<span class=normal><a href=#__codelineno-0-546> 546</a></span>
<span class=normal><a href=#__codelineno-0-547> 547</a></span>
<span class=normal><a href=#__codelineno-0-548> 548</a></span>
<span class=normal><a href=#__codelineno-0-549> 549</a></span>
<span class=normal><a href=#__codelineno-0-550> 550</a></span>
<span class=normal><a href=#__codelineno-0-551> 551</a></span>
<span class=normal><a href=#__codelineno-0-552> 552</a></span>
<span class=normal><a href=#__codelineno-0-553> 553</a></span>
<span class=normal><a href=#__codelineno-0-554> 554</a></span>
<span class=normal><a href=#__codelineno-0-555> 555</a></span>
<span class=normal><a href=#__codelineno-0-556> 556</a></span>
<span class=normal><a href=#__codelineno-0-557> 557</a></span>
<span class=normal><a href=#__codelineno-0-558> 558</a></span>
<span class=normal><a href=#__codelineno-0-559> 559</a></span>
<span class=normal><a href=#__codelineno-0-560> 560</a></span>
<span class=normal><a href=#__codelineno-0-561> 561</a></span>
<span class=normal><a href=#__codelineno-0-562> 562</a></span>
<span class=normal><a href=#__codelineno-0-563> 563</a></span>
<span class=normal><a href=#__codelineno-0-564> 564</a></span>
<span class=normal><a href=#__codelineno-0-565> 565</a></span>
<span class=normal><a href=#__codelineno-0-566> 566</a></span>
<span class=normal><a href=#__codelineno-0-567> 567</a></span>
<span class=normal><a href=#__codelineno-0-568> 568</a></span>
<span class=normal><a href=#__codelineno-0-569> 569</a></span>
<span class=normal><a href=#__codelineno-0-570> 570</a></span>
<span class=normal><a href=#__codelineno-0-571> 571</a></span>
<span class=normal><a href=#__codelineno-0-572> 572</a></span>
<span class=normal><a href=#__codelineno-0-573> 573</a></span>
<span class=normal><a href=#__codelineno-0-574> 574</a></span>
<span class=normal><a href=#__codelineno-0-575> 575</a></span>
<span class=normal><a href=#__codelineno-0-576> 576</a></span>
<span class=normal><a href=#__codelineno-0-577> 577</a></span>
<span class=normal><a href=#__codelineno-0-578> 578</a></span>
<span class=normal><a href=#__codelineno-0-579> 579</a></span>
<span class=normal><a href=#__codelineno-0-580> 580</a></span>
<span class=normal><a href=#__codelineno-0-581> 581</a></span>
<span class=normal><a href=#__codelineno-0-582> 582</a></span>
<span class=normal><a href=#__codelineno-0-583> 583</a></span>
<span class=normal><a href=#__codelineno-0-584> 584</a></span>
<span class=normal><a href=#__codelineno-0-585> 585</a></span>
<span class=normal><a href=#__codelineno-0-586> 586</a></span>
<span class=normal><a href=#__codelineno-0-587> 587</a></span>
<span class=normal><a href=#__codelineno-0-588> 588</a></span>
<span class=normal><a href=#__codelineno-0-589> 589</a></span>
<span class=normal><a href=#__codelineno-0-590> 590</a></span>
<span class=normal><a href=#__codelineno-0-591> 591</a></span>
<span class=normal><a href=#__codelineno-0-592> 592</a></span>
<span class=normal><a href=#__codelineno-0-593> 593</a></span>
<span class=normal><a href=#__codelineno-0-594> 594</a></span>
<span class=normal><a href=#__codelineno-0-595> 595</a></span>
<span class=normal><a href=#__codelineno-0-596> 596</a></span>
<span class=normal><a href=#__codelineno-0-597> 597</a></span>
<span class=normal><a href=#__codelineno-0-598> 598</a></span>
<span class=normal><a href=#__codelineno-0-599> 599</a></span>
<span class=normal><a href=#__codelineno-0-600> 600</a></span>
<span class=normal><a href=#__codelineno-0-601> 601</a></span>
<span class=normal><a href=#__codelineno-0-602> 602</a></span>
<span class=normal><a href=#__codelineno-0-603> 603</a></span>
<span class=normal><a href=#__codelineno-0-604> 604</a></span>
<span class=normal><a href=#__codelineno-0-605> 605</a></span>
<span class=normal><a href=#__codelineno-0-606> 606</a></span>
<span class=normal><a href=#__codelineno-0-607> 607</a></span>
<span class=normal><a href=#__codelineno-0-608> 608</a></span>
<span class=normal><a href=#__codelineno-0-609> 609</a></span>
<span class=normal><a href=#__codelineno-0-610> 610</a></span>
<span class=normal><a href=#__codelineno-0-611> 611</a></span>
<span class=normal><a href=#__codelineno-0-612> 612</a></span>
<span class=normal><a href=#__codelineno-0-613> 613</a></span>
<span class=normal><a href=#__codelineno-0-614> 614</a></span>
<span class=normal><a href=#__codelineno-0-615> 615</a></span>
<span class=normal><a href=#__codelineno-0-616> 616</a></span>
<span class=normal><a href=#__codelineno-0-617> 617</a></span>
<span class=normal><a href=#__codelineno-0-618> 618</a></span>
<span class=normal><a href=#__codelineno-0-619> 619</a></span>
<span class=normal><a href=#__codelineno-0-620> 620</a></span>
<span class=normal><a href=#__codelineno-0-621> 621</a></span>
<span class=normal><a href=#__codelineno-0-622> 622</a></span>
<span class=normal><a href=#__codelineno-0-623> 623</a></span>
<span class=normal><a href=#__codelineno-0-624> 624</a></span>
<span class=normal><a href=#__codelineno-0-625> 625</a></span>
<span class=normal><a href=#__codelineno-0-626> 626</a></span>
<span class=normal><a href=#__codelineno-0-627> 627</a></span>
<span class=normal><a href=#__codelineno-0-628> 628</a></span>
<span class=normal><a href=#__codelineno-0-629> 629</a></span>
<span class=normal><a href=#__codelineno-0-630> 630</a></span>
<span class=normal><a href=#__codelineno-0-631> 631</a></span>
<span class=normal><a href=#__codelineno-0-632> 632</a></span>
<span class=normal><a href=#__codelineno-0-633> 633</a></span>
<span class=normal><a href=#__codelineno-0-634> 634</a></span>
<span class=normal><a href=#__codelineno-0-635> 635</a></span>
<span class=normal><a href=#__codelineno-0-636> 636</a></span>
<span class=normal><a href=#__codelineno-0-637> 637</a></span>
<span class=normal><a href=#__codelineno-0-638> 638</a></span>
<span class=normal><a href=#__codelineno-0-639> 639</a></span>
<span class=normal><a href=#__codelineno-0-640> 640</a></span>
<span class=normal><a href=#__codelineno-0-641> 641</a></span>
<span class=normal><a href=#__codelineno-0-642> 642</a></span>
<span class=normal><a href=#__codelineno-0-643> 643</a></span>
<span class=normal><a href=#__codelineno-0-644> 644</a></span>
<span class=normal><a href=#__codelineno-0-645> 645</a></span>
<span class=normal><a href=#__codelineno-0-646> 646</a></span>
<span class=normal><a href=#__codelineno-0-647> 647</a></span>
<span class=normal><a href=#__codelineno-0-648> 648</a></span>
<span class=normal><a href=#__codelineno-0-649> 649</a></span>
<span class=normal><a href=#__codelineno-0-650> 650</a></span>
<span class=normal><a href=#__codelineno-0-651> 651</a></span>
<span class=normal><a href=#__codelineno-0-652> 652</a></span>
<span class=normal><a href=#__codelineno-0-653> 653</a></span>
<span class=normal><a href=#__codelineno-0-654> 654</a></span>
<span class=normal><a href=#__codelineno-0-655> 655</a></span>
<span class=normal><a href=#__codelineno-0-656> 656</a></span>
<span class=normal><a href=#__codelineno-0-657> 657</a></span>
<span class=normal><a href=#__codelineno-0-658> 658</a></span>
<span class=normal><a href=#__codelineno-0-659> 659</a></span>
<span class=normal><a href=#__codelineno-0-660> 660</a></span>
<span class=normal><a href=#__codelineno-0-661> 661</a></span>
<span class=normal><a href=#__codelineno-0-662> 662</a></span>
<span class=normal><a href=#__codelineno-0-663> 663</a></span>
<span class=normal><a href=#__codelineno-0-664> 664</a></span>
<span class=normal><a href=#__codelineno-0-665> 665</a></span>
<span class=normal><a href=#__codelineno-0-666> 666</a></span>
<span class=normal><a href=#__codelineno-0-667> 667</a></span>
<span class=normal><a href=#__codelineno-0-668> 668</a></span>
<span class=normal><a href=#__codelineno-0-669> 669</a></span>
<span class=normal><a href=#__codelineno-0-670> 670</a></span>
<span class=normal><a href=#__codelineno-0-671> 671</a></span>
<span class=normal><a href=#__codelineno-0-672> 672</a></span>
<span class=normal><a href=#__codelineno-0-673> 673</a></span>
<span class=normal><a href=#__codelineno-0-674> 674</a></span>
<span class=normal><a href=#__codelineno-0-675> 675</a></span>
<span class=normal><a href=#__codelineno-0-676> 676</a></span>
<span class=normal><a href=#__codelineno-0-677> 677</a></span>
<span class=normal><a href=#__codelineno-0-678> 678</a></span>
<span class=normal><a href=#__codelineno-0-679> 679</a></span>
<span class=normal><a href=#__codelineno-0-680> 680</a></span>
<span class=normal><a href=#__codelineno-0-681> 681</a></span>
<span class=normal><a href=#__codelineno-0-682> 682</a></span>
<span class=normal><a href=#__codelineno-0-683> 683</a></span>
<span class=normal><a href=#__codelineno-0-684> 684</a></span>
<span class=normal><a href=#__codelineno-0-685> 685</a></span>
<span class=normal><a href=#__codelineno-0-686> 686</a></span>
<span class=normal><a href=#__codelineno-0-687> 687</a></span>
<span class=normal><a href=#__codelineno-0-688> 688</a></span>
<span class=normal><a href=#__codelineno-0-689> 689</a></span>
<span class=normal><a href=#__codelineno-0-690> 690</a></span>
<span class=normal><a href=#__codelineno-0-691> 691</a></span>
<span class=normal><a href=#__codelineno-0-692> 692</a></span>
<span class=normal><a href=#__codelineno-0-693> 693</a></span>
<span class=normal><a href=#__codelineno-0-694> 694</a></span>
<span class=normal><a href=#__codelineno-0-695> 695</a></span>
<span class=normal><a href=#__codelineno-0-696> 696</a></span>
<span class=normal><a href=#__codelineno-0-697> 697</a></span>
<span class=normal><a href=#__codelineno-0-698> 698</a></span>
<span class=normal><a href=#__codelineno-0-699> 699</a></span>
<span class=normal><a href=#__codelineno-0-700> 700</a></span>
<span class=normal><a href=#__codelineno-0-701> 701</a></span>
<span class=normal><a href=#__codelineno-0-702> 702</a></span>
<span class=normal><a href=#__codelineno-0-703> 703</a></span>
<span class=normal><a href=#__codelineno-0-704> 704</a></span>
<span class=normal><a href=#__codelineno-0-705> 705</a></span>
<span class=normal><a href=#__codelineno-0-706> 706</a></span>
<span class=normal><a href=#__codelineno-0-707> 707</a></span>
<span class=normal><a href=#__codelineno-0-708> 708</a></span>
<span class=normal><a href=#__codelineno-0-709> 709</a></span>
<span class=normal><a href=#__codelineno-0-710> 710</a></span>
<span class=normal><a href=#__codelineno-0-711> 711</a></span>
<span class=normal><a href=#__codelineno-0-712> 712</a></span>
<span class=normal><a href=#__codelineno-0-713> 713</a></span>
<span class=normal><a href=#__codelineno-0-714> 714</a></span>
<span class=normal><a href=#__codelineno-0-715> 715</a></span>
<span class=normal><a href=#__codelineno-0-716> 716</a></span>
<span class=normal><a href=#__codelineno-0-717> 717</a></span>
<span class=normal><a href=#__codelineno-0-718> 718</a></span>
<span class=normal><a href=#__codelineno-0-719> 719</a></span>
<span class=normal><a href=#__codelineno-0-720> 720</a></span>
<span class=normal><a href=#__codelineno-0-721> 721</a></span>
<span class=normal><a href=#__codelineno-0-722> 722</a></span>
<span class=normal><a href=#__codelineno-0-723> 723</a></span>
<span class=normal><a href=#__codelineno-0-724> 724</a></span>
<span class=normal><a href=#__codelineno-0-725> 725</a></span>
<span class=normal><a href=#__codelineno-0-726> 726</a></span>
<span class=normal><a href=#__codelineno-0-727> 727</a></span>
<span class=normal><a href=#__codelineno-0-728> 728</a></span>
<span class=normal><a href=#__codelineno-0-729> 729</a></span>
<span class=normal><a href=#__codelineno-0-730> 730</a></span>
<span class=normal><a href=#__codelineno-0-731> 731</a></span>
<span class=normal><a href=#__codelineno-0-732> 732</a></span>
<span class=normal><a href=#__codelineno-0-733> 733</a></span>
<span class=normal><a href=#__codelineno-0-734> 734</a></span>
<span class=normal><a href=#__codelineno-0-735> 735</a></span>
<span class=normal><a href=#__codelineno-0-736> 736</a></span>
<span class=normal><a href=#__codelineno-0-737> 737</a></span>
<span class=normal><a href=#__codelineno-0-738> 738</a></span>
<span class=normal><a href=#__codelineno-0-739> 739</a></span>
<span class=normal><a href=#__codelineno-0-740> 740</a></span>
<span class=normal><a href=#__codelineno-0-741> 741</a></span>
<span class=normal><a href=#__codelineno-0-742> 742</a></span>
<span class=normal><a href=#__codelineno-0-743> 743</a></span>
<span class=normal><a href=#__codelineno-0-744> 744</a></span>
<span class=normal><a href=#__codelineno-0-745> 745</a></span>
<span class=normal><a href=#__codelineno-0-746> 746</a></span>
<span class=normal><a href=#__codelineno-0-747> 747</a></span>
<span class=normal><a href=#__codelineno-0-748> 748</a></span>
<span class=normal><a href=#__codelineno-0-749> 749</a></span>
<span class=normal><a href=#__codelineno-0-750> 750</a></span>
<span class=normal><a href=#__codelineno-0-751> 751</a></span>
<span class=normal><a href=#__codelineno-0-752> 752</a></span>
<span class=normal><a href=#__codelineno-0-753> 753</a></span>
<span class=normal><a href=#__codelineno-0-754> 754</a></span>
<span class=normal><a href=#__codelineno-0-755> 755</a></span>
<span class=normal><a href=#__codelineno-0-756> 756</a></span>
<span class=normal><a href=#__codelineno-0-757> 757</a></span>
<span class=normal><a href=#__codelineno-0-758> 758</a></span>
<span class=normal><a href=#__codelineno-0-759> 759</a></span>
<span class=normal><a href=#__codelineno-0-760> 760</a></span>
<span class=normal><a href=#__codelineno-0-761> 761</a></span>
<span class=normal><a href=#__codelineno-0-762> 762</a></span>
<span class=normal><a href=#__codelineno-0-763> 763</a></span>
<span class=normal><a href=#__codelineno-0-764> 764</a></span>
<span class=normal><a href=#__codelineno-0-765> 765</a></span>
<span class=normal><a href=#__codelineno-0-766> 766</a></span>
<span class=normal><a href=#__codelineno-0-767> 767</a></span>
<span class=normal><a href=#__codelineno-0-768> 768</a></span>
<span class=normal><a href=#__codelineno-0-769> 769</a></span>
<span class=normal><a href=#__codelineno-0-770> 770</a></span>
<span class=normal><a href=#__codelineno-0-771> 771</a></span>
<span class=normal><a href=#__codelineno-0-772> 772</a></span>
<span class=normal><a href=#__codelineno-0-773> 773</a></span>
<span class=normal><a href=#__codelineno-0-774> 774</a></span>
<span class=normal><a href=#__codelineno-0-775> 775</a></span>
<span class=normal><a href=#__codelineno-0-776> 776</a></span>
<span class=normal><a href=#__codelineno-0-777> 777</a></span>
<span class=normal><a href=#__codelineno-0-778> 778</a></span>
<span class=normal><a href=#__codelineno-0-779> 779</a></span>
<span class=normal><a href=#__codelineno-0-780> 780</a></span>
<span class=normal><a href=#__codelineno-0-781> 781</a></span>
<span class=normal><a href=#__codelineno-0-782> 782</a></span>
<span class=normal><a href=#__codelineno-0-783> 783</a></span>
<span class=normal><a href=#__codelineno-0-784> 784</a></span>
<span class=normal><a href=#__codelineno-0-785> 785</a></span>
<span class=normal><a href=#__codelineno-0-786> 786</a></span>
<span class=normal><a href=#__codelineno-0-787> 787</a></span>
<span class=normal><a href=#__codelineno-0-788> 788</a></span>
<span class=normal><a href=#__codelineno-0-789> 789</a></span>
<span class=normal><a href=#__codelineno-0-790> 790</a></span>
<span class=normal><a href=#__codelineno-0-791> 791</a></span>
<span class=normal><a href=#__codelineno-0-792> 792</a></span>
<span class=normal><a href=#__codelineno-0-793> 793</a></span>
<span class=normal><a href=#__codelineno-0-794> 794</a></span>
<span class=normal><a href=#__codelineno-0-795> 795</a></span>
<span class=normal><a href=#__codelineno-0-796> 796</a></span>
<span class=normal><a href=#__codelineno-0-797> 797</a></span>
<span class=normal><a href=#__codelineno-0-798> 798</a></span>
<span class=normal><a href=#__codelineno-0-799> 799</a></span>
<span class=normal><a href=#__codelineno-0-800> 800</a></span>
<span class=normal><a href=#__codelineno-0-801> 801</a></span>
<span class=normal><a href=#__codelineno-0-802> 802</a></span>
<span class=normal><a href=#__codelineno-0-803> 803</a></span>
<span class=normal><a href=#__codelineno-0-804> 804</a></span>
<span class=normal><a href=#__codelineno-0-805> 805</a></span>
<span class=normal><a href=#__codelineno-0-806> 806</a></span>
<span class=normal><a href=#__codelineno-0-807> 807</a></span>
<span class=normal><a href=#__codelineno-0-808> 808</a></span>
<span class=normal><a href=#__codelineno-0-809> 809</a></span>
<span class=normal><a href=#__codelineno-0-810> 810</a></span>
<span class=normal><a href=#__codelineno-0-811> 811</a></span>
<span class=normal><a href=#__codelineno-0-812> 812</a></span>
<span class=normal><a href=#__codelineno-0-813> 813</a></span>
<span class=normal><a href=#__codelineno-0-814> 814</a></span>
<span class=normal><a href=#__codelineno-0-815> 815</a></span>
<span class=normal><a href=#__codelineno-0-816> 816</a></span>
<span class=normal><a href=#__codelineno-0-817> 817</a></span>
<span class=normal><a href=#__codelineno-0-818> 818</a></span>
<span class=normal><a href=#__codelineno-0-819> 819</a></span>
<span class=normal><a href=#__codelineno-0-820> 820</a></span>
<span class=normal><a href=#__codelineno-0-821> 821</a></span>
<span class=normal><a href=#__codelineno-0-822> 822</a></span>
<span class=normal><a href=#__codelineno-0-823> 823</a></span>
<span class=normal><a href=#__codelineno-0-824> 824</a></span>
<span class=normal><a href=#__codelineno-0-825> 825</a></span>
<span class=normal><a href=#__codelineno-0-826> 826</a></span>
<span class=normal><a href=#__codelineno-0-827> 827</a></span>
<span class=normal><a href=#__codelineno-0-828> 828</a></span>
<span class=normal><a href=#__codelineno-0-829> 829</a></span>
<span class=normal><a href=#__codelineno-0-830> 830</a></span>
<span class=normal><a href=#__codelineno-0-831> 831</a></span>
<span class=normal><a href=#__codelineno-0-832> 832</a></span>
<span class=normal><a href=#__codelineno-0-833> 833</a></span>
<span class=normal><a href=#__codelineno-0-834> 834</a></span>
<span class=normal><a href=#__codelineno-0-835> 835</a></span>
<span class=normal><a href=#__codelineno-0-836> 836</a></span>
<span class=normal><a href=#__codelineno-0-837> 837</a></span>
<span class=normal><a href=#__codelineno-0-838> 838</a></span>
<span class=normal><a href=#__codelineno-0-839> 839</a></span>
<span class=normal><a href=#__codelineno-0-840> 840</a></span>
<span class=normal><a href=#__codelineno-0-841> 841</a></span>
<span class=normal><a href=#__codelineno-0-842> 842</a></span>
<span class=normal><a href=#__codelineno-0-843> 843</a></span>
<span class=normal><a href=#__codelineno-0-844> 844</a></span>
<span class=normal><a href=#__codelineno-0-845> 845</a></span>
<span class=normal><a href=#__codelineno-0-846> 846</a></span>
<span class=normal><a href=#__codelineno-0-847> 847</a></span>
<span class=normal><a href=#__codelineno-0-848> 848</a></span>
<span class=normal><a href=#__codelineno-0-849> 849</a></span>
<span class=normal><a href=#__codelineno-0-850> 850</a></span>
<span class=normal><a href=#__codelineno-0-851> 851</a></span>
<span class=normal><a href=#__codelineno-0-852> 852</a></span>
<span class=normal><a href=#__codelineno-0-853> 853</a></span>
<span class=normal><a href=#__codelineno-0-854> 854</a></span>
<span class=normal><a href=#__codelineno-0-855> 855</a></span>
<span class=normal><a href=#__codelineno-0-856> 856</a></span>
<span class=normal><a href=#__codelineno-0-857> 857</a></span>
<span class=normal><a href=#__codelineno-0-858> 858</a></span>
<span class=normal><a href=#__codelineno-0-859> 859</a></span>
<span class=normal><a href=#__codelineno-0-860> 860</a></span>
<span class=normal><a href=#__codelineno-0-861> 861</a></span>
<span class=normal><a href=#__codelineno-0-862> 862</a></span>
<span class=normal><a href=#__codelineno-0-863> 863</a></span>
<span class=normal><a href=#__codelineno-0-864> 864</a></span>
<span class=normal><a href=#__codelineno-0-865> 865</a></span>
<span class=normal><a href=#__codelineno-0-866> 866</a></span>
<span class=normal><a href=#__codelineno-0-867> 867</a></span>
<span class=normal><a href=#__codelineno-0-868> 868</a></span>
<span class=normal><a href=#__codelineno-0-869> 869</a></span>
<span class=normal><a href=#__codelineno-0-870> 870</a></span>
<span class=normal><a href=#__codelineno-0-871> 871</a></span>
<span class=normal><a href=#__codelineno-0-872> 872</a></span>
<span class=normal><a href=#__codelineno-0-873> 873</a></span>
<span class=normal><a href=#__codelineno-0-874> 874</a></span>
<span class=normal><a href=#__codelineno-0-875> 875</a></span>
<span class=normal><a href=#__codelineno-0-876> 876</a></span>
<span class=normal><a href=#__codelineno-0-877> 877</a></span>
<span class=normal><a href=#__codelineno-0-878> 878</a></span>
<span class=normal><a href=#__codelineno-0-879> 879</a></span>
<span class=normal><a href=#__codelineno-0-880> 880</a></span>
<span class=normal><a href=#__codelineno-0-881> 881</a></span>
<span class=normal><a href=#__codelineno-0-882> 882</a></span>
<span class=normal><a href=#__codelineno-0-883> 883</a></span>
<span class=normal><a href=#__codelineno-0-884> 884</a></span>
<span class=normal><a href=#__codelineno-0-885> 885</a></span>
<span class=normal><a href=#__codelineno-0-886> 886</a></span>
<span class=normal><a href=#__codelineno-0-887> 887</a></span>
<span class=normal><a href=#__codelineno-0-888> 888</a></span>
<span class=normal><a href=#__codelineno-0-889> 889</a></span>
<span class=normal><a href=#__codelineno-0-890> 890</a></span>
<span class=normal><a href=#__codelineno-0-891> 891</a></span>
<span class=normal><a href=#__codelineno-0-892> 892</a></span>
<span class=normal><a href=#__codelineno-0-893> 893</a></span>
<span class=normal><a href=#__codelineno-0-894> 894</a></span>
<span class=normal><a href=#__codelineno-0-895> 895</a></span>
<span class=normal><a href=#__codelineno-0-896> 896</a></span>
<span class=normal><a href=#__codelineno-0-897> 897</a></span>
<span class=normal><a href=#__codelineno-0-898> 898</a></span>
<span class=normal><a href=#__codelineno-0-899> 899</a></span>
<span class=normal><a href=#__codelineno-0-900> 900</a></span>
<span class=normal><a href=#__codelineno-0-901> 901</a></span>
<span class=normal><a href=#__codelineno-0-902> 902</a></span>
<span class=normal><a href=#__codelineno-0-903> 903</a></span>
<span class=normal><a href=#__codelineno-0-904> 904</a></span>
<span class=normal><a href=#__codelineno-0-905> 905</a></span>
<span class=normal><a href=#__codelineno-0-906> 906</a></span>
<span class=normal><a href=#__codelineno-0-907> 907</a></span>
<span class=normal><a href=#__codelineno-0-908> 908</a></span>
<span class=normal><a href=#__codelineno-0-909> 909</a></span>
<span class=normal><a href=#__codelineno-0-910> 910</a></span>
<span class=normal><a href=#__codelineno-0-911> 911</a></span>
<span class=normal><a href=#__codelineno-0-912> 912</a></span>
<span class=normal><a href=#__codelineno-0-913> 913</a></span>
<span class=normal><a href=#__codelineno-0-914> 914</a></span>
<span class=normal><a href=#__codelineno-0-915> 915</a></span>
<span class=normal><a href=#__codelineno-0-916> 916</a></span>
<span class=normal><a href=#__codelineno-0-917> 917</a></span>
<span class=normal><a href=#__codelineno-0-918> 918</a></span>
<span class=normal><a href=#__codelineno-0-919> 919</a></span>
<span class=normal><a href=#__codelineno-0-920> 920</a></span>
<span class=normal><a href=#__codelineno-0-921> 921</a></span>
<span class=normal><a href=#__codelineno-0-922> 922</a></span>
<span class=normal><a href=#__codelineno-0-923> 923</a></span>
<span class=normal><a href=#__codelineno-0-924> 924</a></span>
<span class=normal><a href=#__codelineno-0-925> 925</a></span>
<span class=normal><a href=#__codelineno-0-926> 926</a></span>
<span class=normal><a href=#__codelineno-0-927> 927</a></span>
<span class=normal><a href=#__codelineno-0-928> 928</a></span>
<span class=normal><a href=#__codelineno-0-929> 929</a></span>
<span class=normal><a href=#__codelineno-0-930> 930</a></span>
<span class=normal><a href=#__codelineno-0-931> 931</a></span>
<span class=normal><a href=#__codelineno-0-932> 932</a></span>
<span class=normal><a href=#__codelineno-0-933> 933</a></span>
<span class=normal><a href=#__codelineno-0-934> 934</a></span>
<span class=normal><a href=#__codelineno-0-935> 935</a></span>
<span class=normal><a href=#__codelineno-0-936> 936</a></span>
<span class=normal><a href=#__codelineno-0-937> 937</a></span>
<span class=normal><a href=#__codelineno-0-938> 938</a></span>
<span class=normal><a href=#__codelineno-0-939> 939</a></span>
<span class=normal><a href=#__codelineno-0-940> 940</a></span>
<span class=normal><a href=#__codelineno-0-941> 941</a></span>
<span class=normal><a href=#__codelineno-0-942> 942</a></span>
<span class=normal><a href=#__codelineno-0-943> 943</a></span>
<span class=normal><a href=#__codelineno-0-944> 944</a></span>
<span class=normal><a href=#__codelineno-0-945> 945</a></span>
<span class=normal><a href=#__codelineno-0-946> 946</a></span>
<span class=normal><a href=#__codelineno-0-947> 947</a></span>
<span class=normal><a href=#__codelineno-0-948> 948</a></span>
<span class=normal><a href=#__codelineno-0-949> 949</a></span>
<span class=normal><a href=#__codelineno-0-950> 950</a></span>
<span class=normal><a href=#__codelineno-0-951> 951</a></span>
<span class=normal><a href=#__codelineno-0-952> 952</a></span>
<span class=normal><a href=#__codelineno-0-953> 953</a></span>
<span class=normal><a href=#__codelineno-0-954> 954</a></span>
<span class=normal><a href=#__codelineno-0-955> 955</a></span>
<span class=normal><a href=#__codelineno-0-956> 956</a></span>
<span class=normal><a href=#__codelineno-0-957> 957</a></span>
<span class=normal><a href=#__codelineno-0-958> 958</a></span>
<span class=normal><a href=#__codelineno-0-959> 959</a></span>
<span class=normal><a href=#__codelineno-0-960> 960</a></span>
<span class=normal><a href=#__codelineno-0-961> 961</a></span>
<span class=normal><a href=#__codelineno-0-962> 962</a></span>
<span class=normal><a href=#__codelineno-0-963> 963</a></span>
<span class=normal><a href=#__codelineno-0-964> 964</a></span>
<span class=normal><a href=#__codelineno-0-965> 965</a></span>
<span class=normal><a href=#__codelineno-0-966> 966</a></span>
<span class=normal><a href=#__codelineno-0-967> 967</a></span>
<span class=normal><a href=#__codelineno-0-968> 968</a></span>
<span class=normal><a href=#__codelineno-0-969> 969</a></span>
<span class=normal><a href=#__codelineno-0-970> 970</a></span>
<span class=normal><a href=#__codelineno-0-971> 971</a></span>
<span class=normal><a href=#__codelineno-0-972> 972</a></span>
<span class=normal><a href=#__codelineno-0-973> 973</a></span>
<span class=normal><a href=#__codelineno-0-974> 974</a></span>
<span class=normal><a href=#__codelineno-0-975> 975</a></span>
<span class=normal><a href=#__codelineno-0-976> 976</a></span>
<span class=normal><a href=#__codelineno-0-977> 977</a></span>
<span class=normal><a href=#__codelineno-0-978> 978</a></span>
<span class=normal><a href=#__codelineno-0-979> 979</a></span>
<span class=normal><a href=#__codelineno-0-980> 980</a></span>
<span class=normal><a href=#__codelineno-0-981> 981</a></span>
<span class=normal><a href=#__codelineno-0-982> 982</a></span>
<span class=normal><a href=#__codelineno-0-983> 983</a></span>
<span class=normal><a href=#__codelineno-0-984> 984</a></span>
<span class=normal><a href=#__codelineno-0-985> 985</a></span>
<span class=normal><a href=#__codelineno-0-986> 986</a></span>
<span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span>
<span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span>
<span class=normal><a href=#__codelineno-0-1175>1175</a></span>
<span class=normal><a href=#__codelineno-0-1176>1176</a></span>
<span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span>
<span class=normal><a href=#__codelineno-0-1190>1190</a></span>
<span class=normal><a href=#__codelineno-0-1191>1191</a></span>
<span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span>
<span class=normal><a href=#__codelineno-0-1194>1194</a></span>
<span class=normal><a href=#__codelineno-0-1195>1195</a></span>
<span class=normal><a href=#__codelineno-0-1196>1196</a></span>
<span class=normal><a href=#__codelineno-0-1197>1197</a></span>
<span class=normal><a href=#__codelineno-0-1198>1198</a></span>
<span class=normal><a href=#__codelineno-0-1199>1199</a></span>
<span class=normal><a href=#__codelineno-0-1200>1200</a></span>
<span class=normal><a href=#__codelineno-0-1201>1201</a></span>
<span class=normal><a href=#__codelineno-0-1202>1202</a></span>
<span class=normal><a href=#__codelineno-0-1203>1203</a></span>
<span class=normal><a href=#__codelineno-0-1204>1204</a></span>
<span class=normal><a href=#__codelineno-0-1205>1205</a></span>
<span class=normal><a href=#__codelineno-0-1206>1206</a></span>
<span class=normal><a href=#__codelineno-0-1207>1207</a></span>
<span class=normal><a href=#__codelineno-0-1208>1208</a></span>
<span class=normal><a href=#__codelineno-0-1209>1209</a></span>
<span class=normal><a href=#__codelineno-0-1210>1210</a></span>
<span class=normal><a href=#__codelineno-0-1211>1211</a></span>
<span class=normal><a href=#__codelineno-0-1212>1212</a></span>
<span class=normal><a href=#__codelineno-0-1213>1213</a></span>
<span class=normal><a href=#__codelineno-0-1214>1214</a></span>
<span class=normal><a href=#__codelineno-0-1215>1215</a></span>
<span class=normal><a href=#__codelineno-0-1216>1216</a></span>
<span class=normal><a href=#__codelineno-0-1217>1217</a></span>
<span class=normal><a href=#__codelineno-0-1218>1218</a></span>
<span class=normal><a href=#__codelineno-0-1219>1219</a></span>
<span class=normal><a href=#__codelineno-0-1220>1220</a></span>
<span class=normal><a href=#__codelineno-0-1221>1221</a></span>
<span class=normal><a href=#__codelineno-0-1222>1222</a></span>
<span class=normal><a href=#__codelineno-0-1223>1223</a></span>
<span class=normal><a href=#__codelineno-0-1224>1224</a></span>
<span class=normal><a href=#__codelineno-0-1225>1225</a></span>
<span class=normal><a href=#__codelineno-0-1226>1226</a></span>
<span class=normal><a href=#__codelineno-0-1227>1227</a></span>
<span class=normal><a href=#__codelineno-0-1228>1228</a></span>
<span class=normal><a href=#__codelineno-0-1229>1229</a></span>
<span class=normal><a href=#__codelineno-0-1230>1230</a></span>
<span class=normal><a href=#__codelineno-0-1231>1231</a></span>
<span class=normal><a href=#__codelineno-0-1232>1232</a></span>
<span class=normal><a href=#__codelineno-0-1233>1233</a></span>
<span class=normal><a href=#__codelineno-0-1234>1234</a></span>
<span class=normal><a href=#__codelineno-0-1235>1235</a></span>
<span class=normal><a href=#__codelineno-0-1236>1236</a></span>
<span class=normal><a href=#__codelineno-0-1237>1237</a></span>
<span class=normal><a href=#__codelineno-0-1238>1238</a></span>
<span class=normal><a href=#__codelineno-0-1239>1239</a></span>
<span class=normal><a href=#__codelineno-0-1240>1240</a></span>
<span class=normal><a href=#__codelineno-0-1241>1241</a></span>
<span class=normal><a href=#__codelineno-0-1242>1242</a></span>
<span class=normal><a href=#__codelineno-0-1243>1243</a></span>
<span class=normal><a href=#__codelineno-0-1244>1244</a></span>
<span class=normal><a href=#__codelineno-0-1245>1245</a></span>
<span class=normal><a href=#__codelineno-0-1246>1246</a></span>
<span class=normal><a href=#__codelineno-0-1247>1247</a></span>
<span class=normal><a href=#__codelineno-0-1248>1248</a></span>
<span class=normal><a href=#__codelineno-0-1249>1249</a></span>
<span class=normal><a href=#__codelineno-0-1250>1250</a></span>
<span class=normal><a href=#__codelineno-0-1251>1251</a></span>
<span class=normal><a href=#__codelineno-0-1252>1252</a></span>
<span class=normal><a href=#__codelineno-0-1253>1253</a></span>
<span class=normal><a href=#__codelineno-0-1254>1254</a></span>
<span class=normal><a href=#__codelineno-0-1255>1255</a></span>
<span class=normal><a href=#__codelineno-0-1256>1256</a></span>
<span class=normal><a href=#__codelineno-0-1257>1257</a></span>
<span class=normal><a href=#__codelineno-0-1258>1258</a></span>
<span class=normal><a href=#__codelineno-0-1259>1259</a></span>
<span class=normal><a href=#__codelineno-0-1260>1260</a></span>
<span class=normal><a href=#__codelineno-0-1261>1261</a></span>
<span class=normal><a href=#__codelineno-0-1262>1262</a></span>
<span class=normal><a href=#__codelineno-0-1263>1263</a></span>
<span class=normal><a href=#__codelineno-0-1264>1264</a></span>
<span class=normal><a href=#__codelineno-0-1265>1265</a></span>
<span class=normal><a href=#__codelineno-0-1266>1266</a></span>
<span class=normal><a href=#__codelineno-0-1267>1267</a></span>
<span class=normal><a href=#__codelineno-0-1268>1268</a></span>
<span class=normal><a href=#__codelineno-0-1269>1269</a></span>
<span class=normal><a href=#__codelineno-0-1270>1270</a></span>
<span class=normal><a href=#__codelineno-0-1271>1271</a></span>
<span class=normal><a href=#__codelineno-0-1272>1272</a></span>
<span class=normal><a href=#__codelineno-0-1273>1273</a></span>
<span class=normal><a href=#__codelineno-0-1274>1274</a></span>
<span class=normal><a href=#__codelineno-0-1275>1275</a></span>
<span class=normal><a href=#__codelineno-0-1276>1276</a></span>
<span class=normal><a href=#__codelineno-0-1277>1277</a></span>
<span class=normal><a href=#__codelineno-0-1278>1278</a></span>
<span class=normal><a href=#__codelineno-0-1279>1279</a></span>
<span class=normal><a href=#__codelineno-0-1280>1280</a></span>
<span class=normal><a href=#__codelineno-0-1281>1281</a></span>
<span class=normal><a href=#__codelineno-0-1282>1282</a></span>
<span class=normal><a href=#__codelineno-0-1283>1283</a></span>
<span class=normal><a href=#__codelineno-0-1284>1284</a></span>
<span class=normal><a href=#__codelineno-0-1285>1285</a></span>
<span class=normal><a href=#__codelineno-0-1286>1286</a></span>
<span class=normal><a href=#__codelineno-0-1287>1287</a></span>
<span class=normal><a href=#__codelineno-0-1288>1288</a></span>
<span class=normal><a href=#__codelineno-0-1289>1289</a></span>
<span class=normal><a href=#__codelineno-0-1290>1290</a></span>
<span class=normal><a href=#__codelineno-0-1291>1291</a></span>
<span class=normal><a href=#__codelineno-0-1292>1292</a></span>
<span class=normal><a href=#__codelineno-0-1293>1293</a></span>
<span class=normal><a href=#__codelineno-0-1294>1294</a></span>
<span class=normal><a href=#__codelineno-0-1295>1295</a></span>
<span class=normal><a href=#__codelineno-0-1296>1296</a></span>
<span class=normal><a href=#__codelineno-0-1297>1297</a></span>
<span class=normal><a href=#__codelineno-0-1298>1298</a></span>
<span class=normal><a href=#__codelineno-0-1299>1299</a></span>
<span class=normal><a href=#__codelineno-0-1300>1300</a></span>
<span class=normal><a href=#__codelineno-0-1301>1301</a></span>
<span class=normal><a href=#__codelineno-0-1302>1302</a></span>
<span class=normal><a href=#__codelineno-0-1303>1303</a></span>
<span class=normal><a href=#__codelineno-0-1304>1304</a></span>
<span class=normal><a href=#__codelineno-0-1305>1305</a></span>
<span class=normal><a href=#__codelineno-0-1306>1306</a></span>
<span class=normal><a href=#__codelineno-0-1307>1307</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-98 name=__codelineno-0-98></a><span class=k>class</span><span class=w> </span><span class=nc>ApiLinker</span><span class=p>:</span>
<a id=__codelineno-0-99 name=__codelineno-0-99></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=sd>    Main class for connecting, mapping and transferring data between APIs.</span>
<a id=__codelineno-0-101 name=__codelineno-0-101></a>
<a id=__codelineno-0-102 name=__codelineno-0-102></a><span class=sd>    This class orchestrates the entire process of:</span>
<a id=__codelineno-0-103 name=__codelineno-0-103></a><span class=sd>    1. Connecting to source and target APIs</span>
<a id=__codelineno-0-104 name=__codelineno-0-104></a><span class=sd>    2. Fetching data from the source</span>
<a id=__codelineno-0-105 name=__codelineno-0-105></a><span class=sd>    3. Mapping fields according to configuration</span>
<a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=sd>    4. Transforming data as needed</span>
<a id=__codelineno-0-107 name=__codelineno-0-107></a><span class=sd>    5. Sending data to the target</span>
<a id=__codelineno-0-108 name=__codelineno-0-108></a><span class=sd>    6. Scheduling recurring operations</span>
<a id=__codelineno-0-109 name=__codelineno-0-109></a>
<a id=__codelineno-0-110 name=__codelineno-0-110></a><span class=sd>    Args:</span>
<a id=__codelineno-0-111 name=__codelineno-0-111></a><span class=sd>        config_path: Path to YAML/JSON configuration file</span>
<a id=__codelineno-0-112 name=__codelineno-0-112></a><span class=sd>        source_config: Direct source configuration dictionary</span>
<a id=__codelineno-0-113 name=__codelineno-0-113></a><span class=sd>        target_config: Direct target configuration dictionary</span>
<a id=__codelineno-0-114 name=__codelineno-0-114></a><span class=sd>        mapping_config: Direct mapping configuration dictionary</span>
<a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=sd>        schedule_config: Direct scheduling configuration dictionary</span>
<a id=__codelineno-0-116 name=__codelineno-0-116></a><span class=sd>        log_level: Logging level (DEBUG, INFO, WARNING, ERROR)</span>
<a id=__codelineno-0-117 name=__codelineno-0-117></a><span class=sd>        log_file: Path to log file</span>
<a id=__codelineno-0-118 name=__codelineno-0-118></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-119 name=__codelineno-0-119></a>
<a id=__codelineno-0-120 name=__codelineno-0-120></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
<a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=n>config_path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-123 name=__codelineno-0-123></a>        <span class=n>source_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=n>target_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=n>mapping_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-126 name=__codelineno-0-126></a>        <span class=n>schedule_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=n>error_handling_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-128 name=__codelineno-0-128></a>        <span class=n>security_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=n>validation_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>observability_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=n>secret_manager_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=n>log_level</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;INFO&quot;</span><span class=p>,</span>
<a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=n>log_file</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-134 name=__codelineno-0-134></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=c1># Initialize logger</span>
<a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>setup_logger</span><span class=p>(</span><span class=n>log_level</span><span class=p>,</span> <span class=n>log_file</span><span class=p>)</span>
<a id=__codelineno-0-137 name=__codelineno-0-137></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Initializing ApiLinker&quot;</span><span class=p>)</span>
<a id=__codelineno-0-138 name=__codelineno-0-138></a>
<a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=c1># Initialize components</span>
<a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ApiConnector</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ApiConnector</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span> <span class=o>=</span> <span class=n>FieldMapper</span><span class=p>()</span>
<a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span> <span class=o>=</span> <span class=n>Scheduler</span><span class=p>()</span>
<a id=__codelineno-0-144 name=__codelineno-0-144></a>        <span class=bp>self</span><span class=o>.</span><span class=n>validation_config</span> <span class=o>=</span> <span class=n>validation_config</span> <span class=ow>or</span> <span class=p>{</span><span class=s2>&quot;strict_mode&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>}</span>
<a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span> <span class=o>=</span> <span class=n>ProvenanceRecorder</span><span class=p>()</span>
<a id=__codelineno-0-146 name=__codelineno-0-146></a>        <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span> <span class=o>=</span> <span class=n>InMemoryDeduplicator</span><span class=p>()</span>
<a id=__codelineno-0-147 name=__codelineno-0-147></a>        <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>StateStore</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-148 name=__codelineno-0-148></a>
<a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=c1># Initialize observability</span>
<a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_observability</span><span class=p>(</span><span class=n>observability_config</span><span class=p>)</span>
<a id=__codelineno-0-151 name=__codelineno-0-151></a>
<a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=c1># Initialize secret management</span>
<a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_secret_manager</span><span class=p>(</span><span class=n>secret_manager_config</span><span class=p>)</span>
<a id=__codelineno-0-154 name=__codelineno-0-154></a>
<a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=c1># Initialize security system</span>
<a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_security</span><span class=p>(</span><span class=n>security_config</span><span class=p>)</span>
<a id=__codelineno-0-157 name=__codelineno-0-157></a>
<a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=c1># Initialize auth manager and integrate with security</span>
<a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span> <span class=o>=</span> <span class=n>AuthManager</span><span class=p>()</span>
<a id=__codelineno-0-160 name=__codelineno-0-160></a>        <span class=n>integrate_security_with_auth_manager</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=p>)</span>
<a id=__codelineno-0-161 name=__codelineno-0-161></a>
<a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=c1># Initialize error handling system</span>
<a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dlq</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=n>create_error_handler</span><span class=p>()</span>
<a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=p>)</span>
<a id=__codelineno-0-166 name=__codelineno-0-166></a>
<a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=c1># Load configuration if provided</span>
<a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=k>if</span> <span class=n>config_path</span><span class=p>:</span>
<a id=__codelineno-0-169 name=__codelineno-0-169></a>            <span class=bp>self</span><span class=o>.</span><span class=n>load_config</span><span class=p>(</span><span class=n>config_path</span><span class=p>)</span>
<a id=__codelineno-0-170 name=__codelineno-0-170></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-171 name=__codelineno-0-171></a>            <span class=c1># Set up direct configurations if provided</span>
<a id=__codelineno-0-172 name=__codelineno-0-172></a>            <span class=k>if</span> <span class=n>source_config</span><span class=p>:</span>
<a id=__codelineno-0-173 name=__codelineno-0-173></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_source</span><span class=p>(</span><span class=o>**</span><span class=n>source_config</span><span class=p>)</span>
<a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=k>if</span> <span class=n>target_config</span><span class=p>:</span>
<a id=__codelineno-0-175 name=__codelineno-0-175></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_target</span><span class=p>(</span><span class=o>**</span><span class=n>target_config</span><span class=p>)</span>
<a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=k>if</span> <span class=n>mapping_config</span><span class=p>:</span>
<a id=__codelineno-0-177 name=__codelineno-0-177></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=o>**</span><span class=n>mapping_config</span><span class=p>)</span>
<a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=k>if</span> <span class=n>schedule_config</span><span class=p>:</span>
<a id=__codelineno-0-179 name=__codelineno-0-179></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_schedule</span><span class=p>(</span><span class=o>**</span><span class=n>schedule_config</span><span class=p>)</span>
<a id=__codelineno-0-180 name=__codelineno-0-180></a>            <span class=k>if</span> <span class=n>error_handling_config</span><span class=p>:</span>
<a id=__codelineno-0-181 name=__codelineno-0-181></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_configure_error_handling</span><span class=p>(</span><span class=n>error_handling_config</span><span class=p>)</span>
<a id=__codelineno-0-182 name=__codelineno-0-182></a>            <span class=k>if</span> <span class=n>security_config</span><span class=p>:</span>
<a id=__codelineno-0-183 name=__codelineno-0-183></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_configure_security</span><span class=p>(</span><span class=n>security_config</span><span class=p>)</span>
<a id=__codelineno-0-184 name=__codelineno-0-184></a>
<a id=__codelineno-0-185 name=__codelineno-0-185></a>    <span class=k>def</span><span class=w> </span><span class=nf>load_config</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-186 name=__codelineno-0-186></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-187 name=__codelineno-0-187></a><span class=sd>        Load configuration from a YAML or JSON file.</span>
<a id=__codelineno-0-188 name=__codelineno-0-188></a>
<a id=__codelineno-0-189 name=__codelineno-0-189></a><span class=sd>        Args:</span>
<a id=__codelineno-0-190 name=__codelineno-0-190></a><span class=sd>            config_path: Path to the configuration file</span>
<a id=__codelineno-0-191 name=__codelineno-0-191></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-192 name=__codelineno-0-192></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Loading configuration from </span><span class=si>{</span><span class=n>config_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-193 name=__codelineno-0-193></a>
<a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=c1># Resolve environment variables in config path</span>
<a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=n>config_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expandvars</span><span class=p>(</span><span class=n>config_path</span><span class=p>)</span>
<a id=__codelineno-0-196 name=__codelineno-0-196></a>
<a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>config_path</span><span class=p>):</span>
<a id=__codelineno-0-198 name=__codelineno-0-198></a>            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Configuration file not found: </span><span class=si>{</span><span class=n>config_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-199 name=__codelineno-0-199></a>
<a id=__codelineno-0-200 name=__codelineno-0-200></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>config_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-0-201 name=__codelineno-0-201></a>            <span class=n>config</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>.</span><span class=n>safe_load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
<a id=__codelineno-0-202 name=__codelineno-0-202></a>
<a id=__codelineno-0-203 name=__codelineno-0-203></a>        <span class=c1># Set up components from config</span>
<a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=k>if</span> <span class=s2>&quot;source&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-205 name=__codelineno-0-205></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_source</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>])</span>
<a id=__codelineno-0-206 name=__codelineno-0-206></a>
<a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=k>if</span> <span class=s2>&quot;target&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-208 name=__codelineno-0-208></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_target</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;target&quot;</span><span class=p>])</span>
<a id=__codelineno-0-209 name=__codelineno-0-209></a>
<a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=k>if</span> <span class=s2>&quot;mapping&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-211 name=__codelineno-0-211></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;mapping&quot;</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-212 name=__codelineno-0-212></a>                <span class=k>for</span> <span class=n>mapping</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;mapping&quot;</span><span class=p>]:</span>
<a id=__codelineno-0-213 name=__codelineno-0-213></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=o>**</span><span class=n>mapping</span><span class=p>)</span>
<a id=__codelineno-0-214 name=__codelineno-0-214></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-215 name=__codelineno-0-215></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;mapping&quot;</span><span class=p>])</span>
<a id=__codelineno-0-216 name=__codelineno-0-216></a>
<a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=k>if</span> <span class=s2>&quot;schedule&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-218 name=__codelineno-0-218></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_schedule</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;schedule&quot;</span><span class=p>])</span>
<a id=__codelineno-0-219 name=__codelineno-0-219></a>
<a id=__codelineno-0-220 name=__codelineno-0-220></a>        <span class=c1># Configure error handling if specified</span>
<a id=__codelineno-0-221 name=__codelineno-0-221></a>        <span class=k>if</span> <span class=s2>&quot;error_handling&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-222 name=__codelineno-0-222></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_configure_error_handling</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;error_handling&quot;</span><span class=p>])</span>
<a id=__codelineno-0-223 name=__codelineno-0-223></a>
<a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=c1># Configure security if specified</span>
<a id=__codelineno-0-225 name=__codelineno-0-225></a>        <span class=k>if</span> <span class=s2>&quot;security&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-226 name=__codelineno-0-226></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_configure_security</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;security&quot;</span><span class=p>])</span>
<a id=__codelineno-0-227 name=__codelineno-0-227></a>
<a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=c1># Configure secret management if specified</span>
<a id=__codelineno-0-229 name=__codelineno-0-229></a>        <span class=k>if</span> <span class=s2>&quot;secrets&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-230 name=__codelineno-0-230></a>            <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_secret_manager</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;secrets&quot;</span><span class=p>])</span>
<a id=__codelineno-0-231 name=__codelineno-0-231></a>
<a id=__codelineno-0-232 name=__codelineno-0-232></a>        <span class=c1># Validation configuration</span>
<a id=__codelineno-0-233 name=__codelineno-0-233></a>        <span class=k>if</span> <span class=s2>&quot;validation&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-234 name=__codelineno-0-234></a>            <span class=bp>self</span><span class=o>.</span><span class=n>validation_config</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;validation&quot;</span><span class=p>]</span>
<a id=__codelineno-0-235 name=__codelineno-0-235></a>
<a id=__codelineno-0-236 name=__codelineno-0-236></a>        <span class=k>if</span> <span class=s2>&quot;logging&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-237 name=__codelineno-0-237></a>            <span class=n>log_config</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;logging&quot;</span><span class=p>]</span>
<a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=n>log_level</span> <span class=o>=</span> <span class=n>log_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;level&quot;</span><span class=p>,</span> <span class=s2>&quot;INFO&quot;</span><span class=p>)</span>
<a id=__codelineno-0-239 name=__codelineno-0-239></a>            <span class=n>log_file</span> <span class=o>=</span> <span class=n>log_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;file&quot;</span><span class=p>)</span>
<a id=__codelineno-0-240 name=__codelineno-0-240></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>setup_logger</span><span class=p>(</span><span class=n>log_level</span><span class=p>,</span> <span class=n>log_file</span><span class=p>)</span>
<a id=__codelineno-0-241 name=__codelineno-0-241></a>
<a id=__codelineno-0-242 name=__codelineno-0-242></a>        <span class=c1># Provenance options</span>
<a id=__codelineno-0-243 name=__codelineno-0-243></a>        <span class=k>if</span> <span class=s2>&quot;provenance&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-244 name=__codelineno-0-244></a>            <span class=n>prov_cfg</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;provenance&quot;</span><span class=p>]</span>
<a id=__codelineno-0-245 name=__codelineno-0-245></a>            <span class=n>output_dir</span> <span class=o>=</span> <span class=n>prov_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;output_dir&quot;</span><span class=p>)</span>
<a id=__codelineno-0-246 name=__codelineno-0-246></a>            <span class=n>jsonl_log</span> <span class=o>=</span> <span class=n>prov_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;jsonl_log&quot;</span><span class=p>)</span>
<a id=__codelineno-0-247 name=__codelineno-0-247></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span> <span class=o>=</span> <span class=n>ProvenanceRecorder</span><span class=p>(</span>
<a id=__codelineno-0-248 name=__codelineno-0-248></a>                <span class=n>output_dir</span><span class=o>=</span><span class=n>output_dir</span><span class=p>,</span> <span class=n>jsonl_log_path</span><span class=o>=</span><span class=n>jsonl_log</span>
<a id=__codelineno-0-249 name=__codelineno-0-249></a>            <span class=p>)</span>
<a id=__codelineno-0-250 name=__codelineno-0-250></a>
<a id=__codelineno-0-251 name=__codelineno-0-251></a>        <span class=c1># Idempotency</span>
<a id=__codelineno-0-252 name=__codelineno-0-252></a>        <span class=k>if</span> <span class=s2>&quot;idempotency&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-253 name=__codelineno-0-253></a>            <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;idempotency&quot;</span><span class=p>]</span>
<a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-255 name=__codelineno-0-255></a>            <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;enabled&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;salt&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>}</span>
<a id=__codelineno-0-256 name=__codelineno-0-256></a>
<a id=__codelineno-0-257 name=__codelineno-0-257></a>        <span class=c1># State store</span>
<a id=__codelineno-0-258 name=__codelineno-0-258></a>        <span class=k>if</span> <span class=s2>&quot;state&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-259 name=__codelineno-0-259></a>            <span class=n>st_cfg</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;state&quot;</span><span class=p>]</span>
<a id=__codelineno-0-260 name=__codelineno-0-260></a>            <span class=n>st_type</span> <span class=o>=</span> <span class=n>st_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;type&quot;</span><span class=p>,</span> <span class=s2>&quot;file&quot;</span><span class=p>)</span>
<a id=__codelineno-0-261 name=__codelineno-0-261></a>            <span class=k>if</span> <span class=n>st_type</span> <span class=o>==</span> <span class=s2>&quot;file&quot;</span><span class=p>:</span>
<a id=__codelineno-0-262 name=__codelineno-0-262></a>                <span class=n>path</span> <span class=o>=</span> <span class=n>st_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;.apilinker/state.json&quot;</span><span class=p>)</span>
<a id=__codelineno-0-263 name=__codelineno-0-263></a>                <span class=n>default_last_sync</span> <span class=o>=</span> <span class=n>st_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;default_last_sync&quot;</span><span class=p>)</span>
<a id=__codelineno-0-264 name=__codelineno-0-264></a>                <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span> <span class=o>=</span> <span class=n>FileStateStore</span><span class=p>(</span>
<a id=__codelineno-0-265 name=__codelineno-0-265></a>                    <span class=n>path</span><span class=p>,</span> <span class=n>default_last_sync</span><span class=o>=</span><span class=n>default_last_sync</span>
<a id=__codelineno-0-266 name=__codelineno-0-266></a>                <span class=p>)</span>
<a id=__codelineno-0-267 name=__codelineno-0-267></a>            <span class=k>elif</span> <span class=n>st_type</span> <span class=o>==</span> <span class=s2>&quot;sqlite&quot;</span><span class=p>:</span>
<a id=__codelineno-0-268 name=__codelineno-0-268></a>                <span class=n>path</span> <span class=o>=</span> <span class=n>st_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>,</span> <span class=s2>&quot;.apilinker/state.db&quot;</span><span class=p>)</span>
<a id=__codelineno-0-269 name=__codelineno-0-269></a>                <span class=n>default_last_sync</span> <span class=o>=</span> <span class=n>st_cfg</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;default_last_sync&quot;</span><span class=p>)</span>
<a id=__codelineno-0-270 name=__codelineno-0-270></a>                <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span> <span class=o>=</span> <span class=n>SQLiteStateStore</span><span class=p>(</span>
<a id=__codelineno-0-271 name=__codelineno-0-271></a>                    <span class=n>path</span><span class=p>,</span> <span class=n>default_last_sync</span><span class=o>=</span><span class=n>default_last_sync</span>
<a id=__codelineno-0-272 name=__codelineno-0-272></a>                <span class=p>)</span>
<a id=__codelineno-0-273 name=__codelineno-0-273></a>
<a id=__codelineno-0-274 name=__codelineno-0-274></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_source</span><span class=p>(</span>
<a id=__codelineno-0-275 name=__codelineno-0-275></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-276 name=__codelineno-0-276></a>        <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-277 name=__codelineno-0-277></a>        <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-278 name=__codelineno-0-278></a>        <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-279 name=__codelineno-0-279></a>        <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-280 name=__codelineno-0-280></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-281 name=__codelineno-0-281></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-282 name=__codelineno-0-282></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-283 name=__codelineno-0-283></a><span class=sd>        Add a source API connector.</span>
<a id=__codelineno-0-284 name=__codelineno-0-284></a>
<a id=__codelineno-0-285 name=__codelineno-0-285></a><span class=sd>        Args:</span>
<a id=__codelineno-0-286 name=__codelineno-0-286></a><span class=sd>            type: Type of API connector (rest, graphql, etc.)</span>
<a id=__codelineno-0-287 name=__codelineno-0-287></a><span class=sd>            base_url: Base URL of the API</span>
<a id=__codelineno-0-288 name=__codelineno-0-288></a><span class=sd>            auth: Authentication configuration</span>
<a id=__codelineno-0-289 name=__codelineno-0-289></a><span class=sd>            endpoints: Configured endpoints</span>
<a id=__codelineno-0-290 name=__codelineno-0-290></a><span class=sd>            **kwargs: Additional configuration parameters</span>
<a id=__codelineno-0-291 name=__codelineno-0-291></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-292 name=__codelineno-0-292></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Adding source connector: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2> for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-293 name=__codelineno-0-293></a>
<a id=__codelineno-0-294 name=__codelineno-0-294></a>        <span class=c1># Resolve secrets in authentication configuration</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>        <span class=k>if</span> <span class=n>auth</span><span class=p>:</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>            <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_auth_secrets</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>            <span class=n>auth_config</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=o>.</span><span class=n>configure_auth</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-299 name=__codelineno-0-299></a>            <span class=n>auth_config</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-300 name=__codelineno-0-300></a>
<a id=__codelineno-0-301 name=__codelineno-0-301></a>        <span class=c1># Create source connector</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>        <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=o>=</span> <span class=n>ApiConnector</span><span class=p>(</span>
<a id=__codelineno-0-303 name=__codelineno-0-303></a>            <span class=n>connector_type</span><span class=o>=</span><span class=nb>type</span><span class=p>,</span>
<a id=__codelineno-0-304 name=__codelineno-0-304></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a>            <span class=n>auth_config</span><span class=o>=</span><span class=n>auth_config</span><span class=p>,</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a>            <span class=n>endpoints</span><span class=o>=</span><span class=n>endpoints</span> <span class=ow>or</span> <span class=p>{},</span>
<a id=__codelineno-0-307 name=__codelineno-0-307></a>            <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<a id=__codelineno-0-308 name=__codelineno-0-308></a>        <span class=p>)</span>
<a id=__codelineno-0-309 name=__codelineno-0-309></a>
<a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_target</span><span class=p>(</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>        <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-313 name=__codelineno-0-313></a>        <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-314 name=__codelineno-0-314></a>        <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a>        <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-319 name=__codelineno-0-319></a><span class=sd>        Add a target API connector.</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>
<a id=__codelineno-0-321 name=__codelineno-0-321></a><span class=sd>        Args:</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a><span class=sd>            type: Type of API connector (rest, graphql, etc.)</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a><span class=sd>            base_url: Base URL of the API</span>
<a id=__codelineno-0-324 name=__codelineno-0-324></a><span class=sd>            auth: Authentication configuration</span>
<a id=__codelineno-0-325 name=__codelineno-0-325></a><span class=sd>            endpoints: Configured endpoints</span>
<a id=__codelineno-0-326 name=__codelineno-0-326></a><span class=sd>            **kwargs: Additional configuration parameters</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Adding target connector: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2> for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>        <span class=c1># Resolve secrets in authentication configuration</span>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=k>if</span> <span class=n>auth</span><span class=p>:</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>            <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_auth_secrets</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>            <span class=n>auth_config</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=o>.</span><span class=n>configure_auth</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>            <span class=n>auth_config</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a>
<a id=__codelineno-0-337 name=__codelineno-0-337></a>        <span class=c1># Create target connector</span>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>        <span class=bp>self</span><span class=o>.</span><span class=n>target</span> <span class=o>=</span> <span class=n>ApiConnector</span><span class=p>(</span>
<a id=__codelineno-0-339 name=__codelineno-0-339></a>            <span class=n>connector_type</span><span class=o>=</span><span class=nb>type</span><span class=p>,</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a>            <span class=n>auth_config</span><span class=o>=</span><span class=n>auth_config</span><span class=p>,</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>            <span class=n>endpoints</span><span class=o>=</span><span class=n>endpoints</span> <span class=ow>or</span> <span class=p>{},</span>
<a id=__codelineno-0-343 name=__codelineno-0-343></a>            <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a>        <span class=p>)</span>
<a id=__codelineno-0-345 name=__codelineno-0-345></a>
<a id=__codelineno-0-346 name=__codelineno-0-346></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_mapping</span><span class=p>(</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>fields</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-348 name=__codelineno-0-348></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a><span class=sd>        Add a field mapping between source and target endpoints.</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>
<a id=__codelineno-0-352 name=__codelineno-0-352></a><span class=sd>        Args:</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a><span class=sd>            source: Source endpoint name</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a><span class=sd>            target: Target endpoint name</span>
<a id=__codelineno-0-355 name=__codelineno-0-355></a><span class=sd>            fields: List of field mappings</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>            <span class=sa>f</span><span class=s2>&quot;Adding mapping from </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>fields</span><span class=p>)</span><span class=si>}</span><span class=s2> fields&quot;</span>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>        <span class=p>)</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>fields</span><span class=p>)</span>
<a id=__codelineno-0-361 name=__codelineno-0-361></a>
<a id=__codelineno-0-362 name=__codelineno-0-362></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_schedule</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-363 name=__codelineno-0-363></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-364 name=__codelineno-0-364></a><span class=sd>        Add a schedule for recurring syncs.</span>
<a id=__codelineno-0-365 name=__codelineno-0-365></a>
<a id=__codelineno-0-366 name=__codelineno-0-366></a><span class=sd>        Args:</span>
<a id=__codelineno-0-367 name=__codelineno-0-367></a><span class=sd>            type: Type of schedule (interval, cron)</span>
<a id=__codelineno-0-368 name=__codelineno-0-368></a><span class=sd>            **kwargs: Schedule-specific parameters</span>
<a id=__codelineno-0-369 name=__codelineno-0-369></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-370 name=__codelineno-0-370></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Adding schedule: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-371 name=__codelineno-0-371></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=o>.</span><span class=n>add_schedule</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a id=__codelineno-0-372 name=__codelineno-0-372></a>
<a id=__codelineno-0-373 name=__codelineno-0-373></a>    <span class=k>def</span><span class=w> </span><span class=nf>_initialize_security</span><span class=p>(</span>
<a id=__codelineno-0-374 name=__codelineno-0-374></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-375 name=__codelineno-0-375></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SecurityManager</span><span class=p>:</span>
<a id=__codelineno-0-376 name=__codelineno-0-376></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-377 name=__codelineno-0-377></a><span class=sd>        Initialize the security system based on provided configuration.</span>
<a id=__codelineno-0-378 name=__codelineno-0-378></a>
<a id=__codelineno-0-379 name=__codelineno-0-379></a><span class=sd>        Args:</span>
<a id=__codelineno-0-380 name=__codelineno-0-380></a><span class=sd>            config: Security configuration dictionary</span>
<a id=__codelineno-0-381 name=__codelineno-0-381></a>
<a id=__codelineno-0-382 name=__codelineno-0-382></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-383 name=__codelineno-0-383></a><span class=sd>            SecurityManager instance</span>
<a id=__codelineno-0-384 name=__codelineno-0-384></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-385 name=__codelineno-0-385></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-386 name=__codelineno-0-386></a>            <span class=n>config</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-387 name=__codelineno-0-387></a>
<a id=__codelineno-0-388 name=__codelineno-0-388></a>        <span class=c1># Extract security configuration</span>
<a id=__codelineno-0-389 name=__codelineno-0-389></a>        <span class=n>master_password</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;master_password&quot;</span><span class=p>)</span>
<a id=__codelineno-0-390 name=__codelineno-0-390></a>        <span class=n>storage_path</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;credential_storage_path&quot;</span><span class=p>)</span>
<a id=__codelineno-0-391 name=__codelineno-0-391></a>        <span class=n>encryption_level</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;encryption_level&quot;</span><span class=p>,</span> <span class=s2>&quot;none&quot;</span><span class=p>)</span>
<a id=__codelineno-0-392 name=__codelineno-0-392></a>        <span class=n>encryption_key</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;encryption_key&quot;</span><span class=p>)</span>
<a id=__codelineno-0-393 name=__codelineno-0-393></a>        <span class=n>enable_access_control</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enable_access_control&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-0-394 name=__codelineno-0-394></a>
<a id=__codelineno-0-395 name=__codelineno-0-395></a>        <span class=c1># Initialize security manager</span>
<a id=__codelineno-0-396 name=__codelineno-0-396></a>        <span class=n>security_manager</span> <span class=o>=</span> <span class=n>SecurityManager</span><span class=p>(</span>
<a id=__codelineno-0-397 name=__codelineno-0-397></a>            <span class=n>master_password</span><span class=o>=</span><span class=n>master_password</span><span class=p>,</span>
<a id=__codelineno-0-398 name=__codelineno-0-398></a>            <span class=n>storage_path</span><span class=o>=</span><span class=n>storage_path</span><span class=p>,</span>
<a id=__codelineno-0-399 name=__codelineno-0-399></a>            <span class=n>encryption_level</span><span class=o>=</span><span class=n>encryption_level</span><span class=p>,</span>
<a id=__codelineno-0-400 name=__codelineno-0-400></a>            <span class=n>encryption_key</span><span class=o>=</span><span class=n>encryption_key</span><span class=p>,</span>
<a id=__codelineno-0-401 name=__codelineno-0-401></a>            <span class=n>enable_access_control</span><span class=o>=</span><span class=n>enable_access_control</span><span class=p>,</span>
<a id=__codelineno-0-402 name=__codelineno-0-402></a>        <span class=p>)</span>
<a id=__codelineno-0-403 name=__codelineno-0-403></a>
<a id=__codelineno-0-404 name=__codelineno-0-404></a>        <span class=c1># Set up initial users if access control is enabled</span>
<a id=__codelineno-0-405 name=__codelineno-0-405></a>        <span class=k>if</span> <span class=n>enable_access_control</span> <span class=ow>and</span> <span class=s2>&quot;users&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-406 name=__codelineno-0-406></a>            <span class=k>for</span> <span class=n>user_config</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;users&quot;</span><span class=p>]:</span>
<a id=__codelineno-0-407 name=__codelineno-0-407></a>                <span class=n>username</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>)</span>
<a id=__codelineno-0-408 name=__codelineno-0-408></a>                <span class=n>role</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role&quot;</span><span class=p>,</span> <span class=s2>&quot;viewer&quot;</span><span class=p>)</span>
<a id=__codelineno-0-409 name=__codelineno-0-409></a>                <span class=n>api_key</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;api_key&quot;</span><span class=p>)</span>
<a id=__codelineno-0-410 name=__codelineno-0-410></a>
<a id=__codelineno-0-411 name=__codelineno-0-411></a>                <span class=k>if</span> <span class=n>username</span><span class=p>:</span>
<a id=__codelineno-0-412 name=__codelineno-0-412></a>                    <span class=n>security_manager</span><span class=o>.</span><span class=n>add_user</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>role</span><span class=p>,</span> <span class=n>api_key</span><span class=p>)</span>
<a id=__codelineno-0-413 name=__codelineno-0-413></a>
<a id=__codelineno-0-414 name=__codelineno-0-414></a>        <span class=k>return</span> <span class=n>security_manager</span>
<a id=__codelineno-0-415 name=__codelineno-0-415></a>
<a id=__codelineno-0-416 name=__codelineno-0-416></a>    <span class=k>def</span><span class=w> </span><span class=nf>_initialize_observability</span><span class=p>(</span>
<a id=__codelineno-0-417 name=__codelineno-0-417></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-418 name=__codelineno-0-418></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TelemetryManager</span><span class=p>:</span>
<a id=__codelineno-0-419 name=__codelineno-0-419></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-420 name=__codelineno-0-420></a><span class=sd>        Initialize the observability system based on provided configuration.</span>
<a id=__codelineno-0-421 name=__codelineno-0-421></a>
<a id=__codelineno-0-422 name=__codelineno-0-422></a><span class=sd>        Args:</span>
<a id=__codelineno-0-423 name=__codelineno-0-423></a><span class=sd>            config: Observability configuration dictionary</span>
<a id=__codelineno-0-424 name=__codelineno-0-424></a>
<a id=__codelineno-0-425 name=__codelineno-0-425></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-426 name=__codelineno-0-426></a><span class=sd>            TelemetryManager instance</span>
<a id=__codelineno-0-427 name=__codelineno-0-427></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-428 name=__codelineno-0-428></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-429 name=__codelineno-0-429></a>            <span class=n>config</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-430 name=__codelineno-0-430></a>
<a id=__codelineno-0-431 name=__codelineno-0-431></a>        <span class=c1># Create observability configuration</span>
<a id=__codelineno-0-432 name=__codelineno-0-432></a>        <span class=n>obs_config</span> <span class=o>=</span> <span class=n>ObservabilityConfig</span><span class=p>(</span>
<a id=__codelineno-0-433 name=__codelineno-0-433></a>            <span class=n>enabled</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
<a id=__codelineno-0-434 name=__codelineno-0-434></a>            <span class=n>service_name</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;service_name&quot;</span><span class=p>,</span> <span class=s2>&quot;apilinker&quot;</span><span class=p>),</span>
<a id=__codelineno-0-435 name=__codelineno-0-435></a>            <span class=n>enable_tracing</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enable_tracing&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
<a id=__codelineno-0-436 name=__codelineno-0-436></a>            <span class=n>enable_metrics</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enable_metrics&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
<a id=__codelineno-0-437 name=__codelineno-0-437></a>            <span class=n>export_to_console</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;export_to_console&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
<a id=__codelineno-0-438 name=__codelineno-0-438></a>            <span class=n>export_to_prometheus</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;export_to_prometheus&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
<a id=__codelineno-0-439 name=__codelineno-0-439></a>            <span class=n>prometheus_host</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;prometheus_host&quot;</span><span class=p>,</span> <span class=s2>&quot;0.0.0.0&quot;</span><span class=p>),</span>
<a id=__codelineno-0-440 name=__codelineno-0-440></a>            <span class=n>prometheus_port</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;prometheus_port&quot;</span><span class=p>,</span> <span class=mi>9090</span><span class=p>),</span>
<a id=__codelineno-0-441 name=__codelineno-0-441></a>        <span class=p>)</span>
<a id=__codelineno-0-442 name=__codelineno-0-442></a>
<a id=__codelineno-0-443 name=__codelineno-0-443></a>        <span class=k>return</span> <span class=n>TelemetryManager</span><span class=p>(</span><span class=n>obs_config</span><span class=p>)</span>
<a id=__codelineno-0-444 name=__codelineno-0-444></a>
<a id=__codelineno-0-445 name=__codelineno-0-445></a>    <span class=k>def</span><span class=w> </span><span class=nf>_initialize_secret_manager</span><span class=p>(</span>
<a id=__codelineno-0-446 name=__codelineno-0-446></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-447 name=__codelineno-0-447></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>SecretManager</span><span class=p>]:</span>
<a id=__codelineno-0-448 name=__codelineno-0-448></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-449 name=__codelineno-0-449></a><span class=sd>        Initialize the secret management system based on provided configuration.</span>
<a id=__codelineno-0-450 name=__codelineno-0-450></a>
<a id=__codelineno-0-451 name=__codelineno-0-451></a><span class=sd>        Args:</span>
<a id=__codelineno-0-452 name=__codelineno-0-452></a><span class=sd>            config: Secret manager configuration dictionary</span>
<a id=__codelineno-0-453 name=__codelineno-0-453></a>
<a id=__codelineno-0-454 name=__codelineno-0-454></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-455 name=__codelineno-0-455></a><span class=sd>            SecretManager instance or None if not configured</span>
<a id=__codelineno-0-456 name=__codelineno-0-456></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-457 name=__codelineno-0-457></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-458 name=__codelineno-0-458></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-459 name=__codelineno-0-459></a>
<a id=__codelineno-0-460 name=__codelineno-0-460></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-461 name=__codelineno-0-461></a>            <span class=c1># Create secret manager configuration</span>
<a id=__codelineno-0-462 name=__codelineno-0-462></a>            <span class=kn>from</span><span class=w> </span><span class=nn>apilinker.core.secrets</span><span class=w> </span><span class=kn>import</span> <span class=n>SecretProvider</span><span class=p>,</span> <span class=n>RotationStrategy</span>
<a id=__codelineno-0-463 name=__codelineno-0-463></a>
<a id=__codelineno-0-464 name=__codelineno-0-464></a>            <span class=n>provider_str</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=s2>&quot;env&quot;</span><span class=p>)</span>
<a id=__codelineno-0-465 name=__codelineno-0-465></a>            <span class=n>provider</span> <span class=o>=</span> <span class=n>SecretProvider</span><span class=p>(</span><span class=n>provider_str</span><span class=p>)</span>
<a id=__codelineno-0-466 name=__codelineno-0-466></a>
<a id=__codelineno-0-467 name=__codelineno-0-467></a>            <span class=n>rotation_str</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;rotation_strategy&quot;</span><span class=p>,</span> <span class=s2>&quot;manual&quot;</span><span class=p>)</span>
<a id=__codelineno-0-468 name=__codelineno-0-468></a>            <span class=n>rotation_strategy</span> <span class=o>=</span> <span class=n>RotationStrategy</span><span class=p>(</span><span class=n>rotation_str</span><span class=p>)</span>
<a id=__codelineno-0-469 name=__codelineno-0-469></a>
<a id=__codelineno-0-470 name=__codelineno-0-470></a>            <span class=n>secret_config</span> <span class=o>=</span> <span class=n>SecretManagerConfig</span><span class=p>(</span>
<a id=__codelineno-0-471 name=__codelineno-0-471></a>                <span class=n>provider</span><span class=o>=</span><span class=n>provider</span><span class=p>,</span>
<a id=__codelineno-0-472 name=__codelineno-0-472></a>                <span class=n>vault_config</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;vault&quot;</span><span class=p>),</span>
<a id=__codelineno-0-473 name=__codelineno-0-473></a>                <span class=n>aws_config</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;aws&quot;</span><span class=p>),</span>
<a id=__codelineno-0-474 name=__codelineno-0-474></a>                <span class=n>azure_config</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;azure&quot;</span><span class=p>),</span>
<a id=__codelineno-0-475 name=__codelineno-0-475></a>                <span class=n>gcp_config</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;gcp&quot;</span><span class=p>),</span>
<a id=__codelineno-0-476 name=__codelineno-0-476></a>                <span class=n>rotation_strategy</span><span class=o>=</span><span class=n>rotation_strategy</span><span class=p>,</span>
<a id=__codelineno-0-477 name=__codelineno-0-477></a>                <span class=n>rotation_interval_days</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;rotation_interval_days&quot;</span><span class=p>,</span> <span class=mi>90</span><span class=p>),</span>
<a id=__codelineno-0-478 name=__codelineno-0-478></a>                <span class=n>cache_ttl_seconds</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;cache_ttl_seconds&quot;</span><span class=p>,</span> <span class=mi>300</span><span class=p>),</span>
<a id=__codelineno-0-479 name=__codelineno-0-479></a>                <span class=n>enable_least_privilege</span><span class=o>=</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enable_least_privilege&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>),</span>
<a id=__codelineno-0-480 name=__codelineno-0-480></a>            <span class=p>)</span>
<a id=__codelineno-0-481 name=__codelineno-0-481></a>
<a id=__codelineno-0-482 name=__codelineno-0-482></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Initialized secret manager with provider: </span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-483 name=__codelineno-0-483></a>            <span class=k>return</span> <span class=n>SecretManager</span><span class=p>(</span><span class=n>secret_config</span><span class=p>)</span>
<a id=__codelineno-0-484 name=__codelineno-0-484></a>
<a id=__codelineno-0-485 name=__codelineno-0-485></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-486 name=__codelineno-0-486></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to initialize secret manager: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-487 name=__codelineno-0-487></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-488 name=__codelineno-0-488></a>
<a id=__codelineno-0-489 name=__codelineno-0-489></a>    <span class=k>def</span><span class=w> </span><span class=nf>_resolve_secret</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-490 name=__codelineno-0-490></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-491 name=__codelineno-0-491></a><span class=sd>        Resolve a secret reference to its actual value.</span>
<a id=__codelineno-0-492 name=__codelineno-0-492></a>
<a id=__codelineno-0-493 name=__codelineno-0-493></a><span class=sd>        Secret references can be specified as:</span>
<a id=__codelineno-0-494 name=__codelineno-0-494></a><span class=sd>        - String starting with &quot;secret://&quot; (e.g., &quot;secret://api-key&quot;)</span>
<a id=__codelineno-0-495 name=__codelineno-0-495></a><span class=sd>        - Dict with &quot;secret&quot; key (e.g., {&quot;secret&quot;: &quot;api-key&quot;})</span>
<a id=__codelineno-0-496 name=__codelineno-0-496></a>
<a id=__codelineno-0-497 name=__codelineno-0-497></a><span class=sd>        Args:</span>
<a id=__codelineno-0-498 name=__codelineno-0-498></a><span class=sd>            value: Value that may contain a secret reference</span>
<a id=__codelineno-0-499 name=__codelineno-0-499></a>
<a id=__codelineno-0-500 name=__codelineno-0-500></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-501 name=__codelineno-0-501></a><span class=sd>            Resolved secret value or original value if not a secret reference</span>
<a id=__codelineno-0-502 name=__codelineno-0-502></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-503 name=__codelineno-0-503></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span><span class=p>:</span>
<a id=__codelineno-0-504 name=__codelineno-0-504></a>            <span class=k>return</span> <span class=n>value</span>
<a id=__codelineno-0-505 name=__codelineno-0-505></a>
<a id=__codelineno-0-506 name=__codelineno-0-506></a>        <span class=c1># Handle string secret references</span>
<a id=__codelineno-0-507 name=__codelineno-0-507></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=ow>and</span> <span class=n>value</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;secret://&quot;</span><span class=p>):</span>
<a id=__codelineno-0-508 name=__codelineno-0-508></a>            <span class=n>secret_name</span> <span class=o>=</span> <span class=n>value</span><span class=p>[</span><span class=mi>9</span><span class=p>:]</span>  <span class=c1># Remove &quot;secret://&quot; prefix</span>
<a id=__codelineno-0-509 name=__codelineno-0-509></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-510 name=__codelineno-0-510></a>                <span class=n>secret_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span><span class=o>.</span><span class=n>get_secret</span><span class=p>(</span><span class=n>secret_name</span><span class=p>)</span>
<a id=__codelineno-0-511 name=__codelineno-0-511></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrieved secret: </span><span class=si>{</span><span class=n>secret_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-512 name=__codelineno-0-512></a>                <span class=k>return</span> <span class=n>secret_value</span>
<a id=__codelineno-0-513 name=__codelineno-0-513></a>            <span class=k>except</span> <span class=p>(</span><span class=n>SecretNotFoundError</span><span class=p>,</span> <span class=n>SecretAccessError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-514 name=__codelineno-0-514></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to retrieve secret &#39;</span><span class=si>{</span><span class=n>secret_name</span><span class=si>}</span><span class=s2>&#39;: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-515 name=__codelineno-0-515></a>                <span class=k>raise</span>
<a id=__codelineno-0-516 name=__codelineno-0-516></a>
<a id=__codelineno-0-517 name=__codelineno-0-517></a>        <span class=c1># Handle dict secret references</span>
<a id=__codelineno-0-518 name=__codelineno-0-518></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;secret&quot;</span> <span class=ow>in</span> <span class=n>value</span><span class=p>:</span>
<a id=__codelineno-0-519 name=__codelineno-0-519></a>            <span class=n>secret_name</span> <span class=o>=</span> <span class=n>value</span><span class=p>[</span><span class=s2>&quot;secret&quot;</span><span class=p>]</span>
<a id=__codelineno-0-520 name=__codelineno-0-520></a>            <span class=n>version</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>)</span>
<a id=__codelineno-0-521 name=__codelineno-0-521></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-522 name=__codelineno-0-522></a>                <span class=n>secret_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span><span class=o>.</span><span class=n>get_secret</span><span class=p>(</span><span class=n>secret_name</span><span class=p>,</span> <span class=n>version</span><span class=p>)</span>
<a id=__codelineno-0-523 name=__codelineno-0-523></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrieved secret: </span><span class=si>{</span><span class=n>secret_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-524 name=__codelineno-0-524></a>                <span class=k>return</span> <span class=n>secret_value</span>
<a id=__codelineno-0-525 name=__codelineno-0-525></a>            <span class=k>except</span> <span class=p>(</span><span class=n>SecretNotFoundError</span><span class=p>,</span> <span class=n>SecretAccessError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-526 name=__codelineno-0-526></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to retrieve secret &#39;</span><span class=si>{</span><span class=n>secret_name</span><span class=si>}</span><span class=s2>&#39;: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-527 name=__codelineno-0-527></a>                <span class=k>raise</span>
<a id=__codelineno-0-528 name=__codelineno-0-528></a>
<a id=__codelineno-0-529 name=__codelineno-0-529></a>        <span class=k>return</span> <span class=n>value</span>
<a id=__codelineno-0-530 name=__codelineno-0-530></a>
<a id=__codelineno-0-531 name=__codelineno-0-531></a>    <span class=k>def</span><span class=w> </span><span class=nf>_resolve_auth_secrets</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>auth_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-532 name=__codelineno-0-532></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-533 name=__codelineno-0-533></a><span class=sd>        Recursively resolve secret references in authentication configuration.</span>
<a id=__codelineno-0-534 name=__codelineno-0-534></a>
<a id=__codelineno-0-535 name=__codelineno-0-535></a><span class=sd>        Args:</span>
<a id=__codelineno-0-536 name=__codelineno-0-536></a><span class=sd>            auth_config: Authentication configuration that may contain secret references</span>
<a id=__codelineno-0-537 name=__codelineno-0-537></a>
<a id=__codelineno-0-538 name=__codelineno-0-538></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-539 name=__codelineno-0-539></a><span class=sd>            Authentication configuration with resolved secrets</span>
<a id=__codelineno-0-540 name=__codelineno-0-540></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-541 name=__codelineno-0-541></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span><span class=p>:</span>
<a id=__codelineno-0-542 name=__codelineno-0-542></a>            <span class=k>return</span> <span class=n>auth_config</span>
<a id=__codelineno-0-543 name=__codelineno-0-543></a>
<a id=__codelineno-0-544 name=__codelineno-0-544></a>        <span class=n>resolved_config</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-545 name=__codelineno-0-545></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>auth_config</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-546 name=__codelineno-0-546></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-547 name=__codelineno-0-547></a>                <span class=c1># Recursively resolve nested dicts</span>
<a id=__codelineno-0-548 name=__codelineno-0-548></a>                <span class=n>resolved_config</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_auth_secrets</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-549 name=__codelineno-0-549></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-550 name=__codelineno-0-550></a>                <span class=c1># Resolve each item in list</span>
<a id=__codelineno-0-551 name=__codelineno-0-551></a>                <span class=n>resolved_config</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>  <span class=c1># type: ignore[assignment]</span>
<a id=__codelineno-0-552 name=__codelineno-0-552></a>                    <span class=p>(</span>
<a id=__codelineno-0-553 name=__codelineno-0-553></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_secret</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a id=__codelineno-0-554 name=__codelineno-0-554></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=nb>dict</span><span class=p>))</span>
<a id=__codelineno-0-555 name=__codelineno-0-555></a>                        <span class=k>else</span> <span class=n>item</span>
<a id=__codelineno-0-556 name=__codelineno-0-556></a>                    <span class=p>)</span>
<a id=__codelineno-0-557 name=__codelineno-0-557></a>                    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>value</span>
<a id=__codelineno-0-558 name=__codelineno-0-558></a>                <span class=p>]</span>
<a id=__codelineno-0-559 name=__codelineno-0-559></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-560 name=__codelineno-0-560></a>                <span class=c1># Resolve individual value</span>
<a id=__codelineno-0-561 name=__codelineno-0-561></a>                <span class=n>resolved_config</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_secret</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-562 name=__codelineno-0-562></a>
<a id=__codelineno-0-563 name=__codelineno-0-563></a>        <span class=k>return</span> <span class=n>resolved_config</span>
<a id=__codelineno-0-564 name=__codelineno-0-564></a>
<a id=__codelineno-0-565 name=__codelineno-0-565></a>    <span class=k>def</span><span class=w> </span><span class=nf>_configure_security</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-566 name=__codelineno-0-566></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-567 name=__codelineno-0-567></a><span class=sd>        Configure security features based on provided configuration.</span>
<a id=__codelineno-0-568 name=__codelineno-0-568></a>
<a id=__codelineno-0-569 name=__codelineno-0-569></a><span class=sd>        Args:</span>
<a id=__codelineno-0-570 name=__codelineno-0-570></a><span class=sd>            config: Security configuration dictionary</span>
<a id=__codelineno-0-571 name=__codelineno-0-571></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-572 name=__codelineno-0-572></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Configuring security features&quot;</span><span class=p>)</span>
<a id=__codelineno-0-573 name=__codelineno-0-573></a>
<a id=__codelineno-0-574 name=__codelineno-0-574></a>        <span class=c1># Update encryption level if specified</span>
<a id=__codelineno-0-575 name=__codelineno-0-575></a>        <span class=k>if</span> <span class=s2>&quot;encryption_level&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-576 name=__codelineno-0-576></a>            <span class=n>encryption_level</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;encryption_level&quot;</span><span class=p>]</span>
<a id=__codelineno-0-577 name=__codelineno-0-577></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-578 name=__codelineno-0-578></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>encryption_level</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-0-579 name=__codelineno-0-579></a>                    <span class=n>encryption_level</span> <span class=o>=</span> <span class=n>EncryptionLevel</span><span class=p>[</span><span class=n>encryption_level</span><span class=o>.</span><span class=n>upper</span><span class=p>()]</span>
<a id=__codelineno-0-580 name=__codelineno-0-580></a>                <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>request_encryption</span><span class=o>.</span><span class=n>encryption_level</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-581 name=__codelineno-0-581></a>                    <span class=n>encryption_level</span>
<a id=__codelineno-0-582 name=__codelineno-0-582></a>                <span class=p>)</span>
<a id=__codelineno-0-583 name=__codelineno-0-583></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Updated encryption level to </span><span class=si>{</span><span class=n>encryption_level</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-584 name=__codelineno-0-584></a>            <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>):</span>
<a id=__codelineno-0-585 name=__codelineno-0-585></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid encryption level: </span><span class=si>{</span><span class=n>encryption_level</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-586 name=__codelineno-0-586></a>
<a id=__codelineno-0-587 name=__codelineno-0-587></a>        <span class=c1># Add users if specified and access control is enabled</span>
<a id=__codelineno-0-588 name=__codelineno-0-588></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>enable_access_control</span> <span class=ow>and</span> <span class=s2>&quot;users&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-589 name=__codelineno-0-589></a>            <span class=k>for</span> <span class=n>user_config</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;users&quot;</span><span class=p>]:</span>
<a id=__codelineno-0-590 name=__codelineno-0-590></a>                <span class=n>username</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>)</span>
<a id=__codelineno-0-591 name=__codelineno-0-591></a>                <span class=n>role</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role&quot;</span><span class=p>,</span> <span class=s2>&quot;viewer&quot;</span><span class=p>)</span>
<a id=__codelineno-0-592 name=__codelineno-0-592></a>                <span class=n>api_key</span> <span class=o>=</span> <span class=n>user_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;api_key&quot;</span><span class=p>)</span>
<a id=__codelineno-0-593 name=__codelineno-0-593></a>
<a id=__codelineno-0-594 name=__codelineno-0-594></a>                <span class=k>if</span> <span class=n>username</span><span class=p>:</span>
<a id=__codelineno-0-595 name=__codelineno-0-595></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>add_user</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>role</span><span class=p>,</span> <span class=n>api_key</span><span class=p>)</span>
<a id=__codelineno-0-596 name=__codelineno-0-596></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Added user </span><span class=si>{</span><span class=n>username</span><span class=si>}</span><span class=s2> with role </span><span class=si>{</span><span class=n>role</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-597 name=__codelineno-0-597></a>
<a id=__codelineno-0-598 name=__codelineno-0-598></a>    <span class=k>def</span><span class=w> </span><span class=nf>_configure_error_handling</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-599 name=__codelineno-0-599></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-600 name=__codelineno-0-600></a><span class=sd>        Configure the error handling system based on provided configuration.</span>
<a id=__codelineno-0-601 name=__codelineno-0-601></a>
<a id=__codelineno-0-602 name=__codelineno-0-602></a><span class=sd>        Args:</span>
<a id=__codelineno-0-603 name=__codelineno-0-603></a><span class=sd>            config: Error handling configuration dictionary</span>
<a id=__codelineno-0-604 name=__codelineno-0-604></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-605 name=__codelineno-0-605></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Configuring error handling system&quot;</span><span class=p>)</span>
<a id=__codelineno-0-606 name=__codelineno-0-606></a>
<a id=__codelineno-0-607 name=__codelineno-0-607></a>        <span class=c1># Configure circuit breakers</span>
<a id=__codelineno-0-608 name=__codelineno-0-608></a>        <span class=k>if</span> <span class=s2>&quot;circuit_breakers&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-609 name=__codelineno-0-609></a>            <span class=k>for</span> <span class=n>cb_name</span><span class=p>,</span> <span class=n>cb_config</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;circuit_breakers&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-610 name=__codelineno-0-610></a>                <span class=n>failure_threshold</span> <span class=o>=</span> <span class=n>cb_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;failure_threshold&quot;</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
<a id=__codelineno-0-611 name=__codelineno-0-611></a>                <span class=n>reset_timeout</span> <span class=o>=</span> <span class=n>cb_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reset_timeout_seconds&quot;</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
<a id=__codelineno-0-612 name=__codelineno-0-612></a>                <span class=n>half_open_max_calls</span> <span class=o>=</span> <span class=n>cb_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;half_open_max_calls&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-0-613 name=__codelineno-0-613></a>
<a id=__codelineno-0-614 name=__codelineno-0-614></a>                <span class=c1># Create and register circuit breaker</span>
<a id=__codelineno-0-615 name=__codelineno-0-615></a>                <span class=n>circuit</span><span class=p>:</span> <span class=n>CircuitBreaker</span> <span class=o>=</span> <span class=n>CircuitBreaker</span><span class=p>(</span>
<a id=__codelineno-0-616 name=__codelineno-0-616></a>                    <span class=n>name</span><span class=o>=</span><span class=n>cb_name</span><span class=p>,</span>
<a id=__codelineno-0-617 name=__codelineno-0-617></a>                    <span class=n>failure_threshold</span><span class=o>=</span><span class=n>failure_threshold</span><span class=p>,</span>
<a id=__codelineno-0-618 name=__codelineno-0-618></a>                    <span class=n>reset_timeout_seconds</span><span class=o>=</span><span class=n>reset_timeout</span><span class=p>,</span>
<a id=__codelineno-0-619 name=__codelineno-0-619></a>                    <span class=n>half_open_max_calls</span><span class=o>=</span><span class=n>half_open_max_calls</span><span class=p>,</span>
<a id=__codelineno-0-620 name=__codelineno-0-620></a>                <span class=p>)</span>
<a id=__codelineno-0-621 name=__codelineno-0-621></a>
<a id=__codelineno-0-622 name=__codelineno-0-622></a>                <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>circuit_breakers</span><span class=p>[</span><span class=n>cb_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>circuit</span>
<a id=__codelineno-0-623 name=__codelineno-0-623></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Configured circuit breaker: </span><span class=si>{</span><span class=n>cb_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-624 name=__codelineno-0-624></a>
<a id=__codelineno-0-625 name=__codelineno-0-625></a>        <span class=c1># Configure recovery strategies</span>
<a id=__codelineno-0-626 name=__codelineno-0-626></a>        <span class=k>if</span> <span class=s2>&quot;recovery_strategies&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-627 name=__codelineno-0-627></a>            <span class=k>for</span> <span class=n>category_name</span><span class=p>,</span> <span class=n>strategies</span> <span class=ow>in</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;recovery_strategies&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-628 name=__codelineno-0-628></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-629 name=__codelineno-0-629></a>                    <span class=n>error_category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=p>[</span><span class=n>category_name</span><span class=o>.</span><span class=n>upper</span><span class=p>()]</span>
<a id=__codelineno-0-630 name=__codelineno-0-630></a>                    <span class=n>strategy_list</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-0-631 name=__codelineno-0-631></a>                        <span class=n>RecoveryStrategy</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()]</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>strategies</span>
<a id=__codelineno-0-632 name=__codelineno-0-632></a>                    <span class=p>]</span>
<a id=__codelineno-0-633 name=__codelineno-0-633></a>
<a id=__codelineno-0-634 name=__codelineno-0-634></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>set_strategy</span><span class=p>(</span>
<a id=__codelineno-0-635 name=__codelineno-0-635></a>                        <span class=n>error_category</span><span class=p>,</span> <span class=n>strategy_list</span>
<a id=__codelineno-0-636 name=__codelineno-0-636></a>                    <span class=p>)</span>
<a id=__codelineno-0-637 name=__codelineno-0-637></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
<a id=__codelineno-0-638 name=__codelineno-0-638></a>                        <span class=sa>f</span><span class=s2>&quot;Configured recovery strategies for </span><span class=si>{</span><span class=n>category_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>strategies</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-639 name=__codelineno-0-639></a>                    <span class=p>)</span>
<a id=__codelineno-0-640 name=__codelineno-0-640></a>
<a id=__codelineno-0-641 name=__codelineno-0-641></a>                <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-642 name=__codelineno-0-642></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-643 name=__codelineno-0-643></a>                        <span class=sa>f</span><span class=s2>&quot;Invalid recovery strategy configuration: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-644 name=__codelineno-0-644></a>                    <span class=p>)</span>
<a id=__codelineno-0-645 name=__codelineno-0-645></a>
<a id=__codelineno-0-646 name=__codelineno-0-646></a>        <span class=c1># Configure DLQ</span>
<a id=__codelineno-0-647 name=__codelineno-0-647></a>        <span class=k>if</span> <span class=s2>&quot;dlq&quot;</span> <span class=ow>in</span> <span class=n>config</span><span class=p>:</span>
<a id=__codelineno-0-648 name=__codelineno-0-648></a>            <span class=n>dlq_dir</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;dlq&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;directory&quot;</span><span class=p>)</span>
<a id=__codelineno-0-649 name=__codelineno-0-649></a>            <span class=k>if</span> <span class=n>dlq_dir</span><span class=p>:</span>
<a id=__codelineno-0-650 name=__codelineno-0-650></a>                <span class=bp>self</span><span class=o>.</span><span class=n>dlq</span> <span class=o>=</span> <span class=n>DeadLetterQueue</span><span class=p>(</span><span class=n>dlq_dir</span><span class=p>)</span>
<a id=__codelineno-0-651 name=__codelineno-0-651></a>                <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>dlq</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlq</span>
<a id=__codelineno-0-652 name=__codelineno-0-652></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Configured Dead Letter Queue at </span><span class=si>{</span><span class=n>dlq_dir</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-653 name=__codelineno-0-653></a>
<a id=__codelineno-0-654 name=__codelineno-0-654></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_error_analytics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-655 name=__codelineno-0-655></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-656 name=__codelineno-0-656></a><span class=sd>        Get error analytics summary.</span>
<a id=__codelineno-0-657 name=__codelineno-0-657></a>
<a id=__codelineno-0-658 name=__codelineno-0-658></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-659 name=__codelineno-0-659></a><span class=sd>            Dictionary with error statistics</span>
<a id=__codelineno-0-660 name=__codelineno-0-660></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-661 name=__codelineno-0-661></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>get_summary</span><span class=p>()</span>
<a id=__codelineno-0-662 name=__codelineno-0-662></a>
<a id=__codelineno-0-663 name=__codelineno-0-663></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_user</span><span class=p>(</span>
<a id=__codelineno-0-664 name=__codelineno-0-664></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>api_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-665 name=__codelineno-0-665></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-666 name=__codelineno-0-666></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-667 name=__codelineno-0-667></a><span class=sd>        Add a user to the system with specified role.</span>
<a id=__codelineno-0-668 name=__codelineno-0-668></a>
<a id=__codelineno-0-669 name=__codelineno-0-669></a><span class=sd>        Args:</span>
<a id=__codelineno-0-670 name=__codelineno-0-670></a><span class=sd>            username: Username to identify the user</span>
<a id=__codelineno-0-671 name=__codelineno-0-671></a><span class=sd>            role: Access role (admin, operator, viewer, developer)</span>
<a id=__codelineno-0-672 name=__codelineno-0-672></a><span class=sd>            api_key: Optional API key for authentication</span>
<a id=__codelineno-0-673 name=__codelineno-0-673></a>
<a id=__codelineno-0-674 name=__codelineno-0-674></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-675 name=__codelineno-0-675></a><span class=sd>            User data including generated API key if not provided</span>
<a id=__codelineno-0-676 name=__codelineno-0-676></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-677 name=__codelineno-0-677></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>enable_access_control</span><span class=p>:</span>
<a id=__codelineno-0-678 name=__codelineno-0-678></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-679 name=__codelineno-0-679></a>                <span class=s2>&quot;Access control is not enabled. Enable it in the security configuration.&quot;</span>
<a id=__codelineno-0-680 name=__codelineno-0-680></a>            <span class=p>)</span>
<a id=__codelineno-0-681 name=__codelineno-0-681></a>
<a id=__codelineno-0-682 name=__codelineno-0-682></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>add_user</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>role</span><span class=p>,</span> <span class=n>api_key</span><span class=p>)</span>
<a id=__codelineno-0-683 name=__codelineno-0-683></a>
<a id=__codelineno-0-684 name=__codelineno-0-684></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_users</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-685 name=__codelineno-0-685></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-686 name=__codelineno-0-686></a><span class=sd>        List all users in the system.</span>
<a id=__codelineno-0-687 name=__codelineno-0-687></a>
<a id=__codelineno-0-688 name=__codelineno-0-688></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-689 name=__codelineno-0-689></a><span class=sd>            List of user data dictionaries</span>
<a id=__codelineno-0-690 name=__codelineno-0-690></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-691 name=__codelineno-0-691></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>enable_access_control</span><span class=p>:</span>
<a id=__codelineno-0-692 name=__codelineno-0-692></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-693 name=__codelineno-0-693></a>                <span class=s2>&quot;Access control is not enabled. Enable it in the security configuration.&quot;</span>
<a id=__codelineno-0-694 name=__codelineno-0-694></a>            <span class=p>)</span>
<a id=__codelineno-0-695 name=__codelineno-0-695></a>
<a id=__codelineno-0-696 name=__codelineno-0-696></a>        <span class=n>users</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-697 name=__codelineno-0-697></a>        <span class=k>for</span> <span class=n>username</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>access_control</span><span class=o>.</span><span class=n>users</span><span class=p>:</span>
<a id=__codelineno-0-698 name=__codelineno-0-698></a>            <span class=n>user_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>access_control</span><span class=o>.</span><span class=n>get_user</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
<a id=__codelineno-0-699 name=__codelineno-0-699></a>            <span class=c1># Remove sensitive data like API key</span>
<a id=__codelineno-0-700 name=__codelineno-0-700></a>            <span class=k>if</span> <span class=s2>&quot;api_key&quot;</span> <span class=ow>in</span> <span class=n>user_data</span><span class=p>:</span>
<a id=__codelineno-0-701 name=__codelineno-0-701></a>                <span class=n>user_data</span><span class=p>[</span><span class=s2>&quot;api_key&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;*&quot;</span> <span class=o>*</span> <span class=mi>8</span>  <span class=c1># Mask API key</span>
<a id=__codelineno-0-702 name=__codelineno-0-702></a>            <span class=n>users</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
<a id=__codelineno-0-703 name=__codelineno-0-703></a>
<a id=__codelineno-0-704 name=__codelineno-0-704></a>        <span class=k>return</span> <span class=n>users</span>
<a id=__codelineno-0-705 name=__codelineno-0-705></a>
<a id=__codelineno-0-706 name=__codelineno-0-706></a>    <span class=k>def</span><span class=w> </span><span class=nf>store_credential</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>credential_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-0-707 name=__codelineno-0-707></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-708 name=__codelineno-0-708></a><span class=sd>        Store API credentials securely.</span>
<a id=__codelineno-0-709 name=__codelineno-0-709></a>
<a id=__codelineno-0-710 name=__codelineno-0-710></a><span class=sd>        Args:</span>
<a id=__codelineno-0-711 name=__codelineno-0-711></a><span class=sd>            name: Name to identify the credential</span>
<a id=__codelineno-0-712 name=__codelineno-0-712></a><span class=sd>            credential_data: Credential data to store</span>
<a id=__codelineno-0-713 name=__codelineno-0-713></a>
<a id=__codelineno-0-714 name=__codelineno-0-714></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-715 name=__codelineno-0-715></a><span class=sd>            True if successful, False otherwise</span>
<a id=__codelineno-0-716 name=__codelineno-0-716></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-717 name=__codelineno-0-717></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>store_credential</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>credential_data</span><span class=p>)</span>
<a id=__codelineno-0-718 name=__codelineno-0-718></a>
<a id=__codelineno-0-719 name=__codelineno-0-719></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_credential</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-720 name=__codelineno-0-720></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-721 name=__codelineno-0-721></a><span class=sd>        Get stored API credentials.</span>
<a id=__codelineno-0-722 name=__codelineno-0-722></a>
<a id=__codelineno-0-723 name=__codelineno-0-723></a><span class=sd>        Args:</span>
<a id=__codelineno-0-724 name=__codelineno-0-724></a><span class=sd>            name: Name of the credential</span>
<a id=__codelineno-0-725 name=__codelineno-0-725></a>
<a id=__codelineno-0-726 name=__codelineno-0-726></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-727 name=__codelineno-0-727></a><span class=sd>            Credential data if found, None otherwise</span>
<a id=__codelineno-0-728 name=__codelineno-0-728></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-729 name=__codelineno-0-729></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>get_credential</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
<a id=__codelineno-0-730 name=__codelineno-0-730></a>
<a id=__codelineno-0-731 name=__codelineno-0-731></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_credentials</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<a id=__codelineno-0-732 name=__codelineno-0-732></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-733 name=__codelineno-0-733></a><span class=sd>        List available credential names.</span>
<a id=__codelineno-0-734 name=__codelineno-0-734></a>
<a id=__codelineno-0-735 name=__codelineno-0-735></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-736 name=__codelineno-0-736></a><span class=sd>            List of credential names</span>
<a id=__codelineno-0-737 name=__codelineno-0-737></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-738 name=__codelineno-0-738></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>list_credentials</span><span class=p>()</span>
<a id=__codelineno-0-739 name=__codelineno-0-739></a>
<a id=__codelineno-0-740 name=__codelineno-0-740></a>    <span class=k>def</span><span class=w> </span><span class=nf>process_dlq</span><span class=p>(</span>
<a id=__codelineno-0-741 name=__codelineno-0-741></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>operation_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span>
<a id=__codelineno-0-742 name=__codelineno-0-742></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-743 name=__codelineno-0-743></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-744 name=__codelineno-0-744></a><span class=sd>        Process items in the Dead Letter Queue for retry.</span>
<a id=__codelineno-0-745 name=__codelineno-0-745></a>
<a id=__codelineno-0-746 name=__codelineno-0-746></a><span class=sd>        Args:</span>
<a id=__codelineno-0-747 name=__codelineno-0-747></a><span class=sd>            operation_type: Optional operation type to filter by</span>
<a id=__codelineno-0-748 name=__codelineno-0-748></a><span class=sd>            limit: Maximum number of items to process</span>
<a id=__codelineno-0-749 name=__codelineno-0-749></a>
<a id=__codelineno-0-750 name=__codelineno-0-750></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-751 name=__codelineno-0-751></a><span class=sd>            Dictionary with processing results</span>
<a id=__codelineno-0-752 name=__codelineno-0-752></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-753 name=__codelineno-0-753></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-754 name=__codelineno-0-754></a>            <span class=sa>f</span><span class=s2>&quot;Processing Dead Letter Queue (type=</span><span class=si>{</span><span class=n>operation_type</span><span class=si>}</span><span class=s2>, limit=</span><span class=si>{</span><span class=n>limit</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-0-755 name=__codelineno-0-755></a>        <span class=p>)</span>
<a id=__codelineno-0-756 name=__codelineno-0-756></a>
<a id=__codelineno-0-757 name=__codelineno-0-757></a>        <span class=c1># Get DLQ items</span>
<a id=__codelineno-0-758 name=__codelineno-0-758></a>        <span class=n>items</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlq</span><span class=o>.</span><span class=n>get_items</span><span class=p>(</span><span class=n>limit</span><span class=o>=</span><span class=n>limit</span><span class=p>)</span>
<a id=__codelineno-0-759 name=__codelineno-0-759></a>
<a id=__codelineno-0-760 name=__codelineno-0-760></a>        <span class=k>class</span><span class=w> </span><span class=nc>DLQResults</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>):</span>
<a id=__codelineno-0-761 name=__codelineno-0-761></a>            <span class=n>total_processed</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-0-762 name=__codelineno-0-762></a>            <span class=n>successful</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-0-763 name=__codelineno-0-763></a>            <span class=n>failed</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-0-764 name=__codelineno-0-764></a>            <span class=n>items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-765 name=__codelineno-0-765></a>
<a id=__codelineno-0-766 name=__codelineno-0-766></a>        <span class=n>results</span><span class=p>:</span> <span class=n>DLQResults</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-0-767 name=__codelineno-0-767></a>            <span class=s2>&quot;total_processed&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-768 name=__codelineno-0-768></a>            <span class=s2>&quot;successful&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-769 name=__codelineno-0-769></a>            <span class=s2>&quot;failed&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-770 name=__codelineno-0-770></a>            <span class=s2>&quot;items&quot;</span><span class=p>:</span> <span class=p>[],</span>
<a id=__codelineno-0-771 name=__codelineno-0-771></a>        <span class=p>}</span>
<a id=__codelineno-0-772 name=__codelineno-0-772></a>
<a id=__codelineno-0-773 name=__codelineno-0-773></a>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
<a id=__codelineno-0-774 name=__codelineno-0-774></a>            <span class=c1># Skip if not matching the requested operation type</span>
<a id=__codelineno-0-775 name=__codelineno-0-775></a>            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-776 name=__codelineno-0-776></a>                <span class=n>operation_type</span>
<a id=__codelineno-0-777 name=__codelineno-0-777></a>                <span class=ow>and</span> <span class=n>item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;metadata&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;operation_type&quot;</span><span class=p>)</span> <span class=o>!=</span> <span class=n>operation_type</span>
<a id=__codelineno-0-778 name=__codelineno-0-778></a>            <span class=p>):</span>
<a id=__codelineno-0-779 name=__codelineno-0-779></a>                <span class=k>continue</span>
<a id=__codelineno-0-780 name=__codelineno-0-780></a>
<a id=__codelineno-0-781 name=__codelineno-0-781></a>            <span class=n>item_id</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=s2>&quot;unknown&quot;</span><span class=p>)</span>
<a id=__codelineno-0-782 name=__codelineno-0-782></a>            <span class=n>payload</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;payload&quot;</span><span class=p>,</span> <span class=p>{})</span>
<a id=__codelineno-0-783 name=__codelineno-0-783></a>            <span class=n>metadata</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;metadata&quot;</span><span class=p>,</span> <span class=p>{})</span>
<a id=__codelineno-0-784 name=__codelineno-0-784></a>
<a id=__codelineno-0-785 name=__codelineno-0-785></a>            <span class=n>retry_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-0-786 name=__codelineno-0-786></a>                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>item_id</span><span class=p>,</span>
<a id=__codelineno-0-787 name=__codelineno-0-787></a>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-0-788 name=__codelineno-0-788></a>                <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;Operation not retried&quot;</span><span class=p>,</span>
<a id=__codelineno-0-789 name=__codelineno-0-789></a>            <span class=p>}</span>
<a id=__codelineno-0-790 name=__codelineno-0-790></a>
<a id=__codelineno-0-791 name=__codelineno-0-791></a>            <span class=c1># Determine what type of operation this is and how to retry it</span>
<a id=__codelineno-0-792 name=__codelineno-0-792></a>            <span class=k>if</span> <span class=s2>&quot;endpoint&quot;</span> <span class=ow>in</span> <span class=n>payload</span> <span class=ow>and</span> <span class=s2>&quot;source_&quot;</span> <span class=ow>in</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<a id=__codelineno-0-793 name=__codelineno-0-793></a>                <span class=s2>&quot;operation_type&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-794 name=__codelineno-0-794></a>            <span class=p>):</span>
<a id=__codelineno-0-795 name=__codelineno-0-795></a>                <span class=c1># This is a source operation</span>
<a id=__codelineno-0-796 name=__codelineno-0-796></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-797 name=__codelineno-0-797></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span>
<a id=__codelineno-0-798 name=__codelineno-0-798></a>                        <span class=n>payload</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;endpoint&quot;</span><span class=p>),</span> <span class=n>payload</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;params&quot;</span><span class=p>)</span>
<a id=__codelineno-0-799 name=__codelineno-0-799></a>                    <span class=p>)</span>
<a id=__codelineno-0-800 name=__codelineno-0-800></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;success&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-801 name=__codelineno-0-801></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Successfully retried source operation&quot;</span>
<a id=__codelineno-0-802 name=__codelineno-0-802></a>                    <span class=n>results</span><span class=p>[</span><span class=s2>&quot;successful&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-803 name=__codelineno-0-803></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-804 name=__codelineno-0-804></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-805 name=__codelineno-0-805></a>                        <span class=sa>f</span><span class=s2>&quot;Failed to retry source operation: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-806 name=__codelineno-0-806></a>                    <span class=p>)</span>
<a id=__codelineno-0-807 name=__codelineno-0-807></a>                    <span class=n>results</span><span class=p>[</span><span class=s2>&quot;failed&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-808 name=__codelineno-0-808></a>
<a id=__codelineno-0-809 name=__codelineno-0-809></a>            <span class=k>elif</span> <span class=s2>&quot;endpoint&quot;</span> <span class=ow>in</span> <span class=n>payload</span> <span class=ow>and</span> <span class=s2>&quot;target_&quot;</span> <span class=ow>in</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
<a id=__codelineno-0-810 name=__codelineno-0-810></a>                <span class=s2>&quot;operation_type&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-811 name=__codelineno-0-811></a>            <span class=p>):</span>
<a id=__codelineno-0-812 name=__codelineno-0-812></a>                <span class=c1># This is a target operation</span>
<a id=__codelineno-0-813 name=__codelineno-0-813></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-814 name=__codelineno-0-814></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;endpoint&quot;</span><span class=p>),</span> <span class=n>payload</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>))</span>
<a id=__codelineno-0-815 name=__codelineno-0-815></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;success&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-816 name=__codelineno-0-816></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Successfully retried target operation&quot;</span>
<a id=__codelineno-0-817 name=__codelineno-0-817></a>                    <span class=n>results</span><span class=p>[</span><span class=s2>&quot;successful&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-818 name=__codelineno-0-818></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-819 name=__codelineno-0-819></a>                    <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-820 name=__codelineno-0-820></a>                        <span class=sa>f</span><span class=s2>&quot;Failed to retry target operation: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-821 name=__codelineno-0-821></a>                    <span class=p>)</span>
<a id=__codelineno-0-822 name=__codelineno-0-822></a>                    <span class=n>results</span><span class=p>[</span><span class=s2>&quot;failed&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-823 name=__codelineno-0-823></a>
<a id=__codelineno-0-824 name=__codelineno-0-824></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-825 name=__codelineno-0-825></a>                <span class=c1># Unknown operation type</span>
<a id=__codelineno-0-826 name=__codelineno-0-826></a>                <span class=n>retry_result</span><span class=p>[</span><span class=s2>&quot;message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Unknown operation type - cannot retry&quot;</span>
<a id=__codelineno-0-827 name=__codelineno-0-827></a>                <span class=n>results</span><span class=p>[</span><span class=s2>&quot;failed&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-828 name=__codelineno-0-828></a>
<a id=__codelineno-0-829 name=__codelineno-0-829></a>            <span class=n>results</span><span class=p>[</span><span class=s2>&quot;total_processed&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-830 name=__codelineno-0-830></a>            <span class=n>results</span><span class=p>[</span><span class=s2>&quot;items&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>retry_result</span><span class=p>)</span>
<a id=__codelineno-0-831 name=__codelineno-0-831></a>
<a id=__codelineno-0-832 name=__codelineno-0-832></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-833 name=__codelineno-0-833></a>            <span class=sa>f</span><span class=s2>&quot;DLQ processing complete: </span><span class=si>{</span><span class=n>results</span><span class=p>[</span><span class=s1>&#39;successful&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> successful, </span><span class=si>{</span><span class=n>results</span><span class=p>[</span><span class=s1>&#39;failed&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> failed&quot;</span>
<a id=__codelineno-0-834 name=__codelineno-0-834></a>        <span class=p>)</span>
<a id=__codelineno-0-835 name=__codelineno-0-835></a>        <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
<a id=__codelineno-0-836 name=__codelineno-0-836></a>
<a id=__codelineno-0-837 name=__codelineno-0-837></a>    <span class=k>def</span><span class=w> </span><span class=nf>fetch</span><span class=p>(</span>
<a id=__codelineno-0-838 name=__codelineno-0-838></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-839 name=__codelineno-0-839></a>        <span class=n>endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-840 name=__codelineno-0-840></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-841 name=__codelineno-0-841></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-842 name=__codelineno-0-842></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-843 name=__codelineno-0-843></a><span class=sd>        Convenience wrapper to fetch data from the configured source connector.</span>
<a id=__codelineno-0-844 name=__codelineno-0-844></a>
<a id=__codelineno-0-845 name=__codelineno-0-845></a><span class=sd>        Args:</span>
<a id=__codelineno-0-846 name=__codelineno-0-846></a><span class=sd>            endpoint: Source endpoint name to fetch from</span>
<a id=__codelineno-0-847 name=__codelineno-0-847></a><span class=sd>            params: Optional parameters for the request</span>
<a id=__codelineno-0-848 name=__codelineno-0-848></a>
<a id=__codelineno-0-849 name=__codelineno-0-849></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-850 name=__codelineno-0-850></a><span class=sd>            Parsed response payload from the source API</span>
<a id=__codelineno-0-851 name=__codelineno-0-851></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-852 name=__codelineno-0-852></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>:</span>
<a id=__codelineno-0-853 name=__codelineno-0-853></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Source connector is not configured&quot;</span><span class=p>)</span>
<a id=__codelineno-0-854 name=__codelineno-0-854></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-855 name=__codelineno-0-855></a>
<a id=__codelineno-0-856 name=__codelineno-0-856></a>    <span class=k>def</span><span class=w> </span><span class=nf>send</span><span class=p>(</span>
<a id=__codelineno-0-857 name=__codelineno-0-857></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-858 name=__codelineno-0-858></a>        <span class=n>endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-859 name=__codelineno-0-859></a>        <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span>
<a id=__codelineno-0-860 name=__codelineno-0-860></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-861 name=__codelineno-0-861></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-862 name=__codelineno-0-862></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-863 name=__codelineno-0-863></a><span class=sd>        Convenience wrapper to send data to the configured target connector.</span>
<a id=__codelineno-0-864 name=__codelineno-0-864></a>
<a id=__codelineno-0-865 name=__codelineno-0-865></a><span class=sd>        Args:</span>
<a id=__codelineno-0-866 name=__codelineno-0-866></a><span class=sd>            endpoint: Target endpoint name to send to</span>
<a id=__codelineno-0-867 name=__codelineno-0-867></a><span class=sd>            data: Payload to send (single item or list)</span>
<a id=__codelineno-0-868 name=__codelineno-0-868></a>
<a id=__codelineno-0-869 name=__codelineno-0-869></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-870 name=__codelineno-0-870></a><span class=sd>            Target connector response (if any)</span>
<a id=__codelineno-0-871 name=__codelineno-0-871></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-872 name=__codelineno-0-872></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span>
<a id=__codelineno-0-873 name=__codelineno-0-873></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Target connector is not configured&quot;</span><span class=p>)</span>
<a id=__codelineno-0-874 name=__codelineno-0-874></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a id=__codelineno-0-875 name=__codelineno-0-875></a>
<a id=__codelineno-0-876 name=__codelineno-0-876></a>    <span class=k>def</span><span class=w> </span><span class=nf>sync</span><span class=p>(</span>
<a id=__codelineno-0-877 name=__codelineno-0-877></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-878 name=__codelineno-0-878></a>        <span class=n>source_endpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-879 name=__codelineno-0-879></a>        <span class=n>target_endpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-880 name=__codelineno-0-880></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-881 name=__codelineno-0-881></a>        <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-0-882 name=__codelineno-0-882></a>        <span class=n>retry_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<a id=__codelineno-0-883 name=__codelineno-0-883></a>        <span class=n>retry_backoff_factor</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>2.0</span><span class=p>,</span>
<a id=__codelineno-0-884 name=__codelineno-0-884></a>        <span class=n>retry_status_codes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-885 name=__codelineno-0-885></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SyncResult</span><span class=p>:</span>
<a id=__codelineno-0-886 name=__codelineno-0-886></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-887 name=__codelineno-0-887></a><span class=sd>        Execute a sync operation between source and target APIs.</span>
<a id=__codelineno-0-888 name=__codelineno-0-888></a>
<a id=__codelineno-0-889 name=__codelineno-0-889></a><span class=sd>        Args:</span>
<a id=__codelineno-0-890 name=__codelineno-0-890></a><span class=sd>            source_endpoint: Source endpoint to use (overrides mapping)</span>
<a id=__codelineno-0-891 name=__codelineno-0-891></a><span class=sd>            target_endpoint: Target endpoint to use (overrides mapping)</span>
<a id=__codelineno-0-892 name=__codelineno-0-892></a><span class=sd>            params: Additional parameters for the source API call</span>
<a id=__codelineno-0-893 name=__codelineno-0-893></a><span class=sd>            max_retries: Maximum number of retry attempts for transient failures</span>
<a id=__codelineno-0-894 name=__codelineno-0-894></a><span class=sd>            retry_delay: Initial delay between retries in seconds</span>
<a id=__codelineno-0-895 name=__codelineno-0-895></a><span class=sd>            retry_backoff_factor: Multiplicative factor for retry delay</span>
<a id=__codelineno-0-896 name=__codelineno-0-896></a><span class=sd>            retry_status_codes: HTTP status codes to retry (default: 429, 502, 503, 504)</span>
<a id=__codelineno-0-897 name=__codelineno-0-897></a>
<a id=__codelineno-0-898 name=__codelineno-0-898></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-899 name=__codelineno-0-899></a><span class=sd>            SyncResult: Result of the sync operation</span>
<a id=__codelineno-0-900 name=__codelineno-0-900></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-901 name=__codelineno-0-901></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span>
<a id=__codelineno-0-902 name=__codelineno-0-902></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-903 name=__codelineno-0-903></a>                <span class=s2>&quot;Source and target connectors must be configured before syncing&quot;</span>
<a id=__codelineno-0-904 name=__codelineno-0-904></a>            <span class=p>)</span>
<a id=__codelineno-0-905 name=__codelineno-0-905></a>
<a id=__codelineno-0-906 name=__codelineno-0-906></a>        <span class=c1># If no endpoints specified, use the first mapping</span>
<a id=__codelineno-0-907 name=__codelineno-0-907></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>source_endpoint</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>target_endpoint</span><span class=p>:</span>
<a id=__codelineno-0-908 name=__codelineno-0-908></a>            <span class=n>mapping</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>get_first_mapping</span><span class=p>()</span>
<a id=__codelineno-0-909 name=__codelineno-0-909></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>mapping</span><span class=p>:</span>
<a id=__codelineno-0-910 name=__codelineno-0-910></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;No mapping configured and no endpoints specified&quot;</span><span class=p>)</span>
<a id=__codelineno-0-911 name=__codelineno-0-911></a>            <span class=n>source_endpoint</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span>
<a id=__codelineno-0-912 name=__codelineno-0-912></a>            <span class=n>target_endpoint</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;target&quot;</span><span class=p>]</span>
<a id=__codelineno-0-913 name=__codelineno-0-913></a>
<a id=__codelineno-0-914 name=__codelineno-0-914></a>        <span class=c1># Generate correlation ID for this sync operation</span>
<a id=__codelineno-0-915 name=__codelineno-0-915></a>        <span class=n>correlation_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
<a id=__codelineno-0-916 name=__codelineno-0-916></a>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-917 name=__codelineno-0-917></a>
<a id=__codelineno-0-918 name=__codelineno-0-918></a>        <span class=c1># Wrap entire sync operation in distributed tracing</span>
<a id=__codelineno-0-919 name=__codelineno-0-919></a>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>trace_sync</span><span class=p>(</span>
<a id=__codelineno-0-920 name=__codelineno-0-920></a>            <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=n>correlation_id</span>
<a id=__codelineno-0-921 name=__codelineno-0-921></a>        <span class=p>):</span>
<a id=__codelineno-0-922 name=__codelineno-0-922></a>            <span class=c1># Start provenance</span>
<a id=__codelineno-0-923 name=__codelineno-0-923></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>start_run</span><span class=p>(</span>
<a id=__codelineno-0-924 name=__codelineno-0-924></a>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>,</span>
<a id=__codelineno-0-925 name=__codelineno-0-925></a>                <span class=n>config_path</span><span class=o>=</span><span class=p>(</span>
<a id=__codelineno-0-926 name=__codelineno-0-926></a>                    <span class=n>config_path</span>
<a id=__codelineno-0-927 name=__codelineno-0-927></a>                    <span class=k>if</span> <span class=p>(</span><span class=n>config_path</span> <span class=o>:=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;_last_config_path&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span>
<a id=__codelineno-0-928 name=__codelineno-0-928></a>                    <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-929 name=__codelineno-0-929></a>                <span class=p>),</span>
<a id=__codelineno-0-930 name=__codelineno-0-930></a>                <span class=n>source_endpoint</span><span class=o>=</span><span class=n>source_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-931 name=__codelineno-0-931></a>                <span class=n>target_endpoint</span><span class=o>=</span><span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-932 name=__codelineno-0-932></a>            <span class=p>)</span>
<a id=__codelineno-0-933 name=__codelineno-0-933></a>
<a id=__codelineno-0-934 name=__codelineno-0-934></a>            <span class=c1># Default retry status codes if none provided</span>
<a id=__codelineno-0-935 name=__codelineno-0-935></a>            <span class=k>if</span> <span class=n>retry_status_codes</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-936 name=__codelineno-0-936></a>                <span class=n>retry_status_codes</span> <span class=o>=</span> <span class=p>[</span><span class=mi>429</span><span class=p>,</span> <span class=mi>502</span><span class=p>,</span> <span class=mi>503</span><span class=p>,</span> <span class=mi>504</span><span class=p>]</span>  <span class=c1># Common transient failures</span>
<a id=__codelineno-0-937 name=__codelineno-0-937></a>
<a id=__codelineno-0-938 name=__codelineno-0-938></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-939 name=__codelineno-0-939></a>                <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Starting sync from </span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-940 name=__codelineno-0-940></a>            <span class=p>)</span>
<a id=__codelineno-0-941 name=__codelineno-0-941></a>
<a id=__codelineno-0-942 name=__codelineno-0-942></a>            <span class=c1># Initialize result object</span>
<a id=__codelineno-0-943 name=__codelineno-0-943></a>            <span class=n>sync_result</span> <span class=o>=</span> <span class=n>SyncResult</span><span class=p>(</span><span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>)</span>
<a id=__codelineno-0-944 name=__codelineno-0-944></a>
<a id=__codelineno-0-945 name=__codelineno-0-945></a>            <span class=c1># Get circuit breaker for source endpoint</span>
<a id=__codelineno-0-946 name=__codelineno-0-946></a>            <span class=n>source_circuit_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;source_</span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-947 name=__codelineno-0-947></a>            <span class=n>source_cb</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>get_circuit_breaker</span><span class=p>(</span>
<a id=__codelineno-0-948 name=__codelineno-0-948></a>                <span class=n>source_circuit_name</span>
<a id=__codelineno-0-949 name=__codelineno-0-949></a>            <span class=p>)</span>
<a id=__codelineno-0-950 name=__codelineno-0-950></a>
<a id=__codelineno-0-951 name=__codelineno-0-951></a>            <span class=c1># Check if user has permission for this operation</span>
<a id=__codelineno-0-952 name=__codelineno-0-952></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>enable_access_control</span><span class=p>:</span>
<a id=__codelineno-0-953 name=__codelineno-0-953></a>                <span class=n>current_user</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;current_user&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-954 name=__codelineno-0-954></a>                <span class=k>if</span> <span class=n>current_user</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>check_permission</span><span class=p>(</span>
<a id=__codelineno-0-955 name=__codelineno-0-955></a>                    <span class=n>current_user</span><span class=p>,</span> <span class=s2>&quot;run_sync&quot;</span>
<a id=__codelineno-0-956 name=__codelineno-0-956></a>                <span class=p>):</span>
<a id=__codelineno-0-957 name=__codelineno-0-957></a>                    <span class=k>raise</span> <span class=ne>PermissionError</span><span class=p>(</span>
<a id=__codelineno-0-958 name=__codelineno-0-958></a>                        <span class=sa>f</span><span class=s2>&quot;User </span><span class=si>{</span><span class=n>current_user</span><span class=si>}</span><span class=s2> does not have permission to run sync operations&quot;</span>
<a id=__codelineno-0-959 name=__codelineno-0-959></a>                    <span class=p>)</span>
<a id=__codelineno-0-960 name=__codelineno-0-960></a>
<a id=__codelineno-0-961 name=__codelineno-0-961></a>            <span class=c1># Merge last_sync into params from state store if not provided</span>
<a id=__codelineno-0-962 name=__codelineno-0-962></a>            <span class=k>if</span> <span class=n>params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-963 name=__codelineno-0-963></a>                <span class=n>effective_params</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-964 name=__codelineno-0-964></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-965 name=__codelineno-0-965></a>                <span class=n>effective_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-966 name=__codelineno-0-966></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span>
<a id=__codelineno-0-967 name=__codelineno-0-967></a>                <span class=c1># Ensure we have a dict if we are going to inject</span>
<a id=__codelineno-0-968 name=__codelineno-0-968></a>                <span class=n>need_inject</span> <span class=o>=</span> <span class=p>(</span><span class=n>effective_params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span>
<a id=__codelineno-0-969 name=__codelineno-0-969></a>                    <span class=s2>&quot;updated_since&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>effective_params</span>
<a id=__codelineno-0-970 name=__codelineno-0-970></a>                <span class=p>)</span>
<a id=__codelineno-0-971 name=__codelineno-0-971></a>                <span class=k>if</span> <span class=n>need_inject</span><span class=p>:</span>
<a id=__codelineno-0-972 name=__codelineno-0-972></a>                    <span class=n>last_sync</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=o>.</span><span class=n>get_last_sync</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>)</span>
<a id=__codelineno-0-973 name=__codelineno-0-973></a>                    <span class=k>if</span> <span class=n>last_sync</span><span class=p>:</span>
<a id=__codelineno-0-974 name=__codelineno-0-974></a>                        <span class=n>effective_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>effective_params</span> <span class=ow>or</span> <span class=p>{})</span>
<a id=__codelineno-0-975 name=__codelineno-0-975></a>                        <span class=n>effective_params</span><span class=p>[</span><span class=s2>&quot;updated_since&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>last_sync</span>
<a id=__codelineno-0-976 name=__codelineno-0-976></a>
<a id=__codelineno-0-977 name=__codelineno-0-977></a>            <span class=c1># Always use standard non-encrypted call</span>
<a id=__codelineno-0-978 name=__codelineno-0-978></a>            <span class=n>source_data</span><span class=p>,</span> <span class=n>source_error</span> <span class=o>=</span> <span class=n>source_cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
<a id=__codelineno-0-979 name=__codelineno-0-979></a>                <span class=k>lambda</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>,</span> <span class=n>effective_params</span><span class=p>)</span>
<a id=__codelineno-0-980 name=__codelineno-0-980></a>            <span class=p>)</span>
<a id=__codelineno-0-981 name=__codelineno-0-981></a>
<a id=__codelineno-0-982 name=__codelineno-0-982></a>            <span class=c1># If circuit breaker failed, try recovery strategies</span>
<a id=__codelineno-0-983 name=__codelineno-0-983></a>            <span class=k>if</span> <span class=n>source_error</span><span class=p>:</span>
<a id=__codelineno-0-984 name=__codelineno-0-984></a>                <span class=c1># Create payload for retry</span>
<a id=__codelineno-0-985 name=__codelineno-0-985></a>                <span class=n>fetch_payload</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>source_endpoint</span><span class=p>,</span> <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=n>params</span><span class=p>}</span>
<a id=__codelineno-0-986 name=__codelineno-0-986></a>
<a id=__codelineno-0-987 name=__codelineno-0-987></a>                <span class=c1># Apply recovery strategies</span>
<a id=__codelineno-0-988 name=__codelineno-0-988></a>                <span class=n>success</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>handle_error</span><span class=p>(</span>
<a id=__codelineno-0-989 name=__codelineno-0-989></a>                    <span class=n>error</span><span class=o>=</span><span class=n>source_error</span><span class=p>,</span>
<a id=__codelineno-0-990 name=__codelineno-0-990></a>                    <span class=n>payload</span><span class=o>=</span><span class=n>fetch_payload</span><span class=p>,</span>
<a id=__codelineno-0-991 name=__codelineno-0-991></a>                    <span class=n>operation</span><span class=o>=</span><span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span>
<a id=__codelineno-0-992 name=__codelineno-0-992></a>                        <span class=n>p</span><span class=p>[</span><span class=s2>&quot;endpoint&quot;</span><span class=p>],</span> <span class=n>p</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>]</span>
<a id=__codelineno-0-993 name=__codelineno-0-993></a>                    <span class=p>),</span>
<a id=__codelineno-0-994 name=__codelineno-0-994></a>                    <span class=n>operation_type</span><span class=o>=</span><span class=n>source_circuit_name</span><span class=p>,</span>
<a id=__codelineno-0-995 name=__codelineno-0-995></a>                    <span class=n>max_retries</span><span class=o>=</span><span class=n>max_retries</span><span class=p>,</span>
<a id=__codelineno-0-996 name=__codelineno-0-996></a>                    <span class=n>retry_delay</span><span class=o>=</span><span class=n>retry_delay</span><span class=p>,</span>
<a id=__codelineno-0-997 name=__codelineno-0-997></a>                    <span class=n>retry_backoff_factor</span><span class=o>=</span><span class=n>retry_backoff_factor</span><span class=p>,</span>
<a id=__codelineno-0-998 name=__codelineno-0-998></a>                <span class=p>)</span>
<a id=__codelineno-0-999 name=__codelineno-0-999></a>
<a id=__codelineno-0-1000 name=__codelineno-0-1000></a>                <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
<a id=__codelineno-0-1001 name=__codelineno-0-1001></a>                    <span class=n>source_data</span> <span class=o>=</span> <span class=n>result</span>
<a id=__codelineno-0-1002 name=__codelineno-0-1002></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1003 name=__codelineno-0-1003></a>                    <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1004 name=__codelineno-0-1004></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1005 name=__codelineno-0-1005></a>
<a id=__codelineno-0-1006 name=__codelineno-0-1006></a>                    <span class=c1># Update result with error details</span>
<a id=__codelineno-0-1007 name=__codelineno-0-1007></a>                    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1008 name=__codelineno-0-1008></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1009 name=__codelineno-0-1009></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1010 name=__codelineno-0-1010></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1011 name=__codelineno-0-1011></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1012 name=__codelineno-0-1012></a>                    <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1013 name=__codelineno-0-1013></a>
<a id=__codelineno-0-1014 name=__codelineno-0-1014></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1015 name=__codelineno-0-1015></a>                <span class=c1># Map fields according to configuration</span>
<a id=__codelineno-0-1016 name=__codelineno-0-1016></a>                <span class=n>transformed_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>map_data</span><span class=p>(</span>
<a id=__codelineno-0-1017 name=__codelineno-0-1017></a>                    <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=n>source_data</span>
<a id=__codelineno-0-1018 name=__codelineno-0-1018></a>                <span class=p>)</span>
<a id=__codelineno-0-1019 name=__codelineno-0-1019></a>
<a id=__codelineno-0-1020 name=__codelineno-0-1020></a>                <span class=c1># Optional strict validation against target request schema (if defined in connector)</span>
<a id=__codelineno-0-1021 name=__codelineno-0-1021></a>                <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-1022 name=__codelineno-0-1022></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>validation_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;strict_mode&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1023 name=__codelineno-0-1023></a>                    <span class=ow>and</span> <span class=n>is_validator_available</span><span class=p>()</span>
<a id=__codelineno-0-1024 name=__codelineno-0-1024></a>                <span class=p>):</span>
<a id=__codelineno-0-1025 name=__codelineno-0-1025></a>                    <span class=n>target_endpoint_cfg</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1026 name=__codelineno-0-1026></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>endpoints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>)</span>
<a id=__codelineno-0-1027 name=__codelineno-0-1027></a>                        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span>
<a id=__codelineno-0-1028 name=__codelineno-0-1028></a>                        <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-1029 name=__codelineno-0-1029></a>                    <span class=p>)</span>
<a id=__codelineno-0-1030 name=__codelineno-0-1030></a>                    <span class=k>if</span> <span class=n>target_endpoint_cfg</span> <span class=ow>and</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span><span class=p>:</span>
<a id=__codelineno-0-1031 name=__codelineno-0-1031></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1032 name=__codelineno-0-1032></a>                            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>transformed_data</span><span class=p>:</span>
<a id=__codelineno-0-1033 name=__codelineno-0-1033></a>                                <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1034 name=__codelineno-0-1034></a>                                    <span class=n>item</span><span class=p>,</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1035 name=__codelineno-0-1035></a>                                <span class=p>)</span>
<a id=__codelineno-0-1036 name=__codelineno-0-1036></a>                                <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1037 name=__codelineno-0-1037></a>                                    <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1038 name=__codelineno-0-1038></a>                                        <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Strict mode: target payload failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1039 name=__codelineno-0-1039></a>                                        <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1040 name=__codelineno-0-1040></a>                                        <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1041 name=__codelineno-0-1041></a>                                        <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1042 name=__codelineno-0-1042></a>                                    <span class=p>)</span>
<a id=__codelineno-0-1043 name=__codelineno-0-1043></a>                        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1044 name=__codelineno-0-1044></a>                            <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1045 name=__codelineno-0-1045></a>                                <span class=n>transformed_data</span><span class=p>,</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1046 name=__codelineno-0-1046></a>                            <span class=p>)</span>
<a id=__codelineno-0-1047 name=__codelineno-0-1047></a>                            <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1048 name=__codelineno-0-1048></a>                                <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1049 name=__codelineno-0-1049></a>                                    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Strict mode: target payload failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1050 name=__codelineno-0-1050></a>                                    <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1051 name=__codelineno-0-1051></a>                                    <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1052 name=__codelineno-0-1052></a>                                    <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1053 name=__codelineno-0-1053></a>                                <span class=p>)</span>
<a id=__codelineno-0-1054 name=__codelineno-0-1054></a>
<a id=__codelineno-0-1055 name=__codelineno-0-1055></a>                <span class=c1># Record source data metrics</span>
<a id=__codelineno-0-1056 name=__codelineno-0-1056></a>                <span class=n>source_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>source_data</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>source_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=k>else</span> <span class=mi>1</span>
<a id=__codelineno-0-1057 name=__codelineno-0-1057></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>details</span><span class=p>[</span><span class=s2>&quot;source_count&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_count</span>
<a id=__codelineno-0-1058 name=__codelineno-0-1058></a>
<a id=__codelineno-0-1059 name=__codelineno-0-1059></a>                <span class=c1># Get circuit breaker for target endpoint</span>
<a id=__codelineno-0-1060 name=__codelineno-0-1060></a>                <span class=n>target_circuit_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;target_</span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1061 name=__codelineno-0-1061></a>                <span class=n>target_cb</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>get_circuit_breaker</span><span class=p>(</span>
<a id=__codelineno-0-1062 name=__codelineno-0-1062></a>                    <span class=n>target_circuit_name</span>
<a id=__codelineno-0-1063 name=__codelineno-0-1063></a>                <span class=p>)</span>
<a id=__codelineno-0-1064 name=__codelineno-0-1064></a>
<a id=__codelineno-0-1065 name=__codelineno-0-1065></a>                <span class=c1># Idempotency: skip payloads we&#39;ve already sent during replays</span>
<a id=__codelineno-0-1066 name=__codelineno-0-1066></a>                <span class=k>def</span><span class=w> </span><span class=nf>_send</span><span class=p>():</span>
<a id=__codelineno-0-1067 name=__codelineno-0-1067></a>                    <span class=c1># If idempotency enabled, de-duplicate per item</span>
<a id=__codelineno-0-1068 name=__codelineno-0-1068></a>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span>
<a id=__codelineno-0-1069 name=__codelineno-0-1069></a>                        <span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span>
<a id=__codelineno-0-1070 name=__codelineno-0-1070></a>                    <span class=p>):</span>
<a id=__codelineno-0-1071 name=__codelineno-0-1071></a>                        <span class=n>salt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;salt&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1072 name=__codelineno-0-1072></a>                        <span class=n>filtered</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1073 name=__codelineno-0-1073></a>                        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>transformed_data</span><span class=p>:</span>
<a id=__codelineno-0-1074 name=__codelineno-0-1074></a>                            <span class=n>key</span> <span class=o>=</span> <span class=n>generate_idempotency_key</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>salt</span><span class=o>=</span><span class=n>salt</span><span class=p>)</span>
<a id=__codelineno-0-1075 name=__codelineno-0-1075></a>                            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span><span class=o>.</span><span class=n>has_seen</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
<a id=__codelineno-0-1076 name=__codelineno-0-1076></a>                                <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span><span class=o>.</span><span class=n>mark_seen</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
<a id=__codelineno-0-1077 name=__codelineno-0-1077></a>                                <span class=n>filtered</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a id=__codelineno-0-1078 name=__codelineno-0-1078></a>                        <span class=n>payload</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>filtered</span>
<a id=__codelineno-0-1079 name=__codelineno-0-1079></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1080 name=__codelineno-0-1080></a>                        <span class=n>payload</span> <span class=o>=</span> <span class=n>transformed_data</span>
<a id=__codelineno-0-1081 name=__codelineno-0-1081></a>                    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
<a id=__codelineno-0-1082 name=__codelineno-0-1082></a>
<a id=__codelineno-0-1083 name=__codelineno-0-1083></a>                <span class=c1># Always use standard non-encrypted call</span>
<a id=__codelineno-0-1084 name=__codelineno-0-1084></a>                <span class=n>target_result</span><span class=p>,</span> <span class=n>target_error</span> <span class=o>=</span> <span class=n>target_cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>_send</span><span class=p>)</span>
<a id=__codelineno-0-1085 name=__codelineno-0-1085></a>
<a id=__codelineno-0-1086 name=__codelineno-0-1086></a>                <span class=c1># If circuit breaker failed, try recovery strategies</span>
<a id=__codelineno-0-1087 name=__codelineno-0-1087></a>                <span class=k>if</span> <span class=n>target_error</span><span class=p>:</span>
<a id=__codelineno-0-1088 name=__codelineno-0-1088></a>                    <span class=c1># Create payload for retry</span>
<a id=__codelineno-0-1089 name=__codelineno-0-1089></a>                    <span class=n>send_payload</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-0-1090 name=__codelineno-0-1090></a>                        <span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-1091 name=__codelineno-0-1091></a>                        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=n>transformed_data</span><span class=p>,</span>
<a id=__codelineno-0-1092 name=__codelineno-0-1092></a>                    <span class=p>}</span>
<a id=__codelineno-0-1093 name=__codelineno-0-1093></a>
<a id=__codelineno-0-1094 name=__codelineno-0-1094></a>                    <span class=c1># Apply recovery strategies</span>
<a id=__codelineno-0-1095 name=__codelineno-0-1095></a>                    <span class=n>success</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>handle_error</span><span class=p>(</span>
<a id=__codelineno-0-1096 name=__codelineno-0-1096></a>                        <span class=n>error</span><span class=o>=</span><span class=n>target_error</span><span class=p>,</span>
<a id=__codelineno-0-1097 name=__codelineno-0-1097></a>                        <span class=n>payload</span><span class=o>=</span><span class=n>send_payload</span><span class=p>,</span>
<a id=__codelineno-0-1098 name=__codelineno-0-1098></a>                        <span class=n>operation</span><span class=o>=</span><span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span>
<a id=__codelineno-0-1099 name=__codelineno-0-1099></a>                            <span class=n>p</span><span class=p>[</span><span class=s2>&quot;endpoint&quot;</span><span class=p>],</span> <span class=n>p</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span>
<a id=__codelineno-0-1100 name=__codelineno-0-1100></a>                        <span class=p>),</span>
<a id=__codelineno-0-1101 name=__codelineno-0-1101></a>                        <span class=n>operation_type</span><span class=o>=</span><span class=n>target_circuit_name</span><span class=p>,</span>
<a id=__codelineno-0-1102 name=__codelineno-0-1102></a>                        <span class=n>max_retries</span><span class=o>=</span><span class=n>max_retries</span><span class=p>,</span>
<a id=__codelineno-0-1103 name=__codelineno-0-1103></a>                        <span class=n>retry_delay</span><span class=o>=</span><span class=n>retry_delay</span><span class=p>,</span>
<a id=__codelineno-0-1104 name=__codelineno-0-1104></a>                        <span class=n>retry_backoff_factor</span><span class=o>=</span><span class=n>retry_backoff_factor</span><span class=p>,</span>
<a id=__codelineno-0-1105 name=__codelineno-0-1105></a>                    <span class=p>)</span>
<a id=__codelineno-0-1106 name=__codelineno-0-1106></a>
<a id=__codelineno-0-1107 name=__codelineno-0-1107></a>                    <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
<a id=__codelineno-0-1108 name=__codelineno-0-1108></a>                        <span class=n>target_result</span> <span class=o>=</span> <span class=n>result</span>
<a id=__codelineno-0-1109 name=__codelineno-0-1109></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1110 name=__codelineno-0-1110></a>                        <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1111 name=__codelineno-0-1111></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1112 name=__codelineno-0-1112></a>
<a id=__codelineno-0-1113 name=__codelineno-0-1113></a>                        <span class=c1># Update result with error details</span>
<a id=__codelineno-0-1114 name=__codelineno-0-1114></a>                        <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1115 name=__codelineno-0-1115></a>                        <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1116 name=__codelineno-0-1116></a>                        <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1117 name=__codelineno-0-1117></a>                        <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1118 name=__codelineno-0-1118></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1119 name=__codelineno-0-1119></a>                        <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
<a id=__codelineno-0-1121 name=__codelineno-0-1121></a>                <span class=c1># Update result with success information</span>
<a id=__codelineno-0-1122 name=__codelineno-0-1122></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1123 name=__codelineno-0-1123></a>                    <span class=nb>len</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=k>else</span> <span class=mi>1</span>
<a id=__codelineno-0-1124 name=__codelineno-0-1124></a>                <span class=p>)</span>
<a id=__codelineno-0-1125 name=__codelineno-0-1125></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-1126 name=__codelineno-0-1126></a>
<a id=__codelineno-0-1127 name=__codelineno-0-1127></a>                <span class=c1># Set target response directly</span>
<a id=__codelineno-0-1128 name=__codelineno-0-1128></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>target_result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-1129 name=__codelineno-0-1129></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>target_response</span> <span class=o>=</span> <span class=n>target_result</span>
<a id=__codelineno-0-1130 name=__codelineno-0-1130></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1131 name=__codelineno-0-1131></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>target_response</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-1132 name=__codelineno-0-1132></a>
<a id=__codelineno-0-1133 name=__codelineno-0-1133></a>                <span class=c1># Calculate duration</span>
<a id=__codelineno-0-1134 name=__codelineno-0-1134></a>                <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1135 name=__codelineno-0-1135></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1136 name=__codelineno-0-1136></a>
<a id=__codelineno-0-1137 name=__codelineno-0-1137></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1138 name=__codelineno-0-1138></a>                    <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync completed successfully: </span><span class=si>{</span><span class=n>sync_result</span><span class=o>.</span><span class=n>count</span><span class=si>}</span><span class=s2> items transferred in </span><span class=si>{</span><span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span><span class=si>}</span><span class=s2>ms&quot;</span>
<a id=__codelineno-0-1139 name=__codelineno-0-1139></a>                <span class=p>)</span>
<a id=__codelineno-0-1140 name=__codelineno-0-1140></a>                <span class=c1># Update last_sync checkpoint</span>
<a id=__codelineno-0-1141 name=__codelineno-0-1141></a>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span>
<a id=__codelineno-0-1142 name=__codelineno-0-1142></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=o>.</span><span class=n>set_last_sync</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>,</span> <span class=n>now_iso</span><span class=p>())</span>
<a id=__codelineno-0-1143 name=__codelineno-0-1143></a>                <span class=c1># Complete provenance</span>
<a id=__codelineno-0-1144 name=__codelineno-0-1144></a>                <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>complete_run</span><span class=p>(</span>
<a id=__codelineno-0-1145 name=__codelineno-0-1145></a>                    <span class=kc>True</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>details</span>
<a id=__codelineno-0-1146 name=__codelineno-0-1146></a>                <span class=p>)</span>
<a id=__codelineno-0-1147 name=__codelineno-0-1147></a>
<a id=__codelineno-0-1148 name=__codelineno-0-1148></a>                <span class=c1># Record telemetry metrics</span>
<a id=__codelineno-0-1149 name=__codelineno-0-1149></a>                <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_sync_completion</span><span class=p>(</span>
<a id=__codelineno-0-1150 name=__codelineno-0-1150></a>                    <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span>
<a id=__codelineno-0-1151 name=__codelineno-0-1151></a>                <span class=p>)</span>
<a id=__codelineno-0-1152 name=__codelineno-0-1152></a>
<a id=__codelineno-0-1153 name=__codelineno-0-1153></a>                <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
<a id=__codelineno-0-1155 name=__codelineno-0-1155></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1156 name=__codelineno-0-1156></a>                <span class=c1># Convert to ApiLinkerError</span>
<a id=__codelineno-0-1157 name=__codelineno-0-1157></a>                <span class=n>error</span> <span class=o>=</span> <span class=n>ApiLinkerError</span><span class=o>.</span><span class=n>from_exception</span><span class=p>(</span>
<a id=__codelineno-0-1158 name=__codelineno-0-1158></a>                    <span class=n>e</span><span class=p>,</span>
<a id=__codelineno-0-1159 name=__codelineno-0-1159></a>                    <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>MAPPING</span><span class=p>,</span>
<a id=__codelineno-0-1160 name=__codelineno-0-1160></a>                    <span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>,</span>
<a id=__codelineno-0-1161 name=__codelineno-0-1161></a>                    <span class=n>operation_id</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;mapping_</span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2>_to_</span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1162 name=__codelineno-0-1162></a>                <span class=p>)</span>
<a id=__codelineno-0-1163 name=__codelineno-0-1163></a>
<a id=__codelineno-0-1164 name=__codelineno-0-1164></a>                <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1165 name=__codelineno-0-1165></a>                <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1166 name=__codelineno-0-1166></a>
<a id=__codelineno-0-1167 name=__codelineno-0-1167></a>                <span class=c1># Update result</span>
<a id=__codelineno-0-1168 name=__codelineno-0-1168></a>                <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1169 name=__codelineno-0-1169></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1170 name=__codelineno-0-1170></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1171 name=__codelineno-0-1171></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1172 name=__codelineno-0-1172></a>
<a id=__codelineno-0-1173 name=__codelineno-0-1173></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
<a id=__codelineno-0-1174 name=__codelineno-0-1174></a>                    <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed during mapping: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1175 name=__codelineno-0-1175></a>                <span class=p>)</span>
<a id=__codelineno-0-1176 name=__codelineno-0-1176></a>                <span class=c1># Record error in provenance</span>
<a id=__codelineno-0-1177 name=__codelineno-0-1177></a>                <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span>
<a id=__codelineno-0-1178 name=__codelineno-0-1178></a>                    <span class=n>error</span><span class=o>.</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-1179 name=__codelineno-0-1179></a>                    <span class=n>category</span><span class=o>=</span><span class=n>error</span><span class=o>.</span><span class=n>error_category</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<a id=__codelineno-0-1180 name=__codelineno-0-1180></a>                    <span class=n>status_code</span><span class=o>=</span><span class=n>error</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1181 name=__codelineno-0-1181></a>                    <span class=n>endpoint</span><span class=o>=</span><span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-1182 name=__codelineno-0-1182></a>                <span class=p>)</span>
<a id=__codelineno-0-1183 name=__codelineno-0-1183></a>                <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>complete_run</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=p>{})</span>
<a id=__codelineno-0-1184 name=__codelineno-0-1184></a>
<a id=__codelineno-0-1185 name=__codelineno-0-1185></a>                <span class=c1># Record telemetry metrics</span>
<a id=__codelineno-0-1186 name=__codelineno-0-1186></a>                <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_sync_completion</span><span class=p>(</span>
<a id=__codelineno-0-1187 name=__codelineno-0-1187></a>                    <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=mi>0</span>
<a id=__codelineno-0-1188 name=__codelineno-0-1188></a>                <span class=p>)</span>
<a id=__codelineno-0-1189 name=__codelineno-0-1189></a>                <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span>
<a id=__codelineno-0-1190 name=__codelineno-0-1190></a>                    <span class=n>error</span><span class=o>.</span><span class=n>error_category</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=s2>&quot;sync&quot;</span><span class=p>,</span> <span class=n>error</span><span class=o>.</span><span class=n>message</span>
<a id=__codelineno-0-1191 name=__codelineno-0-1191></a>                <span class=p>)</span>
<a id=__codelineno-0-1192 name=__codelineno-0-1192></a>
<a id=__codelineno-0-1193 name=__codelineno-0-1193></a>            <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1194 name=__codelineno-0-1194></a>
<a id=__codelineno-0-1195 name=__codelineno-0-1195></a>    <span class=k>def</span><span class=w> </span><span class=nf>start_scheduled_sync</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-1196 name=__codelineno-0-1196></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Start scheduled sync operations.&quot;&quot;&quot;</span>
<a id=__codelineno-0-1197 name=__codelineno-0-1197></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Starting scheduled sync&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1198 name=__codelineno-0-1198></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=o>.</span><span class=n>start</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sync</span><span class=p>)</span>
<a id=__codelineno-0-1199 name=__codelineno-0-1199></a>
<a id=__codelineno-0-1200 name=__codelineno-0-1200></a>    <span class=k>def</span><span class=w> </span><span class=nf>stop_scheduled_sync</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-1201 name=__codelineno-0-1201></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Stop scheduled sync operations.&quot;&quot;&quot;</span>
<a id=__codelineno-0-1202 name=__codelineno-0-1202></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Stopping scheduled sync&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1203 name=__codelineno-0-1203></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
<a id=__codelineno-0-1204 name=__codelineno-0-1204></a>
<a id=__codelineno-0-1205 name=__codelineno-0-1205></a>    <span class=k>def</span><span class=w> </span><span class=nf>_with_retries</span><span class=p>(</span>
<a id=__codelineno-0-1206 name=__codelineno-0-1206></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-1207 name=__codelineno-0-1207></a>        <span class=n>operation</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>Any</span><span class=p>],</span>
<a id=__codelineno-0-1208 name=__codelineno-0-1208></a>        <span class=n>operation_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-1209 name=__codelineno-0-1209></a>        <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<a id=__codelineno-0-1210 name=__codelineno-0-1210></a>        <span class=n>retry_delay</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
<a id=__codelineno-0-1211 name=__codelineno-0-1211></a>        <span class=n>retry_backoff_factor</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
<a id=__codelineno-0-1212 name=__codelineno-0-1212></a>        <span class=n>retry_status_codes</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span>
<a id=__codelineno-0-1213 name=__codelineno-0-1213></a>        <span class=n>correlation_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-1214 name=__codelineno-0-1214></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ErrorDetail</span><span class=p>]]:</span>
<a id=__codelineno-0-1215 name=__codelineno-0-1215></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-1216 name=__codelineno-0-1216></a><span class=sd>        Execute an operation with configurable retry logic for transient failures.</span>
<a id=__codelineno-0-1217 name=__codelineno-0-1217></a>
<a id=__codelineno-0-1218 name=__codelineno-0-1218></a><span class=sd>        Args:</span>
<a id=__codelineno-0-1219 name=__codelineno-0-1219></a><span class=sd>            operation: Callable function to execute</span>
<a id=__codelineno-0-1220 name=__codelineno-0-1220></a><span class=sd>            operation_name: Name of operation for logging</span>
<a id=__codelineno-0-1221 name=__codelineno-0-1221></a><span class=sd>            max_retries: Maximum number of retry attempts</span>
<a id=__codelineno-0-1222 name=__codelineno-0-1222></a><span class=sd>            retry_delay: Initial delay between retries in seconds</span>
<a id=__codelineno-0-1223 name=__codelineno-0-1223></a><span class=sd>            retry_backoff_factor: Multiplicative factor for retry delay</span>
<a id=__codelineno-0-1224 name=__codelineno-0-1224></a><span class=sd>            retry_status_codes: HTTP status codes that should trigger a retry</span>
<a id=__codelineno-0-1225 name=__codelineno-0-1225></a><span class=sd>            correlation_id: Correlation ID for tracing</span>
<a id=__codelineno-0-1226 name=__codelineno-0-1226></a>
<a id=__codelineno-0-1227 name=__codelineno-0-1227></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-1228 name=__codelineno-0-1228></a><span class=sd>            Tuple of (result, error_detail) - If successful, error_detail will be None</span>
<a id=__codelineno-0-1229 name=__codelineno-0-1229></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-1230 name=__codelineno-0-1230></a>        <span class=n>current_delay</span> <span class=o>=</span> <span class=n>retry_delay</span>
<a id=__codelineno-0-1231 name=__codelineno-0-1231></a>
<a id=__codelineno-0-1232 name=__codelineno-0-1232></a>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-0-1233 name=__codelineno-0-1233></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1234 name=__codelineno-0-1234></a>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-1235 name=__codelineno-0-1235></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1236 name=__codelineno-0-1236></a>                        <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Retry attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> for </span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2> after </span><span class=si>{</span><span class=n>current_delay</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s delay&quot;</span>
<a id=__codelineno-0-1237 name=__codelineno-0-1237></a>                    <span class=p>)</span>
<a id=__codelineno-0-1238 name=__codelineno-0-1238></a>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>current_delay</span><span class=p>)</span>
<a id=__codelineno-0-1239 name=__codelineno-0-1239></a>                    <span class=n>current_delay</span> <span class=o>*=</span> <span class=n>retry_backoff_factor</span>
<a id=__codelineno-0-1240 name=__codelineno-0-1240></a>
<a id=__codelineno-0-1241 name=__codelineno-0-1241></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>operation</span><span class=p>()</span>
<a id=__codelineno-0-1242 name=__codelineno-0-1242></a>
<a id=__codelineno-0-1243 name=__codelineno-0-1243></a>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-1244 name=__codelineno-0-1244></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1245 name=__codelineno-0-1245></a>                        <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Retry succeeded for </span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1246 name=__codelineno-0-1246></a>                    <span class=p>)</span>
<a id=__codelineno-0-1247 name=__codelineno-0-1247></a>
<a id=__codelineno-0-1248 name=__codelineno-0-1248></a>                <span class=k>return</span> <span class=n>result</span><span class=p>,</span> <span class=kc>None</span>
<a id=__codelineno-0-1249 name=__codelineno-0-1249></a>
<a id=__codelineno-0-1250 name=__codelineno-0-1250></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1251 name=__codelineno-0-1251></a>                <span class=n>status_code</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;status_code&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-1252 name=__codelineno-0-1252></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-1253 name=__codelineno-0-1253></a>                <span class=n>request_url</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;url&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-1254 name=__codelineno-0-1254></a>                <span class=n>request_method</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;method&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-1255 name=__codelineno-0-1255></a>
<a id=__codelineno-0-1256 name=__codelineno-0-1256></a>                <span class=c1># Convert response to string if it&#39;s not already</span>
<a id=__codelineno-0-1257 name=__codelineno-0-1257></a>                <span class=k>if</span> <span class=n>response_body</span> <span class=ow>and</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response_body</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-0-1258 name=__codelineno-0-1258></a>                    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1259 name=__codelineno-0-1259></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>response_body</span><span class=p>)[:</span><span class=mi>1000</span><span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-1260 name=__codelineno-0-1260></a>                    <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-1261 name=__codelineno-0-1261></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to convert response to string&gt;&quot;</span>
<a id=__codelineno-0-1262 name=__codelineno-0-1262></a>
<a id=__codelineno-0-1263 name=__codelineno-0-1263></a>                <span class=n>error_detail</span> <span class=o>=</span> <span class=n>ErrorDetail</span><span class=p>(</span>
<a id=__codelineno-0-1264 name=__codelineno-0-1264></a>                    <span class=n>message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-0-1265 name=__codelineno-0-1265></a>                    <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1266 name=__codelineno-0-1266></a>                    <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-1267 name=__codelineno-0-1267></a>                    <span class=n>request_url</span><span class=o>=</span><span class=n>request_url</span><span class=p>,</span>
<a id=__codelineno-0-1268 name=__codelineno-0-1268></a>                    <span class=n>request_method</span><span class=o>=</span><span class=n>request_method</span><span class=p>,</span>
<a id=__codelineno-0-1269 name=__codelineno-0-1269></a>                    <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
<a id=__codelineno-0-1270 name=__codelineno-0-1270></a>                    <span class=n>error_type</span><span class=o>=</span><span class=p>(</span>
<a id=__codelineno-0-1271 name=__codelineno-0-1271></a>                        <span class=s2>&quot;transient_error&quot;</span>
<a id=__codelineno-0-1272 name=__codelineno-0-1272></a>                        <span class=k>if</span> <span class=n>status_code</span> <span class=ow>in</span> <span class=n>retry_status_codes</span>
<a id=__codelineno-0-1273 name=__codelineno-0-1273></a>                        <span class=k>else</span> <span class=s2>&quot;api_error&quot;</span>
<a id=__codelineno-0-1274 name=__codelineno-0-1274></a>                    <span class=p>),</span>
<a id=__codelineno-0-1275 name=__codelineno-0-1275></a>                <span class=p>)</span>
<a id=__codelineno-0-1276 name=__codelineno-0-1276></a>
<a id=__codelineno-0-1277 name=__codelineno-0-1277></a>                <span class=c1># Check if this is a retryable error</span>
<a id=__codelineno-0-1278 name=__codelineno-0-1278></a>                <span class=n>is_retryable</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1279 name=__codelineno-0-1279></a>                    <span class=n>status_code</span> <span class=ow>in</span> <span class=n>retry_status_codes</span> <span class=k>if</span> <span class=n>status_code</span> <span class=k>else</span> <span class=kc>False</span>
<a id=__codelineno-0-1280 name=__codelineno-0-1280></a>                <span class=p>)</span>
<a id=__codelineno-0-1281 name=__codelineno-0-1281></a>
<a id=__codelineno-0-1282 name=__codelineno-0-1282></a>                <span class=k>if</span> <span class=n>is_retryable</span> <span class=ow>and</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=n>max_retries</span><span class=p>:</span>
<a id=__codelineno-0-1283 name=__codelineno-0-1283></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-1284 name=__codelineno-0-1284></a>                        <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] </span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2> failed with retryable error (status: </span><span class=si>{</span><span class=n>status_code</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1285 name=__codelineno-0-1285></a>                    <span class=p>)</span>
<a id=__codelineno-0-1286 name=__codelineno-0-1286></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1287 name=__codelineno-0-1287></a>                    <span class=c1># Either not retryable or out of retries</span>
<a id=__codelineno-0-1288 name=__codelineno-0-1288></a>                    <span class=n>log_level</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span> <span class=k>if</span> <span class=n>is_retryable</span> <span class=k>else</span> <span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span>
<a id=__codelineno-0-1289 name=__codelineno-0-1289></a>                    <span class=n>retry_msg</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1290 name=__codelineno-0-1290></a>                        <span class=s2>&quot;out of retry attempts&quot;</span>
<a id=__codelineno-0-1291 name=__codelineno-0-1291></a>                        <span class=k>if</span> <span class=n>is_retryable</span>
<a id=__codelineno-0-1292 name=__codelineno-0-1292></a>                        <span class=k>else</span> <span class=s2>&quot;non-retryable error&quot;</span>
<a id=__codelineno-0-1293 name=__codelineno-0-1293></a>                    <span class=p>)</span>
<a id=__codelineno-0-1294 name=__codelineno-0-1294></a>
<a id=__codelineno-0-1295 name=__codelineno-0-1295></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>log</span><span class=p>(</span>
<a id=__codelineno-0-1296 name=__codelineno-0-1296></a>                        <span class=n>log_level</span><span class=p>,</span>
<a id=__codelineno-0-1297 name=__codelineno-0-1297></a>                        <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] </span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2> failed with </span><span class=si>{</span><span class=n>retry_msg</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1298 name=__codelineno-0-1298></a>                    <span class=p>)</span>
<a id=__codelineno-0-1299 name=__codelineno-0-1299></a>                    <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=n>error_detail</span>
<a id=__codelineno-0-1300 name=__codelineno-0-1300></a>
<a id=__codelineno-0-1301 name=__codelineno-0-1301></a>        <span class=c1># We should never reach here, but just in case</span>
<a id=__codelineno-0-1302 name=__codelineno-0-1302></a>        <span class=n>fallback_error</span> <span class=o>=</span> <span class=n>ErrorDetail</span><span class=p>(</span>
<a id=__codelineno-0-1303 name=__codelineno-0-1303></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Unknown error during </span><span class=si>{</span><span class=n>operation_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1304 name=__codelineno-0-1304></a>            <span class=n>timestamp</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
<a id=__codelineno-0-1305 name=__codelineno-0-1305></a>            <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;unknown_error&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1306 name=__codelineno-0-1306></a>        <span class=p>)</span>
<a id=__codelineno-0-1307 name=__codelineno-0-1307></a>        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fallback_error</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>config_path</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>source_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>target_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>mapping_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>schedule_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>error_handling_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>security_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>validation_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>observability_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>secret_manager_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>log_level</span><span class=o>=</span><span class=s1>&#39;INFO&#39;</span><span class=p>,</span> <span class=n>log_file</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-120 name=__codelineno-0-120></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
<a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-122 name=__codelineno-0-122></a>    <span class=n>config_path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-123 name=__codelineno-0-123></a>    <span class=n>source_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=n>target_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-125 name=__codelineno-0-125></a>    <span class=n>mapping_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-126 name=__codelineno-0-126></a>    <span class=n>schedule_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-127 name=__codelineno-0-127></a>    <span class=n>error_handling_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=n>security_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=n>validation_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-130 name=__codelineno-0-130></a>    <span class=n>observability_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-131 name=__codelineno-0-131></a>    <span class=n>secret_manager_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=n>log_level</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;INFO&quot;</span><span class=p>,</span>
<a id=__codelineno-0-133 name=__codelineno-0-133></a>    <span class=n>log_file</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-134 name=__codelineno-0-134></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=c1># Initialize logger</span>
<a id=__codelineno-0-136 name=__codelineno-0-136></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>setup_logger</span><span class=p>(</span><span class=n>log_level</span><span class=p>,</span> <span class=n>log_file</span><span class=p>)</span>
<a id=__codelineno-0-137 name=__codelineno-0-137></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Initializing ApiLinker&quot;</span><span class=p>)</span>
<a id=__codelineno-0-138 name=__codelineno-0-138></a>
<a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=c1># Initialize components</span>
<a id=__codelineno-0-140 name=__codelineno-0-140></a>    <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ApiConnector</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-141 name=__codelineno-0-141></a>    <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ApiConnector</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-142 name=__codelineno-0-142></a>    <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span> <span class=o>=</span> <span class=n>FieldMapper</span><span class=p>()</span>
<a id=__codelineno-0-143 name=__codelineno-0-143></a>    <span class=bp>self</span><span class=o>.</span><span class=n>scheduler</span> <span class=o>=</span> <span class=n>Scheduler</span><span class=p>()</span>
<a id=__codelineno-0-144 name=__codelineno-0-144></a>    <span class=bp>self</span><span class=o>.</span><span class=n>validation_config</span> <span class=o>=</span> <span class=n>validation_config</span> <span class=ow>or</span> <span class=p>{</span><span class=s2>&quot;strict_mode&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>}</span>
<a id=__codelineno-0-145 name=__codelineno-0-145></a>    <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span> <span class=o>=</span> <span class=n>ProvenanceRecorder</span><span class=p>()</span>
<a id=__codelineno-0-146 name=__codelineno-0-146></a>    <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span> <span class=o>=</span> <span class=n>InMemoryDeduplicator</span><span class=p>()</span>
<a id=__codelineno-0-147 name=__codelineno-0-147></a>    <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>StateStore</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-148 name=__codelineno-0-148></a>
<a id=__codelineno-0-149 name=__codelineno-0-149></a>    <span class=c1># Initialize observability</span>
<a id=__codelineno-0-150 name=__codelineno-0-150></a>    <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_observability</span><span class=p>(</span><span class=n>observability_config</span><span class=p>)</span>
<a id=__codelineno-0-151 name=__codelineno-0-151></a>
<a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=c1># Initialize secret management</span>
<a id=__codelineno-0-153 name=__codelineno-0-153></a>    <span class=bp>self</span><span class=o>.</span><span class=n>secret_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_secret_manager</span><span class=p>(</span><span class=n>secret_manager_config</span><span class=p>)</span>
<a id=__codelineno-0-154 name=__codelineno-0-154></a>
<a id=__codelineno-0-155 name=__codelineno-0-155></a>    <span class=c1># Initialize security system</span>
<a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_initialize_security</span><span class=p>(</span><span class=n>security_config</span><span class=p>)</span>
<a id=__codelineno-0-157 name=__codelineno-0-157></a>
<a id=__codelineno-0-158 name=__codelineno-0-158></a>    <span class=c1># Initialize auth manager and integrate with security</span>
<a id=__codelineno-0-159 name=__codelineno-0-159></a>    <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span> <span class=o>=</span> <span class=n>AuthManager</span><span class=p>()</span>
<a id=__codelineno-0-160 name=__codelineno-0-160></a>    <span class=n>integrate_security_with_auth_manager</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=p>)</span>
<a id=__codelineno-0-161 name=__codelineno-0-161></a>
<a id=__codelineno-0-162 name=__codelineno-0-162></a>    <span class=c1># Initialize error handling system</span>
<a id=__codelineno-0-163 name=__codelineno-0-163></a>    <span class=bp>self</span><span class=o>.</span><span class=n>dlq</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-164 name=__codelineno-0-164></a>        <span class=n>create_error_handler</span><span class=p>()</span>
<a id=__codelineno-0-165 name=__codelineno-0-165></a>    <span class=p>)</span>
<a id=__codelineno-0-166 name=__codelineno-0-166></a>
<a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=c1># Load configuration if provided</span>
<a id=__codelineno-0-168 name=__codelineno-0-168></a>    <span class=k>if</span> <span class=n>config_path</span><span class=p>:</span>
<a id=__codelineno-0-169 name=__codelineno-0-169></a>        <span class=bp>self</span><span class=o>.</span><span class=n>load_config</span><span class=p>(</span><span class=n>config_path</span><span class=p>)</span>
<a id=__codelineno-0-170 name=__codelineno-0-170></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=c1># Set up direct configurations if provided</span>
<a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=k>if</span> <span class=n>source_config</span><span class=p>:</span>
<a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_source</span><span class=p>(</span><span class=o>**</span><span class=n>source_config</span><span class=p>)</span>
<a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=k>if</span> <span class=n>target_config</span><span class=p>:</span>
<a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_target</span><span class=p>(</span><span class=o>**</span><span class=n>target_config</span><span class=p>)</span>
<a id=__codelineno-0-176 name=__codelineno-0-176></a>        <span class=k>if</span> <span class=n>mapping_config</span><span class=p>:</span>
<a id=__codelineno-0-177 name=__codelineno-0-177></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=o>**</span><span class=n>mapping_config</span><span class=p>)</span>
<a id=__codelineno-0-178 name=__codelineno-0-178></a>        <span class=k>if</span> <span class=n>schedule_config</span><span class=p>:</span>
<a id=__codelineno-0-179 name=__codelineno-0-179></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_schedule</span><span class=p>(</span><span class=o>**</span><span class=n>schedule_config</span><span class=p>)</span>
<a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>if</span> <span class=n>error_handling_config</span><span class=p>:</span>
<a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_configure_error_handling</span><span class=p>(</span><span class=n>error_handling_config</span><span class=p>)</span>
<a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=k>if</span> <span class=n>security_config</span><span class=p>:</span>
<a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_configure_security</span><span class=p>(</span><span class=n>security_config</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.add_source class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_source</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span> <span class=n>base_url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>endpoints</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add a source API connector.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Type of API connector (rest, graphql, etc.)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>base_url</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Base URL of the API</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>auth</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Authentication configuration</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>endpoints</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Configured endpoints</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>**kwargs</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Additional configuration parameters</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=k>def</span><span class=w> </span><span class=nf>add_source</span><span class=p>(</span>
<a id=__codelineno-0-275 name=__codelineno-0-275></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-276 name=__codelineno-0-276></a>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-277 name=__codelineno-0-277></a>    <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-278 name=__codelineno-0-278></a>    <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-279 name=__codelineno-0-279></a>    <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-280 name=__codelineno-0-280></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-281 name=__codelineno-0-281></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-282 name=__codelineno-0-282></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-283 name=__codelineno-0-283></a><span class=sd>    Add a source API connector.</span>
<a id=__codelineno-0-284 name=__codelineno-0-284></a>
<a id=__codelineno-0-285 name=__codelineno-0-285></a><span class=sd>    Args:</span>
<a id=__codelineno-0-286 name=__codelineno-0-286></a><span class=sd>        type: Type of API connector (rest, graphql, etc.)</span>
<a id=__codelineno-0-287 name=__codelineno-0-287></a><span class=sd>        base_url: Base URL of the API</span>
<a id=__codelineno-0-288 name=__codelineno-0-288></a><span class=sd>        auth: Authentication configuration</span>
<a id=__codelineno-0-289 name=__codelineno-0-289></a><span class=sd>        endpoints: Configured endpoints</span>
<a id=__codelineno-0-290 name=__codelineno-0-290></a><span class=sd>        **kwargs: Additional configuration parameters</span>
<a id=__codelineno-0-291 name=__codelineno-0-291></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-292 name=__codelineno-0-292></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Adding source connector: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2> for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-293 name=__codelineno-0-293></a>
<a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=c1># Resolve secrets in authentication configuration</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>    <span class=k>if</span> <span class=n>auth</span><span class=p>:</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_auth_secrets</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=n>auth_config</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=o>.</span><span class=n>configure_auth</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-299 name=__codelineno-0-299></a>        <span class=n>auth_config</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-300 name=__codelineno-0-300></a>
<a id=__codelineno-0-301 name=__codelineno-0-301></a>    <span class=c1># Create source connector</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>    <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=o>=</span> <span class=n>ApiConnector</span><span class=p>(</span>
<a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=n>connector_type</span><span class=o>=</span><span class=nb>type</span><span class=p>,</span>
<a id=__codelineno-0-304 name=__codelineno-0-304></a>        <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a>        <span class=n>auth_config</span><span class=o>=</span><span class=n>auth_config</span><span class=p>,</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a>        <span class=n>endpoints</span><span class=o>=</span><span class=n>endpoints</span> <span class=ow>or</span> <span class=p>{},</span>
<a id=__codelineno-0-307 name=__codelineno-0-307></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<a id=__codelineno-0-308 name=__codelineno-0-308></a>    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.add_target class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_target</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span> <span class=n>base_url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>endpoints</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add a target API connector.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Type of API connector (rest, graphql, etc.)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>base_url</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Base URL of the API</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>auth</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Authentication configuration</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>endpoints</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Configured endpoints</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>**kwargs</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Additional configuration parameters</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-310 name=__codelineno-0-310></a><span class=k>def</span><span class=w> </span><span class=nf>add_target</span><span class=p>(</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>    <span class=nb>type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-313 name=__codelineno-0-313></a>    <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-314 name=__codelineno-0-314></a>    <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a>    <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-319 name=__codelineno-0-319></a><span class=sd>    Add a target API connector.</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>
<a id=__codelineno-0-321 name=__codelineno-0-321></a><span class=sd>    Args:</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a><span class=sd>        type: Type of API connector (rest, graphql, etc.)</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a><span class=sd>        base_url: Base URL of the API</span>
<a id=__codelineno-0-324 name=__codelineno-0-324></a><span class=sd>        auth: Authentication configuration</span>
<a id=__codelineno-0-325 name=__codelineno-0-325></a><span class=sd>        endpoints: Configured endpoints</span>
<a id=__codelineno-0-326 name=__codelineno-0-326></a><span class=sd>        **kwargs: Additional configuration parameters</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Adding target connector: </span><span class=si>{</span><span class=nb>type</span><span class=si>}</span><span class=s2> for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>    <span class=c1># Resolve secrets in authentication configuration</span>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>    <span class=k>if</span> <span class=n>auth</span><span class=p>:</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>        <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_resolve_auth_secrets</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>        <span class=n>auth_config</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_manager</span><span class=o>.</span><span class=n>configure_auth</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>        <span class=n>auth_config</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a>
<a id=__codelineno-0-337 name=__codelineno-0-337></a>    <span class=c1># Create target connector</span>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>    <span class=bp>self</span><span class=o>.</span><span class=n>target</span> <span class=o>=</span> <span class=n>ApiConnector</span><span class=p>(</span>
<a id=__codelineno-0-339 name=__codelineno-0-339></a>        <span class=n>connector_type</span><span class=o>=</span><span class=nb>type</span><span class=p>,</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a>        <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a>        <span class=n>auth_config</span><span class=o>=</span><span class=n>auth_config</span><span class=p>,</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>        <span class=n>endpoints</span><span class=o>=</span><span class=n>endpoints</span> <span class=ow>or</span> <span class=p>{},</span>
<a id=__codelineno-0-343 name=__codelineno-0-343></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a>    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.add_mapping class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_mapping</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>fields</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add a field mapping between source and target endpoints.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>source</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Source endpoint name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>target</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Target endpoint name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fields</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>List of field mappings</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-346 name=__codelineno-0-346></a><span class=k>def</span><span class=w> </span><span class=nf>add_mapping</span><span class=p>(</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>fields</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-348 name=__codelineno-0-348></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a><span class=sd>    Add a field mapping between source and target endpoints.</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>
<a id=__codelineno-0-352 name=__codelineno-0-352></a><span class=sd>    Args:</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a><span class=sd>        source: Source endpoint name</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a><span class=sd>        target: Target endpoint name</span>
<a id=__codelineno-0-355 name=__codelineno-0-355></a><span class=sd>        fields: List of field mappings</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>        <span class=sa>f</span><span class=s2>&quot;Adding mapping from </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>fields</span><span class=p>)</span><span class=si>}</span><span class=s2> fields&quot;</span>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>    <span class=p>)</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>    <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>add_mapping</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>fields</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.sync class="doc doc-heading"> <code class="highlight language-python"><span class=n>sync</span><span class=p>(</span><span class=n>source_endpoint</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>retry_delay</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>retry_backoff_factor</span><span class=o>=</span><span class=mf>2.0</span><span class=p>,</span> <span class=n>retry_status_codes</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Execute a sync operation between source and target APIs.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>source_endpoint</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Source endpoint to use (overrides mapping)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>target_endpoint</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Target endpoint to use (overrides mapping)</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>params</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Additional parameters for the source API call</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>max_retries</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Maximum number of retry attempts for transient failures</p> </div> </td> <td> <code>3</code> </td> </tr> <tr class=doc-section-item> <td> <code>retry_delay</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Initial delay between retries in seconds</p> </div> </td> <td> <code>1.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>retry_backoff_factor</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Multiplicative factor for retry delay</p> </div> </td> <td> <code>2.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>retry_status_codes</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.List>List</span>[<span title=int>int</span>]]</code> </td> <td> <div class=doc-md-description> <p>HTTP status codes to retry (default: 429, 502, 503, 504)</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>SyncResult</code></td> <td> <code><span title=apilinker.api_linker.SyncResult>SyncResult</span></code> </td> <td> <div class=doc-md-description> <p>Result of the sync operation</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-876> 876</a></span>
<span class=normal><a href=#__codelineno-0-877> 877</a></span>
<span class=normal><a href=#__codelineno-0-878> 878</a></span>
<span class=normal><a href=#__codelineno-0-879> 879</a></span>
<span class=normal><a href=#__codelineno-0-880> 880</a></span>
<span class=normal><a href=#__codelineno-0-881> 881</a></span>
<span class=normal><a href=#__codelineno-0-882> 882</a></span>
<span class=normal><a href=#__codelineno-0-883> 883</a></span>
<span class=normal><a href=#__codelineno-0-884> 884</a></span>
<span class=normal><a href=#__codelineno-0-885> 885</a></span>
<span class=normal><a href=#__codelineno-0-886> 886</a></span>
<span class=normal><a href=#__codelineno-0-887> 887</a></span>
<span class=normal><a href=#__codelineno-0-888> 888</a></span>
<span class=normal><a href=#__codelineno-0-889> 889</a></span>
<span class=normal><a href=#__codelineno-0-890> 890</a></span>
<span class=normal><a href=#__codelineno-0-891> 891</a></span>
<span class=normal><a href=#__codelineno-0-892> 892</a></span>
<span class=normal><a href=#__codelineno-0-893> 893</a></span>
<span class=normal><a href=#__codelineno-0-894> 894</a></span>
<span class=normal><a href=#__codelineno-0-895> 895</a></span>
<span class=normal><a href=#__codelineno-0-896> 896</a></span>
<span class=normal><a href=#__codelineno-0-897> 897</a></span>
<span class=normal><a href=#__codelineno-0-898> 898</a></span>
<span class=normal><a href=#__codelineno-0-899> 899</a></span>
<span class=normal><a href=#__codelineno-0-900> 900</a></span>
<span class=normal><a href=#__codelineno-0-901> 901</a></span>
<span class=normal><a href=#__codelineno-0-902> 902</a></span>
<span class=normal><a href=#__codelineno-0-903> 903</a></span>
<span class=normal><a href=#__codelineno-0-904> 904</a></span>
<span class=normal><a href=#__codelineno-0-905> 905</a></span>
<span class=normal><a href=#__codelineno-0-906> 906</a></span>
<span class=normal><a href=#__codelineno-0-907> 907</a></span>
<span class=normal><a href=#__codelineno-0-908> 908</a></span>
<span class=normal><a href=#__codelineno-0-909> 909</a></span>
<span class=normal><a href=#__codelineno-0-910> 910</a></span>
<span class=normal><a href=#__codelineno-0-911> 911</a></span>
<span class=normal><a href=#__codelineno-0-912> 912</a></span>
<span class=normal><a href=#__codelineno-0-913> 913</a></span>
<span class=normal><a href=#__codelineno-0-914> 914</a></span>
<span class=normal><a href=#__codelineno-0-915> 915</a></span>
<span class=normal><a href=#__codelineno-0-916> 916</a></span>
<span class=normal><a href=#__codelineno-0-917> 917</a></span>
<span class=normal><a href=#__codelineno-0-918> 918</a></span>
<span class=normal><a href=#__codelineno-0-919> 919</a></span>
<span class=normal><a href=#__codelineno-0-920> 920</a></span>
<span class=normal><a href=#__codelineno-0-921> 921</a></span>
<span class=normal><a href=#__codelineno-0-922> 922</a></span>
<span class=normal><a href=#__codelineno-0-923> 923</a></span>
<span class=normal><a href=#__codelineno-0-924> 924</a></span>
<span class=normal><a href=#__codelineno-0-925> 925</a></span>
<span class=normal><a href=#__codelineno-0-926> 926</a></span>
<span class=normal><a href=#__codelineno-0-927> 927</a></span>
<span class=normal><a href=#__codelineno-0-928> 928</a></span>
<span class=normal><a href=#__codelineno-0-929> 929</a></span>
<span class=normal><a href=#__codelineno-0-930> 930</a></span>
<span class=normal><a href=#__codelineno-0-931> 931</a></span>
<span class=normal><a href=#__codelineno-0-932> 932</a></span>
<span class=normal><a href=#__codelineno-0-933> 933</a></span>
<span class=normal><a href=#__codelineno-0-934> 934</a></span>
<span class=normal><a href=#__codelineno-0-935> 935</a></span>
<span class=normal><a href=#__codelineno-0-936> 936</a></span>
<span class=normal><a href=#__codelineno-0-937> 937</a></span>
<span class=normal><a href=#__codelineno-0-938> 938</a></span>
<span class=normal><a href=#__codelineno-0-939> 939</a></span>
<span class=normal><a href=#__codelineno-0-940> 940</a></span>
<span class=normal><a href=#__codelineno-0-941> 941</a></span>
<span class=normal><a href=#__codelineno-0-942> 942</a></span>
<span class=normal><a href=#__codelineno-0-943> 943</a></span>
<span class=normal><a href=#__codelineno-0-944> 944</a></span>
<span class=normal><a href=#__codelineno-0-945> 945</a></span>
<span class=normal><a href=#__codelineno-0-946> 946</a></span>
<span class=normal><a href=#__codelineno-0-947> 947</a></span>
<span class=normal><a href=#__codelineno-0-948> 948</a></span>
<span class=normal><a href=#__codelineno-0-949> 949</a></span>
<span class=normal><a href=#__codelineno-0-950> 950</a></span>
<span class=normal><a href=#__codelineno-0-951> 951</a></span>
<span class=normal><a href=#__codelineno-0-952> 952</a></span>
<span class=normal><a href=#__codelineno-0-953> 953</a></span>
<span class=normal><a href=#__codelineno-0-954> 954</a></span>
<span class=normal><a href=#__codelineno-0-955> 955</a></span>
<span class=normal><a href=#__codelineno-0-956> 956</a></span>
<span class=normal><a href=#__codelineno-0-957> 957</a></span>
<span class=normal><a href=#__codelineno-0-958> 958</a></span>
<span class=normal><a href=#__codelineno-0-959> 959</a></span>
<span class=normal><a href=#__codelineno-0-960> 960</a></span>
<span class=normal><a href=#__codelineno-0-961> 961</a></span>
<span class=normal><a href=#__codelineno-0-962> 962</a></span>
<span class=normal><a href=#__codelineno-0-963> 963</a></span>
<span class=normal><a href=#__codelineno-0-964> 964</a></span>
<span class=normal><a href=#__codelineno-0-965> 965</a></span>
<span class=normal><a href=#__codelineno-0-966> 966</a></span>
<span class=normal><a href=#__codelineno-0-967> 967</a></span>
<span class=normal><a href=#__codelineno-0-968> 968</a></span>
<span class=normal><a href=#__codelineno-0-969> 969</a></span>
<span class=normal><a href=#__codelineno-0-970> 970</a></span>
<span class=normal><a href=#__codelineno-0-971> 971</a></span>
<span class=normal><a href=#__codelineno-0-972> 972</a></span>
<span class=normal><a href=#__codelineno-0-973> 973</a></span>
<span class=normal><a href=#__codelineno-0-974> 974</a></span>
<span class=normal><a href=#__codelineno-0-975> 975</a></span>
<span class=normal><a href=#__codelineno-0-976> 976</a></span>
<span class=normal><a href=#__codelineno-0-977> 977</a></span>
<span class=normal><a href=#__codelineno-0-978> 978</a></span>
<span class=normal><a href=#__codelineno-0-979> 979</a></span>
<span class=normal><a href=#__codelineno-0-980> 980</a></span>
<span class=normal><a href=#__codelineno-0-981> 981</a></span>
<span class=normal><a href=#__codelineno-0-982> 982</a></span>
<span class=normal><a href=#__codelineno-0-983> 983</a></span>
<span class=normal><a href=#__codelineno-0-984> 984</a></span>
<span class=normal><a href=#__codelineno-0-985> 985</a></span>
<span class=normal><a href=#__codelineno-0-986> 986</a></span>
<span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span>
<span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span>
<span class=normal><a href=#__codelineno-0-1175>1175</a></span>
<span class=normal><a href=#__codelineno-0-1176>1176</a></span>
<span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span>
<span class=normal><a href=#__codelineno-0-1190>1190</a></span>
<span class=normal><a href=#__codelineno-0-1191>1191</a></span>
<span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-876 name=__codelineno-0-876></a><span class=k>def</span><span class=w> </span><span class=nf>sync</span><span class=p>(</span>
<a id=__codelineno-0-877 name=__codelineno-0-877></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-878 name=__codelineno-0-878></a>    <span class=n>source_endpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-879 name=__codelineno-0-879></a>    <span class=n>target_endpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-880 name=__codelineno-0-880></a>    <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-881 name=__codelineno-0-881></a>    <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-0-882 name=__codelineno-0-882></a>    <span class=n>retry_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<a id=__codelineno-0-883 name=__codelineno-0-883></a>    <span class=n>retry_backoff_factor</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>2.0</span><span class=p>,</span>
<a id=__codelineno-0-884 name=__codelineno-0-884></a>    <span class=n>retry_status_codes</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-885 name=__codelineno-0-885></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SyncResult</span><span class=p>:</span>
<a id=__codelineno-0-886 name=__codelineno-0-886></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-887 name=__codelineno-0-887></a><span class=sd>    Execute a sync operation between source and target APIs.</span>
<a id=__codelineno-0-888 name=__codelineno-0-888></a>
<a id=__codelineno-0-889 name=__codelineno-0-889></a><span class=sd>    Args:</span>
<a id=__codelineno-0-890 name=__codelineno-0-890></a><span class=sd>        source_endpoint: Source endpoint to use (overrides mapping)</span>
<a id=__codelineno-0-891 name=__codelineno-0-891></a><span class=sd>        target_endpoint: Target endpoint to use (overrides mapping)</span>
<a id=__codelineno-0-892 name=__codelineno-0-892></a><span class=sd>        params: Additional parameters for the source API call</span>
<a id=__codelineno-0-893 name=__codelineno-0-893></a><span class=sd>        max_retries: Maximum number of retry attempts for transient failures</span>
<a id=__codelineno-0-894 name=__codelineno-0-894></a><span class=sd>        retry_delay: Initial delay between retries in seconds</span>
<a id=__codelineno-0-895 name=__codelineno-0-895></a><span class=sd>        retry_backoff_factor: Multiplicative factor for retry delay</span>
<a id=__codelineno-0-896 name=__codelineno-0-896></a><span class=sd>        retry_status_codes: HTTP status codes to retry (default: 429, 502, 503, 504)</span>
<a id=__codelineno-0-897 name=__codelineno-0-897></a>
<a id=__codelineno-0-898 name=__codelineno-0-898></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-899 name=__codelineno-0-899></a><span class=sd>        SyncResult: Result of the sync operation</span>
<a id=__codelineno-0-900 name=__codelineno-0-900></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-901 name=__codelineno-0-901></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span>
<a id=__codelineno-0-902 name=__codelineno-0-902></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-903 name=__codelineno-0-903></a>            <span class=s2>&quot;Source and target connectors must be configured before syncing&quot;</span>
<a id=__codelineno-0-904 name=__codelineno-0-904></a>        <span class=p>)</span>
<a id=__codelineno-0-905 name=__codelineno-0-905></a>
<a id=__codelineno-0-906 name=__codelineno-0-906></a>    <span class=c1># If no endpoints specified, use the first mapping</span>
<a id=__codelineno-0-907 name=__codelineno-0-907></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>source_endpoint</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>target_endpoint</span><span class=p>:</span>
<a id=__codelineno-0-908 name=__codelineno-0-908></a>        <span class=n>mapping</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>get_first_mapping</span><span class=p>()</span>
<a id=__codelineno-0-909 name=__codelineno-0-909></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>mapping</span><span class=p>:</span>
<a id=__codelineno-0-910 name=__codelineno-0-910></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;No mapping configured and no endpoints specified&quot;</span><span class=p>)</span>
<a id=__codelineno-0-911 name=__codelineno-0-911></a>        <span class=n>source_endpoint</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span>
<a id=__codelineno-0-912 name=__codelineno-0-912></a>        <span class=n>target_endpoint</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;target&quot;</span><span class=p>]</span>
<a id=__codelineno-0-913 name=__codelineno-0-913></a>
<a id=__codelineno-0-914 name=__codelineno-0-914></a>    <span class=c1># Generate correlation ID for this sync operation</span>
<a id=__codelineno-0-915 name=__codelineno-0-915></a>    <span class=n>correlation_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
<a id=__codelineno-0-916 name=__codelineno-0-916></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-917 name=__codelineno-0-917></a>
<a id=__codelineno-0-918 name=__codelineno-0-918></a>    <span class=c1># Wrap entire sync operation in distributed tracing</span>
<a id=__codelineno-0-919 name=__codelineno-0-919></a>    <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>trace_sync</span><span class=p>(</span>
<a id=__codelineno-0-920 name=__codelineno-0-920></a>        <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=n>correlation_id</span>
<a id=__codelineno-0-921 name=__codelineno-0-921></a>    <span class=p>):</span>
<a id=__codelineno-0-922 name=__codelineno-0-922></a>        <span class=c1># Start provenance</span>
<a id=__codelineno-0-923 name=__codelineno-0-923></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>start_run</span><span class=p>(</span>
<a id=__codelineno-0-924 name=__codelineno-0-924></a>            <span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>,</span>
<a id=__codelineno-0-925 name=__codelineno-0-925></a>            <span class=n>config_path</span><span class=o>=</span><span class=p>(</span>
<a id=__codelineno-0-926 name=__codelineno-0-926></a>                <span class=n>config_path</span>
<a id=__codelineno-0-927 name=__codelineno-0-927></a>                <span class=k>if</span> <span class=p>(</span><span class=n>config_path</span> <span class=o>:=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;_last_config_path&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span>
<a id=__codelineno-0-928 name=__codelineno-0-928></a>                <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-929 name=__codelineno-0-929></a>            <span class=p>),</span>
<a id=__codelineno-0-930 name=__codelineno-0-930></a>            <span class=n>source_endpoint</span><span class=o>=</span><span class=n>source_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-931 name=__codelineno-0-931></a>            <span class=n>target_endpoint</span><span class=o>=</span><span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-932 name=__codelineno-0-932></a>        <span class=p>)</span>
<a id=__codelineno-0-933 name=__codelineno-0-933></a>
<a id=__codelineno-0-934 name=__codelineno-0-934></a>        <span class=c1># Default retry status codes if none provided</span>
<a id=__codelineno-0-935 name=__codelineno-0-935></a>        <span class=k>if</span> <span class=n>retry_status_codes</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-936 name=__codelineno-0-936></a>            <span class=n>retry_status_codes</span> <span class=o>=</span> <span class=p>[</span><span class=mi>429</span><span class=p>,</span> <span class=mi>502</span><span class=p>,</span> <span class=mi>503</span><span class=p>,</span> <span class=mi>504</span><span class=p>]</span>  <span class=c1># Common transient failures</span>
<a id=__codelineno-0-937 name=__codelineno-0-937></a>
<a id=__codelineno-0-938 name=__codelineno-0-938></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-939 name=__codelineno-0-939></a>            <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Starting sync from </span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-940 name=__codelineno-0-940></a>        <span class=p>)</span>
<a id=__codelineno-0-941 name=__codelineno-0-941></a>
<a id=__codelineno-0-942 name=__codelineno-0-942></a>        <span class=c1># Initialize result object</span>
<a id=__codelineno-0-943 name=__codelineno-0-943></a>        <span class=n>sync_result</span> <span class=o>=</span> <span class=n>SyncResult</span><span class=p>(</span><span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>)</span>
<a id=__codelineno-0-944 name=__codelineno-0-944></a>
<a id=__codelineno-0-945 name=__codelineno-0-945></a>        <span class=c1># Get circuit breaker for source endpoint</span>
<a id=__codelineno-0-946 name=__codelineno-0-946></a>        <span class=n>source_circuit_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;source_</span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-947 name=__codelineno-0-947></a>        <span class=n>source_cb</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>get_circuit_breaker</span><span class=p>(</span>
<a id=__codelineno-0-948 name=__codelineno-0-948></a>            <span class=n>source_circuit_name</span>
<a id=__codelineno-0-949 name=__codelineno-0-949></a>        <span class=p>)</span>
<a id=__codelineno-0-950 name=__codelineno-0-950></a>
<a id=__codelineno-0-951 name=__codelineno-0-951></a>        <span class=c1># Check if user has permission for this operation</span>
<a id=__codelineno-0-952 name=__codelineno-0-952></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>enable_access_control</span><span class=p>:</span>
<a id=__codelineno-0-953 name=__codelineno-0-953></a>            <span class=n>current_user</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;current_user&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-954 name=__codelineno-0-954></a>            <span class=k>if</span> <span class=n>current_user</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>security_manager</span><span class=o>.</span><span class=n>check_permission</span><span class=p>(</span>
<a id=__codelineno-0-955 name=__codelineno-0-955></a>                <span class=n>current_user</span><span class=p>,</span> <span class=s2>&quot;run_sync&quot;</span>
<a id=__codelineno-0-956 name=__codelineno-0-956></a>            <span class=p>):</span>
<a id=__codelineno-0-957 name=__codelineno-0-957></a>                <span class=k>raise</span> <span class=ne>PermissionError</span><span class=p>(</span>
<a id=__codelineno-0-958 name=__codelineno-0-958></a>                    <span class=sa>f</span><span class=s2>&quot;User </span><span class=si>{</span><span class=n>current_user</span><span class=si>}</span><span class=s2> does not have permission to run sync operations&quot;</span>
<a id=__codelineno-0-959 name=__codelineno-0-959></a>                <span class=p>)</span>
<a id=__codelineno-0-960 name=__codelineno-0-960></a>
<a id=__codelineno-0-961 name=__codelineno-0-961></a>        <span class=c1># Merge last_sync into params from state store if not provided</span>
<a id=__codelineno-0-962 name=__codelineno-0-962></a>        <span class=k>if</span> <span class=n>params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-963 name=__codelineno-0-963></a>            <span class=n>effective_params</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-964 name=__codelineno-0-964></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-965 name=__codelineno-0-965></a>            <span class=n>effective_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-966 name=__codelineno-0-966></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span>
<a id=__codelineno-0-967 name=__codelineno-0-967></a>            <span class=c1># Ensure we have a dict if we are going to inject</span>
<a id=__codelineno-0-968 name=__codelineno-0-968></a>            <span class=n>need_inject</span> <span class=o>=</span> <span class=p>(</span><span class=n>effective_params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span>
<a id=__codelineno-0-969 name=__codelineno-0-969></a>                <span class=s2>&quot;updated_since&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>effective_params</span>
<a id=__codelineno-0-970 name=__codelineno-0-970></a>            <span class=p>)</span>
<a id=__codelineno-0-971 name=__codelineno-0-971></a>            <span class=k>if</span> <span class=n>need_inject</span><span class=p>:</span>
<a id=__codelineno-0-972 name=__codelineno-0-972></a>                <span class=n>last_sync</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=o>.</span><span class=n>get_last_sync</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>)</span>
<a id=__codelineno-0-973 name=__codelineno-0-973></a>                <span class=k>if</span> <span class=n>last_sync</span><span class=p>:</span>
<a id=__codelineno-0-974 name=__codelineno-0-974></a>                    <span class=n>effective_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>effective_params</span> <span class=ow>or</span> <span class=p>{})</span>
<a id=__codelineno-0-975 name=__codelineno-0-975></a>                    <span class=n>effective_params</span><span class=p>[</span><span class=s2>&quot;updated_since&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>last_sync</span>
<a id=__codelineno-0-976 name=__codelineno-0-976></a>
<a id=__codelineno-0-977 name=__codelineno-0-977></a>        <span class=c1># Always use standard non-encrypted call</span>
<a id=__codelineno-0-978 name=__codelineno-0-978></a>        <span class=n>source_data</span><span class=p>,</span> <span class=n>source_error</span> <span class=o>=</span> <span class=n>source_cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
<a id=__codelineno-0-979 name=__codelineno-0-979></a>            <span class=k>lambda</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>,</span> <span class=n>effective_params</span><span class=p>)</span>
<a id=__codelineno-0-980 name=__codelineno-0-980></a>        <span class=p>)</span>
<a id=__codelineno-0-981 name=__codelineno-0-981></a>
<a id=__codelineno-0-982 name=__codelineno-0-982></a>        <span class=c1># If circuit breaker failed, try recovery strategies</span>
<a id=__codelineno-0-983 name=__codelineno-0-983></a>        <span class=k>if</span> <span class=n>source_error</span><span class=p>:</span>
<a id=__codelineno-0-984 name=__codelineno-0-984></a>            <span class=c1># Create payload for retry</span>
<a id=__codelineno-0-985 name=__codelineno-0-985></a>            <span class=n>fetch_payload</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>source_endpoint</span><span class=p>,</span> <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=n>params</span><span class=p>}</span>
<a id=__codelineno-0-986 name=__codelineno-0-986></a>
<a id=__codelineno-0-987 name=__codelineno-0-987></a>            <span class=c1># Apply recovery strategies</span>
<a id=__codelineno-0-988 name=__codelineno-0-988></a>            <span class=n>success</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>handle_error</span><span class=p>(</span>
<a id=__codelineno-0-989 name=__codelineno-0-989></a>                <span class=n>error</span><span class=o>=</span><span class=n>source_error</span><span class=p>,</span>
<a id=__codelineno-0-990 name=__codelineno-0-990></a>                <span class=n>payload</span><span class=o>=</span><span class=n>fetch_payload</span><span class=p>,</span>
<a id=__codelineno-0-991 name=__codelineno-0-991></a>                <span class=n>operation</span><span class=o>=</span><span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span>
<a id=__codelineno-0-992 name=__codelineno-0-992></a>                    <span class=n>p</span><span class=p>[</span><span class=s2>&quot;endpoint&quot;</span><span class=p>],</span> <span class=n>p</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>]</span>
<a id=__codelineno-0-993 name=__codelineno-0-993></a>                <span class=p>),</span>
<a id=__codelineno-0-994 name=__codelineno-0-994></a>                <span class=n>operation_type</span><span class=o>=</span><span class=n>source_circuit_name</span><span class=p>,</span>
<a id=__codelineno-0-995 name=__codelineno-0-995></a>                <span class=n>max_retries</span><span class=o>=</span><span class=n>max_retries</span><span class=p>,</span>
<a id=__codelineno-0-996 name=__codelineno-0-996></a>                <span class=n>retry_delay</span><span class=o>=</span><span class=n>retry_delay</span><span class=p>,</span>
<a id=__codelineno-0-997 name=__codelineno-0-997></a>                <span class=n>retry_backoff_factor</span><span class=o>=</span><span class=n>retry_backoff_factor</span><span class=p>,</span>
<a id=__codelineno-0-998 name=__codelineno-0-998></a>            <span class=p>)</span>
<a id=__codelineno-0-999 name=__codelineno-0-999></a>
<a id=__codelineno-0-1000 name=__codelineno-0-1000></a>            <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
<a id=__codelineno-0-1001 name=__codelineno-0-1001></a>                <span class=n>source_data</span> <span class=o>=</span> <span class=n>result</span>
<a id=__codelineno-0-1002 name=__codelineno-0-1002></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1003 name=__codelineno-0-1003></a>                <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1004 name=__codelineno-0-1004></a>                <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1005 name=__codelineno-0-1005></a>
<a id=__codelineno-0-1006 name=__codelineno-0-1006></a>                <span class=c1># Update result with error details</span>
<a id=__codelineno-0-1007 name=__codelineno-0-1007></a>                <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1008 name=__codelineno-0-1008></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1009 name=__codelineno-0-1009></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1010 name=__codelineno-0-1010></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1011 name=__codelineno-0-1011></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1012 name=__codelineno-0-1012></a>                <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1013 name=__codelineno-0-1013></a>
<a id=__codelineno-0-1014 name=__codelineno-0-1014></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1015 name=__codelineno-0-1015></a>            <span class=c1># Map fields according to configuration</span>
<a id=__codelineno-0-1016 name=__codelineno-0-1016></a>            <span class=n>transformed_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mapper</span><span class=o>.</span><span class=n>map_data</span><span class=p>(</span>
<a id=__codelineno-0-1017 name=__codelineno-0-1017></a>                <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=n>source_data</span>
<a id=__codelineno-0-1018 name=__codelineno-0-1018></a>            <span class=p>)</span>
<a id=__codelineno-0-1019 name=__codelineno-0-1019></a>
<a id=__codelineno-0-1020 name=__codelineno-0-1020></a>            <span class=c1># Optional strict validation against target request schema (if defined in connector)</span>
<a id=__codelineno-0-1021 name=__codelineno-0-1021></a>            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-1022 name=__codelineno-0-1022></a>                <span class=bp>self</span><span class=o>.</span><span class=n>validation_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;strict_mode&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1023 name=__codelineno-0-1023></a>                <span class=ow>and</span> <span class=n>is_validator_available</span><span class=p>()</span>
<a id=__codelineno-0-1024 name=__codelineno-0-1024></a>            <span class=p>):</span>
<a id=__codelineno-0-1025 name=__codelineno-0-1025></a>                <span class=n>target_endpoint_cfg</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1026 name=__codelineno-0-1026></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>endpoints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>)</span>
<a id=__codelineno-0-1027 name=__codelineno-0-1027></a>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span>
<a id=__codelineno-0-1028 name=__codelineno-0-1028></a>                    <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-1029 name=__codelineno-0-1029></a>                <span class=p>)</span>
<a id=__codelineno-0-1030 name=__codelineno-0-1030></a>                <span class=k>if</span> <span class=n>target_endpoint_cfg</span> <span class=ow>and</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span><span class=p>:</span>
<a id=__codelineno-0-1031 name=__codelineno-0-1031></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1032 name=__codelineno-0-1032></a>                        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>transformed_data</span><span class=p>:</span>
<a id=__codelineno-0-1033 name=__codelineno-0-1033></a>                            <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1034 name=__codelineno-0-1034></a>                                <span class=n>item</span><span class=p>,</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1035 name=__codelineno-0-1035></a>                            <span class=p>)</span>
<a id=__codelineno-0-1036 name=__codelineno-0-1036></a>                            <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1037 name=__codelineno-0-1037></a>                                <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1038 name=__codelineno-0-1038></a>                                    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Strict mode: target payload failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1039 name=__codelineno-0-1039></a>                                    <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1040 name=__codelineno-0-1040></a>                                    <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1041 name=__codelineno-0-1041></a>                                    <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1042 name=__codelineno-0-1042></a>                                <span class=p>)</span>
<a id=__codelineno-0-1043 name=__codelineno-0-1043></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1044 name=__codelineno-0-1044></a>                        <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1045 name=__codelineno-0-1045></a>                            <span class=n>transformed_data</span><span class=p>,</span> <span class=n>target_endpoint_cfg</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1046 name=__codelineno-0-1046></a>                        <span class=p>)</span>
<a id=__codelineno-0-1047 name=__codelineno-0-1047></a>                        <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1048 name=__codelineno-0-1048></a>                            <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1049 name=__codelineno-0-1049></a>                                <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Strict mode: target payload failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1050 name=__codelineno-0-1050></a>                                <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1051 name=__codelineno-0-1051></a>                                <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1052 name=__codelineno-0-1052></a>                                <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1053 name=__codelineno-0-1053></a>                            <span class=p>)</span>
<a id=__codelineno-0-1054 name=__codelineno-0-1054></a>
<a id=__codelineno-0-1055 name=__codelineno-0-1055></a>            <span class=c1># Record source data metrics</span>
<a id=__codelineno-0-1056 name=__codelineno-0-1056></a>            <span class=n>source_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>source_data</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>source_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=k>else</span> <span class=mi>1</span>
<a id=__codelineno-0-1057 name=__codelineno-0-1057></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>details</span><span class=p>[</span><span class=s2>&quot;source_count&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>source_count</span>
<a id=__codelineno-0-1058 name=__codelineno-0-1058></a>
<a id=__codelineno-0-1059 name=__codelineno-0-1059></a>            <span class=c1># Get circuit breaker for target endpoint</span>
<a id=__codelineno-0-1060 name=__codelineno-0-1060></a>            <span class=n>target_circuit_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;target_</span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1061 name=__codelineno-0-1061></a>            <span class=n>target_cb</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>get_circuit_breaker</span><span class=p>(</span>
<a id=__codelineno-0-1062 name=__codelineno-0-1062></a>                <span class=n>target_circuit_name</span>
<a id=__codelineno-0-1063 name=__codelineno-0-1063></a>            <span class=p>)</span>
<a id=__codelineno-0-1064 name=__codelineno-0-1064></a>
<a id=__codelineno-0-1065 name=__codelineno-0-1065></a>            <span class=c1># Idempotency: skip payloads we&#39;ve already sent during replays</span>
<a id=__codelineno-0-1066 name=__codelineno-0-1066></a>            <span class=k>def</span><span class=w> </span><span class=nf>_send</span><span class=p>():</span>
<a id=__codelineno-0-1067 name=__codelineno-0-1067></a>                <span class=c1># If idempotency enabled, de-duplicate per item</span>
<a id=__codelineno-0-1068 name=__codelineno-0-1068></a>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;enabled&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span>
<a id=__codelineno-0-1069 name=__codelineno-0-1069></a>                    <span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span>
<a id=__codelineno-0-1070 name=__codelineno-0-1070></a>                <span class=p>):</span>
<a id=__codelineno-0-1071 name=__codelineno-0-1071></a>                    <span class=n>salt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>idempotency_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;salt&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1072 name=__codelineno-0-1072></a>                    <span class=n>filtered</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1073 name=__codelineno-0-1073></a>                    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>transformed_data</span><span class=p>:</span>
<a id=__codelineno-0-1074 name=__codelineno-0-1074></a>                        <span class=n>key</span> <span class=o>=</span> <span class=n>generate_idempotency_key</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>salt</span><span class=o>=</span><span class=n>salt</span><span class=p>)</span>
<a id=__codelineno-0-1075 name=__codelineno-0-1075></a>                        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span><span class=o>.</span><span class=n>has_seen</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
<a id=__codelineno-0-1076 name=__codelineno-0-1076></a>                            <span class=bp>self</span><span class=o>.</span><span class=n>deduplicator</span><span class=o>.</span><span class=n>mark_seen</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
<a id=__codelineno-0-1077 name=__codelineno-0-1077></a>                            <span class=n>filtered</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a id=__codelineno-0-1078 name=__codelineno-0-1078></a>                    <span class=n>payload</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>filtered</span>
<a id=__codelineno-0-1079 name=__codelineno-0-1079></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1080 name=__codelineno-0-1080></a>                    <span class=n>payload</span> <span class=o>=</span> <span class=n>transformed_data</span>
<a id=__codelineno-0-1081 name=__codelineno-0-1081></a>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span><span class=n>target_endpoint</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
<a id=__codelineno-0-1082 name=__codelineno-0-1082></a>
<a id=__codelineno-0-1083 name=__codelineno-0-1083></a>            <span class=c1># Always use standard non-encrypted call</span>
<a id=__codelineno-0-1084 name=__codelineno-0-1084></a>            <span class=n>target_result</span><span class=p>,</span> <span class=n>target_error</span> <span class=o>=</span> <span class=n>target_cb</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>_send</span><span class=p>)</span>
<a id=__codelineno-0-1085 name=__codelineno-0-1085></a>
<a id=__codelineno-0-1086 name=__codelineno-0-1086></a>            <span class=c1># If circuit breaker failed, try recovery strategies</span>
<a id=__codelineno-0-1087 name=__codelineno-0-1087></a>            <span class=k>if</span> <span class=n>target_error</span><span class=p>:</span>
<a id=__codelineno-0-1088 name=__codelineno-0-1088></a>                <span class=c1># Create payload for retry</span>
<a id=__codelineno-0-1089 name=__codelineno-0-1089></a>                <span class=n>send_payload</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-0-1090 name=__codelineno-0-1090></a>                    <span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-1091 name=__codelineno-0-1091></a>                    <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=n>transformed_data</span><span class=p>,</span>
<a id=__codelineno-0-1092 name=__codelineno-0-1092></a>                <span class=p>}</span>
<a id=__codelineno-0-1093 name=__codelineno-0-1093></a>
<a id=__codelineno-0-1094 name=__codelineno-0-1094></a>                <span class=c1># Apply recovery strategies</span>
<a id=__codelineno-0-1095 name=__codelineno-0-1095></a>                <span class=n>success</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>error_recovery_manager</span><span class=o>.</span><span class=n>handle_error</span><span class=p>(</span>
<a id=__codelineno-0-1096 name=__codelineno-0-1096></a>                    <span class=n>error</span><span class=o>=</span><span class=n>target_error</span><span class=p>,</span>
<a id=__codelineno-0-1097 name=__codelineno-0-1097></a>                    <span class=n>payload</span><span class=o>=</span><span class=n>send_payload</span><span class=p>,</span>
<a id=__codelineno-0-1098 name=__codelineno-0-1098></a>                    <span class=n>operation</span><span class=o>=</span><span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span>
<a id=__codelineno-0-1099 name=__codelineno-0-1099></a>                        <span class=n>p</span><span class=p>[</span><span class=s2>&quot;endpoint&quot;</span><span class=p>],</span> <span class=n>p</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span>
<a id=__codelineno-0-1100 name=__codelineno-0-1100></a>                    <span class=p>),</span>
<a id=__codelineno-0-1101 name=__codelineno-0-1101></a>                    <span class=n>operation_type</span><span class=o>=</span><span class=n>target_circuit_name</span><span class=p>,</span>
<a id=__codelineno-0-1102 name=__codelineno-0-1102></a>                    <span class=n>max_retries</span><span class=o>=</span><span class=n>max_retries</span><span class=p>,</span>
<a id=__codelineno-0-1103 name=__codelineno-0-1103></a>                    <span class=n>retry_delay</span><span class=o>=</span><span class=n>retry_delay</span><span class=p>,</span>
<a id=__codelineno-0-1104 name=__codelineno-0-1104></a>                    <span class=n>retry_backoff_factor</span><span class=o>=</span><span class=n>retry_backoff_factor</span><span class=p>,</span>
<a id=__codelineno-0-1105 name=__codelineno-0-1105></a>                <span class=p>)</span>
<a id=__codelineno-0-1106 name=__codelineno-0-1106></a>
<a id=__codelineno-0-1107 name=__codelineno-0-1107></a>                <span class=k>if</span> <span class=n>success</span><span class=p>:</span>
<a id=__codelineno-0-1108 name=__codelineno-0-1108></a>                    <span class=n>target_result</span> <span class=o>=</span> <span class=n>result</span>
<a id=__codelineno-0-1109 name=__codelineno-0-1109></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1110 name=__codelineno-0-1110></a>                    <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1111 name=__codelineno-0-1111></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1112 name=__codelineno-0-1112></a>
<a id=__codelineno-0-1113 name=__codelineno-0-1113></a>                    <span class=c1># Update result with error details</span>
<a id=__codelineno-0-1114 name=__codelineno-0-1114></a>                    <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1115 name=__codelineno-0-1115></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1116 name=__codelineno-0-1116></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1117 name=__codelineno-0-1117></a>                    <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1118 name=__codelineno-0-1118></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1119 name=__codelineno-0-1119></a>                    <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
<a id=__codelineno-0-1121 name=__codelineno-0-1121></a>            <span class=c1># Update result with success information</span>
<a id=__codelineno-0-1122 name=__codelineno-0-1122></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-1123 name=__codelineno-0-1123></a>                <span class=nb>len</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transformed_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=k>else</span> <span class=mi>1</span>
<a id=__codelineno-0-1124 name=__codelineno-0-1124></a>            <span class=p>)</span>
<a id=__codelineno-0-1125 name=__codelineno-0-1125></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-1126 name=__codelineno-0-1126></a>
<a id=__codelineno-0-1127 name=__codelineno-0-1127></a>            <span class=c1># Set target response directly</span>
<a id=__codelineno-0-1128 name=__codelineno-0-1128></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>target_result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-1129 name=__codelineno-0-1129></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>target_response</span> <span class=o>=</span> <span class=n>target_result</span>
<a id=__codelineno-0-1130 name=__codelineno-0-1130></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1131 name=__codelineno-0-1131></a>                <span class=n>sync_result</span><span class=o>.</span><span class=n>target_response</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-1132 name=__codelineno-0-1132></a>
<a id=__codelineno-0-1133 name=__codelineno-0-1133></a>            <span class=c1># Calculate duration</span>
<a id=__codelineno-0-1134 name=__codelineno-0-1134></a>            <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1135 name=__codelineno-0-1135></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1136 name=__codelineno-0-1136></a>
<a id=__codelineno-0-1137 name=__codelineno-0-1137></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1138 name=__codelineno-0-1138></a>                <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync completed successfully: </span><span class=si>{</span><span class=n>sync_result</span><span class=o>.</span><span class=n>count</span><span class=si>}</span><span class=s2> items transferred in </span><span class=si>{</span><span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span><span class=si>}</span><span class=s2>ms&quot;</span>
<a id=__codelineno-0-1139 name=__codelineno-0-1139></a>            <span class=p>)</span>
<a id=__codelineno-0-1140 name=__codelineno-0-1140></a>            <span class=c1># Update last_sync checkpoint</span>
<a id=__codelineno-0-1141 name=__codelineno-0-1141></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=p>:</span>
<a id=__codelineno-0-1142 name=__codelineno-0-1142></a>                <span class=bp>self</span><span class=o>.</span><span class=n>state_store</span><span class=o>.</span><span class=n>set_last_sync</span><span class=p>(</span><span class=n>source_endpoint</span><span class=p>,</span> <span class=n>now_iso</span><span class=p>())</span>
<a id=__codelineno-0-1143 name=__codelineno-0-1143></a>            <span class=c1># Complete provenance</span>
<a id=__codelineno-0-1144 name=__codelineno-0-1144></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>complete_run</span><span class=p>(</span>
<a id=__codelineno-0-1145 name=__codelineno-0-1145></a>                <span class=kc>True</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>details</span>
<a id=__codelineno-0-1146 name=__codelineno-0-1146></a>            <span class=p>)</span>
<a id=__codelineno-0-1147 name=__codelineno-0-1147></a>
<a id=__codelineno-0-1148 name=__codelineno-0-1148></a>            <span class=c1># Record telemetry metrics</span>
<a id=__codelineno-0-1149 name=__codelineno-0-1149></a>            <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_sync_completion</span><span class=p>(</span>
<a id=__codelineno-0-1150 name=__codelineno-0-1150></a>                <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>count</span>
<a id=__codelineno-0-1151 name=__codelineno-0-1151></a>            <span class=p>)</span>
<a id=__codelineno-0-1152 name=__codelineno-0-1152></a>
<a id=__codelineno-0-1153 name=__codelineno-0-1153></a>            <span class=k>return</span> <span class=n>sync_result</span>
<a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
<a id=__codelineno-0-1155 name=__codelineno-0-1155></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1156 name=__codelineno-0-1156></a>            <span class=c1># Convert to ApiLinkerError</span>
<a id=__codelineno-0-1157 name=__codelineno-0-1157></a>            <span class=n>error</span> <span class=o>=</span> <span class=n>ApiLinkerError</span><span class=o>.</span><span class=n>from_exception</span><span class=p>(</span>
<a id=__codelineno-0-1158 name=__codelineno-0-1158></a>                <span class=n>e</span><span class=p>,</span>
<a id=__codelineno-0-1159 name=__codelineno-0-1159></a>                <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>MAPPING</span><span class=p>,</span>
<a id=__codelineno-0-1160 name=__codelineno-0-1160></a>                <span class=n>correlation_id</span><span class=o>=</span><span class=n>correlation_id</span><span class=p>,</span>
<a id=__codelineno-0-1161 name=__codelineno-0-1161></a>                <span class=n>operation_id</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;mapping_</span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2>_to_</span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1162 name=__codelineno-0-1162></a>            <span class=p>)</span>
<a id=__codelineno-0-1163 name=__codelineno-0-1163></a>
<a id=__codelineno-0-1164 name=__codelineno-0-1164></a>            <span class=c1># Record the error for analytics</span>
<a id=__codelineno-0-1165 name=__codelineno-0-1165></a>            <span class=bp>self</span><span class=o>.</span><span class=n>error_analytics</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
<a id=__codelineno-0-1166 name=__codelineno-0-1166></a>
<a id=__codelineno-0-1167 name=__codelineno-0-1167></a>            <span class=c1># Update result</span>
<a id=__codelineno-0-1168 name=__codelineno-0-1168></a>            <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1169 name=__codelineno-0-1169></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>duration_ms</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-0-1170 name=__codelineno-0-1170></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-1171 name=__codelineno-0-1171></a>            <span class=n>sync_result</span><span class=o>.</span><span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1172 name=__codelineno-0-1172></a>
<a id=__codelineno-0-1173 name=__codelineno-0-1173></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
<a id=__codelineno-0-1174 name=__codelineno-0-1174></a>                <span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>correlation_id</span><span class=si>}</span><span class=s2>] Sync failed during mapping: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1175 name=__codelineno-0-1175></a>            <span class=p>)</span>
<a id=__codelineno-0-1176 name=__codelineno-0-1176></a>            <span class=c1># Record error in provenance</span>
<a id=__codelineno-0-1177 name=__codelineno-0-1177></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span>
<a id=__codelineno-0-1178 name=__codelineno-0-1178></a>                <span class=n>error</span><span class=o>.</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-1179 name=__codelineno-0-1179></a>                <span class=n>category</span><span class=o>=</span><span class=n>error</span><span class=o>.</span><span class=n>error_category</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<a id=__codelineno-0-1180 name=__codelineno-0-1180></a>                <span class=n>status_code</span><span class=o>=</span><span class=n>error</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1181 name=__codelineno-0-1181></a>                <span class=n>endpoint</span><span class=o>=</span><span class=n>target_endpoint</span><span class=p>,</span>
<a id=__codelineno-0-1182 name=__codelineno-0-1182></a>            <span class=p>)</span>
<a id=__codelineno-0-1183 name=__codelineno-0-1183></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provenance</span><span class=o>.</span><span class=n>complete_run</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=p>{})</span>
<a id=__codelineno-0-1184 name=__codelineno-0-1184></a>
<a id=__codelineno-0-1185 name=__codelineno-0-1185></a>            <span class=c1># Record telemetry metrics</span>
<a id=__codelineno-0-1186 name=__codelineno-0-1186></a>            <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_sync_completion</span><span class=p>(</span>
<a id=__codelineno-0-1187 name=__codelineno-0-1187></a>                <span class=n>source_endpoint</span><span class=p>,</span> <span class=n>target_endpoint</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=mi>0</span>
<a id=__codelineno-0-1188 name=__codelineno-0-1188></a>            <span class=p>)</span>
<a id=__codelineno-0-1189 name=__codelineno-0-1189></a>            <span class=bp>self</span><span class=o>.</span><span class=n>telemetry</span><span class=o>.</span><span class=n>record_error</span><span class=p>(</span>
<a id=__codelineno-0-1190 name=__codelineno-0-1190></a>                <span class=n>error</span><span class=o>.</span><span class=n>error_category</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=s2>&quot;sync&quot;</span><span class=p>,</span> <span class=n>error</span><span class=o>.</span><span class=n>message</span>
<a id=__codelineno-0-1191 name=__codelineno-0-1191></a>            <span class=p>)</span>
<a id=__codelineno-0-1192 name=__codelineno-0-1192></a>
<a id=__codelineno-0-1193 name=__codelineno-0-1193></a>        <span class=k>return</span> <span class=n>sync_result</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.fetch class="doc doc-heading"> <code class="highlight language-python"><span class=n>fetch</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Convenience wrapper to fetch data from the configured source connector.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Source endpoint name to fetch from</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>params</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Optional parameters for the request</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Parsed response payload from the source API</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-837>837</a></span>
<span class=normal><a href=#__codelineno-0-838>838</a></span>
<span class=normal><a href=#__codelineno-0-839>839</a></span>
<span class=normal><a href=#__codelineno-0-840>840</a></span>
<span class=normal><a href=#__codelineno-0-841>841</a></span>
<span class=normal><a href=#__codelineno-0-842>842</a></span>
<span class=normal><a href=#__codelineno-0-843>843</a></span>
<span class=normal><a href=#__codelineno-0-844>844</a></span>
<span class=normal><a href=#__codelineno-0-845>845</a></span>
<span class=normal><a href=#__codelineno-0-846>846</a></span>
<span class=normal><a href=#__codelineno-0-847>847</a></span>
<span class=normal><a href=#__codelineno-0-848>848</a></span>
<span class=normal><a href=#__codelineno-0-849>849</a></span>
<span class=normal><a href=#__codelineno-0-850>850</a></span>
<span class=normal><a href=#__codelineno-0-851>851</a></span>
<span class=normal><a href=#__codelineno-0-852>852</a></span>
<span class=normal><a href=#__codelineno-0-853>853</a></span>
<span class=normal><a href=#__codelineno-0-854>854</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-837 name=__codelineno-0-837></a><span class=k>def</span><span class=w> </span><span class=nf>fetch</span><span class=p>(</span>
<a id=__codelineno-0-838 name=__codelineno-0-838></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-839 name=__codelineno-0-839></a>    <span class=n>endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-840 name=__codelineno-0-840></a>    <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-841 name=__codelineno-0-841></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-842 name=__codelineno-0-842></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-843 name=__codelineno-0-843></a><span class=sd>    Convenience wrapper to fetch data from the configured source connector.</span>
<a id=__codelineno-0-844 name=__codelineno-0-844></a>
<a id=__codelineno-0-845 name=__codelineno-0-845></a><span class=sd>    Args:</span>
<a id=__codelineno-0-846 name=__codelineno-0-846></a><span class=sd>        endpoint: Source endpoint name to fetch from</span>
<a id=__codelineno-0-847 name=__codelineno-0-847></a><span class=sd>        params: Optional parameters for the request</span>
<a id=__codelineno-0-848 name=__codelineno-0-848></a>
<a id=__codelineno-0-849 name=__codelineno-0-849></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-850 name=__codelineno-0-850></a><span class=sd>        Parsed response payload from the source API</span>
<a id=__codelineno-0-851 name=__codelineno-0-851></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-852 name=__codelineno-0-852></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>:</span>
<a id=__codelineno-0-853 name=__codelineno-0-853></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Source connector is not configured&quot;</span><span class=p>)</span>
<a id=__codelineno-0-854 name=__codelineno-0-854></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>fetch_data</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.ApiLinker.send class="doc doc-heading"> <code class="highlight language-python"><span class=n>send</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Convenience wrapper to send data to the configured target connector.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Target endpoint name to send to</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>], <span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Payload to send (single item or list)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Target connector response (if any)</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/api_linker.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-856>856</a></span>
<span class=normal><a href=#__codelineno-0-857>857</a></span>
<span class=normal><a href=#__codelineno-0-858>858</a></span>
<span class=normal><a href=#__codelineno-0-859>859</a></span>
<span class=normal><a href=#__codelineno-0-860>860</a></span>
<span class=normal><a href=#__codelineno-0-861>861</a></span>
<span class=normal><a href=#__codelineno-0-862>862</a></span>
<span class=normal><a href=#__codelineno-0-863>863</a></span>
<span class=normal><a href=#__codelineno-0-864>864</a></span>
<span class=normal><a href=#__codelineno-0-865>865</a></span>
<span class=normal><a href=#__codelineno-0-866>866</a></span>
<span class=normal><a href=#__codelineno-0-867>867</a></span>
<span class=normal><a href=#__codelineno-0-868>868</a></span>
<span class=normal><a href=#__codelineno-0-869>869</a></span>
<span class=normal><a href=#__codelineno-0-870>870</a></span>
<span class=normal><a href=#__codelineno-0-871>871</a></span>
<span class=normal><a href=#__codelineno-0-872>872</a></span>
<span class=normal><a href=#__codelineno-0-873>873</a></span>
<span class=normal><a href=#__codelineno-0-874>874</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-856 name=__codelineno-0-856></a><span class=k>def</span><span class=w> </span><span class=nf>send</span><span class=p>(</span>
<a id=__codelineno-0-857 name=__codelineno-0-857></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-858 name=__codelineno-0-858></a>    <span class=n>endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-859 name=__codelineno-0-859></a>    <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span>
<a id=__codelineno-0-860 name=__codelineno-0-860></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-861 name=__codelineno-0-861></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-862 name=__codelineno-0-862></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-863 name=__codelineno-0-863></a><span class=sd>    Convenience wrapper to send data to the configured target connector.</span>
<a id=__codelineno-0-864 name=__codelineno-0-864></a>
<a id=__codelineno-0-865 name=__codelineno-0-865></a><span class=sd>    Args:</span>
<a id=__codelineno-0-866 name=__codelineno-0-866></a><span class=sd>        endpoint: Target endpoint name to send to</span>
<a id=__codelineno-0-867 name=__codelineno-0-867></a><span class=sd>        data: Payload to send (single item or list)</span>
<a id=__codelineno-0-868 name=__codelineno-0-868></a>
<a id=__codelineno-0-869 name=__codelineno-0-869></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-870 name=__codelineno-0-870></a><span class=sd>        Target connector response (if any)</span>
<a id=__codelineno-0-871 name=__codelineno-0-871></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-872 name=__codelineno-0-872></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=p>:</span>
<a id=__codelineno-0-873 name=__codelineno-0-873></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Target connector is not configured&quot;</span><span class=p>)</span>
<a id=__codelineno-0-874 name=__codelineno-0-874></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>send_data</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h3 id=apiconnector>ApiConnector</h3> <p>Base class for all API connectors.</p> <div class="doc doc-object doc-class"> <h2 id=apilinker.core.connector.ApiConnector class="doc doc-heading"> <code>apilinker.core.connector.ApiConnector</code> </h2> <div class="doc doc-contents first"> <p>API Connector for interacting with REST APIs.</p> <p>This class handles the connection to APIs, making requests, and processing responses.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>connector_type</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Type of connector (rest, graphql, etc.)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>base_url</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Base URL for the API</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>auth_config</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=apilinker.core.auth.AuthConfig>AuthConfig</span>]</code> </td> <td> <div class=doc-md-description> <p>Authentication configuration</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>endpoints</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Dictionary of endpoint configurations</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>timeout</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Request timeout in seconds</p> </div> </td> <td> <code>30</code> </td> </tr> <tr class=doc-section-item> <td> <code>retry_count</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of retries on failure</p> </div> </td> <td> <code>3</code> </td> </tr> <tr class=doc-section-item> <td> <code>retry_delay</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Delay between retries in seconds</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-47>  47</a></span>
<span class=normal><a href=#__codelineno-0-48>  48</a></span>
<span class=normal><a href=#__codelineno-0-49>  49</a></span>
<span class=normal><a href=#__codelineno-0-50>  50</a></span>
<span class=normal><a href=#__codelineno-0-51>  51</a></span>
<span class=normal><a href=#__codelineno-0-52>  52</a></span>
<span class=normal><a href=#__codelineno-0-53>  53</a></span>
<span class=normal><a href=#__codelineno-0-54>  54</a></span>
<span class=normal><a href=#__codelineno-0-55>  55</a></span>
<span class=normal><a href=#__codelineno-0-56>  56</a></span>
<span class=normal><a href=#__codelineno-0-57>  57</a></span>
<span class=normal><a href=#__codelineno-0-58>  58</a></span>
<span class=normal><a href=#__codelineno-0-59>  59</a></span>
<span class=normal><a href=#__codelineno-0-60>  60</a></span>
<span class=normal><a href=#__codelineno-0-61>  61</a></span>
<span class=normal><a href=#__codelineno-0-62>  62</a></span>
<span class=normal><a href=#__codelineno-0-63>  63</a></span>
<span class=normal><a href=#__codelineno-0-64>  64</a></span>
<span class=normal><a href=#__codelineno-0-65>  65</a></span>
<span class=normal><a href=#__codelineno-0-66>  66</a></span>
<span class=normal><a href=#__codelineno-0-67>  67</a></span>
<span class=normal><a href=#__codelineno-0-68>  68</a></span>
<span class=normal><a href=#__codelineno-0-69>  69</a></span>
<span class=normal><a href=#__codelineno-0-70>  70</a></span>
<span class=normal><a href=#__codelineno-0-71>  71</a></span>
<span class=normal><a href=#__codelineno-0-72>  72</a></span>
<span class=normal><a href=#__codelineno-0-73>  73</a></span>
<span class=normal><a href=#__codelineno-0-74>  74</a></span>
<span class=normal><a href=#__codelineno-0-75>  75</a></span>
<span class=normal><a href=#__codelineno-0-76>  76</a></span>
<span class=normal><a href=#__codelineno-0-77>  77</a></span>
<span class=normal><a href=#__codelineno-0-78>  78</a></span>
<span class=normal><a href=#__codelineno-0-79>  79</a></span>
<span class=normal><a href=#__codelineno-0-80>  80</a></span>
<span class=normal><a href=#__codelineno-0-81>  81</a></span>
<span class=normal><a href=#__codelineno-0-82>  82</a></span>
<span class=normal><a href=#__codelineno-0-83>  83</a></span>
<span class=normal><a href=#__codelineno-0-84>  84</a></span>
<span class=normal><a href=#__codelineno-0-85>  85</a></span>
<span class=normal><a href=#__codelineno-0-86>  86</a></span>
<span class=normal><a href=#__codelineno-0-87>  87</a></span>
<span class=normal><a href=#__codelineno-0-88>  88</a></span>
<span class=normal><a href=#__codelineno-0-89>  89</a></span>
<span class=normal><a href=#__codelineno-0-90>  90</a></span>
<span class=normal><a href=#__codelineno-0-91>  91</a></span>
<span class=normal><a href=#__codelineno-0-92>  92</a></span>
<span class=normal><a href=#__codelineno-0-93>  93</a></span>
<span class=normal><a href=#__codelineno-0-94>  94</a></span>
<span class=normal><a href=#__codelineno-0-95>  95</a></span>
<span class=normal><a href=#__codelineno-0-96>  96</a></span>
<span class=normal><a href=#__codelineno-0-97>  97</a></span>
<span class=normal><a href=#__codelineno-0-98>  98</a></span>
<span class=normal><a href=#__codelineno-0-99>  99</a></span>
<span class=normal><a href=#__codelineno-0-100> 100</a></span>
<span class=normal><a href=#__codelineno-0-101> 101</a></span>
<span class=normal><a href=#__codelineno-0-102> 102</a></span>
<span class=normal><a href=#__codelineno-0-103> 103</a></span>
<span class=normal><a href=#__codelineno-0-104> 104</a></span>
<span class=normal><a href=#__codelineno-0-105> 105</a></span>
<span class=normal><a href=#__codelineno-0-106> 106</a></span>
<span class=normal><a href=#__codelineno-0-107> 107</a></span>
<span class=normal><a href=#__codelineno-0-108> 108</a></span>
<span class=normal><a href=#__codelineno-0-109> 109</a></span>
<span class=normal><a href=#__codelineno-0-110> 110</a></span>
<span class=normal><a href=#__codelineno-0-111> 111</a></span>
<span class=normal><a href=#__codelineno-0-112> 112</a></span>
<span class=normal><a href=#__codelineno-0-113> 113</a></span>
<span class=normal><a href=#__codelineno-0-114> 114</a></span>
<span class=normal><a href=#__codelineno-0-115> 115</a></span>
<span class=normal><a href=#__codelineno-0-116> 116</a></span>
<span class=normal><a href=#__codelineno-0-117> 117</a></span>
<span class=normal><a href=#__codelineno-0-118> 118</a></span>
<span class=normal><a href=#__codelineno-0-119> 119</a></span>
<span class=normal><a href=#__codelineno-0-120> 120</a></span>
<span class=normal><a href=#__codelineno-0-121> 121</a></span>
<span class=normal><a href=#__codelineno-0-122> 122</a></span>
<span class=normal><a href=#__codelineno-0-123> 123</a></span>
<span class=normal><a href=#__codelineno-0-124> 124</a></span>
<span class=normal><a href=#__codelineno-0-125> 125</a></span>
<span class=normal><a href=#__codelineno-0-126> 126</a></span>
<span class=normal><a href=#__codelineno-0-127> 127</a></span>
<span class=normal><a href=#__codelineno-0-128> 128</a></span>
<span class=normal><a href=#__codelineno-0-129> 129</a></span>
<span class=normal><a href=#__codelineno-0-130> 130</a></span>
<span class=normal><a href=#__codelineno-0-131> 131</a></span>
<span class=normal><a href=#__codelineno-0-132> 132</a></span>
<span class=normal><a href=#__codelineno-0-133> 133</a></span>
<span class=normal><a href=#__codelineno-0-134> 134</a></span>
<span class=normal><a href=#__codelineno-0-135> 135</a></span>
<span class=normal><a href=#__codelineno-0-136> 136</a></span>
<span class=normal><a href=#__codelineno-0-137> 137</a></span>
<span class=normal><a href=#__codelineno-0-138> 138</a></span>
<span class=normal><a href=#__codelineno-0-139> 139</a></span>
<span class=normal><a href=#__codelineno-0-140> 140</a></span>
<span class=normal><a href=#__codelineno-0-141> 141</a></span>
<span class=normal><a href=#__codelineno-0-142> 142</a></span>
<span class=normal><a href=#__codelineno-0-143> 143</a></span>
<span class=normal><a href=#__codelineno-0-144> 144</a></span>
<span class=normal><a href=#__codelineno-0-145> 145</a></span>
<span class=normal><a href=#__codelineno-0-146> 146</a></span>
<span class=normal><a href=#__codelineno-0-147> 147</a></span>
<span class=normal><a href=#__codelineno-0-148> 148</a></span>
<span class=normal><a href=#__codelineno-0-149> 149</a></span>
<span class=normal><a href=#__codelineno-0-150> 150</a></span>
<span class=normal><a href=#__codelineno-0-151> 151</a></span>
<span class=normal><a href=#__codelineno-0-152> 152</a></span>
<span class=normal><a href=#__codelineno-0-153> 153</a></span>
<span class=normal><a href=#__codelineno-0-154> 154</a></span>
<span class=normal><a href=#__codelineno-0-155> 155</a></span>
<span class=normal><a href=#__codelineno-0-156> 156</a></span>
<span class=normal><a href=#__codelineno-0-157> 157</a></span>
<span class=normal><a href=#__codelineno-0-158> 158</a></span>
<span class=normal><a href=#__codelineno-0-159> 159</a></span>
<span class=normal><a href=#__codelineno-0-160> 160</a></span>
<span class=normal><a href=#__codelineno-0-161> 161</a></span>
<span class=normal><a href=#__codelineno-0-162> 162</a></span>
<span class=normal><a href=#__codelineno-0-163> 163</a></span>
<span class=normal><a href=#__codelineno-0-164> 164</a></span>
<span class=normal><a href=#__codelineno-0-165> 165</a></span>
<span class=normal><a href=#__codelineno-0-166> 166</a></span>
<span class=normal><a href=#__codelineno-0-167> 167</a></span>
<span class=normal><a href=#__codelineno-0-168> 168</a></span>
<span class=normal><a href=#__codelineno-0-169> 169</a></span>
<span class=normal><a href=#__codelineno-0-170> 170</a></span>
<span class=normal><a href=#__codelineno-0-171> 171</a></span>
<span class=normal><a href=#__codelineno-0-172> 172</a></span>
<span class=normal><a href=#__codelineno-0-173> 173</a></span>
<span class=normal><a href=#__codelineno-0-174> 174</a></span>
<span class=normal><a href=#__codelineno-0-175> 175</a></span>
<span class=normal><a href=#__codelineno-0-176> 176</a></span>
<span class=normal><a href=#__codelineno-0-177> 177</a></span>
<span class=normal><a href=#__codelineno-0-178> 178</a></span>
<span class=normal><a href=#__codelineno-0-179> 179</a></span>
<span class=normal><a href=#__codelineno-0-180> 180</a></span>
<span class=normal><a href=#__codelineno-0-181> 181</a></span>
<span class=normal><a href=#__codelineno-0-182> 182</a></span>
<span class=normal><a href=#__codelineno-0-183> 183</a></span>
<span class=normal><a href=#__codelineno-0-184> 184</a></span>
<span class=normal><a href=#__codelineno-0-185> 185</a></span>
<span class=normal><a href=#__codelineno-0-186> 186</a></span>
<span class=normal><a href=#__codelineno-0-187> 187</a></span>
<span class=normal><a href=#__codelineno-0-188> 188</a></span>
<span class=normal><a href=#__codelineno-0-189> 189</a></span>
<span class=normal><a href=#__codelineno-0-190> 190</a></span>
<span class=normal><a href=#__codelineno-0-191> 191</a></span>
<span class=normal><a href=#__codelineno-0-192> 192</a></span>
<span class=normal><a href=#__codelineno-0-193> 193</a></span>
<span class=normal><a href=#__codelineno-0-194> 194</a></span>
<span class=normal><a href=#__codelineno-0-195> 195</a></span>
<span class=normal><a href=#__codelineno-0-196> 196</a></span>
<span class=normal><a href=#__codelineno-0-197> 197</a></span>
<span class=normal><a href=#__codelineno-0-198> 198</a></span>
<span class=normal><a href=#__codelineno-0-199> 199</a></span>
<span class=normal><a href=#__codelineno-0-200> 200</a></span>
<span class=normal><a href=#__codelineno-0-201> 201</a></span>
<span class=normal><a href=#__codelineno-0-202> 202</a></span>
<span class=normal><a href=#__codelineno-0-203> 203</a></span>
<span class=normal><a href=#__codelineno-0-204> 204</a></span>
<span class=normal><a href=#__codelineno-0-205> 205</a></span>
<span class=normal><a href=#__codelineno-0-206> 206</a></span>
<span class=normal><a href=#__codelineno-0-207> 207</a></span>
<span class=normal><a href=#__codelineno-0-208> 208</a></span>
<span class=normal><a href=#__codelineno-0-209> 209</a></span>
<span class=normal><a href=#__codelineno-0-210> 210</a></span>
<span class=normal><a href=#__codelineno-0-211> 211</a></span>
<span class=normal><a href=#__codelineno-0-212> 212</a></span>
<span class=normal><a href=#__codelineno-0-213> 213</a></span>
<span class=normal><a href=#__codelineno-0-214> 214</a></span>
<span class=normal><a href=#__codelineno-0-215> 215</a></span>
<span class=normal><a href=#__codelineno-0-216> 216</a></span>
<span class=normal><a href=#__codelineno-0-217> 217</a></span>
<span class=normal><a href=#__codelineno-0-218> 218</a></span>
<span class=normal><a href=#__codelineno-0-219> 219</a></span>
<span class=normal><a href=#__codelineno-0-220> 220</a></span>
<span class=normal><a href=#__codelineno-0-221> 221</a></span>
<span class=normal><a href=#__codelineno-0-222> 222</a></span>
<span class=normal><a href=#__codelineno-0-223> 223</a></span>
<span class=normal><a href=#__codelineno-0-224> 224</a></span>
<span class=normal><a href=#__codelineno-0-225> 225</a></span>
<span class=normal><a href=#__codelineno-0-226> 226</a></span>
<span class=normal><a href=#__codelineno-0-227> 227</a></span>
<span class=normal><a href=#__codelineno-0-228> 228</a></span>
<span class=normal><a href=#__codelineno-0-229> 229</a></span>
<span class=normal><a href=#__codelineno-0-230> 230</a></span>
<span class=normal><a href=#__codelineno-0-231> 231</a></span>
<span class=normal><a href=#__codelineno-0-232> 232</a></span>
<span class=normal><a href=#__codelineno-0-233> 233</a></span>
<span class=normal><a href=#__codelineno-0-234> 234</a></span>
<span class=normal><a href=#__codelineno-0-235> 235</a></span>
<span class=normal><a href=#__codelineno-0-236> 236</a></span>
<span class=normal><a href=#__codelineno-0-237> 237</a></span>
<span class=normal><a href=#__codelineno-0-238> 238</a></span>
<span class=normal><a href=#__codelineno-0-239> 239</a></span>
<span class=normal><a href=#__codelineno-0-240> 240</a></span>
<span class=normal><a href=#__codelineno-0-241> 241</a></span>
<span class=normal><a href=#__codelineno-0-242> 242</a></span>
<span class=normal><a href=#__codelineno-0-243> 243</a></span>
<span class=normal><a href=#__codelineno-0-244> 244</a></span>
<span class=normal><a href=#__codelineno-0-245> 245</a></span>
<span class=normal><a href=#__codelineno-0-246> 246</a></span>
<span class=normal><a href=#__codelineno-0-247> 247</a></span>
<span class=normal><a href=#__codelineno-0-248> 248</a></span>
<span class=normal><a href=#__codelineno-0-249> 249</a></span>
<span class=normal><a href=#__codelineno-0-250> 250</a></span>
<span class=normal><a href=#__codelineno-0-251> 251</a></span>
<span class=normal><a href=#__codelineno-0-252> 252</a></span>
<span class=normal><a href=#__codelineno-0-253> 253</a></span>
<span class=normal><a href=#__codelineno-0-254> 254</a></span>
<span class=normal><a href=#__codelineno-0-255> 255</a></span>
<span class=normal><a href=#__codelineno-0-256> 256</a></span>
<span class=normal><a href=#__codelineno-0-257> 257</a></span>
<span class=normal><a href=#__codelineno-0-258> 258</a></span>
<span class=normal><a href=#__codelineno-0-259> 259</a></span>
<span class=normal><a href=#__codelineno-0-260> 260</a></span>
<span class=normal><a href=#__codelineno-0-261> 261</a></span>
<span class=normal><a href=#__codelineno-0-262> 262</a></span>
<span class=normal><a href=#__codelineno-0-263> 263</a></span>
<span class=normal><a href=#__codelineno-0-264> 264</a></span>
<span class=normal><a href=#__codelineno-0-265> 265</a></span>
<span class=normal><a href=#__codelineno-0-266> 266</a></span>
<span class=normal><a href=#__codelineno-0-267> 267</a></span>
<span class=normal><a href=#__codelineno-0-268> 268</a></span>
<span class=normal><a href=#__codelineno-0-269> 269</a></span>
<span class=normal><a href=#__codelineno-0-270> 270</a></span>
<span class=normal><a href=#__codelineno-0-271> 271</a></span>
<span class=normal><a href=#__codelineno-0-272> 272</a></span>
<span class=normal><a href=#__codelineno-0-273> 273</a></span>
<span class=normal><a href=#__codelineno-0-274> 274</a></span>
<span class=normal><a href=#__codelineno-0-275> 275</a></span>
<span class=normal><a href=#__codelineno-0-276> 276</a></span>
<span class=normal><a href=#__codelineno-0-277> 277</a></span>
<span class=normal><a href=#__codelineno-0-278> 278</a></span>
<span class=normal><a href=#__codelineno-0-279> 279</a></span>
<span class=normal><a href=#__codelineno-0-280> 280</a></span>
<span class=normal><a href=#__codelineno-0-281> 281</a></span>
<span class=normal><a href=#__codelineno-0-282> 282</a></span>
<span class=normal><a href=#__codelineno-0-283> 283</a></span>
<span class=normal><a href=#__codelineno-0-284> 284</a></span>
<span class=normal><a href=#__codelineno-0-285> 285</a></span>
<span class=normal><a href=#__codelineno-0-286> 286</a></span>
<span class=normal><a href=#__codelineno-0-287> 287</a></span>
<span class=normal><a href=#__codelineno-0-288> 288</a></span>
<span class=normal><a href=#__codelineno-0-289> 289</a></span>
<span class=normal><a href=#__codelineno-0-290> 290</a></span>
<span class=normal><a href=#__codelineno-0-291> 291</a></span>
<span class=normal><a href=#__codelineno-0-292> 292</a></span>
<span class=normal><a href=#__codelineno-0-293> 293</a></span>
<span class=normal><a href=#__codelineno-0-294> 294</a></span>
<span class=normal><a href=#__codelineno-0-295> 295</a></span>
<span class=normal><a href=#__codelineno-0-296> 296</a></span>
<span class=normal><a href=#__codelineno-0-297> 297</a></span>
<span class=normal><a href=#__codelineno-0-298> 298</a></span>
<span class=normal><a href=#__codelineno-0-299> 299</a></span>
<span class=normal><a href=#__codelineno-0-300> 300</a></span>
<span class=normal><a href=#__codelineno-0-301> 301</a></span>
<span class=normal><a href=#__codelineno-0-302> 302</a></span>
<span class=normal><a href=#__codelineno-0-303> 303</a></span>
<span class=normal><a href=#__codelineno-0-304> 304</a></span>
<span class=normal><a href=#__codelineno-0-305> 305</a></span>
<span class=normal><a href=#__codelineno-0-306> 306</a></span>
<span class=normal><a href=#__codelineno-0-307> 307</a></span>
<span class=normal><a href=#__codelineno-0-308> 308</a></span>
<span class=normal><a href=#__codelineno-0-309> 309</a></span>
<span class=normal><a href=#__codelineno-0-310> 310</a></span>
<span class=normal><a href=#__codelineno-0-311> 311</a></span>
<span class=normal><a href=#__codelineno-0-312> 312</a></span>
<span class=normal><a href=#__codelineno-0-313> 313</a></span>
<span class=normal><a href=#__codelineno-0-314> 314</a></span>
<span class=normal><a href=#__codelineno-0-315> 315</a></span>
<span class=normal><a href=#__codelineno-0-316> 316</a></span>
<span class=normal><a href=#__codelineno-0-317> 317</a></span>
<span class=normal><a href=#__codelineno-0-318> 318</a></span>
<span class=normal><a href=#__codelineno-0-319> 319</a></span>
<span class=normal><a href=#__codelineno-0-320> 320</a></span>
<span class=normal><a href=#__codelineno-0-321> 321</a></span>
<span class=normal><a href=#__codelineno-0-322> 322</a></span>
<span class=normal><a href=#__codelineno-0-323> 323</a></span>
<span class=normal><a href=#__codelineno-0-324> 324</a></span>
<span class=normal><a href=#__codelineno-0-325> 325</a></span>
<span class=normal><a href=#__codelineno-0-326> 326</a></span>
<span class=normal><a href=#__codelineno-0-327> 327</a></span>
<span class=normal><a href=#__codelineno-0-328> 328</a></span>
<span class=normal><a href=#__codelineno-0-329> 329</a></span>
<span class=normal><a href=#__codelineno-0-330> 330</a></span>
<span class=normal><a href=#__codelineno-0-331> 331</a></span>
<span class=normal><a href=#__codelineno-0-332> 332</a></span>
<span class=normal><a href=#__codelineno-0-333> 333</a></span>
<span class=normal><a href=#__codelineno-0-334> 334</a></span>
<span class=normal><a href=#__codelineno-0-335> 335</a></span>
<span class=normal><a href=#__codelineno-0-336> 336</a></span>
<span class=normal><a href=#__codelineno-0-337> 337</a></span>
<span class=normal><a href=#__codelineno-0-338> 338</a></span>
<span class=normal><a href=#__codelineno-0-339> 339</a></span>
<span class=normal><a href=#__codelineno-0-340> 340</a></span>
<span class=normal><a href=#__codelineno-0-341> 341</a></span>
<span class=normal><a href=#__codelineno-0-342> 342</a></span>
<span class=normal><a href=#__codelineno-0-343> 343</a></span>
<span class=normal><a href=#__codelineno-0-344> 344</a></span>
<span class=normal><a href=#__codelineno-0-345> 345</a></span>
<span class=normal><a href=#__codelineno-0-346> 346</a></span>
<span class=normal><a href=#__codelineno-0-347> 347</a></span>
<span class=normal><a href=#__codelineno-0-348> 348</a></span>
<span class=normal><a href=#__codelineno-0-349> 349</a></span>
<span class=normal><a href=#__codelineno-0-350> 350</a></span>
<span class=normal><a href=#__codelineno-0-351> 351</a></span>
<span class=normal><a href=#__codelineno-0-352> 352</a></span>
<span class=normal><a href=#__codelineno-0-353> 353</a></span>
<span class=normal><a href=#__codelineno-0-354> 354</a></span>
<span class=normal><a href=#__codelineno-0-355> 355</a></span>
<span class=normal><a href=#__codelineno-0-356> 356</a></span>
<span class=normal><a href=#__codelineno-0-357> 357</a></span>
<span class=normal><a href=#__codelineno-0-358> 358</a></span>
<span class=normal><a href=#__codelineno-0-359> 359</a></span>
<span class=normal><a href=#__codelineno-0-360> 360</a></span>
<span class=normal><a href=#__codelineno-0-361> 361</a></span>
<span class=normal><a href=#__codelineno-0-362> 362</a></span>
<span class=normal><a href=#__codelineno-0-363> 363</a></span>
<span class=normal><a href=#__codelineno-0-364> 364</a></span>
<span class=normal><a href=#__codelineno-0-365> 365</a></span>
<span class=normal><a href=#__codelineno-0-366> 366</a></span>
<span class=normal><a href=#__codelineno-0-367> 367</a></span>
<span class=normal><a href=#__codelineno-0-368> 368</a></span>
<span class=normal><a href=#__codelineno-0-369> 369</a></span>
<span class=normal><a href=#__codelineno-0-370> 370</a></span>
<span class=normal><a href=#__codelineno-0-371> 371</a></span>
<span class=normal><a href=#__codelineno-0-372> 372</a></span>
<span class=normal><a href=#__codelineno-0-373> 373</a></span>
<span class=normal><a href=#__codelineno-0-374> 374</a></span>
<span class=normal><a href=#__codelineno-0-375> 375</a></span>
<span class=normal><a href=#__codelineno-0-376> 376</a></span>
<span class=normal><a href=#__codelineno-0-377> 377</a></span>
<span class=normal><a href=#__codelineno-0-378> 378</a></span>
<span class=normal><a href=#__codelineno-0-379> 379</a></span>
<span class=normal><a href=#__codelineno-0-380> 380</a></span>
<span class=normal><a href=#__codelineno-0-381> 381</a></span>
<span class=normal><a href=#__codelineno-0-382> 382</a></span>
<span class=normal><a href=#__codelineno-0-383> 383</a></span>
<span class=normal><a href=#__codelineno-0-384> 384</a></span>
<span class=normal><a href=#__codelineno-0-385> 385</a></span>
<span class=normal><a href=#__codelineno-0-386> 386</a></span>
<span class=normal><a href=#__codelineno-0-387> 387</a></span>
<span class=normal><a href=#__codelineno-0-388> 388</a></span>
<span class=normal><a href=#__codelineno-0-389> 389</a></span>
<span class=normal><a href=#__codelineno-0-390> 390</a></span>
<span class=normal><a href=#__codelineno-0-391> 391</a></span>
<span class=normal><a href=#__codelineno-0-392> 392</a></span>
<span class=normal><a href=#__codelineno-0-393> 393</a></span>
<span class=normal><a href=#__codelineno-0-394> 394</a></span>
<span class=normal><a href=#__codelineno-0-395> 395</a></span>
<span class=normal><a href=#__codelineno-0-396> 396</a></span>
<span class=normal><a href=#__codelineno-0-397> 397</a></span>
<span class=normal><a href=#__codelineno-0-398> 398</a></span>
<span class=normal><a href=#__codelineno-0-399> 399</a></span>
<span class=normal><a href=#__codelineno-0-400> 400</a></span>
<span class=normal><a href=#__codelineno-0-401> 401</a></span>
<span class=normal><a href=#__codelineno-0-402> 402</a></span>
<span class=normal><a href=#__codelineno-0-403> 403</a></span>
<span class=normal><a href=#__codelineno-0-404> 404</a></span>
<span class=normal><a href=#__codelineno-0-405> 405</a></span>
<span class=normal><a href=#__codelineno-0-406> 406</a></span>
<span class=normal><a href=#__codelineno-0-407> 407</a></span>
<span class=normal><a href=#__codelineno-0-408> 408</a></span>
<span class=normal><a href=#__codelineno-0-409> 409</a></span>
<span class=normal><a href=#__codelineno-0-410> 410</a></span>
<span class=normal><a href=#__codelineno-0-411> 411</a></span>
<span class=normal><a href=#__codelineno-0-412> 412</a></span>
<span class=normal><a href=#__codelineno-0-413> 413</a></span>
<span class=normal><a href=#__codelineno-0-414> 414</a></span>
<span class=normal><a href=#__codelineno-0-415> 415</a></span>
<span class=normal><a href=#__codelineno-0-416> 416</a></span>
<span class=normal><a href=#__codelineno-0-417> 417</a></span>
<span class=normal><a href=#__codelineno-0-418> 418</a></span>
<span class=normal><a href=#__codelineno-0-419> 419</a></span>
<span class=normal><a href=#__codelineno-0-420> 420</a></span>
<span class=normal><a href=#__codelineno-0-421> 421</a></span>
<span class=normal><a href=#__codelineno-0-422> 422</a></span>
<span class=normal><a href=#__codelineno-0-423> 423</a></span>
<span class=normal><a href=#__codelineno-0-424> 424</a></span>
<span class=normal><a href=#__codelineno-0-425> 425</a></span>
<span class=normal><a href=#__codelineno-0-426> 426</a></span>
<span class=normal><a href=#__codelineno-0-427> 427</a></span>
<span class=normal><a href=#__codelineno-0-428> 428</a></span>
<span class=normal><a href=#__codelineno-0-429> 429</a></span>
<span class=normal><a href=#__codelineno-0-430> 430</a></span>
<span class=normal><a href=#__codelineno-0-431> 431</a></span>
<span class=normal><a href=#__codelineno-0-432> 432</a></span>
<span class=normal><a href=#__codelineno-0-433> 433</a></span>
<span class=normal><a href=#__codelineno-0-434> 434</a></span>
<span class=normal><a href=#__codelineno-0-435> 435</a></span>
<span class=normal><a href=#__codelineno-0-436> 436</a></span>
<span class=normal><a href=#__codelineno-0-437> 437</a></span>
<span class=normal><a href=#__codelineno-0-438> 438</a></span>
<span class=normal><a href=#__codelineno-0-439> 439</a></span>
<span class=normal><a href=#__codelineno-0-440> 440</a></span>
<span class=normal><a href=#__codelineno-0-441> 441</a></span>
<span class=normal><a href=#__codelineno-0-442> 442</a></span>
<span class=normal><a href=#__codelineno-0-443> 443</a></span>
<span class=normal><a href=#__codelineno-0-444> 444</a></span>
<span class=normal><a href=#__codelineno-0-445> 445</a></span>
<span class=normal><a href=#__codelineno-0-446> 446</a></span>
<span class=normal><a href=#__codelineno-0-447> 447</a></span>
<span class=normal><a href=#__codelineno-0-448> 448</a></span>
<span class=normal><a href=#__codelineno-0-449> 449</a></span>
<span class=normal><a href=#__codelineno-0-450> 450</a></span>
<span class=normal><a href=#__codelineno-0-451> 451</a></span>
<span class=normal><a href=#__codelineno-0-452> 452</a></span>
<span class=normal><a href=#__codelineno-0-453> 453</a></span>
<span class=normal><a href=#__codelineno-0-454> 454</a></span>
<span class=normal><a href=#__codelineno-0-455> 455</a></span>
<span class=normal><a href=#__codelineno-0-456> 456</a></span>
<span class=normal><a href=#__codelineno-0-457> 457</a></span>
<span class=normal><a href=#__codelineno-0-458> 458</a></span>
<span class=normal><a href=#__codelineno-0-459> 459</a></span>
<span class=normal><a href=#__codelineno-0-460> 460</a></span>
<span class=normal><a href=#__codelineno-0-461> 461</a></span>
<span class=normal><a href=#__codelineno-0-462> 462</a></span>
<span class=normal><a href=#__codelineno-0-463> 463</a></span>
<span class=normal><a href=#__codelineno-0-464> 464</a></span>
<span class=normal><a href=#__codelineno-0-465> 465</a></span>
<span class=normal><a href=#__codelineno-0-466> 466</a></span>
<span class=normal><a href=#__codelineno-0-467> 467</a></span>
<span class=normal><a href=#__codelineno-0-468> 468</a></span>
<span class=normal><a href=#__codelineno-0-469> 469</a></span>
<span class=normal><a href=#__codelineno-0-470> 470</a></span>
<span class=normal><a href=#__codelineno-0-471> 471</a></span>
<span class=normal><a href=#__codelineno-0-472> 472</a></span>
<span class=normal><a href=#__codelineno-0-473> 473</a></span>
<span class=normal><a href=#__codelineno-0-474> 474</a></span>
<span class=normal><a href=#__codelineno-0-475> 475</a></span>
<span class=normal><a href=#__codelineno-0-476> 476</a></span>
<span class=normal><a href=#__codelineno-0-477> 477</a></span>
<span class=normal><a href=#__codelineno-0-478> 478</a></span>
<span class=normal><a href=#__codelineno-0-479> 479</a></span>
<span class=normal><a href=#__codelineno-0-480> 480</a></span>
<span class=normal><a href=#__codelineno-0-481> 481</a></span>
<span class=normal><a href=#__codelineno-0-482> 482</a></span>
<span class=normal><a href=#__codelineno-0-483> 483</a></span>
<span class=normal><a href=#__codelineno-0-484> 484</a></span>
<span class=normal><a href=#__codelineno-0-485> 485</a></span>
<span class=normal><a href=#__codelineno-0-486> 486</a></span>
<span class=normal><a href=#__codelineno-0-487> 487</a></span>
<span class=normal><a href=#__codelineno-0-488> 488</a></span>
<span class=normal><a href=#__codelineno-0-489> 489</a></span>
<span class=normal><a href=#__codelineno-0-490> 490</a></span>
<span class=normal><a href=#__codelineno-0-491> 491</a></span>
<span class=normal><a href=#__codelineno-0-492> 492</a></span>
<span class=normal><a href=#__codelineno-0-493> 493</a></span>
<span class=normal><a href=#__codelineno-0-494> 494</a></span>
<span class=normal><a href=#__codelineno-0-495> 495</a></span>
<span class=normal><a href=#__codelineno-0-496> 496</a></span>
<span class=normal><a href=#__codelineno-0-497> 497</a></span>
<span class=normal><a href=#__codelineno-0-498> 498</a></span>
<span class=normal><a href=#__codelineno-0-499> 499</a></span>
<span class=normal><a href=#__codelineno-0-500> 500</a></span>
<span class=normal><a href=#__codelineno-0-501> 501</a></span>
<span class=normal><a href=#__codelineno-0-502> 502</a></span>
<span class=normal><a href=#__codelineno-0-503> 503</a></span>
<span class=normal><a href=#__codelineno-0-504> 504</a></span>
<span class=normal><a href=#__codelineno-0-505> 505</a></span>
<span class=normal><a href=#__codelineno-0-506> 506</a></span>
<span class=normal><a href=#__codelineno-0-507> 507</a></span>
<span class=normal><a href=#__codelineno-0-508> 508</a></span>
<span class=normal><a href=#__codelineno-0-509> 509</a></span>
<span class=normal><a href=#__codelineno-0-510> 510</a></span>
<span class=normal><a href=#__codelineno-0-511> 511</a></span>
<span class=normal><a href=#__codelineno-0-512> 512</a></span>
<span class=normal><a href=#__codelineno-0-513> 513</a></span>
<span class=normal><a href=#__codelineno-0-514> 514</a></span>
<span class=normal><a href=#__codelineno-0-515> 515</a></span>
<span class=normal><a href=#__codelineno-0-516> 516</a></span>
<span class=normal><a href=#__codelineno-0-517> 517</a></span>
<span class=normal><a href=#__codelineno-0-518> 518</a></span>
<span class=normal><a href=#__codelineno-0-519> 519</a></span>
<span class=normal><a href=#__codelineno-0-520> 520</a></span>
<span class=normal><a href=#__codelineno-0-521> 521</a></span>
<span class=normal><a href=#__codelineno-0-522> 522</a></span>
<span class=normal><a href=#__codelineno-0-523> 523</a></span>
<span class=normal><a href=#__codelineno-0-524> 524</a></span>
<span class=normal><a href=#__codelineno-0-525> 525</a></span>
<span class=normal><a href=#__codelineno-0-526> 526</a></span>
<span class=normal><a href=#__codelineno-0-527> 527</a></span>
<span class=normal><a href=#__codelineno-0-528> 528</a></span>
<span class=normal><a href=#__codelineno-0-529> 529</a></span>
<span class=normal><a href=#__codelineno-0-530> 530</a></span>
<span class=normal><a href=#__codelineno-0-531> 531</a></span>
<span class=normal><a href=#__codelineno-0-532> 532</a></span>
<span class=normal><a href=#__codelineno-0-533> 533</a></span>
<span class=normal><a href=#__codelineno-0-534> 534</a></span>
<span class=normal><a href=#__codelineno-0-535> 535</a></span>
<span class=normal><a href=#__codelineno-0-536> 536</a></span>
<span class=normal><a href=#__codelineno-0-537> 537</a></span>
<span class=normal><a href=#__codelineno-0-538> 538</a></span>
<span class=normal><a href=#__codelineno-0-539> 539</a></span>
<span class=normal><a href=#__codelineno-0-540> 540</a></span>
<span class=normal><a href=#__codelineno-0-541> 541</a></span>
<span class=normal><a href=#__codelineno-0-542> 542</a></span>
<span class=normal><a href=#__codelineno-0-543> 543</a></span>
<span class=normal><a href=#__codelineno-0-544> 544</a></span>
<span class=normal><a href=#__codelineno-0-545> 545</a></span>
<span class=normal><a href=#__codelineno-0-546> 546</a></span>
<span class=normal><a href=#__codelineno-0-547> 547</a></span>
<span class=normal><a href=#__codelineno-0-548> 548</a></span>
<span class=normal><a href=#__codelineno-0-549> 549</a></span>
<span class=normal><a href=#__codelineno-0-550> 550</a></span>
<span class=normal><a href=#__codelineno-0-551> 551</a></span>
<span class=normal><a href=#__codelineno-0-552> 552</a></span>
<span class=normal><a href=#__codelineno-0-553> 553</a></span>
<span class=normal><a href=#__codelineno-0-554> 554</a></span>
<span class=normal><a href=#__codelineno-0-555> 555</a></span>
<span class=normal><a href=#__codelineno-0-556> 556</a></span>
<span class=normal><a href=#__codelineno-0-557> 557</a></span>
<span class=normal><a href=#__codelineno-0-558> 558</a></span>
<span class=normal><a href=#__codelineno-0-559> 559</a></span>
<span class=normal><a href=#__codelineno-0-560> 560</a></span>
<span class=normal><a href=#__codelineno-0-561> 561</a></span>
<span class=normal><a href=#__codelineno-0-562> 562</a></span>
<span class=normal><a href=#__codelineno-0-563> 563</a></span>
<span class=normal><a href=#__codelineno-0-564> 564</a></span>
<span class=normal><a href=#__codelineno-0-565> 565</a></span>
<span class=normal><a href=#__codelineno-0-566> 566</a></span>
<span class=normal><a href=#__codelineno-0-567> 567</a></span>
<span class=normal><a href=#__codelineno-0-568> 568</a></span>
<span class=normal><a href=#__codelineno-0-569> 569</a></span>
<span class=normal><a href=#__codelineno-0-570> 570</a></span>
<span class=normal><a href=#__codelineno-0-571> 571</a></span>
<span class=normal><a href=#__codelineno-0-572> 572</a></span>
<span class=normal><a href=#__codelineno-0-573> 573</a></span>
<span class=normal><a href=#__codelineno-0-574> 574</a></span>
<span class=normal><a href=#__codelineno-0-575> 575</a></span>
<span class=normal><a href=#__codelineno-0-576> 576</a></span>
<span class=normal><a href=#__codelineno-0-577> 577</a></span>
<span class=normal><a href=#__codelineno-0-578> 578</a></span>
<span class=normal><a href=#__codelineno-0-579> 579</a></span>
<span class=normal><a href=#__codelineno-0-580> 580</a></span>
<span class=normal><a href=#__codelineno-0-581> 581</a></span>
<span class=normal><a href=#__codelineno-0-582> 582</a></span>
<span class=normal><a href=#__codelineno-0-583> 583</a></span>
<span class=normal><a href=#__codelineno-0-584> 584</a></span>
<span class=normal><a href=#__codelineno-0-585> 585</a></span>
<span class=normal><a href=#__codelineno-0-586> 586</a></span>
<span class=normal><a href=#__codelineno-0-587> 587</a></span>
<span class=normal><a href=#__codelineno-0-588> 588</a></span>
<span class=normal><a href=#__codelineno-0-589> 589</a></span>
<span class=normal><a href=#__codelineno-0-590> 590</a></span>
<span class=normal><a href=#__codelineno-0-591> 591</a></span>
<span class=normal><a href=#__codelineno-0-592> 592</a></span>
<span class=normal><a href=#__codelineno-0-593> 593</a></span>
<span class=normal><a href=#__codelineno-0-594> 594</a></span>
<span class=normal><a href=#__codelineno-0-595> 595</a></span>
<span class=normal><a href=#__codelineno-0-596> 596</a></span>
<span class=normal><a href=#__codelineno-0-597> 597</a></span>
<span class=normal><a href=#__codelineno-0-598> 598</a></span>
<span class=normal><a href=#__codelineno-0-599> 599</a></span>
<span class=normal><a href=#__codelineno-0-600> 600</a></span>
<span class=normal><a href=#__codelineno-0-601> 601</a></span>
<span class=normal><a href=#__codelineno-0-602> 602</a></span>
<span class=normal><a href=#__codelineno-0-603> 603</a></span>
<span class=normal><a href=#__codelineno-0-604> 604</a></span>
<span class=normal><a href=#__codelineno-0-605> 605</a></span>
<span class=normal><a href=#__codelineno-0-606> 606</a></span>
<span class=normal><a href=#__codelineno-0-607> 607</a></span>
<span class=normal><a href=#__codelineno-0-608> 608</a></span>
<span class=normal><a href=#__codelineno-0-609> 609</a></span>
<span class=normal><a href=#__codelineno-0-610> 610</a></span>
<span class=normal><a href=#__codelineno-0-611> 611</a></span>
<span class=normal><a href=#__codelineno-0-612> 612</a></span>
<span class=normal><a href=#__codelineno-0-613> 613</a></span>
<span class=normal><a href=#__codelineno-0-614> 614</a></span>
<span class=normal><a href=#__codelineno-0-615> 615</a></span>
<span class=normal><a href=#__codelineno-0-616> 616</a></span>
<span class=normal><a href=#__codelineno-0-617> 617</a></span>
<span class=normal><a href=#__codelineno-0-618> 618</a></span>
<span class=normal><a href=#__codelineno-0-619> 619</a></span>
<span class=normal><a href=#__codelineno-0-620> 620</a></span>
<span class=normal><a href=#__codelineno-0-621> 621</a></span>
<span class=normal><a href=#__codelineno-0-622> 622</a></span>
<span class=normal><a href=#__codelineno-0-623> 623</a></span>
<span class=normal><a href=#__codelineno-0-624> 624</a></span>
<span class=normal><a href=#__codelineno-0-625> 625</a></span>
<span class=normal><a href=#__codelineno-0-626> 626</a></span>
<span class=normal><a href=#__codelineno-0-627> 627</a></span>
<span class=normal><a href=#__codelineno-0-628> 628</a></span>
<span class=normal><a href=#__codelineno-0-629> 629</a></span>
<span class=normal><a href=#__codelineno-0-630> 630</a></span>
<span class=normal><a href=#__codelineno-0-631> 631</a></span>
<span class=normal><a href=#__codelineno-0-632> 632</a></span>
<span class=normal><a href=#__codelineno-0-633> 633</a></span>
<span class=normal><a href=#__codelineno-0-634> 634</a></span>
<span class=normal><a href=#__codelineno-0-635> 635</a></span>
<span class=normal><a href=#__codelineno-0-636> 636</a></span>
<span class=normal><a href=#__codelineno-0-637> 637</a></span>
<span class=normal><a href=#__codelineno-0-638> 638</a></span>
<span class=normal><a href=#__codelineno-0-639> 639</a></span>
<span class=normal><a href=#__codelineno-0-640> 640</a></span>
<span class=normal><a href=#__codelineno-0-641> 641</a></span>
<span class=normal><a href=#__codelineno-0-642> 642</a></span>
<span class=normal><a href=#__codelineno-0-643> 643</a></span>
<span class=normal><a href=#__codelineno-0-644> 644</a></span>
<span class=normal><a href=#__codelineno-0-645> 645</a></span>
<span class=normal><a href=#__codelineno-0-646> 646</a></span>
<span class=normal><a href=#__codelineno-0-647> 647</a></span>
<span class=normal><a href=#__codelineno-0-648> 648</a></span>
<span class=normal><a href=#__codelineno-0-649> 649</a></span>
<span class=normal><a href=#__codelineno-0-650> 650</a></span>
<span class=normal><a href=#__codelineno-0-651> 651</a></span>
<span class=normal><a href=#__codelineno-0-652> 652</a></span>
<span class=normal><a href=#__codelineno-0-653> 653</a></span>
<span class=normal><a href=#__codelineno-0-654> 654</a></span>
<span class=normal><a href=#__codelineno-0-655> 655</a></span>
<span class=normal><a href=#__codelineno-0-656> 656</a></span>
<span class=normal><a href=#__codelineno-0-657> 657</a></span>
<span class=normal><a href=#__codelineno-0-658> 658</a></span>
<span class=normal><a href=#__codelineno-0-659> 659</a></span>
<span class=normal><a href=#__codelineno-0-660> 660</a></span>
<span class=normal><a href=#__codelineno-0-661> 661</a></span>
<span class=normal><a href=#__codelineno-0-662> 662</a></span>
<span class=normal><a href=#__codelineno-0-663> 663</a></span>
<span class=normal><a href=#__codelineno-0-664> 664</a></span>
<span class=normal><a href=#__codelineno-0-665> 665</a></span>
<span class=normal><a href=#__codelineno-0-666> 666</a></span>
<span class=normal><a href=#__codelineno-0-667> 667</a></span>
<span class=normal><a href=#__codelineno-0-668> 668</a></span>
<span class=normal><a href=#__codelineno-0-669> 669</a></span>
<span class=normal><a href=#__codelineno-0-670> 670</a></span>
<span class=normal><a href=#__codelineno-0-671> 671</a></span>
<span class=normal><a href=#__codelineno-0-672> 672</a></span>
<span class=normal><a href=#__codelineno-0-673> 673</a></span>
<span class=normal><a href=#__codelineno-0-674> 674</a></span>
<span class=normal><a href=#__codelineno-0-675> 675</a></span>
<span class=normal><a href=#__codelineno-0-676> 676</a></span>
<span class=normal><a href=#__codelineno-0-677> 677</a></span>
<span class=normal><a href=#__codelineno-0-678> 678</a></span>
<span class=normal><a href=#__codelineno-0-679> 679</a></span>
<span class=normal><a href=#__codelineno-0-680> 680</a></span>
<span class=normal><a href=#__codelineno-0-681> 681</a></span>
<span class=normal><a href=#__codelineno-0-682> 682</a></span>
<span class=normal><a href=#__codelineno-0-683> 683</a></span>
<span class=normal><a href=#__codelineno-0-684> 684</a></span>
<span class=normal><a href=#__codelineno-0-685> 685</a></span>
<span class=normal><a href=#__codelineno-0-686> 686</a></span>
<span class=normal><a href=#__codelineno-0-687> 687</a></span>
<span class=normal><a href=#__codelineno-0-688> 688</a></span>
<span class=normal><a href=#__codelineno-0-689> 689</a></span>
<span class=normal><a href=#__codelineno-0-690> 690</a></span>
<span class=normal><a href=#__codelineno-0-691> 691</a></span>
<span class=normal><a href=#__codelineno-0-692> 692</a></span>
<span class=normal><a href=#__codelineno-0-693> 693</a></span>
<span class=normal><a href=#__codelineno-0-694> 694</a></span>
<span class=normal><a href=#__codelineno-0-695> 695</a></span>
<span class=normal><a href=#__codelineno-0-696> 696</a></span>
<span class=normal><a href=#__codelineno-0-697> 697</a></span>
<span class=normal><a href=#__codelineno-0-698> 698</a></span>
<span class=normal><a href=#__codelineno-0-699> 699</a></span>
<span class=normal><a href=#__codelineno-0-700> 700</a></span>
<span class=normal><a href=#__codelineno-0-701> 701</a></span>
<span class=normal><a href=#__codelineno-0-702> 702</a></span>
<span class=normal><a href=#__codelineno-0-703> 703</a></span>
<span class=normal><a href=#__codelineno-0-704> 704</a></span>
<span class=normal><a href=#__codelineno-0-705> 705</a></span>
<span class=normal><a href=#__codelineno-0-706> 706</a></span>
<span class=normal><a href=#__codelineno-0-707> 707</a></span>
<span class=normal><a href=#__codelineno-0-708> 708</a></span>
<span class=normal><a href=#__codelineno-0-709> 709</a></span>
<span class=normal><a href=#__codelineno-0-710> 710</a></span>
<span class=normal><a href=#__codelineno-0-711> 711</a></span>
<span class=normal><a href=#__codelineno-0-712> 712</a></span>
<span class=normal><a href=#__codelineno-0-713> 713</a></span>
<span class=normal><a href=#__codelineno-0-714> 714</a></span>
<span class=normal><a href=#__codelineno-0-715> 715</a></span>
<span class=normal><a href=#__codelineno-0-716> 716</a></span>
<span class=normal><a href=#__codelineno-0-717> 717</a></span>
<span class=normal><a href=#__codelineno-0-718> 718</a></span>
<span class=normal><a href=#__codelineno-0-719> 719</a></span>
<span class=normal><a href=#__codelineno-0-720> 720</a></span>
<span class=normal><a href=#__codelineno-0-721> 721</a></span>
<span class=normal><a href=#__codelineno-0-722> 722</a></span>
<span class=normal><a href=#__codelineno-0-723> 723</a></span>
<span class=normal><a href=#__codelineno-0-724> 724</a></span>
<span class=normal><a href=#__codelineno-0-725> 725</a></span>
<span class=normal><a href=#__codelineno-0-726> 726</a></span>
<span class=normal><a href=#__codelineno-0-727> 727</a></span>
<span class=normal><a href=#__codelineno-0-728> 728</a></span>
<span class=normal><a href=#__codelineno-0-729> 729</a></span>
<span class=normal><a href=#__codelineno-0-730> 730</a></span>
<span class=normal><a href=#__codelineno-0-731> 731</a></span>
<span class=normal><a href=#__codelineno-0-732> 732</a></span>
<span class=normal><a href=#__codelineno-0-733> 733</a></span>
<span class=normal><a href=#__codelineno-0-734> 734</a></span>
<span class=normal><a href=#__codelineno-0-735> 735</a></span>
<span class=normal><a href=#__codelineno-0-736> 736</a></span>
<span class=normal><a href=#__codelineno-0-737> 737</a></span>
<span class=normal><a href=#__codelineno-0-738> 738</a></span>
<span class=normal><a href=#__codelineno-0-739> 739</a></span>
<span class=normal><a href=#__codelineno-0-740> 740</a></span>
<span class=normal><a href=#__codelineno-0-741> 741</a></span>
<span class=normal><a href=#__codelineno-0-742> 742</a></span>
<span class=normal><a href=#__codelineno-0-743> 743</a></span>
<span class=normal><a href=#__codelineno-0-744> 744</a></span>
<span class=normal><a href=#__codelineno-0-745> 745</a></span>
<span class=normal><a href=#__codelineno-0-746> 746</a></span>
<span class=normal><a href=#__codelineno-0-747> 747</a></span>
<span class=normal><a href=#__codelineno-0-748> 748</a></span>
<span class=normal><a href=#__codelineno-0-749> 749</a></span>
<span class=normal><a href=#__codelineno-0-750> 750</a></span>
<span class=normal><a href=#__codelineno-0-751> 751</a></span>
<span class=normal><a href=#__codelineno-0-752> 752</a></span>
<span class=normal><a href=#__codelineno-0-753> 753</a></span>
<span class=normal><a href=#__codelineno-0-754> 754</a></span>
<span class=normal><a href=#__codelineno-0-755> 755</a></span>
<span class=normal><a href=#__codelineno-0-756> 756</a></span>
<span class=normal><a href=#__codelineno-0-757> 757</a></span>
<span class=normal><a href=#__codelineno-0-758> 758</a></span>
<span class=normal><a href=#__codelineno-0-759> 759</a></span>
<span class=normal><a href=#__codelineno-0-760> 760</a></span>
<span class=normal><a href=#__codelineno-0-761> 761</a></span>
<span class=normal><a href=#__codelineno-0-762> 762</a></span>
<span class=normal><a href=#__codelineno-0-763> 763</a></span>
<span class=normal><a href=#__codelineno-0-764> 764</a></span>
<span class=normal><a href=#__codelineno-0-765> 765</a></span>
<span class=normal><a href=#__codelineno-0-766> 766</a></span>
<span class=normal><a href=#__codelineno-0-767> 767</a></span>
<span class=normal><a href=#__codelineno-0-768> 768</a></span>
<span class=normal><a href=#__codelineno-0-769> 769</a></span>
<span class=normal><a href=#__codelineno-0-770> 770</a></span>
<span class=normal><a href=#__codelineno-0-771> 771</a></span>
<span class=normal><a href=#__codelineno-0-772> 772</a></span>
<span class=normal><a href=#__codelineno-0-773> 773</a></span>
<span class=normal><a href=#__codelineno-0-774> 774</a></span>
<span class=normal><a href=#__codelineno-0-775> 775</a></span>
<span class=normal><a href=#__codelineno-0-776> 776</a></span>
<span class=normal><a href=#__codelineno-0-777> 777</a></span>
<span class=normal><a href=#__codelineno-0-778> 778</a></span>
<span class=normal><a href=#__codelineno-0-779> 779</a></span>
<span class=normal><a href=#__codelineno-0-780> 780</a></span>
<span class=normal><a href=#__codelineno-0-781> 781</a></span>
<span class=normal><a href=#__codelineno-0-782> 782</a></span>
<span class=normal><a href=#__codelineno-0-783> 783</a></span>
<span class=normal><a href=#__codelineno-0-784> 784</a></span>
<span class=normal><a href=#__codelineno-0-785> 785</a></span>
<span class=normal><a href=#__codelineno-0-786> 786</a></span>
<span class=normal><a href=#__codelineno-0-787> 787</a></span>
<span class=normal><a href=#__codelineno-0-788> 788</a></span>
<span class=normal><a href=#__codelineno-0-789> 789</a></span>
<span class=normal><a href=#__codelineno-0-790> 790</a></span>
<span class=normal><a href=#__codelineno-0-791> 791</a></span>
<span class=normal><a href=#__codelineno-0-792> 792</a></span>
<span class=normal><a href=#__codelineno-0-793> 793</a></span>
<span class=normal><a href=#__codelineno-0-794> 794</a></span>
<span class=normal><a href=#__codelineno-0-795> 795</a></span>
<span class=normal><a href=#__codelineno-0-796> 796</a></span>
<span class=normal><a href=#__codelineno-0-797> 797</a></span>
<span class=normal><a href=#__codelineno-0-798> 798</a></span>
<span class=normal><a href=#__codelineno-0-799> 799</a></span>
<span class=normal><a href=#__codelineno-0-800> 800</a></span>
<span class=normal><a href=#__codelineno-0-801> 801</a></span>
<span class=normal><a href=#__codelineno-0-802> 802</a></span>
<span class=normal><a href=#__codelineno-0-803> 803</a></span>
<span class=normal><a href=#__codelineno-0-804> 804</a></span>
<span class=normal><a href=#__codelineno-0-805> 805</a></span>
<span class=normal><a href=#__codelineno-0-806> 806</a></span>
<span class=normal><a href=#__codelineno-0-807> 807</a></span>
<span class=normal><a href=#__codelineno-0-808> 808</a></span>
<span class=normal><a href=#__codelineno-0-809> 809</a></span>
<span class=normal><a href=#__codelineno-0-810> 810</a></span>
<span class=normal><a href=#__codelineno-0-811> 811</a></span>
<span class=normal><a href=#__codelineno-0-812> 812</a></span>
<span class=normal><a href=#__codelineno-0-813> 813</a></span>
<span class=normal><a href=#__codelineno-0-814> 814</a></span>
<span class=normal><a href=#__codelineno-0-815> 815</a></span>
<span class=normal><a href=#__codelineno-0-816> 816</a></span>
<span class=normal><a href=#__codelineno-0-817> 817</a></span>
<span class=normal><a href=#__codelineno-0-818> 818</a></span>
<span class=normal><a href=#__codelineno-0-819> 819</a></span>
<span class=normal><a href=#__codelineno-0-820> 820</a></span>
<span class=normal><a href=#__codelineno-0-821> 821</a></span>
<span class=normal><a href=#__codelineno-0-822> 822</a></span>
<span class=normal><a href=#__codelineno-0-823> 823</a></span>
<span class=normal><a href=#__codelineno-0-824> 824</a></span>
<span class=normal><a href=#__codelineno-0-825> 825</a></span>
<span class=normal><a href=#__codelineno-0-826> 826</a></span>
<span class=normal><a href=#__codelineno-0-827> 827</a></span>
<span class=normal><a href=#__codelineno-0-828> 828</a></span>
<span class=normal><a href=#__codelineno-0-829> 829</a></span>
<span class=normal><a href=#__codelineno-0-830> 830</a></span>
<span class=normal><a href=#__codelineno-0-831> 831</a></span>
<span class=normal><a href=#__codelineno-0-832> 832</a></span>
<span class=normal><a href=#__codelineno-0-833> 833</a></span>
<span class=normal><a href=#__codelineno-0-834> 834</a></span>
<span class=normal><a href=#__codelineno-0-835> 835</a></span>
<span class=normal><a href=#__codelineno-0-836> 836</a></span>
<span class=normal><a href=#__codelineno-0-837> 837</a></span>
<span class=normal><a href=#__codelineno-0-838> 838</a></span>
<span class=normal><a href=#__codelineno-0-839> 839</a></span>
<span class=normal><a href=#__codelineno-0-840> 840</a></span>
<span class=normal><a href=#__codelineno-0-841> 841</a></span>
<span class=normal><a href=#__codelineno-0-842> 842</a></span>
<span class=normal><a href=#__codelineno-0-843> 843</a></span>
<span class=normal><a href=#__codelineno-0-844> 844</a></span>
<span class=normal><a href=#__codelineno-0-845> 845</a></span>
<span class=normal><a href=#__codelineno-0-846> 846</a></span>
<span class=normal><a href=#__codelineno-0-847> 847</a></span>
<span class=normal><a href=#__codelineno-0-848> 848</a></span>
<span class=normal><a href=#__codelineno-0-849> 849</a></span>
<span class=normal><a href=#__codelineno-0-850> 850</a></span>
<span class=normal><a href=#__codelineno-0-851> 851</a></span>
<span class=normal><a href=#__codelineno-0-852> 852</a></span>
<span class=normal><a href=#__codelineno-0-853> 853</a></span>
<span class=normal><a href=#__codelineno-0-854> 854</a></span>
<span class=normal><a href=#__codelineno-0-855> 855</a></span>
<span class=normal><a href=#__codelineno-0-856> 856</a></span>
<span class=normal><a href=#__codelineno-0-857> 857</a></span>
<span class=normal><a href=#__codelineno-0-858> 858</a></span>
<span class=normal><a href=#__codelineno-0-859> 859</a></span>
<span class=normal><a href=#__codelineno-0-860> 860</a></span>
<span class=normal><a href=#__codelineno-0-861> 861</a></span>
<span class=normal><a href=#__codelineno-0-862> 862</a></span>
<span class=normal><a href=#__codelineno-0-863> 863</a></span>
<span class=normal><a href=#__codelineno-0-864> 864</a></span>
<span class=normal><a href=#__codelineno-0-865> 865</a></span>
<span class=normal><a href=#__codelineno-0-866> 866</a></span>
<span class=normal><a href=#__codelineno-0-867> 867</a></span>
<span class=normal><a href=#__codelineno-0-868> 868</a></span>
<span class=normal><a href=#__codelineno-0-869> 869</a></span>
<span class=normal><a href=#__codelineno-0-870> 870</a></span>
<span class=normal><a href=#__codelineno-0-871> 871</a></span>
<span class=normal><a href=#__codelineno-0-872> 872</a></span>
<span class=normal><a href=#__codelineno-0-873> 873</a></span>
<span class=normal><a href=#__codelineno-0-874> 874</a></span>
<span class=normal><a href=#__codelineno-0-875> 875</a></span>
<span class=normal><a href=#__codelineno-0-876> 876</a></span>
<span class=normal><a href=#__codelineno-0-877> 877</a></span>
<span class=normal><a href=#__codelineno-0-878> 878</a></span>
<span class=normal><a href=#__codelineno-0-879> 879</a></span>
<span class=normal><a href=#__codelineno-0-880> 880</a></span>
<span class=normal><a href=#__codelineno-0-881> 881</a></span>
<span class=normal><a href=#__codelineno-0-882> 882</a></span>
<span class=normal><a href=#__codelineno-0-883> 883</a></span>
<span class=normal><a href=#__codelineno-0-884> 884</a></span>
<span class=normal><a href=#__codelineno-0-885> 885</a></span>
<span class=normal><a href=#__codelineno-0-886> 886</a></span>
<span class=normal><a href=#__codelineno-0-887> 887</a></span>
<span class=normal><a href=#__codelineno-0-888> 888</a></span>
<span class=normal><a href=#__codelineno-0-889> 889</a></span>
<span class=normal><a href=#__codelineno-0-890> 890</a></span>
<span class=normal><a href=#__codelineno-0-891> 891</a></span>
<span class=normal><a href=#__codelineno-0-892> 892</a></span>
<span class=normal><a href=#__codelineno-0-893> 893</a></span>
<span class=normal><a href=#__codelineno-0-894> 894</a></span>
<span class=normal><a href=#__codelineno-0-895> 895</a></span>
<span class=normal><a href=#__codelineno-0-896> 896</a></span>
<span class=normal><a href=#__codelineno-0-897> 897</a></span>
<span class=normal><a href=#__codelineno-0-898> 898</a></span>
<span class=normal><a href=#__codelineno-0-899> 899</a></span>
<span class=normal><a href=#__codelineno-0-900> 900</a></span>
<span class=normal><a href=#__codelineno-0-901> 901</a></span>
<span class=normal><a href=#__codelineno-0-902> 902</a></span>
<span class=normal><a href=#__codelineno-0-903> 903</a></span>
<span class=normal><a href=#__codelineno-0-904> 904</a></span>
<span class=normal><a href=#__codelineno-0-905> 905</a></span>
<span class=normal><a href=#__codelineno-0-906> 906</a></span>
<span class=normal><a href=#__codelineno-0-907> 907</a></span>
<span class=normal><a href=#__codelineno-0-908> 908</a></span>
<span class=normal><a href=#__codelineno-0-909> 909</a></span>
<span class=normal><a href=#__codelineno-0-910> 910</a></span>
<span class=normal><a href=#__codelineno-0-911> 911</a></span>
<span class=normal><a href=#__codelineno-0-912> 912</a></span>
<span class=normal><a href=#__codelineno-0-913> 913</a></span>
<span class=normal><a href=#__codelineno-0-914> 914</a></span>
<span class=normal><a href=#__codelineno-0-915> 915</a></span>
<span class=normal><a href=#__codelineno-0-916> 916</a></span>
<span class=normal><a href=#__codelineno-0-917> 917</a></span>
<span class=normal><a href=#__codelineno-0-918> 918</a></span>
<span class=normal><a href=#__codelineno-0-919> 919</a></span>
<span class=normal><a href=#__codelineno-0-920> 920</a></span>
<span class=normal><a href=#__codelineno-0-921> 921</a></span>
<span class=normal><a href=#__codelineno-0-922> 922</a></span>
<span class=normal><a href=#__codelineno-0-923> 923</a></span>
<span class=normal><a href=#__codelineno-0-924> 924</a></span>
<span class=normal><a href=#__codelineno-0-925> 925</a></span>
<span class=normal><a href=#__codelineno-0-926> 926</a></span>
<span class=normal><a href=#__codelineno-0-927> 927</a></span>
<span class=normal><a href=#__codelineno-0-928> 928</a></span>
<span class=normal><a href=#__codelineno-0-929> 929</a></span>
<span class=normal><a href=#__codelineno-0-930> 930</a></span>
<span class=normal><a href=#__codelineno-0-931> 931</a></span>
<span class=normal><a href=#__codelineno-0-932> 932</a></span>
<span class=normal><a href=#__codelineno-0-933> 933</a></span>
<span class=normal><a href=#__codelineno-0-934> 934</a></span>
<span class=normal><a href=#__codelineno-0-935> 935</a></span>
<span class=normal><a href=#__codelineno-0-936> 936</a></span>
<span class=normal><a href=#__codelineno-0-937> 937</a></span>
<span class=normal><a href=#__codelineno-0-938> 938</a></span>
<span class=normal><a href=#__codelineno-0-939> 939</a></span>
<span class=normal><a href=#__codelineno-0-940> 940</a></span>
<span class=normal><a href=#__codelineno-0-941> 941</a></span>
<span class=normal><a href=#__codelineno-0-942> 942</a></span>
<span class=normal><a href=#__codelineno-0-943> 943</a></span>
<span class=normal><a href=#__codelineno-0-944> 944</a></span>
<span class=normal><a href=#__codelineno-0-945> 945</a></span>
<span class=normal><a href=#__codelineno-0-946> 946</a></span>
<span class=normal><a href=#__codelineno-0-947> 947</a></span>
<span class=normal><a href=#__codelineno-0-948> 948</a></span>
<span class=normal><a href=#__codelineno-0-949> 949</a></span>
<span class=normal><a href=#__codelineno-0-950> 950</a></span>
<span class=normal><a href=#__codelineno-0-951> 951</a></span>
<span class=normal><a href=#__codelineno-0-952> 952</a></span>
<span class=normal><a href=#__codelineno-0-953> 953</a></span>
<span class=normal><a href=#__codelineno-0-954> 954</a></span>
<span class=normal><a href=#__codelineno-0-955> 955</a></span>
<span class=normal><a href=#__codelineno-0-956> 956</a></span>
<span class=normal><a href=#__codelineno-0-957> 957</a></span>
<span class=normal><a href=#__codelineno-0-958> 958</a></span>
<span class=normal><a href=#__codelineno-0-959> 959</a></span>
<span class=normal><a href=#__codelineno-0-960> 960</a></span>
<span class=normal><a href=#__codelineno-0-961> 961</a></span>
<span class=normal><a href=#__codelineno-0-962> 962</a></span>
<span class=normal><a href=#__codelineno-0-963> 963</a></span>
<span class=normal><a href=#__codelineno-0-964> 964</a></span>
<span class=normal><a href=#__codelineno-0-965> 965</a></span>
<span class=normal><a href=#__codelineno-0-966> 966</a></span>
<span class=normal><a href=#__codelineno-0-967> 967</a></span>
<span class=normal><a href=#__codelineno-0-968> 968</a></span>
<span class=normal><a href=#__codelineno-0-969> 969</a></span>
<span class=normal><a href=#__codelineno-0-970> 970</a></span>
<span class=normal><a href=#__codelineno-0-971> 971</a></span>
<span class=normal><a href=#__codelineno-0-972> 972</a></span>
<span class=normal><a href=#__codelineno-0-973> 973</a></span>
<span class=normal><a href=#__codelineno-0-974> 974</a></span>
<span class=normal><a href=#__codelineno-0-975> 975</a></span>
<span class=normal><a href=#__codelineno-0-976> 976</a></span>
<span class=normal><a href=#__codelineno-0-977> 977</a></span>
<span class=normal><a href=#__codelineno-0-978> 978</a></span>
<span class=normal><a href=#__codelineno-0-979> 979</a></span>
<span class=normal><a href=#__codelineno-0-980> 980</a></span>
<span class=normal><a href=#__codelineno-0-981> 981</a></span>
<span class=normal><a href=#__codelineno-0-982> 982</a></span>
<span class=normal><a href=#__codelineno-0-983> 983</a></span>
<span class=normal><a href=#__codelineno-0-984> 984</a></span>
<span class=normal><a href=#__codelineno-0-985> 985</a></span>
<span class=normal><a href=#__codelineno-0-986> 986</a></span>
<span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span>
<span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span>
<span class=normal><a href=#__codelineno-0-1175>1175</a></span>
<span class=normal><a href=#__codelineno-0-1176>1176</a></span>
<span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span>
<span class=normal><a href=#__codelineno-0-1190>1190</a></span>
<span class=normal><a href=#__codelineno-0-1191>1191</a></span>
<span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span>
<span class=normal><a href=#__codelineno-0-1194>1194</a></span>
<span class=normal><a href=#__codelineno-0-1195>1195</a></span>
<span class=normal><a href=#__codelineno-0-1196>1196</a></span>
<span class=normal><a href=#__codelineno-0-1197>1197</a></span>
<span class=normal><a href=#__codelineno-0-1198>1198</a></span>
<span class=normal><a href=#__codelineno-0-1199>1199</a></span>
<span class=normal><a href=#__codelineno-0-1200>1200</a></span>
<span class=normal><a href=#__codelineno-0-1201>1201</a></span>
<span class=normal><a href=#__codelineno-0-1202>1202</a></span>
<span class=normal><a href=#__codelineno-0-1203>1203</a></span>
<span class=normal><a href=#__codelineno-0-1204>1204</a></span>
<span class=normal><a href=#__codelineno-0-1205>1205</a></span>
<span class=normal><a href=#__codelineno-0-1206>1206</a></span>
<span class=normal><a href=#__codelineno-0-1207>1207</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=k>class</span><span class=w> </span><span class=nc>ApiConnector</span><span class=p>:</span>
<a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-49 name=__codelineno-0-49></a><span class=sd>    API Connector for interacting with REST APIs.</span>
<a id=__codelineno-0-50 name=__codelineno-0-50></a>
<a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=sd>    This class handles the connection to APIs, making requests, and</span>
<a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=sd>    processing responses.</span>
<a id=__codelineno-0-53 name=__codelineno-0-53></a>
<a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=sd>    Args:</span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=sd>        connector_type: Type of connector (rest, graphql, etc.)</span>
<a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=sd>        base_url: Base URL for the API</span>
<a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=sd>        auth_config: Authentication configuration</span>
<a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=sd>        endpoints: Dictionary of endpoint configurations</span>
<a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=sd>        timeout: Request timeout in seconds</span>
<a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=sd>        retry_count: Number of retries on failure</span>
<a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=sd>        retry_delay: Delay between retries in seconds</span>
<a id=__codelineno-0-62 name=__codelineno-0-62></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-63 name=__codelineno-0-63></a>
<a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
<a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=n>connector_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=n>auth_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AuthConfig</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a>        <span class=n>retry_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=n>retry_delay</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=n>default_headers</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=bp>self</span><span class=o>.</span><span class=n>connector_type</span> <span class=o>=</span> <span class=n>connector_type</span>
<a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
<a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span> <span class=o>=</span> <span class=n>auth_config</span>
<a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>timeout</span>
<a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>=</span> <span class=n>retry_count</span>
<a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>=</span> <span class=n>retry_delay</span>
<a id=__codelineno-0-82 name=__codelineno-0-82></a>
<a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=c1># Default headers (may be provided via explicit parameter or legacy &#39;headers&#39; kwarg)</span>
<a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=k>if</span> <span class=n>default_headers</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=s2>&quot;headers&quot;</span> <span class=ow>in</span> <span class=n>kwargs</span><span class=p>:</span>
<a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-86 name=__codelineno-0-86></a>                <span class=n>default_headers</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;headers&quot;</span><span class=p>))</span>
<a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
<a id=__codelineno-0-88 name=__codelineno-0-88></a>                <span class=n>default_headers</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=bp>self</span><span class=o>.</span><span class=n>default_headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>default_headers</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=c1># Provide a backwards-compatible attribute name used by some connectors</span>
<a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=bp>self</span><span class=o>.</span><span class=n>headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>default_headers</span>
<a id=__codelineno-0-92 name=__codelineno-0-92></a>
<a id=__codelineno-0-93 name=__codelineno-0-93></a>        <span class=c1># Parse and store endpoint configurations</span>
<a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>EndpointConfig</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=k>if</span> <span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-96 name=__codelineno-0-96></a>            <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>config</span> <span class=ow>in</span> <span class=n>endpoints</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-97 name=__codelineno-0-97></a>                <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>EndpointConfig</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>)</span>
<a id=__codelineno-0-98 name=__codelineno-0-98></a>
<a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=c1># Store additional settings</span>
<a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=bp>self</span><span class=o>.</span><span class=n>settings</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>kwargs</span>
<a id=__codelineno-0-101 name=__codelineno-0-101></a>
<a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=c1># Create HTTP client with default settings</span>
<a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_client</span><span class=p>()</span>
<a id=__codelineno-0-104 name=__codelineno-0-104></a>
<a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=c1># Initialize Rate Limit Manager</span>
<a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span> <span class=o>=</span> <span class=n>RateLimitManager</span><span class=p>()</span>
<a id=__codelineno-0-107 name=__codelineno-0-107></a>
<a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=c1># Configure rate limiters for endpoints</span>
<a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>config</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>rate_limit</span><span class=p>:</span>
<a id=__codelineno-0-111 name=__codelineno-0-111></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>create_limiter</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>config</span><span class=o>.</span><span class=n>rate_limit</span><span class=p>)</span>
<a id=__codelineno-0-112 name=__codelineno-0-112></a>
<a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Initialized </span><span class=si>{</span><span class=n>connector_type</span><span class=si>}</span><span class=s2> connector for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-114 name=__codelineno-0-114></a>
<a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=k>def</span><span class=w> </span><span class=nf>_create_client</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Client</span><span class=p>:</span>
<a id=__codelineno-0-116 name=__codelineno-0-116></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create an HTTP client with appropriate settings.&quot;&quot;&quot;</span>
<a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=c1># Initialize with default parameters</span>
<a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=n>auth</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-120 name=__codelineno-0-120></a>            <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span>
<a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;basic&quot;</span>
<a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;username&quot;</span><span class=p>)</span>
<a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;password&quot;</span><span class=p>)</span>
<a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=p>):</span>
<a id=__codelineno-0-125 name=__codelineno-0-125></a>            <span class=n>auth</span> <span class=o>=</span> <span class=n>httpx</span><span class=o>.</span><span class=n>BasicAuth</span><span class=p>(</span>
<a id=__codelineno-0-126 name=__codelineno-0-126></a>                <span class=n>username</span><span class=o>=</span><span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;username&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
<a id=__codelineno-0-127 name=__codelineno-0-127></a>                <span class=n>password</span><span class=o>=</span><span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;password&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
<a id=__codelineno-0-128 name=__codelineno-0-128></a>            <span class=p>)</span>
<a id=__codelineno-0-129 name=__codelineno-0-129></a>
<a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=c1># Create client with properly structured parameters</span>
<a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=k>return</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Client</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>timeout</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>auth</span><span class=p>)</span>
<a id=__codelineno-0-132 name=__codelineno-0-132></a>
<a id=__codelineno-0-133 name=__codelineno-0-133></a>    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_request</span><span class=p>(</span>
<a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-136 name=__codelineno-0-136></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-137 name=__codelineno-0-137></a><span class=sd>        Prepare a request for the given endpoint.</span>
<a id=__codelineno-0-138 name=__codelineno-0-138></a>
<a id=__codelineno-0-139 name=__codelineno-0-139></a><span class=sd>        Args:</span>
<a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=sd>            endpoint_name: Name of the endpoint to use</span>
<a id=__codelineno-0-141 name=__codelineno-0-141></a><span class=sd>            params: Additional parameters to include in the request</span>
<a id=__codelineno-0-142 name=__codelineno-0-142></a>
<a id=__codelineno-0-143 name=__codelineno-0-143></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-144 name=__codelineno-0-144></a><span class=sd>            Dict containing request details (url, method, headers, params, json)</span>
<a id=__codelineno-0-145 name=__codelineno-0-145></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-146 name=__codelineno-0-146></a>        <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-148 name=__codelineno-0-148></a>
<a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-150 name=__codelineno-0-150></a>
<a id=__codelineno-0-151 name=__codelineno-0-151></a>        <span class=c1># Combine endpoint path with base URL</span>
<a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=n>url</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>path</span>
<a id=__codelineno-0-153 name=__codelineno-0-153></a>
<a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=c1># Combine params from endpoint config and provided params</span>
<a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=n>request_params</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>params</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=k>if</span> <span class=n>params</span><span class=p>:</span>
<a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=n>request_params</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-158 name=__codelineno-0-158></a>
<a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=c1># Prepare headers (merge default headers and endpoint-specific headers)</span>
<a id=__codelineno-0-160 name=__codelineno-0-160></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=o>**</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>default_headers</span> <span class=ow>or</span> <span class=p>{}),</span> <span class=o>**</span><span class=n>endpoint</span><span class=o>.</span><span class=n>headers</span><span class=p>}</span>
<a id=__codelineno-0-161 name=__codelineno-0-161></a>
<a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=c1># Add auth headers if needed</span>
<a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>:</span>
<a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-165 name=__codelineno-0-165></a>                <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;api_key&quot;</span>
<a id=__codelineno-0-166 name=__codelineno-0-166></a>                <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;in_header&quot;</span><span class=p>)</span>
<a id=__codelineno-0-167 name=__codelineno-0-167></a>                <span class=ow>and</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;in_header&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-0-168 name=__codelineno-0-168></a>            <span class=p>):</span>
<a id=__codelineno-0-169 name=__codelineno-0-169></a>                <span class=n>header_name</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;header_name&quot;</span><span class=p>,</span> <span class=s2>&quot;X-API-Key&quot;</span><span class=p>)</span>
<a id=__codelineno-0-170 name=__codelineno-0-170></a>                <span class=n>key</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;key&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-171 name=__codelineno-0-171></a>                <span class=n>headers</span><span class=p>[</span><span class=n>header_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>key</span>
<a id=__codelineno-0-172 name=__codelineno-0-172></a>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;bearer&quot;</span> <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span>
<a id=__codelineno-0-173 name=__codelineno-0-173></a>                <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span> <span class=s2>&quot;token&quot;</span>
<a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=p>):</span>
<a id=__codelineno-0-175 name=__codelineno-0-175></a>                <span class=n>headers</span><span class=p>[</span><span class=s2>&quot;Authorization&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-176 name=__codelineno-0-176></a>                    <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;token&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-177 name=__codelineno-0-177></a>                <span class=p>)</span>
<a id=__codelineno-0-178 name=__codelineno-0-178></a>
<a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=c1># Prepare request object</span>
<a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=n>request</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=s2>&quot;url&quot;</span><span class=p>:</span> <span class=n>url</span><span class=p>,</span>
<a id=__codelineno-0-182 name=__codelineno-0-182></a>            <span class=s2>&quot;method&quot;</span><span class=p>:</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
<a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=s2>&quot;headers&quot;</span><span class=p>:</span> <span class=n>headers</span><span class=p>,</span>
<a id=__codelineno-0-184 name=__codelineno-0-184></a>            <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=n>request_params</span><span class=p>,</span>
<a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=p>}</span>
<a id=__codelineno-0-186 name=__codelineno-0-186></a>
<a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=c1># Add body if endpoint has a body template</span>
<a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>body_template</span><span class=p>:</span>
<a id=__codelineno-0-189 name=__codelineno-0-189></a>            <span class=n>request</span><span class=p>[</span><span class=s2>&quot;json&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>body_template</span>
<a id=__codelineno-0-190 name=__codelineno-0-190></a>
<a id=__codelineno-0-191 name=__codelineno-0-191></a>        <span class=k>return</span> <span class=n>request</span>
<a id=__codelineno-0-192 name=__codelineno-0-192></a>
<a id=__codelineno-0-193 name=__codelineno-0-193></a>    <span class=k>def</span><span class=w> </span><span class=nf>_process_response</span><span class=p>(</span>
<a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>:</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Response</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-0-195 name=__codelineno-0-195></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<a id=__codelineno-0-196 name=__codelineno-0-196></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-197 name=__codelineno-0-197></a><span class=sd>        Process the API response.</span>
<a id=__codelineno-0-198 name=__codelineno-0-198></a>
<a id=__codelineno-0-199 name=__codelineno-0-199></a><span class=sd>        Args:</span>
<a id=__codelineno-0-200 name=__codelineno-0-200></a><span class=sd>            response: The HTTP response</span>
<a id=__codelineno-0-201 name=__codelineno-0-201></a><span class=sd>            endpoint_name: Name of the endpoint</span>
<a id=__codelineno-0-202 name=__codelineno-0-202></a>
<a id=__codelineno-0-203 name=__codelineno-0-203></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-204 name=__codelineno-0-204></a><span class=sd>            Parsed response data</span>
<a id=__codelineno-0-205 name=__codelineno-0-205></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=c1># Update rate limiter from response headers</span>
<a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>update_from_response</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
<a id=__codelineno-0-208 name=__codelineno-0-208></a>
<a id=__codelineno-0-209 name=__codelineno-0-209></a>        <span class=c1># Raise for HTTP errors</span>
<a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-211 name=__codelineno-0-211></a>
<a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=c1># Parse JSON response</span>
<a id=__codelineno-0-213 name=__codelineno-0-213></a>        <span class=n>data</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
<a id=__codelineno-0-214 name=__codelineno-0-214></a>
<a id=__codelineno-0-215 name=__codelineno-0-215></a>        <span class=c1># Extract data from response path if configured</span>
<a id=__codelineno-0-216 name=__codelineno-0-216></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>response_path</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-218 name=__codelineno-0-218></a>            <span class=n>path_parts</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>response_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-219 name=__codelineno-0-219></a>            <span class=n>current_data</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=n>data</span>
<a id=__codelineno-0-220 name=__codelineno-0-220></a>            <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>path_parts</span><span class=p>:</span>
<a id=__codelineno-0-221 name=__codelineno-0-221></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current_data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>current_data</span><span class=p>:</span>
<a id=__codelineno-0-222 name=__codelineno-0-222></a>                    <span class=n>current_data</span> <span class=o>=</span> <span class=n>current_data</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-223 name=__codelineno-0-223></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-224 name=__codelineno-0-224></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-225 name=__codelineno-0-225></a>                        <span class=sa>f</span><span class=s2>&quot;Response path &#39;</span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>response_path</span><span class=si>}</span><span class=s2>&#39; not found in response&quot;</span>
<a id=__codelineno-0-226 name=__codelineno-0-226></a>                    <span class=p>)</span>
<a id=__codelineno-0-227 name=__codelineno-0-227></a>                    <span class=k>break</span>
<a id=__codelineno-0-228 name=__codelineno-0-228></a>            <span class=c1># Only update data if we successfully navigated through the path</span>
<a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=k>if</span> <span class=n>current_data</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
<a id=__codelineno-0-230 name=__codelineno-0-230></a>                <span class=n>data</span> <span class=o>=</span> <span class=n>current_data</span>
<a id=__codelineno-0-231 name=__codelineno-0-231></a>
<a id=__codelineno-0-232 name=__codelineno-0-232></a>        <span class=c1># Validate against response schema if provided</span>
<a id=__codelineno-0-233 name=__codelineno-0-233></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-234 name=__codelineno-0-234></a>        <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>response_schema</span> <span class=ow>and</span> <span class=n>is_validator_available</span><span class=p>():</span>
<a id=__codelineno-0-235 name=__codelineno-0-235></a>            <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-236 name=__codelineno-0-236></a>                <span class=n>data</span><span class=p>,</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>response_schema</span>
<a id=__codelineno-0-237 name=__codelineno-0-237></a>            <span class=p>)</span>
<a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-239 name=__codelineno-0-239></a>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-240 name=__codelineno-0-240></a>                    <span class=s2>&quot;Response schema validation failed for </span><span class=si>%s</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-241 name=__codelineno-0-241></a>                    <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-242 name=__codelineno-0-242></a>                    <span class=n>pretty_print_diffs</span><span class=p>(</span><span class=n>diffs</span><span class=p>),</span>
<a id=__codelineno-0-243 name=__codelineno-0-243></a>                <span class=p>)</span>
<a id=__codelineno-0-244 name=__codelineno-0-244></a>                <span class=c1># Record as a rate-limit or validation event via logger context (provenance layer may hook logs)</span>
<a id=__codelineno-0-245 name=__codelineno-0-245></a>
<a id=__codelineno-0-246 name=__codelineno-0-246></a>        <span class=c1># Ensure we return a valid type</span>
<a id=__codelineno-0-247 name=__codelineno-0-247></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=nb>dict</span><span class=p>,</span> <span class=nb>list</span><span class=p>)):</span>
<a id=__codelineno-0-248 name=__codelineno-0-248></a>            <span class=k>return</span> <span class=n>data</span>
<a id=__codelineno-0-249 name=__codelineno-0-249></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-250 name=__codelineno-0-250></a>            <span class=c1># If response isn&#39;t a dict or list, wrap it in a dict</span>
<a id=__codelineno-0-251 name=__codelineno-0-251></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>data</span><span class=p>}</span>
<a id=__codelineno-0-252 name=__codelineno-0-252></a>
<a id=__codelineno-0-253 name=__codelineno-0-253></a>    <span class=k>def</span><span class=w> </span><span class=nf>_handle_pagination</span><span class=p>(</span>
<a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-255 name=__codelineno-0-255></a>        <span class=n>initial_data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span>
<a id=__codelineno-0-256 name=__codelineno-0-256></a>        <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-257 name=__codelineno-0-257></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-258 name=__codelineno-0-258></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-259 name=__codelineno-0-259></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-260 name=__codelineno-0-260></a><span class=sd>        Handle paginated responses if pagination is configured.</span>
<a id=__codelineno-0-261 name=__codelineno-0-261></a>
<a id=__codelineno-0-262 name=__codelineno-0-262></a><span class=sd>        Args:</span>
<a id=__codelineno-0-263 name=__codelineno-0-263></a><span class=sd>            initial_data: Data from the first request</span>
<a id=__codelineno-0-264 name=__codelineno-0-264></a><span class=sd>            endpoint_name: Name of the endpoint</span>
<a id=__codelineno-0-265 name=__codelineno-0-265></a><span class=sd>            params: Request parameters</span>
<a id=__codelineno-0-266 name=__codelineno-0-266></a>
<a id=__codelineno-0-267 name=__codelineno-0-267></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-268 name=__codelineno-0-268></a><span class=sd>            Combined data from all pages</span>
<a id=__codelineno-0-269 name=__codelineno-0-269></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-270 name=__codelineno-0-270></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-271 name=__codelineno-0-271></a>
<a id=__codelineno-0-272 name=__codelineno-0-272></a>        <span class=c1># If no pagination config or initial data is not a dict, return as is</span>
<a id=__codelineno-0-273 name=__codelineno-0-273></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>pagination</span> <span class=ow>or</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>initial_data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-274 name=__codelineno-0-274></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>initial_data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-275 name=__codelineno-0-275></a>                <span class=k>return</span> <span class=n>initial_data</span>
<a id=__codelineno-0-276 name=__codelineno-0-276></a>            <span class=c1># Convert non-list data to a single-item list</span>
<a id=__codelineno-0-277 name=__codelineno-0-277></a>            <span class=k>return</span> <span class=p>(</span>
<a id=__codelineno-0-278 name=__codelineno-0-278></a>                <span class=p>[</span><span class=n>initial_data</span><span class=p>]</span>
<a id=__codelineno-0-279 name=__codelineno-0-279></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>initial_data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span>
<a id=__codelineno-0-280 name=__codelineno-0-280></a>                <span class=k>else</span> <span class=p>[{</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>initial_data</span><span class=p>}]</span>
<a id=__codelineno-0-281 name=__codelineno-0-281></a>            <span class=p>)</span>
<a id=__codelineno-0-282 name=__codelineno-0-282></a>
<a id=__codelineno-0-283 name=__codelineno-0-283></a>        <span class=c1># Extract the pagination configuration</span>
<a id=__codelineno-0-284 name=__codelineno-0-284></a>        <span class=n>pagination</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>pagination</span>
<a id=__codelineno-0-285 name=__codelineno-0-285></a>        <span class=n>data_path</span> <span class=o>=</span> <span class=n>pagination</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;data_path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-286 name=__codelineno-0-286></a>        <span class=n>next_page_path</span> <span class=o>=</span> <span class=n>pagination</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;next_page_path&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-287 name=__codelineno-0-287></a>        <span class=n>page_param</span> <span class=o>=</span> <span class=n>pagination</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;page_param&quot;</span><span class=p>,</span> <span class=s2>&quot;page&quot;</span><span class=p>)</span>
<a id=__codelineno-0-288 name=__codelineno-0-288></a>
<a id=__codelineno-0-289 name=__codelineno-0-289></a>        <span class=c1># Extract the items from the first response</span>
<a id=__codelineno-0-290 name=__codelineno-0-290></a>        <span class=k>if</span> <span class=n>data_path</span><span class=p>:</span>
<a id=__codelineno-0-291 name=__codelineno-0-291></a>            <span class=n>path_parts</span> <span class=o>=</span> <span class=n>data_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-292 name=__codelineno-0-292></a>            <span class=n>items</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=n>initial_data</span>
<a id=__codelineno-0-293 name=__codelineno-0-293></a>            <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>path_parts</span><span class=p>:</span>
<a id=__codelineno-0-294 name=__codelineno-0-294></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>                    <span class=n>items</span> <span class=o>=</span> <span class=n>items</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data path &#39;</span><span class=si>{</span><span class=n>data_path</span><span class=si>}</span><span class=s2>&#39; not found in response&quot;</span><span class=p>)</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>                    <span class=k>return</span> <span class=p>[</span><span class=n>initial_data</span><span class=p>]</span>
<a id=__codelineno-0-299 name=__codelineno-0-299></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-300 name=__codelineno-0-300></a>            <span class=c1># If no data path is specified, the entire response is the data</span>
<a id=__codelineno-0-301 name=__codelineno-0-301></a>            <span class=n>items</span> <span class=o>=</span> <span class=n>initial_data</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>
<a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=c1># Normalize items to a list of dicts</span>
<a id=__codelineno-0-304 name=__codelineno-0-304></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a>            <span class=n>items_list</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a>                <span class=p>[</span><span class=n>items</span><span class=p>]</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=p>[{</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>items</span><span class=p>}]</span>
<a id=__codelineno-0-307 name=__codelineno-0-307></a>            <span class=p>)</span>
<a id=__codelineno-0-308 name=__codelineno-0-308></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-309 name=__codelineno-0-309></a>            <span class=n>items_list</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-310 name=__codelineno-0-310></a>            <span class=k>for</span> <span class=n>elem</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>                    <span class=n>items_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>elem</span><span class=p>)</span>
<a id=__codelineno-0-313 name=__codelineno-0-313></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-314 name=__codelineno-0-314></a>                    <span class=n>items_list</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>elem</span><span class=p>})</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>        <span class=c1># Extract next page token/URL if available</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a>        <span class=n>next_page</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-318 name=__codelineno-0-318></a>        <span class=k>if</span> <span class=n>next_page_path</span><span class=p>:</span>
<a id=__codelineno-0-319 name=__codelineno-0-319></a>            <span class=n>path_parts</span> <span class=o>=</span> <span class=n>next_page_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>            <span class=n>temp_next_page</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=n>initial_data</span>
<a id=__codelineno-0-321 name=__codelineno-0-321></a>            <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>path_parts</span><span class=p>:</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>temp_next_page</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>temp_next_page</span><span class=p>:</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a>                    <span class=n>temp_next_page</span> <span class=o>=</span> <span class=n>temp_next_page</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-324 name=__codelineno-0-324></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-325 name=__codelineno-0-325></a>                    <span class=n>temp_next_page</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-326 name=__codelineno-0-326></a>                    <span class=k>break</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a>            <span class=c1># Only assign if it&#39;s a valid type for pagination</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>temp_next_page</span><span class=p>,</span> <span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>)):</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>                <span class=n>next_page</span> <span class=o>=</span> <span class=n>temp_next_page</span>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=c1># Return the items if there&#39;s no next page</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>next_page</span><span class=p>:</span>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>            <span class=k>return</span> <span class=n>items_list</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>        <span class=c1># Fetch all pages</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a>        <span class=n>all_items</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>items_list</span><span class=p>)</span>
<a id=__codelineno-0-337 name=__codelineno-0-337></a>        <span class=n>page</span> <span class=o>=</span> <span class=mi>2</span>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>
<a id=__codelineno-0-339 name=__codelineno-0-339></a>        <span class=k>while</span> <span class=n>next_page</span><span class=p>:</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a>            <span class=c1># Update params for next page</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a>            <span class=n>next_params</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span> <span class=k>if</span> <span class=n>params</span> <span class=k>else</span> <span class=p>{}</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>
<a id=__codelineno-0-343 name=__codelineno-0-343></a>            <span class=c1># Use either page number or next page token (refined to str|int in this loop)</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a>            <span class=n>next_params</span><span class=p>[</span><span class=n>page_param</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_page</span>
<a id=__codelineno-0-345 name=__codelineno-0-345></a>
<a id=__codelineno-0-346 name=__codelineno-0-346></a>            <span class=c1># Make the next request</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-348 name=__codelineno-0-348></a>                <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>next_params</span><span class=p>)</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a>                <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-352 name=__codelineno-0-352></a>                    <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a>                    <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a>                    <span class=n>json</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;json&quot;</span><span class=p>),</span>
<a id=__codelineno-0-355 name=__codelineno-0-355></a>                <span class=p>)</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a>                <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>                <span class=n>page_data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>                <span class=c1># Extract items from this page</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>                <span class=n>page_items</span><span class=p>:</span> <span class=n>Any</span>
<a id=__codelineno-0-361 name=__codelineno-0-361></a>                <span class=k>if</span> <span class=n>data_path</span><span class=p>:</span>
<a id=__codelineno-0-362 name=__codelineno-0-362></a>                    <span class=n>path_parts</span> <span class=o>=</span> <span class=n>data_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-363 name=__codelineno-0-363></a>                    <span class=n>page_items</span> <span class=o>=</span> <span class=n>page_data</span>
<a id=__codelineno-0-364 name=__codelineno-0-364></a>                    <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>path_parts</span><span class=p>:</span>
<a id=__codelineno-0-365 name=__codelineno-0-365></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>page_items</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>page_items</span><span class=p>:</span>
<a id=__codelineno-0-366 name=__codelineno-0-366></a>                            <span class=n>page_items</span> <span class=o>=</span> <span class=n>page_items</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-367 name=__codelineno-0-367></a>                        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-368 name=__codelineno-0-368></a>                            <span class=n>page_items</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-369 name=__codelineno-0-369></a>                            <span class=k>break</span>
<a id=__codelineno-0-370 name=__codelineno-0-370></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-371 name=__codelineno-0-371></a>                    <span class=n>page_items</span> <span class=o>=</span> <span class=n>page_data</span>
<a id=__codelineno-0-372 name=__codelineno-0-372></a>
<a id=__codelineno-0-373 name=__codelineno-0-373></a>                <span class=c1># Add items to the result, normalizing to list[dict]</span>
<a id=__codelineno-0-374 name=__codelineno-0-374></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>page_items</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-375 name=__codelineno-0-375></a>                    <span class=k>for</span> <span class=n>elem</span> <span class=ow>in</span> <span class=n>page_items</span><span class=p>:</span>
<a id=__codelineno-0-376 name=__codelineno-0-376></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-377 name=__codelineno-0-377></a>                            <span class=n>all_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>elem</span><span class=p>)</span>
<a id=__codelineno-0-378 name=__codelineno-0-378></a>                        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-379 name=__codelineno-0-379></a>                            <span class=n>all_items</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>elem</span><span class=p>})</span>
<a id=__codelineno-0-380 name=__codelineno-0-380></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-381 name=__codelineno-0-381></a>                    <span class=n>all_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
<a id=__codelineno-0-382 name=__codelineno-0-382></a>                        <span class=n>page_items</span>
<a id=__codelineno-0-383 name=__codelineno-0-383></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>page_items</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span>
<a id=__codelineno-0-384 name=__codelineno-0-384></a>                        <span class=k>else</span> <span class=p>{</span><span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>page_items</span><span class=p>}</span>
<a id=__codelineno-0-385 name=__codelineno-0-385></a>                    <span class=p>)</span>
<a id=__codelineno-0-386 name=__codelineno-0-386></a>
<a id=__codelineno-0-387 name=__codelineno-0-387></a>                <span class=c1># Extract next page token</span>
<a id=__codelineno-0-388 name=__codelineno-0-388></a>                <span class=k>if</span> <span class=n>next_page_path</span><span class=p>:</span>
<a id=__codelineno-0-389 name=__codelineno-0-389></a>                    <span class=n>path_parts</span> <span class=o>=</span> <span class=n>next_page_path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-390 name=__codelineno-0-390></a>                    <span class=n>temp_next_page</span> <span class=o>=</span> <span class=n>page_data</span>
<a id=__codelineno-0-391 name=__codelineno-0-391></a>                    <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>path_parts</span><span class=p>:</span>
<a id=__codelineno-0-392 name=__codelineno-0-392></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>temp_next_page</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>temp_next_page</span><span class=p>:</span>
<a id=__codelineno-0-393 name=__codelineno-0-393></a>                            <span class=n>temp_next_page</span> <span class=o>=</span> <span class=n>temp_next_page</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-394 name=__codelineno-0-394></a>                        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-395 name=__codelineno-0-395></a>                            <span class=n>temp_next_page</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-396 name=__codelineno-0-396></a>                            <span class=k>break</span>
<a id=__codelineno-0-397 name=__codelineno-0-397></a>                    <span class=c1># Only assign if it&#39;s a valid type for pagination</span>
<a id=__codelineno-0-398 name=__codelineno-0-398></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>temp_next_page</span><span class=p>,</span> <span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>)):</span>
<a id=__codelineno-0-399 name=__codelineno-0-399></a>                        <span class=n>next_page</span> <span class=o>=</span> <span class=n>temp_next_page</span>
<a id=__codelineno-0-400 name=__codelineno-0-400></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-401 name=__codelineno-0-401></a>                        <span class=n>next_page</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-402 name=__codelineno-0-402></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-403 name=__codelineno-0-403></a>                    <span class=c1># If no next page path, just increment the page number</span>
<a id=__codelineno-0-404 name=__codelineno-0-404></a>                    <span class=n>page</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-405 name=__codelineno-0-405></a>                    <span class=n>next_page</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-406 name=__codelineno-0-406></a>                        <span class=n>page</span> <span class=k>if</span> <span class=n>page</span> <span class=o>&lt;=</span> <span class=n>pagination</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_pages&quot;</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-407 name=__codelineno-0-407></a>                    <span class=p>)</span>
<a id=__codelineno-0-408 name=__codelineno-0-408></a>
<a id=__codelineno-0-409 name=__codelineno-0-409></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-410 name=__codelineno-0-410></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error fetching page </span><span class=si>{</span><span class=n>page</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-411 name=__codelineno-0-411></a>                <span class=k>break</span>
<a id=__codelineno-0-412 name=__codelineno-0-412></a>
<a id=__codelineno-0-413 name=__codelineno-0-413></a>        <span class=k>return</span> <span class=n>all_items</span>
<a id=__codelineno-0-414 name=__codelineno-0-414></a>
<a id=__codelineno-0-415 name=__codelineno-0-415></a>    <span class=k>def</span><span class=w> </span><span class=nf>_categorize_error</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>ErrorCategory</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
<a id=__codelineno-0-416 name=__codelineno-0-416></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-417 name=__codelineno-0-417></a><span class=sd>        Categorize an exception to determine its error category and status code.</span>
<a id=__codelineno-0-418 name=__codelineno-0-418></a>
<a id=__codelineno-0-419 name=__codelineno-0-419></a><span class=sd>        Args:</span>
<a id=__codelineno-0-420 name=__codelineno-0-420></a><span class=sd>            exc: The exception to categorize</span>
<a id=__codelineno-0-421 name=__codelineno-0-421></a>
<a id=__codelineno-0-422 name=__codelineno-0-422></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-423 name=__codelineno-0-423></a><span class=sd>            Tuple of (ErrorCategory, status_code)</span>
<a id=__codelineno-0-424 name=__codelineno-0-424></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-425 name=__codelineno-0-425></a>        <span class=c1># Default values</span>
<a id=__codelineno-0-426 name=__codelineno-0-426></a>        <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>UNKNOWN</span>
<a id=__codelineno-0-427 name=__codelineno-0-427></a>        <span class=n>status_code</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-428 name=__codelineno-0-428></a>
<a id=__codelineno-0-429 name=__codelineno-0-429></a>        <span class=c1># Check for HTTP-specific errors</span>
<a id=__codelineno-0-430 name=__codelineno-0-430></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>httpx</span><span class=o>.</span><span class=n>TimeoutException</span><span class=p>):</span>
<a id=__codelineno-0-431 name=__codelineno-0-431></a>            <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>TIMEOUT</span>
<a id=__codelineno-0-432 name=__codelineno-0-432></a>            <span class=n>status_code</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># Custom code for timeout</span>
<a id=__codelineno-0-433 name=__codelineno-0-433></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>httpx</span><span class=o>.</span><span class=n>TransportError</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span>
<a id=__codelineno-0-434 name=__codelineno-0-434></a>            <span class=n>exc</span><span class=p>,</span> <span class=n>httpx</span><span class=o>.</span><span class=n>RequestError</span>
<a id=__codelineno-0-435 name=__codelineno-0-435></a>        <span class=p>):</span>
<a id=__codelineno-0-436 name=__codelineno-0-436></a>            <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>NETWORK</span>
<a id=__codelineno-0-437 name=__codelineno-0-437></a>            <span class=n>status_code</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># Custom code for network/transport errors</span>
<a id=__codelineno-0-438 name=__codelineno-0-438></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>httpx</span><span class=o>.</span><span class=n>HTTPStatusError</span><span class=p>):</span>
<a id=__codelineno-0-439 name=__codelineno-0-439></a>            <span class=n>status_code</span> <span class=o>=</span> <span class=n>exc</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span>
<a id=__codelineno-0-440 name=__codelineno-0-440></a>
<a id=__codelineno-0-441 name=__codelineno-0-441></a>            <span class=c1># Categorize based on HTTP status code</span>
<a id=__codelineno-0-442 name=__codelineno-0-442></a>            <span class=k>if</span> <span class=n>status_code</span> <span class=o>==</span> <span class=mi>401</span> <span class=ow>or</span> <span class=n>status_code</span> <span class=o>==</span> <span class=mi>403</span><span class=p>:</span>
<a id=__codelineno-0-443 name=__codelineno-0-443></a>                <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>AUTHENTICATION</span>
<a id=__codelineno-0-444 name=__codelineno-0-444></a>            <span class=k>elif</span> <span class=n>status_code</span> <span class=o>==</span> <span class=mi>422</span> <span class=ow>or</span> <span class=n>status_code</span> <span class=o>==</span> <span class=mi>400</span><span class=p>:</span>
<a id=__codelineno-0-445 name=__codelineno-0-445></a>                <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span>
<a id=__codelineno-0-446 name=__codelineno-0-446></a>            <span class=k>elif</span> <span class=n>status_code</span> <span class=o>==</span> <span class=mi>429</span><span class=p>:</span>
<a id=__codelineno-0-447 name=__codelineno-0-447></a>                <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>RATE_LIMIT</span>
<a id=__codelineno-0-448 name=__codelineno-0-448></a>            <span class=k>elif</span> <span class=n>status_code</span> <span class=o>&gt;=</span> <span class=mi>500</span><span class=p>:</span>
<a id=__codelineno-0-449 name=__codelineno-0-449></a>                <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>SERVER</span>
<a id=__codelineno-0-450 name=__codelineno-0-450></a>            <span class=k>elif</span> <span class=n>status_code</span> <span class=o>&gt;=</span> <span class=mi>400</span><span class=p>:</span>
<a id=__codelineno-0-451 name=__codelineno-0-451></a>                <span class=n>category</span> <span class=o>=</span> <span class=n>ErrorCategory</span><span class=o>.</span><span class=n>CLIENT</span>
<a id=__codelineno-0-452 name=__codelineno-0-452></a>
<a id=__codelineno-0-453 name=__codelineno-0-453></a>        <span class=k>return</span> <span class=n>category</span><span class=p>,</span> <span class=n>status_code</span>
<a id=__codelineno-0-454 name=__codelineno-0-454></a>
<a id=__codelineno-0-455 name=__codelineno-0-455></a>    <span class=k>def</span><span class=w> </span><span class=nf>_decode_sse_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>raw_data</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>decode_json</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-456 name=__codelineno-0-456></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-457 name=__codelineno-0-457></a><span class=sd>        Decode an SSE data field.</span>
<a id=__codelineno-0-458 name=__codelineno-0-458></a>
<a id=__codelineno-0-459 name=__codelineno-0-459></a><span class=sd>        Args:</span>
<a id=__codelineno-0-460 name=__codelineno-0-460></a><span class=sd>            raw_data: Raw SSE data payload after line-join</span>
<a id=__codelineno-0-461 name=__codelineno-0-461></a><span class=sd>            decode_json: Whether to attempt JSON decoding</span>
<a id=__codelineno-0-462 name=__codelineno-0-462></a>
<a id=__codelineno-0-463 name=__codelineno-0-463></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-464 name=__codelineno-0-464></a><span class=sd>            Decoded object or raw string payload</span>
<a id=__codelineno-0-465 name=__codelineno-0-465></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-466 name=__codelineno-0-466></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>decode_json</span><span class=p>:</span>
<a id=__codelineno-0-467 name=__codelineno-0-467></a>            <span class=k>return</span> <span class=n>raw_data</span>
<a id=__codelineno-0-468 name=__codelineno-0-468></a>
<a id=__codelineno-0-469 name=__codelineno-0-469></a>        <span class=k>if</span> <span class=n>raw_data</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
<a id=__codelineno-0-470 name=__codelineno-0-470></a>            <span class=k>return</span> <span class=n>raw_data</span>
<a id=__codelineno-0-471 name=__codelineno-0-471></a>
<a id=__codelineno-0-472 name=__codelineno-0-472></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-473 name=__codelineno-0-473></a>            <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>raw_data</span><span class=p>)</span>
<a id=__codelineno-0-474 name=__codelineno-0-474></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
<a id=__codelineno-0-475 name=__codelineno-0-475></a>            <span class=k>return</span> <span class=n>raw_data</span>
<a id=__codelineno-0-476 name=__codelineno-0-476></a>
<a id=__codelineno-0-477 name=__codelineno-0-477></a>    <span class=k>def</span><span class=w> </span><span class=nf>_parse_sse_event</span><span class=p>(</span>
<a id=__codelineno-0-478 name=__codelineno-0-478></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>raw_lines</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>decode_json</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-479 name=__codelineno-0-479></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-480 name=__codelineno-0-480></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-481 name=__codelineno-0-481></a><span class=sd>        Parse a single SSE event block (lines between blank separators).</span>
<a id=__codelineno-0-482 name=__codelineno-0-482></a>
<a id=__codelineno-0-483 name=__codelineno-0-483></a><span class=sd>        Args:</span>
<a id=__codelineno-0-484 name=__codelineno-0-484></a><span class=sd>            raw_lines: Raw lines from the SSE stream</span>
<a id=__codelineno-0-485 name=__codelineno-0-485></a><span class=sd>            decode_json: Whether to decode JSON payloads automatically</span>
<a id=__codelineno-0-486 name=__codelineno-0-486></a>
<a id=__codelineno-0-487 name=__codelineno-0-487></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-488 name=__codelineno-0-488></a><span class=sd>            Parsed event dictionary, or None if event is ignorable.</span>
<a id=__codelineno-0-489 name=__codelineno-0-489></a><span class=sd>            Returned event includes a transient ``has_data`` flag used internally.</span>
<a id=__codelineno-0-490 name=__codelineno-0-490></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-491 name=__codelineno-0-491></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>raw_lines</span><span class=p>:</span>
<a id=__codelineno-0-492 name=__codelineno-0-492></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-493 name=__codelineno-0-493></a>
<a id=__codelineno-0-494 name=__codelineno-0-494></a>        <span class=n>event_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-495 name=__codelineno-0-495></a>        <span class=n>event_name</span> <span class=o>=</span> <span class=s2>&quot;message&quot;</span>
<a id=__codelineno-0-496 name=__codelineno-0-496></a>        <span class=n>data_lines</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-497 name=__codelineno-0-497></a>        <span class=n>retry_ms</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-498 name=__codelineno-0-498></a>
<a id=__codelineno-0-499 name=__codelineno-0-499></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>raw_lines</span><span class=p>:</span>
<a id=__codelineno-0-500 name=__codelineno-0-500></a>            <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>):</span>
<a id=__codelineno-0-501 name=__codelineno-0-501></a>                <span class=c1># SSE comment/keepalive line</span>
<a id=__codelineno-0-502 name=__codelineno-0-502></a>                <span class=k>continue</span>
<a id=__codelineno-0-503 name=__codelineno-0-503></a>
<a id=__codelineno-0-504 name=__codelineno-0-504></a>            <span class=k>if</span> <span class=s2>&quot;:&quot;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
<a id=__codelineno-0-505 name=__codelineno-0-505></a>                <span class=n>field</span><span class=p>,</span> <span class=n>value</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-0-506 name=__codelineno-0-506></a>                <span class=k>if</span> <span class=n>value</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>):</span>
<a id=__codelineno-0-507 name=__codelineno-0-507></a>                    <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
<a id=__codelineno-0-508 name=__codelineno-0-508></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-509 name=__codelineno-0-509></a>                <span class=n>field</span><span class=p>,</span> <span class=n>value</span> <span class=o>=</span> <span class=n>line</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-510 name=__codelineno-0-510></a>
<a id=__codelineno-0-511 name=__codelineno-0-511></a>            <span class=k>if</span> <span class=n>field</span> <span class=o>==</span> <span class=s2>&quot;event&quot;</span><span class=p>:</span>
<a id=__codelineno-0-512 name=__codelineno-0-512></a>                <span class=n>event_name</span> <span class=o>=</span> <span class=n>value</span> <span class=ow>or</span> <span class=s2>&quot;message&quot;</span>
<a id=__codelineno-0-513 name=__codelineno-0-513></a>            <span class=k>elif</span> <span class=n>field</span> <span class=o>==</span> <span class=s2>&quot;data&quot;</span><span class=p>:</span>
<a id=__codelineno-0-514 name=__codelineno-0-514></a>                <span class=n>data_lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-515 name=__codelineno-0-515></a>            <span class=k>elif</span> <span class=n>field</span> <span class=o>==</span> <span class=s2>&quot;id&quot;</span><span class=p>:</span>
<a id=__codelineno-0-516 name=__codelineno-0-516></a>                <span class=c1># Ignore invalid ids per SSE spec guidance</span>
<a id=__codelineno-0-517 name=__codelineno-0-517></a>                <span class=k>if</span> <span class=s2>&quot;</span><span class=se>\x00</span><span class=s2>&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>value</span><span class=p>:</span>
<a id=__codelineno-0-518 name=__codelineno-0-518></a>                    <span class=n>event_id</span> <span class=o>=</span> <span class=n>value</span>
<a id=__codelineno-0-519 name=__codelineno-0-519></a>            <span class=k>elif</span> <span class=n>field</span> <span class=o>==</span> <span class=s2>&quot;retry&quot;</span><span class=p>:</span>
<a id=__codelineno-0-520 name=__codelineno-0-520></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-521 name=__codelineno-0-521></a>                    <span class=n>parsed_retry</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-522 name=__codelineno-0-522></a>                    <span class=k>if</span> <span class=n>parsed_retry</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-523 name=__codelineno-0-523></a>                        <span class=n>retry_ms</span> <span class=o>=</span> <span class=n>parsed_retry</span>
<a id=__codelineno-0-524 name=__codelineno-0-524></a>                <span class=k>except</span> <span class=p>(</span><span class=ne>TypeError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>):</span>
<a id=__codelineno-0-525 name=__codelineno-0-525></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Ignoring invalid SSE retry value: </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-526 name=__codelineno-0-526></a>
<a id=__codelineno-0-527 name=__codelineno-0-527></a>        <span class=n>has_data</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>data_lines</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
<a id=__codelineno-0-528 name=__codelineno-0-528></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>has_data</span> <span class=ow>and</span> <span class=n>retry_ms</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>event_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-529 name=__codelineno-0-529></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-530 name=__codelineno-0-530></a>
<a id=__codelineno-0-531 name=__codelineno-0-531></a>        <span class=n>raw_data</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>data_lines</span><span class=p>)</span>
<a id=__codelineno-0-532 name=__codelineno-0-532></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-533 name=__codelineno-0-533></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>event_id</span><span class=p>,</span>
<a id=__codelineno-0-534 name=__codelineno-0-534></a>            <span class=s2>&quot;event&quot;</span><span class=p>:</span> <span class=n>event_name</span><span class=p>,</span>
<a id=__codelineno-0-535 name=__codelineno-0-535></a>            <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_decode_sse_data</span><span class=p>(</span><span class=n>raw_data</span><span class=p>,</span> <span class=n>decode_json</span><span class=p>)</span> <span class=k>if</span> <span class=n>has_data</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-536 name=__codelineno-0-536></a>            <span class=s2>&quot;retry&quot;</span><span class=p>:</span> <span class=n>retry_ms</span><span class=p>,</span>
<a id=__codelineno-0-537 name=__codelineno-0-537></a>            <span class=s2>&quot;raw_data&quot;</span><span class=p>:</span> <span class=n>raw_data</span><span class=p>,</span>
<a id=__codelineno-0-538 name=__codelineno-0-538></a>            <span class=s2>&quot;has_data&quot;</span><span class=p>:</span> <span class=n>has_data</span><span class=p>,</span>
<a id=__codelineno-0-539 name=__codelineno-0-539></a>        <span class=p>}</span>
<a id=__codelineno-0-540 name=__codelineno-0-540></a>
<a id=__codelineno-0-541 name=__codelineno-0-541></a>    <span class=k>def</span><span class=w> </span><span class=nf>_build_sse_request</span><span class=p>(</span>
<a id=__codelineno-0-542 name=__codelineno-0-542></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-543 name=__codelineno-0-543></a>        <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-544 name=__codelineno-0-544></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-545 name=__codelineno-0-545></a>        <span class=n>last_event_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-546 name=__codelineno-0-546></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-547 name=__codelineno-0-547></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-548 name=__codelineno-0-548></a><span class=sd>        Build a request dictionary for an SSE endpoint.</span>
<a id=__codelineno-0-549 name=__codelineno-0-549></a>
<a id=__codelineno-0-550 name=__codelineno-0-550></a><span class=sd>        Adds SSE-friendly headers while preserving endpoint/default headers.</span>
<a id=__codelineno-0-551 name=__codelineno-0-551></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-552 name=__codelineno-0-552></a>        <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-553 name=__codelineno-0-553></a>        <span class=n>headers</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;headers&quot;</span><span class=p>,</span> <span class=p>{}))</span>
<a id=__codelineno-0-554 name=__codelineno-0-554></a>        <span class=n>headers</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&quot;Accept&quot;</span><span class=p>,</span> <span class=s2>&quot;text/event-stream&quot;</span><span class=p>)</span>
<a id=__codelineno-0-555 name=__codelineno-0-555></a>        <span class=n>headers</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>&quot;Cache-Control&quot;</span><span class=p>,</span> <span class=s2>&quot;no-cache&quot;</span><span class=p>)</span>
<a id=__codelineno-0-556 name=__codelineno-0-556></a>        <span class=k>if</span> <span class=n>last_event_id</span><span class=p>:</span>
<a id=__codelineno-0-557 name=__codelineno-0-557></a>            <span class=n>headers</span><span class=p>[</span><span class=s2>&quot;Last-Event-ID&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>last_event_id</span>
<a id=__codelineno-0-558 name=__codelineno-0-558></a>        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>headers</span>
<a id=__codelineno-0-559 name=__codelineno-0-559></a>        <span class=k>return</span> <span class=n>request</span>
<a id=__codelineno-0-560 name=__codelineno-0-560></a>
<a id=__codelineno-0-561 name=__codelineno-0-561></a>    <span class=k>def</span><span class=w> </span><span class=nf>_raise_sse_error</span><span class=p>(</span>
<a id=__codelineno-0-562 name=__codelineno-0-562></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
<a id=__codelineno-0-563 name=__codelineno-0-563></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-564 name=__codelineno-0-564></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Raise an ``ApiLinkerError`` for SSE failures with rich context.&quot;&quot;&quot;</span>
<a id=__codelineno-0-565 name=__codelineno-0-565></a>        <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>exc</span><span class=p>)</span>
<a id=__codelineno-0-566 name=__codelineno-0-566></a>        <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-567 name=__codelineno-0-567></a>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-568 name=__codelineno-0-568></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-569 name=__codelineno-0-569></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=n>exc</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>]</span>
<a id=__codelineno-0-570 name=__codelineno-0-570></a>            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
<a id=__codelineno-0-571 name=__codelineno-0-571></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-572 name=__codelineno-0-572></a>
<a id=__codelineno-0-573 name=__codelineno-0-573></a>        <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-574 name=__codelineno-0-574></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to stream SSE from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-575 name=__codelineno-0-575></a>            <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-576 name=__codelineno-0-576></a>            <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-577 name=__codelineno-0-577></a>            <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-578 name=__codelineno-0-578></a>            <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;url&quot;</span><span class=p>)),</span>
<a id=__codelineno-0-579 name=__codelineno-0-579></a>            <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;method&quot;</span><span class=p>,</span> <span class=s2>&quot;GET&quot;</span><span class=p>),</span>
<a id=__codelineno-0-580 name=__codelineno-0-580></a>            <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>},</span>
<a id=__codelineno-0-581 name=__codelineno-0-581></a>        <span class=p>)</span>
<a id=__codelineno-0-582 name=__codelineno-0-582></a>
<a id=__codelineno-0-583 name=__codelineno-0-583></a>    <span class=k>def</span><span class=w> </span><span class=nf>stream_sse</span><span class=p>(</span>
<a id=__codelineno-0-584 name=__codelineno-0-584></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-585 name=__codelineno-0-585></a>        <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-586 name=__codelineno-0-586></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-587 name=__codelineno-0-587></a>        <span class=n>max_events</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-588 name=__codelineno-0-588></a>        <span class=n>reconnect</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-589 name=__codelineno-0-589></a>        <span class=n>reconnect_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<a id=__codelineno-0-590 name=__codelineno-0-590></a>        <span class=n>max_reconnect_attempts</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-591 name=__codelineno-0-591></a>        <span class=n>read_timeout</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-592 name=__codelineno-0-592></a>        <span class=n>decode_json</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-593 name=__codelineno-0-593></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<a id=__codelineno-0-594 name=__codelineno-0-594></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-595 name=__codelineno-0-595></a><span class=sd>        Stream events from an SSE endpoint.</span>
<a id=__codelineno-0-596 name=__codelineno-0-596></a>
<a id=__codelineno-0-597 name=__codelineno-0-597></a><span class=sd>        Supports automatic reconnection, Last-Event-ID resume, and optional</span>
<a id=__codelineno-0-598 name=__codelineno-0-598></a><span class=sd>        JSON decoding of event payloads.</span>
<a id=__codelineno-0-599 name=__codelineno-0-599></a>
<a id=__codelineno-0-600 name=__codelineno-0-600></a><span class=sd>        Args:</span>
<a id=__codelineno-0-601 name=__codelineno-0-601></a><span class=sd>            endpoint_name: Endpoint key configured in ``self.endpoints``.</span>
<a id=__codelineno-0-602 name=__codelineno-0-602></a><span class=sd>            params: Query parameters.</span>
<a id=__codelineno-0-603 name=__codelineno-0-603></a><span class=sd>            max_events: Stop after this many dispatched events.</span>
<a id=__codelineno-0-604 name=__codelineno-0-604></a><span class=sd>            reconnect: Whether to reconnect on disconnect/error.</span>
<a id=__codelineno-0-605 name=__codelineno-0-605></a><span class=sd>            reconnect_delay: Base reconnect delay in seconds.</span>
<a id=__codelineno-0-606 name=__codelineno-0-606></a><span class=sd>            max_reconnect_attempts: Maximum reconnect attempts (None = unlimited).</span>
<a id=__codelineno-0-607 name=__codelineno-0-607></a><span class=sd>            read_timeout: Per-stream read timeout. Defaults to connector timeout.</span>
<a id=__codelineno-0-608 name=__codelineno-0-608></a><span class=sd>            decode_json: Whether to decode JSON payloads automatically.</span>
<a id=__codelineno-0-609 name=__codelineno-0-609></a>
<a id=__codelineno-0-610 name=__codelineno-0-610></a><span class=sd>        Yields:</span>
<a id=__codelineno-0-611 name=__codelineno-0-611></a><span class=sd>            Parsed SSE events with keys: ``id``, ``event``, ``data``, ``retry``, ``raw_data``.</span>
<a id=__codelineno-0-612 name=__codelineno-0-612></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-613 name=__codelineno-0-613></a>        <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-614 name=__codelineno-0-614></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-615 name=__codelineno-0-615></a>
<a id=__codelineno-0-616 name=__codelineno-0-616></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-617 name=__codelineno-0-617></a>        <span class=n>sse_config</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>sse</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-618 name=__codelineno-0-618></a>
<a id=__codelineno-0-619 name=__codelineno-0-619></a>        <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_events&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-620 name=__codelineno-0-620></a>            <span class=n>max_events</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_events&quot;</span><span class=p>])</span>
<a id=__codelineno-0-621 name=__codelineno-0-621></a>
<a id=__codelineno-0-622 name=__codelineno-0-622></a>        <span class=n>reconnect</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reconnect&quot;</span><span class=p>,</span> <span class=n>reconnect</span><span class=p>))</span>
<a id=__codelineno-0-623 name=__codelineno-0-623></a>        <span class=n>reconnect_delay</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reconnect_delay&quot;</span><span class=p>,</span> <span class=n>reconnect_delay</span><span class=p>))</span>
<a id=__codelineno-0-624 name=__codelineno-0-624></a>
<a id=__codelineno-0-625 name=__codelineno-0-625></a>        <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-626 name=__codelineno-0-626></a>            <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=kc>None</span>
<a id=__codelineno-0-627 name=__codelineno-0-627></a>            <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_reconnect_attempts&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-628 name=__codelineno-0-628></a>        <span class=p>):</span>
<a id=__codelineno-0-629 name=__codelineno-0-629></a>            <span class=n>max_reconnect_attempts</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_reconnect_attempts&quot;</span><span class=p>])</span>
<a id=__codelineno-0-630 name=__codelineno-0-630></a>
<a id=__codelineno-0-631 name=__codelineno-0-631></a>        <span class=k>if</span> <span class=n>read_timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-632 name=__codelineno-0-632></a>            <span class=n>read_timeout</span> <span class=o>=</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;read_timeout&quot;</span><span class=p>)</span>
<a id=__codelineno-0-633 name=__codelineno-0-633></a>        <span class=k>if</span> <span class=n>read_timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-634 name=__codelineno-0-634></a>            <span class=n>read_timeout</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span>
<a id=__codelineno-0-635 name=__codelineno-0-635></a>
<a id=__codelineno-0-636 name=__codelineno-0-636></a>        <span class=n>decode_json</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;decode_json&quot;</span><span class=p>,</span> <span class=n>decode_json</span><span class=p>))</span>
<a id=__codelineno-0-637 name=__codelineno-0-637></a>
<a id=__codelineno-0-638 name=__codelineno-0-638></a>        <span class=n>reconnect_attempts</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-639 name=__codelineno-0-639></a>        <span class=n>received_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-640 name=__codelineno-0-640></a>        <span class=n>last_event_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-641 name=__codelineno-0-641></a>        <span class=n>effective_reconnect_delay</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>reconnect_delay</span><span class=p>)</span>
<a id=__codelineno-0-642 name=__codelineno-0-642></a>
<a id=__codelineno-0-643 name=__codelineno-0-643></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
<a id=__codelineno-0-644 name=__codelineno-0-644></a>            <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_build_sse_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>last_event_id</span><span class=p>)</span>
<a id=__codelineno-0-645 name=__codelineno-0-645></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-646 name=__codelineno-0-646></a>                <span class=c1># Apply endpoint-level rate limiting before opening/renewing stream</span>
<a id=__codelineno-0-647 name=__codelineno-0-647></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-648 name=__codelineno-0-648></a>
<a id=__codelineno-0-649 name=__codelineno-0-649></a>                <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>stream</span><span class=p>(</span>
<a id=__codelineno-0-650 name=__codelineno-0-650></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-651 name=__codelineno-0-651></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-652 name=__codelineno-0-652></a>                    <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-653 name=__codelineno-0-653></a>                    <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-654 name=__codelineno-0-654></a>                    <span class=n>json</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;json&quot;</span><span class=p>),</span>
<a id=__codelineno-0-655 name=__codelineno-0-655></a>                    <span class=n>timeout</span><span class=o>=</span><span class=n>read_timeout</span><span class=p>,</span>
<a id=__codelineno-0-656 name=__codelineno-0-656></a>                <span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
<a id=__codelineno-0-657 name=__codelineno-0-657></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>update_from_response</span><span class=p>(</span>
<a id=__codelineno-0-658 name=__codelineno-0-658></a>                        <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>response</span>
<a id=__codelineno-0-659 name=__codelineno-0-659></a>                    <span class=p>)</span>
<a id=__codelineno-0-660 name=__codelineno-0-660></a>                    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-661 name=__codelineno-0-661></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-662 name=__codelineno-0-662></a>                        <span class=s2>&quot;Connected to SSE endpoint: </span><span class=si>%s</span><span class=s2> (</span><span class=si>%s</span><span class=s2> </span><span class=si>%s</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-663 name=__codelineno-0-663></a>                        <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-664 name=__codelineno-0-664></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-665 name=__codelineno-0-665></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-666 name=__codelineno-0-666></a>                    <span class=p>)</span>
<a id=__codelineno-0-667 name=__codelineno-0-667></a>
<a id=__codelineno-0-668 name=__codelineno-0-668></a>                    <span class=n>pending_lines</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-669 name=__codelineno-0-669></a>
<a id=__codelineno-0-670 name=__codelineno-0-670></a>                    <span class=k>def</span><span class=w> </span><span class=nf>_dispatch_event</span><span class=p>(</span>
<a id=__codelineno-0-671 name=__codelineno-0-671></a>                        <span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<a id=__codelineno-0-672 name=__codelineno-0-672></a>                    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-673 name=__codelineno-0-673></a>                        <span class=k>nonlocal</span> <span class=n>effective_reconnect_delay</span><span class=p>,</span> <span class=n>last_event_id</span><span class=p>,</span> <span class=n>received_events</span>
<a id=__codelineno-0-674 name=__codelineno-0-674></a>
<a id=__codelineno-0-675 name=__codelineno-0-675></a>                        <span class=n>retry_hint</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retry&quot;</span><span class=p>)</span>
<a id=__codelineno-0-676 name=__codelineno-0-676></a>                        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>retry_hint</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
<a id=__codelineno-0-677 name=__codelineno-0-677></a>                            <span class=n>effective_reconnect_delay</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span>
<a id=__codelineno-0-678 name=__codelineno-0-678></a>                                <span class=mf>0.0</span><span class=p>,</span> <span class=nb>float</span><span class=p>(</span><span class=n>retry_hint</span><span class=p>)</span> <span class=o>/</span> <span class=mf>1000.0</span>
<a id=__codelineno-0-679 name=__codelineno-0-679></a>                            <span class=p>)</span>
<a id=__codelineno-0-680 name=__codelineno-0-680></a>
<a id=__codelineno-0-681 name=__codelineno-0-681></a>                        <span class=n>event_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>
<a id=__codelineno-0-682 name=__codelineno-0-682></a>                        <span class=k>if</span> <span class=n>event_id</span><span class=p>:</span>
<a id=__codelineno-0-683 name=__codelineno-0-683></a>                            <span class=n>last_event_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>event_id</span><span class=p>)</span>
<a id=__codelineno-0-684 name=__codelineno-0-684></a>
<a id=__codelineno-0-685 name=__codelineno-0-685></a>                        <span class=k>if</span> <span class=ow>not</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;has_data&quot;</span><span class=p>):</span>
<a id=__codelineno-0-686 name=__codelineno-0-686></a>                            <span class=c1># Retry/id-only control blocks are not dispatched</span>
<a id=__codelineno-0-687 name=__codelineno-0-687></a>                            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-688 name=__codelineno-0-688></a>
<a id=__codelineno-0-689 name=__codelineno-0-689></a>                        <span class=n>event</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;has_data&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-690 name=__codelineno-0-690></a>                        <span class=n>received_events</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-691 name=__codelineno-0-691></a>                        <span class=k>return</span> <span class=n>event</span>
<a id=__codelineno-0-692 name=__codelineno-0-692></a>
<a id=__codelineno-0-693 name=__codelineno-0-693></a>                    <span class=k>for</span> <span class=n>raw_line</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>iter_lines</span><span class=p>():</span>
<a id=__codelineno-0-694 name=__codelineno-0-694></a>                        <span class=k>if</span> <span class=n>raw_line</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-695 name=__codelineno-0-695></a>                            <span class=k>continue</span>
<a id=__codelineno-0-696 name=__codelineno-0-696></a>
<a id=__codelineno-0-697 name=__codelineno-0-697></a>                        <span class=n>line</span> <span class=o>=</span> <span class=n>raw_line</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\r</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-698 name=__codelineno-0-698></a>
<a id=__codelineno-0-699 name=__codelineno-0-699></a>                        <span class=k>if</span> <span class=n>line</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
<a id=__codelineno-0-700 name=__codelineno-0-700></a>                            <span class=n>parsed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_sse_event</span><span class=p>(</span>
<a id=__codelineno-0-701 name=__codelineno-0-701></a>                                <span class=n>pending_lines</span><span class=p>,</span> <span class=n>decode_json</span><span class=o>=</span><span class=n>decode_json</span>
<a id=__codelineno-0-702 name=__codelineno-0-702></a>                            <span class=p>)</span>
<a id=__codelineno-0-703 name=__codelineno-0-703></a>                            <span class=n>pending_lines</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-704 name=__codelineno-0-704></a>
<a id=__codelineno-0-705 name=__codelineno-0-705></a>                            <span class=k>if</span> <span class=n>parsed</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-706 name=__codelineno-0-706></a>                                <span class=k>continue</span>
<a id=__codelineno-0-707 name=__codelineno-0-707></a>
<a id=__codelineno-0-708 name=__codelineno-0-708></a>                            <span class=n>event</span> <span class=o>=</span> <span class=n>_dispatch_event</span><span class=p>(</span><span class=n>parsed</span><span class=p>)</span>
<a id=__codelineno-0-709 name=__codelineno-0-709></a>                            <span class=k>if</span> <span class=n>event</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-710 name=__codelineno-0-710></a>                                <span class=k>continue</span>
<a id=__codelineno-0-711 name=__codelineno-0-711></a>
<a id=__codelineno-0-712 name=__codelineno-0-712></a>                            <span class=k>yield</span> <span class=n>event</span>
<a id=__codelineno-0-713 name=__codelineno-0-713></a>                            <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>received_events</span> <span class=o>&gt;=</span> <span class=n>max_events</span><span class=p>:</span>
<a id=__codelineno-0-714 name=__codelineno-0-714></a>                                <span class=k>return</span>
<a id=__codelineno-0-715 name=__codelineno-0-715></a>                        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-716 name=__codelineno-0-716></a>                            <span class=n>pending_lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
<a id=__codelineno-0-717 name=__codelineno-0-717></a>
<a id=__codelineno-0-718 name=__codelineno-0-718></a>                    <span class=c1># Flush trailing buffered event block on connection close</span>
<a id=__codelineno-0-719 name=__codelineno-0-719></a>                    <span class=k>if</span> <span class=n>pending_lines</span><span class=p>:</span>
<a id=__codelineno-0-720 name=__codelineno-0-720></a>                        <span class=n>parsed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_sse_event</span><span class=p>(</span>
<a id=__codelineno-0-721 name=__codelineno-0-721></a>                            <span class=n>pending_lines</span><span class=p>,</span> <span class=n>decode_json</span><span class=o>=</span><span class=n>decode_json</span>
<a id=__codelineno-0-722 name=__codelineno-0-722></a>                        <span class=p>)</span>
<a id=__codelineno-0-723 name=__codelineno-0-723></a>                        <span class=k>if</span> <span class=n>parsed</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-724 name=__codelineno-0-724></a>                            <span class=n>event</span> <span class=o>=</span> <span class=n>_dispatch_event</span><span class=p>(</span><span class=n>parsed</span><span class=p>)</span>
<a id=__codelineno-0-725 name=__codelineno-0-725></a>                            <span class=k>if</span> <span class=n>event</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-726 name=__codelineno-0-726></a>                                <span class=k>yield</span> <span class=n>event</span>
<a id=__codelineno-0-727 name=__codelineno-0-727></a>                                <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-728 name=__codelineno-0-728></a>                                    <span class=n>max_events</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-729 name=__codelineno-0-729></a>                                    <span class=ow>and</span> <span class=n>received_events</span> <span class=o>&gt;=</span> <span class=n>max_events</span>
<a id=__codelineno-0-730 name=__codelineno-0-730></a>                                <span class=p>):</span>
<a id=__codelineno-0-731 name=__codelineno-0-731></a>                                    <span class=k>return</span>
<a id=__codelineno-0-732 name=__codelineno-0-732></a>
<a id=__codelineno-0-733 name=__codelineno-0-733></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a id=__codelineno-0-734 name=__codelineno-0-734></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>reconnect</span><span class=p>:</span>
<a id=__codelineno-0-735 name=__codelineno-0-735></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_sse_error</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
<a id=__codelineno-0-736 name=__codelineno-0-736></a>
<a id=__codelineno-0-737 name=__codelineno-0-737></a>                <span class=n>reconnect_attempts</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-738 name=__codelineno-0-738></a>                <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-739 name=__codelineno-0-739></a>                    <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-740 name=__codelineno-0-740></a>                    <span class=ow>and</span> <span class=n>reconnect_attempts</span> <span class=o>&gt;</span> <span class=n>max_reconnect_attempts</span>
<a id=__codelineno-0-741 name=__codelineno-0-741></a>                <span class=p>):</span>
<a id=__codelineno-0-742 name=__codelineno-0-742></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>_raise_sse_error</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
<a id=__codelineno-0-743 name=__codelineno-0-743></a>
<a id=__codelineno-0-744 name=__codelineno-0-744></a>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-745 name=__codelineno-0-745></a>                    <span class=s2>&quot;SSE stream error on endpoint &#39;</span><span class=si>%s</span><span class=s2>&#39;: </span><span class=si>%s</span><span class=s2>. Reconnecting in </span><span class=si>%.2f</span><span class=s2>s (attempt </span><span class=si>%d</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-746 name=__codelineno-0-746></a>                    <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-747 name=__codelineno-0-747></a>                    <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>),</span>
<a id=__codelineno-0-748 name=__codelineno-0-748></a>                    <span class=n>effective_reconnect_delay</span><span class=p>,</span>
<a id=__codelineno-0-749 name=__codelineno-0-749></a>                    <span class=n>reconnect_attempts</span><span class=p>,</span>
<a id=__codelineno-0-750 name=__codelineno-0-750></a>                <span class=p>)</span>
<a id=__codelineno-0-751 name=__codelineno-0-751></a>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>effective_reconnect_delay</span><span class=p>)</span>
<a id=__codelineno-0-752 name=__codelineno-0-752></a>                <span class=k>continue</span>
<a id=__codelineno-0-753 name=__codelineno-0-753></a>
<a id=__codelineno-0-754 name=__codelineno-0-754></a>            <span class=c1># Reconnect when stream closes naturally, unless disabled.</span>
<a id=__codelineno-0-755 name=__codelineno-0-755></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>reconnect</span><span class=p>:</span>
<a id=__codelineno-0-756 name=__codelineno-0-756></a>                <span class=k>return</span>
<a id=__codelineno-0-757 name=__codelineno-0-757></a>
<a id=__codelineno-0-758 name=__codelineno-0-758></a>            <span class=n>reconnect_attempts</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-759 name=__codelineno-0-759></a>            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-760 name=__codelineno-0-760></a>                <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-761 name=__codelineno-0-761></a>                <span class=ow>and</span> <span class=n>reconnect_attempts</span> <span class=o>&gt;</span> <span class=n>max_reconnect_attempts</span>
<a id=__codelineno-0-762 name=__codelineno-0-762></a>            <span class=p>):</span>
<a id=__codelineno-0-763 name=__codelineno-0-763></a>                <span class=k>return</span>
<a id=__codelineno-0-764 name=__codelineno-0-764></a>
<a id=__codelineno-0-765 name=__codelineno-0-765></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-766 name=__codelineno-0-766></a>                <span class=s2>&quot;SSE stream closed for endpoint &#39;</span><span class=si>%s</span><span class=s2>&#39;. Reconnecting in </span><span class=si>%.2f</span><span class=s2>s (attempt </span><span class=si>%d</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-767 name=__codelineno-0-767></a>                <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-768 name=__codelineno-0-768></a>                <span class=n>effective_reconnect_delay</span><span class=p>,</span>
<a id=__codelineno-0-769 name=__codelineno-0-769></a>                <span class=n>reconnect_attempts</span><span class=p>,</span>
<a id=__codelineno-0-770 name=__codelineno-0-770></a>            <span class=p>)</span>
<a id=__codelineno-0-771 name=__codelineno-0-771></a>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>effective_reconnect_delay</span><span class=p>)</span>
<a id=__codelineno-0-772 name=__codelineno-0-772></a>
<a id=__codelineno-0-773 name=__codelineno-0-773></a>    <span class=k>def</span><span class=w> </span><span class=nf>consume_sse</span><span class=p>(</span>
<a id=__codelineno-0-774 name=__codelineno-0-774></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-775 name=__codelineno-0-775></a>        <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-776 name=__codelineno-0-776></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-777 name=__codelineno-0-777></a>        <span class=n>processor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>[[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-778 name=__codelineno-0-778></a>        <span class=n>chunk_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>50</span><span class=p>,</span>
<a id=__codelineno-0-779 name=__codelineno-0-779></a>        <span class=n>max_events</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-780 name=__codelineno-0-780></a>        <span class=n>backpressure_buffer_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>500</span><span class=p>,</span>
<a id=__codelineno-0-781 name=__codelineno-0-781></a>        <span class=n>drop_policy</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;block&quot;</span><span class=p>,</span>
<a id=__codelineno-0-782 name=__codelineno-0-782></a>        <span class=o>**</span><span class=n>stream_kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-783 name=__codelineno-0-783></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-784 name=__codelineno-0-784></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-785 name=__codelineno-0-785></a><span class=sd>        Consume SSE events in chunks with bounded in-memory buffering.</span>
<a id=__codelineno-0-786 name=__codelineno-0-786></a>
<a id=__codelineno-0-787 name=__codelineno-0-787></a><span class=sd>        This method adds chunked processing and explicit backpressure handling:</span>
<a id=__codelineno-0-788 name=__codelineno-0-788></a><span class=sd>        - ``drop_policy=&#39;block&#39;``: flushes buffer chunks before accepting more data.</span>
<a id=__codelineno-0-789 name=__codelineno-0-789></a><span class=sd>        - ``drop_policy=&#39;drop_oldest&#39;``: drops oldest buffered events when full.</span>
<a id=__codelineno-0-790 name=__codelineno-0-790></a>
<a id=__codelineno-0-791 name=__codelineno-0-791></a><span class=sd>        Args:</span>
<a id=__codelineno-0-792 name=__codelineno-0-792></a><span class=sd>            endpoint_name: Endpoint key configured in ``self.endpoints``.</span>
<a id=__codelineno-0-793 name=__codelineno-0-793></a><span class=sd>            params: Query parameters.</span>
<a id=__codelineno-0-794 name=__codelineno-0-794></a><span class=sd>            processor: Optional callback invoked with each chunk.</span>
<a id=__codelineno-0-795 name=__codelineno-0-795></a><span class=sd>            chunk_size: Number of events per processing chunk.</span>
<a id=__codelineno-0-796 name=__codelineno-0-796></a><span class=sd>            max_events: Maximum number of events to consume.</span>
<a id=__codelineno-0-797 name=__codelineno-0-797></a><span class=sd>            backpressure_buffer_size: Max in-memory event buffer.</span>
<a id=__codelineno-0-798 name=__codelineno-0-798></a><span class=sd>            drop_policy: ``block`` or ``drop_oldest``.</span>
<a id=__codelineno-0-799 name=__codelineno-0-799></a><span class=sd>            **stream_kwargs: Extra kwargs forwarded to ``stream_sse``.</span>
<a id=__codelineno-0-800 name=__codelineno-0-800></a>
<a id=__codelineno-0-801 name=__codelineno-0-801></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-802 name=__codelineno-0-802></a><span class=sd>            Summary dictionary with processing metrics and chunk results.</span>
<a id=__codelineno-0-803 name=__codelineno-0-803></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-804 name=__codelineno-0-804></a>        <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-805 name=__codelineno-0-805></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-806 name=__codelineno-0-806></a>
<a id=__codelineno-0-807 name=__codelineno-0-807></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-808 name=__codelineno-0-808></a>        <span class=n>sse_config</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>sse</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-809 name=__codelineno-0-809></a>
<a id=__codelineno-0-810 name=__codelineno-0-810></a>        <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_events&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-811 name=__codelineno-0-811></a>            <span class=n>max_events</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_events&quot;</span><span class=p>])</span>
<a id=__codelineno-0-812 name=__codelineno-0-812></a>
<a id=__codelineno-0-813 name=__codelineno-0-813></a>        <span class=n>chunk_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;chunk_size&quot;</span><span class=p>,</span> <span class=n>chunk_size</span><span class=p>))</span>
<a id=__codelineno-0-814 name=__codelineno-0-814></a>        <span class=n>backpressure_buffer_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span>
<a id=__codelineno-0-815 name=__codelineno-0-815></a>            <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;backpressure_buffer_size&quot;</span><span class=p>,</span> <span class=n>backpressure_buffer_size</span><span class=p>)</span>
<a id=__codelineno-0-816 name=__codelineno-0-816></a>        <span class=p>)</span>
<a id=__codelineno-0-817 name=__codelineno-0-817></a>        <span class=n>drop_policy</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;drop_policy&quot;</span><span class=p>,</span> <span class=n>drop_policy</span><span class=p>))</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
<a id=__codelineno-0-818 name=__codelineno-0-818></a>
<a id=__codelineno-0-819 name=__codelineno-0-819></a>        <span class=k>if</span> <span class=n>chunk_size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-820 name=__codelineno-0-820></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;chunk_size must be &gt; 0&quot;</span><span class=p>)</span>
<a id=__codelineno-0-821 name=__codelineno-0-821></a>        <span class=k>if</span> <span class=n>backpressure_buffer_size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-822 name=__codelineno-0-822></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;backpressure_buffer_size must be &gt; 0&quot;</span><span class=p>)</span>
<a id=__codelineno-0-823 name=__codelineno-0-823></a>        <span class=k>if</span> <span class=n>drop_policy</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>{</span><span class=s2>&quot;block&quot;</span><span class=p>,</span> <span class=s2>&quot;drop_oldest&quot;</span><span class=p>}:</span>
<a id=__codelineno-0-824 name=__codelineno-0-824></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;drop_policy must be either &#39;block&#39; or &#39;drop_oldest&#39;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-825 name=__codelineno-0-825></a>
<a id=__codelineno-0-826 name=__codelineno-0-826></a>        <span class=n>buffer</span><span class=p>:</span> <span class=n>Deque</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>deque</span><span class=p>(</span><span class=n>maxlen</span><span class=o>=</span><span class=n>backpressure_buffer_size</span><span class=p>)</span>
<a id=__codelineno-0-827 name=__codelineno-0-827></a>        <span class=n>dropped_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-828 name=__codelineno-0-828></a>        <span class=n>processed_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-829 name=__codelineno-0-829></a>        <span class=n>chunks_processed</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-830 name=__codelineno-0-830></a>        <span class=n>chunk_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-831 name=__codelineno-0-831></a>
<a id=__codelineno-0-832 name=__codelineno-0-832></a>        <span class=k>def</span><span class=w> </span><span class=nf>_flush</span><span class=p>(</span><span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-0-833 name=__codelineno-0-833></a>            <span class=k>nonlocal</span> <span class=n>processed_events</span><span class=p>,</span> <span class=n>chunks_processed</span>
<a id=__codelineno-0-834 name=__codelineno-0-834></a>            <span class=n>flushed</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-835 name=__codelineno-0-835></a>
<a id=__codelineno-0-836 name=__codelineno-0-836></a>            <span class=k>while</span> <span class=n>buffer</span> <span class=ow>and</span> <span class=p>(</span><span class=n>force</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>chunk_size</span><span class=p>):</span>
<a id=__codelineno-0-837 name=__codelineno-0-837></a>                <span class=n>current_chunk_size</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-838 name=__codelineno-0-838></a>                    <span class=n>chunk_size</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>chunk_size</span> <span class=k>else</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span>
<a id=__codelineno-0-839 name=__codelineno-0-839></a>                <span class=p>)</span>
<a id=__codelineno-0-840 name=__codelineno-0-840></a>                <span class=n>chunk</span> <span class=o>=</span> <span class=p>[</span><span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>current_chunk_size</span><span class=p>)]</span>
<a id=__codelineno-0-841 name=__codelineno-0-841></a>                <span class=n>chunks_processed</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-842 name=__codelineno-0-842></a>                <span class=n>processed_events</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
<a id=__codelineno-0-843 name=__codelineno-0-843></a>                <span class=n>flushed</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-844 name=__codelineno-0-844></a>
<a id=__codelineno-0-845 name=__codelineno-0-845></a>                <span class=k>if</span> <span class=n>processor</span><span class=p>:</span>
<a id=__codelineno-0-846 name=__codelineno-0-846></a>                    <span class=n>chunk_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>processor</span><span class=p>(</span><span class=n>chunk</span><span class=p>))</span>
<a id=__codelineno-0-847 name=__codelineno-0-847></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-848 name=__codelineno-0-848></a>                    <span class=n>chunk_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
<a id=__codelineno-0-849 name=__codelineno-0-849></a>
<a id=__codelineno-0-850 name=__codelineno-0-850></a>                <span class=c1># In non-force mode we flush at most one chunk each step.</span>
<a id=__codelineno-0-851 name=__codelineno-0-851></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
<a id=__codelineno-0-852 name=__codelineno-0-852></a>                    <span class=k>break</span>
<a id=__codelineno-0-853 name=__codelineno-0-853></a>
<a id=__codelineno-0-854 name=__codelineno-0-854></a>            <span class=k>return</span> <span class=n>flushed</span>
<a id=__codelineno-0-855 name=__codelineno-0-855></a>
<a id=__codelineno-0-856 name=__codelineno-0-856></a>        <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>stream_sse</span><span class=p>(</span>
<a id=__codelineno-0-857 name=__codelineno-0-857></a>            <span class=n>endpoint_name</span><span class=o>=</span><span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-858 name=__codelineno-0-858></a>            <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span>
<a id=__codelineno-0-859 name=__codelineno-0-859></a>            <span class=n>max_events</span><span class=o>=</span><span class=n>max_events</span><span class=p>,</span>
<a id=__codelineno-0-860 name=__codelineno-0-860></a>            <span class=o>**</span><span class=n>stream_kwargs</span><span class=p>,</span>
<a id=__codelineno-0-861 name=__codelineno-0-861></a>        <span class=p>):</span>
<a id=__codelineno-0-862 name=__codelineno-0-862></a>            <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>backpressure_buffer_size</span><span class=p>:</span>
<a id=__codelineno-0-863 name=__codelineno-0-863></a>                <span class=k>if</span> <span class=n>drop_policy</span> <span class=o>==</span> <span class=s2>&quot;drop_oldest&quot;</span><span class=p>:</span>
<a id=__codelineno-0-864 name=__codelineno-0-864></a>                    <span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
<a id=__codelineno-0-865 name=__codelineno-0-865></a>                    <span class=n>dropped_events</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-866 name=__codelineno-0-866></a>                    <span class=k>break</span>
<a id=__codelineno-0-867 name=__codelineno-0-867></a>
<a id=__codelineno-0-868 name=__codelineno-0-868></a>                <span class=c1># Block strategy: process buffered data before accepting more.</span>
<a id=__codelineno-0-869 name=__codelineno-0-869></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a id=__codelineno-0-870 name=__codelineno-0-870></a>                    <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-0-871 name=__codelineno-0-871></a>                    <span class=k>break</span>
<a id=__codelineno-0-872 name=__codelineno-0-872></a>
<a id=__codelineno-0-873 name=__codelineno-0-873></a>            <span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
<a id=__codelineno-0-874 name=__codelineno-0-874></a>            <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-0-875 name=__codelineno-0-875></a>
<a id=__codelineno-0-876 name=__codelineno-0-876></a>        <span class=c1># Process any trailing events.</span>
<a id=__codelineno-0-877 name=__codelineno-0-877></a>        <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-0-878 name=__codelineno-0-878></a>
<a id=__codelineno-0-879 name=__codelineno-0-879></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-880 name=__codelineno-0-880></a>            <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-881 name=__codelineno-0-881></a>            <span class=s2>&quot;processed_events&quot;</span><span class=p>:</span> <span class=n>processed_events</span><span class=p>,</span>
<a id=__codelineno-0-882 name=__codelineno-0-882></a>            <span class=s2>&quot;chunks_processed&quot;</span><span class=p>:</span> <span class=n>chunks_processed</span><span class=p>,</span>
<a id=__codelineno-0-883 name=__codelineno-0-883></a>            <span class=s2>&quot;dropped_events&quot;</span><span class=p>:</span> <span class=n>dropped_events</span><span class=p>,</span>
<a id=__codelineno-0-884 name=__codelineno-0-884></a>            <span class=s2>&quot;chunk_size&quot;</span><span class=p>:</span> <span class=n>chunk_size</span><span class=p>,</span>
<a id=__codelineno-0-885 name=__codelineno-0-885></a>            <span class=s2>&quot;buffer_max_size&quot;</span><span class=p>:</span> <span class=n>backpressure_buffer_size</span><span class=p>,</span>
<a id=__codelineno-0-886 name=__codelineno-0-886></a>            <span class=s2>&quot;results&quot;</span><span class=p>:</span> <span class=n>chunk_results</span><span class=p>,</span>
<a id=__codelineno-0-887 name=__codelineno-0-887></a>        <span class=p>}</span>
<a id=__codelineno-0-888 name=__codelineno-0-888></a>
<a id=__codelineno-0-889 name=__codelineno-0-889></a>    <span class=k>def</span><span class=w> </span><span class=nf>fetch_data</span><span class=p>(</span>
<a id=__codelineno-0-890 name=__codelineno-0-890></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-891 name=__codelineno-0-891></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<a id=__codelineno-0-892 name=__codelineno-0-892></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-893 name=__codelineno-0-893></a><span class=sd>        Fetch data from the specified endpoint.</span>
<a id=__codelineno-0-894 name=__codelineno-0-894></a>
<a id=__codelineno-0-895 name=__codelineno-0-895></a><span class=sd>        Args:</span>
<a id=__codelineno-0-896 name=__codelineno-0-896></a><span class=sd>            endpoint_name: Name of the endpoint to use</span>
<a id=__codelineno-0-897 name=__codelineno-0-897></a><span class=sd>            params: Additional parameters for the request</span>
<a id=__codelineno-0-898 name=__codelineno-0-898></a>
<a id=__codelineno-0-899 name=__codelineno-0-899></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-900 name=__codelineno-0-900></a><span class=sd>            The parsed response data</span>
<a id=__codelineno-0-901 name=__codelineno-0-901></a>
<a id=__codelineno-0-902 name=__codelineno-0-902></a><span class=sd>        Raises:</span>
<a id=__codelineno-0-903 name=__codelineno-0-903></a><span class=sd>            ApiLinkerError: On API request failure with enhanced error context</span>
<a id=__codelineno-0-904 name=__codelineno-0-904></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-905 name=__codelineno-0-905></a>        <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-906 name=__codelineno-0-906></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-907 name=__codelineno-0-907></a>
<a id=__codelineno-0-908 name=__codelineno-0-908></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-909 name=__codelineno-0-909></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-910 name=__codelineno-0-910></a>            <span class=sa>f</span><span class=s2>&quot;Fetching data from endpoint: </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>method</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-0-911 name=__codelineno-0-911></a>        <span class=p>)</span>
<a id=__codelineno-0-912 name=__codelineno-0-912></a>
<a id=__codelineno-0-913 name=__codelineno-0-913></a>        <span class=c1># Prepare the request</span>
<a id=__codelineno-0-914 name=__codelineno-0-914></a>        <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-915 name=__codelineno-0-915></a>
<a id=__codelineno-0-916 name=__codelineno-0-916></a>        <span class=c1># Make the request with retries (note: main retries are now handled by the error recovery manager)</span>
<a id=__codelineno-0-917 name=__codelineno-0-917></a>        <span class=n>last_exception</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-918 name=__codelineno-0-918></a>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-0-919 name=__codelineno-0-919></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-920 name=__codelineno-0-920></a>                <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-921 name=__codelineno-0-921></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-922 name=__codelineno-0-922></a>
<a id=__codelineno-0-923 name=__codelineno-0-923></a>                <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-924 name=__codelineno-0-924></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-925 name=__codelineno-0-925></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-926 name=__codelineno-0-926></a>                    <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-927 name=__codelineno-0-927></a>                    <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-928 name=__codelineno-0-928></a>                    <span class=n>json</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;json&quot;</span><span class=p>),</span>
<a id=__codelineno-0-929 name=__codelineno-0-929></a>                <span class=p>)</span>
<a id=__codelineno-0-930 name=__codelineno-0-930></a>                <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-931 name=__codelineno-0-931></a>
<a id=__codelineno-0-932 name=__codelineno-0-932></a>                <span class=c1># Process the response</span>
<a id=__codelineno-0-933 name=__codelineno-0-933></a>                <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_response</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-934 name=__codelineno-0-934></a>
<a id=__codelineno-0-935 name=__codelineno-0-935></a>                <span class=c1># Handle pagination if configured</span>
<a id=__codelineno-0-936 name=__codelineno-0-936></a>                <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>pagination</span><span class=p>:</span>
<a id=__codelineno-0-937 name=__codelineno-0-937></a>                    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_pagination</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-938 name=__codelineno-0-938></a>
<a id=__codelineno-0-939 name=__codelineno-0-939></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data fetched successfully from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-940 name=__codelineno-0-940></a>                <span class=k>return</span> <span class=n>result</span>
<a id=__codelineno-0-941 name=__codelineno-0-941></a>
<a id=__codelineno-0-942 name=__codelineno-0-942></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-943 name=__codelineno-0-943></a>                <span class=n>last_exception</span> <span class=o>=</span> <span class=n>e</span>
<a id=__codelineno-0-944 name=__codelineno-0-944></a>                <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<a id=__codelineno-0-945 name=__codelineno-0-945></a>
<a id=__codelineno-0-946 name=__codelineno-0-946></a>                <span class=c1># Log the error at an appropriate level</span>
<a id=__codelineno-0-947 name=__codelineno-0-947></a>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=p>:</span>
<a id=__codelineno-0-948 name=__codelineno-0-948></a>                    <span class=n>wait_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=n>attempt</span>
<a id=__codelineno-0-949 name=__codelineno-0-949></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-950 name=__codelineno-0-950></a>                        <span class=sa>f</span><span class=s2>&quot;Error fetching data (attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-951 name=__codelineno-0-951></a>                    <span class=p>)</span>
<a id=__codelineno-0-952 name=__codelineno-0-952></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrying in </span><span class=si>{</span><span class=n>wait_time</span><span class=si>}</span><span class=s2> seconds...&quot;</span><span class=p>)</span>
<a id=__codelineno-0-953 name=__codelineno-0-953></a>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
<a id=__codelineno-0-954 name=__codelineno-0-954></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-955 name=__codelineno-0-955></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;All retry attempts failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-956 name=__codelineno-0-956></a>
<a id=__codelineno-0-957 name=__codelineno-0-957></a>        <span class=c1># If we get here, all retry attempts failed</span>
<a id=__codelineno-0-958 name=__codelineno-0-958></a>        <span class=k>if</span> <span class=n>last_exception</span><span class=p>:</span>
<a id=__codelineno-0-959 name=__codelineno-0-959></a>            <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span>
<a id=__codelineno-0-960 name=__codelineno-0-960></a>
<a id=__codelineno-0-961 name=__codelineno-0-961></a>            <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-962 name=__codelineno-0-962></a>            <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-963 name=__codelineno-0-963></a>            <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>last_exception</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-964 name=__codelineno-0-964></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-965 name=__codelineno-0-965></a>                    <span class=n>response_body</span> <span class=o>=</span> <span class=n>last_exception</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-966 name=__codelineno-0-966></a>                <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-967 name=__codelineno-0-967></a>                    <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-968 name=__codelineno-0-968></a>
<a id=__codelineno-0-969 name=__codelineno-0-969></a>            <span class=c1># Create an ApiLinkerError with enhanced context</span>
<a id=__codelineno-0-970 name=__codelineno-0-970></a>            <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-971 name=__codelineno-0-971></a>                <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to fetch data from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-972 name=__codelineno-0-972></a>                <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-973 name=__codelineno-0-973></a>                <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-974 name=__codelineno-0-974></a>                <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-975 name=__codelineno-0-975></a>                <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-976 name=__codelineno-0-976></a>                <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-977 name=__codelineno-0-977></a>                <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=n>params</span><span class=p>},</span>
<a id=__codelineno-0-978 name=__codelineno-0-978></a>            <span class=p>)</span>
<a id=__codelineno-0-979 name=__codelineno-0-979></a>
<a id=__codelineno-0-980 name=__codelineno-0-980></a>        <span class=c1># Should not reach here</span>
<a id=__codelineno-0-981 name=__codelineno-0-981></a>        <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-982 name=__codelineno-0-982></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Unexpected state fetching data from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-983 name=__codelineno-0-983></a>            <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>UNKNOWN</span><span class=p>,</span>
<a id=__codelineno-0-984 name=__codelineno-0-984></a>            <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-985 name=__codelineno-0-985></a>        <span class=p>)</span>
<a id=__codelineno-0-986 name=__codelineno-0-986></a>
<a id=__codelineno-0-987 name=__codelineno-0-987></a>    <span class=k>def</span><span class=w> </span><span class=nf>send_data</span><span class=p>(</span>
<a id=__codelineno-0-988 name=__codelineno-0-988></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span>
<a id=__codelineno-0-989 name=__codelineno-0-989></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-990 name=__codelineno-0-990></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-991 name=__codelineno-0-991></a><span class=sd>        Send data to the specified endpoint.</span>
<a id=__codelineno-0-992 name=__codelineno-0-992></a>
<a id=__codelineno-0-993 name=__codelineno-0-993></a><span class=sd>        Args:</span>
<a id=__codelineno-0-994 name=__codelineno-0-994></a><span class=sd>            endpoint_name: Name of the endpoint to use</span>
<a id=__codelineno-0-995 name=__codelineno-0-995></a><span class=sd>            data: Data to send</span>
<a id=__codelineno-0-996 name=__codelineno-0-996></a>
<a id=__codelineno-0-997 name=__codelineno-0-997></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-998 name=__codelineno-0-998></a><span class=sd>            The parsed response</span>
<a id=__codelineno-0-999 name=__codelineno-0-999></a>
<a id=__codelineno-0-1000 name=__codelineno-0-1000></a><span class=sd>        Raises:</span>
<a id=__codelineno-0-1001 name=__codelineno-0-1001></a><span class=sd>            ApiLinkerError: On API request failure with enhanced error context</span>
<a id=__codelineno-0-1002 name=__codelineno-0-1002></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-1003 name=__codelineno-0-1003></a>        <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-1004 name=__codelineno-0-1004></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1005 name=__codelineno-0-1005></a>
<a id=__codelineno-0-1006 name=__codelineno-0-1006></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-1007 name=__codelineno-0-1007></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1008 name=__codelineno-0-1008></a>            <span class=sa>f</span><span class=s2>&quot;Sending data to endpoint: </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>method</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-0-1009 name=__codelineno-0-1009></a>        <span class=p>)</span>
<a id=__codelineno-0-1010 name=__codelineno-0-1010></a>
<a id=__codelineno-0-1011 name=__codelineno-0-1011></a>        <span class=c1># Prepare the request</span>
<a id=__codelineno-0-1012 name=__codelineno-0-1012></a>        <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1013 name=__codelineno-0-1013></a>
<a id=__codelineno-0-1014 name=__codelineno-0-1014></a>        <span class=c1># Validate single item(s) against request schema if provided</span>
<a id=__codelineno-0-1015 name=__codelineno-0-1015></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-1016 name=__codelineno-0-1016></a>        <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>request_schema</span> <span class=ow>and</span> <span class=n>is_validator_available</span><span class=p>():</span>
<a id=__codelineno-0-1017 name=__codelineno-0-1017></a>
<a id=__codelineno-0-1018 name=__codelineno-0-1018></a>            <span class=k>def</span><span class=w> </span><span class=nf>_validate_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-1019 name=__codelineno-0-1019></a>                <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1020 name=__codelineno-0-1020></a>                    <span class=n>item</span><span class=p>,</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1021 name=__codelineno-0-1021></a>                <span class=p>)</span>
<a id=__codelineno-0-1022 name=__codelineno-0-1022></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1023 name=__codelineno-0-1023></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
<a id=__codelineno-0-1024 name=__codelineno-0-1024></a>                        <span class=s2>&quot;Request schema validation failed for </span><span class=si>%s</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1025 name=__codelineno-0-1025></a>                        <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-1026 name=__codelineno-0-1026></a>                        <span class=n>pretty_print_diffs</span><span class=p>(</span><span class=n>diffs</span><span class=p>),</span>
<a id=__codelineno-0-1027 name=__codelineno-0-1027></a>                    <span class=p>)</span>
<a id=__codelineno-0-1028 name=__codelineno-0-1028></a>                    <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1029 name=__codelineno-0-1029></a>                        <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Request failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1030 name=__codelineno-0-1030></a>                        <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1031 name=__codelineno-0-1031></a>                        <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1032 name=__codelineno-0-1032></a>                        <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1033 name=__codelineno-0-1033></a>                    <span class=p>)</span>
<a id=__codelineno-0-1034 name=__codelineno-0-1034></a>
<a id=__codelineno-0-1035 name=__codelineno-0-1035></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1036 name=__codelineno-0-1036></a>                <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
<a id=__codelineno-0-1037 name=__codelineno-0-1037></a>                    <span class=n>_validate_item</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a id=__codelineno-0-1038 name=__codelineno-0-1038></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1039 name=__codelineno-0-1039></a>                <span class=n>_validate_item</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<a id=__codelineno-0-1040 name=__codelineno-0-1040></a>
<a id=__codelineno-0-1041 name=__codelineno-0-1041></a>        <span class=c1># If data is a list, send each item individually</span>
<a id=__codelineno-0-1042 name=__codelineno-0-1042></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1043 name=__codelineno-0-1043></a>            <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1044 name=__codelineno-0-1044></a>            <span class=n>successful</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-1045 name=__codelineno-0-1045></a>            <span class=n>failed</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-1046 name=__codelineno-0-1046></a>            <span class=n>failures</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1047 name=__codelineno-0-1047></a>
<a id=__codelineno-0-1048 name=__codelineno-0-1048></a>            <span class=k>for</span> <span class=n>item_index</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
<a id=__codelineno-0-1049 name=__codelineno-0-1049></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1050 name=__codelineno-0-1050></a>                    <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-1051 name=__codelineno-0-1051></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1052 name=__codelineno-0-1052></a>
<a id=__codelineno-0-1053 name=__codelineno-0-1053></a>                    <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-1054 name=__codelineno-0-1054></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1055 name=__codelineno-0-1055></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1056 name=__codelineno-0-1056></a>                        <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1057 name=__codelineno-0-1057></a>                        <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1058 name=__codelineno-0-1058></a>                        <span class=n>json</span><span class=o>=</span><span class=n>item</span><span class=p>,</span>
<a id=__codelineno-0-1059 name=__codelineno-0-1059></a>                    <span class=p>)</span>
<a id=__codelineno-0-1060 name=__codelineno-0-1060></a>                    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-1061 name=__codelineno-0-1061></a>                    <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span> <span class=k>else</span> <span class=p>{}</span>
<a id=__codelineno-0-1062 name=__codelineno-0-1062></a>                    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
<a id=__codelineno-0-1063 name=__codelineno-0-1063></a>                    <span class=n>successful</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-1064 name=__codelineno-0-1064></a>
<a id=__codelineno-0-1065 name=__codelineno-0-1065></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1066 name=__codelineno-0-1066></a>                    <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<a id=__codelineno-0-1067 name=__codelineno-0-1067></a>
<a id=__codelineno-0-1068 name=__codelineno-0-1068></a>                    <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-1069 name=__codelineno-0-1069></a>                    <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1070 name=__codelineno-0-1070></a>                    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-1071 name=__codelineno-0-1071></a>                        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1072 name=__codelineno-0-1072></a>                            <span class=n>response_body</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-1073 name=__codelineno-0-1073></a>                        <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-1074 name=__codelineno-0-1074></a>                            <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-1075 name=__codelineno-0-1075></a>
<a id=__codelineno-0-1076 name=__codelineno-0-1076></a>                    <span class=n>error</span> <span class=o>=</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1077 name=__codelineno-0-1077></a>                        <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to send data item </span><span class=si>{</span><span class=n>item_index</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1078 name=__codelineno-0-1078></a>                        <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-1079 name=__codelineno-0-1079></a>                        <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1080 name=__codelineno-0-1080></a>                        <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-1081 name=__codelineno-0-1081></a>                        <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-1082 name=__codelineno-0-1082></a>                        <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1083 name=__codelineno-0-1083></a>                        <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-0-1084 name=__codelineno-0-1084></a>                            <span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-1085 name=__codelineno-0-1085></a>                            <span class=s2>&quot;item_index&quot;</span><span class=p>:</span> <span class=n>item_index</span><span class=p>,</span>
<a id=__codelineno-0-1086 name=__codelineno-0-1086></a>                        <span class=p>},</span>
<a id=__codelineno-0-1087 name=__codelineno-0-1087></a>                    <span class=p>)</span>
<a id=__codelineno-0-1088 name=__codelineno-0-1088></a>                    <span class=n>failures</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1089 name=__codelineno-0-1089></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error sending data item </span><span class=si>{</span><span class=n>item_index</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1090 name=__codelineno-0-1090></a>                    <span class=n>failed</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-1091 name=__codelineno-0-1091></a>
<a id=__codelineno-0-1092 name=__codelineno-0-1092></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Sent </span><span class=si>{</span><span class=n>successful</span><span class=si>}</span><span class=s2> items successfully, </span><span class=si>{</span><span class=n>failed</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1093 name=__codelineno-0-1093></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-1094 name=__codelineno-0-1094></a>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=n>successful</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>failed</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1095 name=__codelineno-0-1095></a>                <span class=s2>&quot;sent_count&quot;</span><span class=p>:</span> <span class=n>successful</span><span class=p>,</span>
<a id=__codelineno-0-1096 name=__codelineno-0-1096></a>                <span class=s2>&quot;failed_count&quot;</span><span class=p>:</span> <span class=n>failed</span><span class=p>,</span>
<a id=__codelineno-0-1097 name=__codelineno-0-1097></a>                <span class=s2>&quot;results&quot;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
<a id=__codelineno-0-1098 name=__codelineno-0-1098></a>                <span class=s2>&quot;failures&quot;</span><span class=p>:</span> <span class=n>failures</span><span class=p>,</span>
<a id=__codelineno-0-1099 name=__codelineno-0-1099></a>            <span class=p>}</span>
<a id=__codelineno-0-1100 name=__codelineno-0-1100></a>
<a id=__codelineno-0-1101 name=__codelineno-0-1101></a>        <span class=c1># If data is a single item, send it</span>
<a id=__codelineno-0-1102 name=__codelineno-0-1102></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1103 name=__codelineno-0-1103></a>            <span class=c1># Make the request with retries (note: main retries now handled by error recovery manager)</span>
<a id=__codelineno-0-1104 name=__codelineno-0-1104></a>            <span class=n>last_exception</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1105 name=__codelineno-0-1105></a>
<a id=__codelineno-0-1106 name=__codelineno-0-1106></a>            <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-0-1107 name=__codelineno-0-1107></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1108 name=__codelineno-0-1108></a>                    <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-1109 name=__codelineno-0-1109></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1110 name=__codelineno-0-1110></a>
<a id=__codelineno-0-1111 name=__codelineno-0-1111></a>                    <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-1112 name=__codelineno-0-1112></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1113 name=__codelineno-0-1113></a>                        <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1114 name=__codelineno-0-1114></a>                        <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1115 name=__codelineno-0-1115></a>                        <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1116 name=__codelineno-0-1116></a>                        <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
<a id=__codelineno-0-1117 name=__codelineno-0-1117></a>                    <span class=p>)</span>
<a id=__codelineno-0-1118 name=__codelineno-0-1118></a>                    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-1119 name=__codelineno-0-1119></a>                    <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span> <span class=k>else</span> <span class=p>{}</span>
<a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
<a id=__codelineno-0-1121 name=__codelineno-0-1121></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data sent successfully to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1122 name=__codelineno-0-1122></a>                    <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-1123 name=__codelineno-0-1123></a>                        <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-1124 name=__codelineno-0-1124></a>                        <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>,</span>
<a id=__codelineno-0-1125 name=__codelineno-0-1125></a>                    <span class=p>}</span>
<a id=__codelineno-0-1126 name=__codelineno-0-1126></a>
<a id=__codelineno-0-1127 name=__codelineno-0-1127></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1128 name=__codelineno-0-1128></a>                    <span class=n>last_exception</span> <span class=o>=</span> <span class=n>e</span>
<a id=__codelineno-0-1129 name=__codelineno-0-1129></a>
<a id=__codelineno-0-1130 name=__codelineno-0-1130></a>                    <span class=c1># Log the error at an appropriate level</span>
<a id=__codelineno-0-1131 name=__codelineno-0-1131></a>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=p>:</span>
<a id=__codelineno-0-1132 name=__codelineno-0-1132></a>                        <span class=n>wait_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=n>attempt</span>
<a id=__codelineno-0-1133 name=__codelineno-0-1133></a>                        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-1134 name=__codelineno-0-1134></a>                            <span class=sa>f</span><span class=s2>&quot;Error sending data (attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1135 name=__codelineno-0-1135></a>                        <span class=p>)</span>
<a id=__codelineno-0-1136 name=__codelineno-0-1136></a>                        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrying in </span><span class=si>{</span><span class=n>wait_time</span><span class=si>}</span><span class=s2> seconds...&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1137 name=__codelineno-0-1137></a>                        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
<a id=__codelineno-0-1138 name=__codelineno-0-1138></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1139 name=__codelineno-0-1139></a>                        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;All retry attempts failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1140 name=__codelineno-0-1140></a>
<a id=__codelineno-0-1141 name=__codelineno-0-1141></a>            <span class=c1># If we get here, all retry attempts failed</span>
<a id=__codelineno-0-1142 name=__codelineno-0-1142></a>            <span class=k>if</span> <span class=n>last_exception</span><span class=p>:</span>
<a id=__codelineno-0-1143 name=__codelineno-0-1143></a>                <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span>
<a id=__codelineno-0-1144 name=__codelineno-0-1144></a>
<a id=__codelineno-0-1145 name=__codelineno-0-1145></a>                <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-1146 name=__codelineno-0-1146></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1147 name=__codelineno-0-1147></a>                <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>last_exception</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-1148 name=__codelineno-0-1148></a>                    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1149 name=__codelineno-0-1149></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=n>last_exception</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[</span>
<a id=__codelineno-0-1150 name=__codelineno-0-1150></a>                            <span class=p>:</span><span class=mi>1000</span>
<a id=__codelineno-0-1151 name=__codelineno-0-1151></a>                        <span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-1152 name=__codelineno-0-1152></a>                    <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-1153 name=__codelineno-0-1153></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
<a id=__codelineno-0-1155 name=__codelineno-0-1155></a>                <span class=c1># Create an ApiLinkerError with enhanced context</span>
<a id=__codelineno-0-1156 name=__codelineno-0-1156></a>                <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1157 name=__codelineno-0-1157></a>                    <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to send data to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1158 name=__codelineno-0-1158></a>                    <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-1159 name=__codelineno-0-1159></a>                    <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1160 name=__codelineno-0-1160></a>                    <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-1161 name=__codelineno-0-1161></a>                    <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-1162 name=__codelineno-0-1162></a>                    <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1163 name=__codelineno-0-1163></a>                    <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>},</span>
<a id=__codelineno-0-1164 name=__codelineno-0-1164></a>                <span class=p>)</span>
<a id=__codelineno-0-1165 name=__codelineno-0-1165></a>
<a id=__codelineno-0-1166 name=__codelineno-0-1166></a>            <span class=c1># This should not be reached</span>
<a id=__codelineno-0-1167 name=__codelineno-0-1167></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=s2>&quot;Unknown error&quot;</span><span class=p>}</span>
<a id=__codelineno-0-1168 name=__codelineno-0-1168></a>
<a id=__codelineno-0-1169 name=__codelineno-0-1169></a>    <span class=k>def</span><span class=w> </span><span class=nf>check_health</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>HealthCheckResult</span><span class=p>:</span>
<a id=__codelineno-0-1170 name=__codelineno-0-1170></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-1171 name=__codelineno-0-1171></a><span class=sd>        Check the health of the API connection.</span>
<a id=__codelineno-0-1172 name=__codelineno-0-1172></a>
<a id=__codelineno-0-1173 name=__codelineno-0-1173></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-1174 name=__codelineno-0-1174></a><span class=sd>            HealthCheckResult indicating the status.</span>
<a id=__codelineno-0-1175 name=__codelineno-0-1175></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-1176 name=__codelineno-0-1176></a>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1177 name=__codelineno-0-1177></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1178 name=__codelineno-0-1178></a>            <span class=c1># Try to hit the base URL or a specific health endpoint if we had one configured</span>
<a id=__codelineno-0-1179 name=__codelineno-0-1179></a>            <span class=c1># For now, just check if we can connect to the base URL</span>
<a id=__codelineno-0-1180 name=__codelineno-0-1180></a>            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>5.0</span><span class=p>)</span>
<a id=__codelineno-0-1181 name=__codelineno-0-1181></a>
<a id=__codelineno-0-1182 name=__codelineno-0-1182></a>            <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-1183 name=__codelineno-0-1183></a>
<a id=__codelineno-0-1184 name=__codelineno-0-1184></a>            <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>HEALTHY</span>
<a id=__codelineno-0-1185 name=__codelineno-0-1185></a>            <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Connected to </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1186 name=__codelineno-0-1186></a>
<a id=__codelineno-0-1187 name=__codelineno-0-1187></a>            <span class=c1># If we get a 5xx error, the server is definitely having issues</span>
<a id=__codelineno-0-1188 name=__codelineno-0-1188></a>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>&gt;=</span> <span class=mi>500</span><span class=p>:</span>
<a id=__codelineno-0-1189 name=__codelineno-0-1189></a>                <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-1190 name=__codelineno-0-1190></a>                <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Server returned </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1191 name=__codelineno-0-1191></a>
<a id=__codelineno-0-1192 name=__codelineno-0-1192></a>            <span class=k>return</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-1193 name=__codelineno-0-1193></a>                <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
<a id=__codelineno-0-1194 name=__codelineno-0-1194></a>                <span class=n>component</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;connector:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1195 name=__codelineno-0-1195></a>                <span class=n>message</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-1196 name=__codelineno-0-1196></a>                <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-1197 name=__codelineno-0-1197></a>                <span class=n>details</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status_code&quot;</span><span class=p>:</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>},</span>
<a id=__codelineno-0-1198 name=__codelineno-0-1198></a>            <span class=p>)</span>
<a id=__codelineno-0-1199 name=__codelineno-0-1199></a>
<a id=__codelineno-0-1200 name=__codelineno-0-1200></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1201 name=__codelineno-0-1201></a>            <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-1202 name=__codelineno-0-1202></a>            <span class=k>return</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-1203 name=__codelineno-0-1203></a>                <span class=n>status</span><span class=o>=</span><span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span><span class=p>,</span>
<a id=__codelineno-0-1204 name=__codelineno-0-1204></a>                <span class=n>component</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;connector:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1205 name=__codelineno-0-1205></a>                <span class=n>message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-0-1206 name=__codelineno-0-1206></a>                <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-1207 name=__codelineno-0-1207></a>            <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>(</span><span class=n>connector_type</span><span class=p>,</span> <span class=n>base_url</span><span class=p>,</span> <span class=n>auth_config</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>endpoints</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>retry_count</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>retry_delay</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>default_headers</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
<a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=n>connector_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a>    <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=n>auth_config</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AuthConfig</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=n>endpoints</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=n>retry_count</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-0-72 name=__codelineno-0-72></a>    <span class=n>retry_delay</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=n>default_headers</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-74 name=__codelineno-0-74></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-75 name=__codelineno-0-75></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=bp>self</span><span class=o>.</span><span class=n>connector_type</span> <span class=o>=</span> <span class=n>connector_type</span>
<a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>base_url</span>
<a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=bp>self</span><span class=o>.</span><span class=n>auth_config</span> <span class=o>=</span> <span class=n>auth_config</span>
<a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>timeout</span>
<a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>=</span> <span class=n>retry_count</span>
<a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>=</span> <span class=n>retry_delay</span>
<a id=__codelineno-0-82 name=__codelineno-0-82></a>
<a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=c1># Default headers (may be provided via explicit parameter or legacy &#39;headers&#39; kwarg)</span>
<a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=k>if</span> <span class=n>default_headers</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=s2>&quot;headers&quot;</span> <span class=ow>in</span> <span class=n>kwargs</span><span class=p>:</span>
<a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=n>default_headers</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;headers&quot;</span><span class=p>))</span>
<a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
<a id=__codelineno-0-88 name=__codelineno-0-88></a>            <span class=n>default_headers</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-89 name=__codelineno-0-89></a>    <span class=bp>self</span><span class=o>.</span><span class=n>default_headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>default_headers</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-90 name=__codelineno-0-90></a>    <span class=c1># Provide a backwards-compatible attribute name used by some connectors</span>
<a id=__codelineno-0-91 name=__codelineno-0-91></a>    <span class=bp>self</span><span class=o>.</span><span class=n>headers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>default_headers</span>
<a id=__codelineno-0-92 name=__codelineno-0-92></a>
<a id=__codelineno-0-93 name=__codelineno-0-93></a>    <span class=c1># Parse and store endpoint configurations</span>
<a id=__codelineno-0-94 name=__codelineno-0-94></a>    <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>EndpointConfig</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=k>if</span> <span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>config</span> <span class=ow>in</span> <span class=n>endpoints</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>EndpointConfig</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>)</span>
<a id=__codelineno-0-98 name=__codelineno-0-98></a>
<a id=__codelineno-0-99 name=__codelineno-0-99></a>    <span class=c1># Store additional settings</span>
<a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=bp>self</span><span class=o>.</span><span class=n>settings</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>kwargs</span>
<a id=__codelineno-0-101 name=__codelineno-0-101></a>
<a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=c1># Create HTTP client with default settings</span>
<a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_client</span><span class=p>()</span>
<a id=__codelineno-0-104 name=__codelineno-0-104></a>
<a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=c1># Initialize Rate Limit Manager</span>
<a id=__codelineno-0-106 name=__codelineno-0-106></a>    <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span> <span class=o>=</span> <span class=n>RateLimitManager</span><span class=p>()</span>
<a id=__codelineno-0-107 name=__codelineno-0-107></a>
<a id=__codelineno-0-108 name=__codelineno-0-108></a>    <span class=c1># Configure rate limiters for endpoints</span>
<a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>config</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>rate_limit</span><span class=p>:</span>
<a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>create_limiter</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>config</span><span class=o>.</span><span class=n>rate_limit</span><span class=p>)</span>
<a id=__codelineno-0-112 name=__codelineno-0-112></a>
<a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Initialized </span><span class=si>{</span><span class=n>connector_type</span><span class=si>}</span><span class=s2> connector for </span><span class=si>{</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.fetch_data class="doc doc-heading"> <code class="highlight language-python"><span class=n>fetch_data</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Fetch data from the specified endpoint.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of the endpoint to use</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>params</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Additional parameters for the request</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>], <span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>The parsed response data</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=apilinker.core.error_handling.ApiLinkerError>ApiLinkerError</span></code> </td> <td> <div class=doc-md-description> <p>On API request failure with enhanced error context</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-889>889</a></span>
<span class=normal><a href=#__codelineno-0-890>890</a></span>
<span class=normal><a href=#__codelineno-0-891>891</a></span>
<span class=normal><a href=#__codelineno-0-892>892</a></span>
<span class=normal><a href=#__codelineno-0-893>893</a></span>
<span class=normal><a href=#__codelineno-0-894>894</a></span>
<span class=normal><a href=#__codelineno-0-895>895</a></span>
<span class=normal><a href=#__codelineno-0-896>896</a></span>
<span class=normal><a href=#__codelineno-0-897>897</a></span>
<span class=normal><a href=#__codelineno-0-898>898</a></span>
<span class=normal><a href=#__codelineno-0-899>899</a></span>
<span class=normal><a href=#__codelineno-0-900>900</a></span>
<span class=normal><a href=#__codelineno-0-901>901</a></span>
<span class=normal><a href=#__codelineno-0-902>902</a></span>
<span class=normal><a href=#__codelineno-0-903>903</a></span>
<span class=normal><a href=#__codelineno-0-904>904</a></span>
<span class=normal><a href=#__codelineno-0-905>905</a></span>
<span class=normal><a href=#__codelineno-0-906>906</a></span>
<span class=normal><a href=#__codelineno-0-907>907</a></span>
<span class=normal><a href=#__codelineno-0-908>908</a></span>
<span class=normal><a href=#__codelineno-0-909>909</a></span>
<span class=normal><a href=#__codelineno-0-910>910</a></span>
<span class=normal><a href=#__codelineno-0-911>911</a></span>
<span class=normal><a href=#__codelineno-0-912>912</a></span>
<span class=normal><a href=#__codelineno-0-913>913</a></span>
<span class=normal><a href=#__codelineno-0-914>914</a></span>
<span class=normal><a href=#__codelineno-0-915>915</a></span>
<span class=normal><a href=#__codelineno-0-916>916</a></span>
<span class=normal><a href=#__codelineno-0-917>917</a></span>
<span class=normal><a href=#__codelineno-0-918>918</a></span>
<span class=normal><a href=#__codelineno-0-919>919</a></span>
<span class=normal><a href=#__codelineno-0-920>920</a></span>
<span class=normal><a href=#__codelineno-0-921>921</a></span>
<span class=normal><a href=#__codelineno-0-922>922</a></span>
<span class=normal><a href=#__codelineno-0-923>923</a></span>
<span class=normal><a href=#__codelineno-0-924>924</a></span>
<span class=normal><a href=#__codelineno-0-925>925</a></span>
<span class=normal><a href=#__codelineno-0-926>926</a></span>
<span class=normal><a href=#__codelineno-0-927>927</a></span>
<span class=normal><a href=#__codelineno-0-928>928</a></span>
<span class=normal><a href=#__codelineno-0-929>929</a></span>
<span class=normal><a href=#__codelineno-0-930>930</a></span>
<span class=normal><a href=#__codelineno-0-931>931</a></span>
<span class=normal><a href=#__codelineno-0-932>932</a></span>
<span class=normal><a href=#__codelineno-0-933>933</a></span>
<span class=normal><a href=#__codelineno-0-934>934</a></span>
<span class=normal><a href=#__codelineno-0-935>935</a></span>
<span class=normal><a href=#__codelineno-0-936>936</a></span>
<span class=normal><a href=#__codelineno-0-937>937</a></span>
<span class=normal><a href=#__codelineno-0-938>938</a></span>
<span class=normal><a href=#__codelineno-0-939>939</a></span>
<span class=normal><a href=#__codelineno-0-940>940</a></span>
<span class=normal><a href=#__codelineno-0-941>941</a></span>
<span class=normal><a href=#__codelineno-0-942>942</a></span>
<span class=normal><a href=#__codelineno-0-943>943</a></span>
<span class=normal><a href=#__codelineno-0-944>944</a></span>
<span class=normal><a href=#__codelineno-0-945>945</a></span>
<span class=normal><a href=#__codelineno-0-946>946</a></span>
<span class=normal><a href=#__codelineno-0-947>947</a></span>
<span class=normal><a href=#__codelineno-0-948>948</a></span>
<span class=normal><a href=#__codelineno-0-949>949</a></span>
<span class=normal><a href=#__codelineno-0-950>950</a></span>
<span class=normal><a href=#__codelineno-0-951>951</a></span>
<span class=normal><a href=#__codelineno-0-952>952</a></span>
<span class=normal><a href=#__codelineno-0-953>953</a></span>
<span class=normal><a href=#__codelineno-0-954>954</a></span>
<span class=normal><a href=#__codelineno-0-955>955</a></span>
<span class=normal><a href=#__codelineno-0-956>956</a></span>
<span class=normal><a href=#__codelineno-0-957>957</a></span>
<span class=normal><a href=#__codelineno-0-958>958</a></span>
<span class=normal><a href=#__codelineno-0-959>959</a></span>
<span class=normal><a href=#__codelineno-0-960>960</a></span>
<span class=normal><a href=#__codelineno-0-961>961</a></span>
<span class=normal><a href=#__codelineno-0-962>962</a></span>
<span class=normal><a href=#__codelineno-0-963>963</a></span>
<span class=normal><a href=#__codelineno-0-964>964</a></span>
<span class=normal><a href=#__codelineno-0-965>965</a></span>
<span class=normal><a href=#__codelineno-0-966>966</a></span>
<span class=normal><a href=#__codelineno-0-967>967</a></span>
<span class=normal><a href=#__codelineno-0-968>968</a></span>
<span class=normal><a href=#__codelineno-0-969>969</a></span>
<span class=normal><a href=#__codelineno-0-970>970</a></span>
<span class=normal><a href=#__codelineno-0-971>971</a></span>
<span class=normal><a href=#__codelineno-0-972>972</a></span>
<span class=normal><a href=#__codelineno-0-973>973</a></span>
<span class=normal><a href=#__codelineno-0-974>974</a></span>
<span class=normal><a href=#__codelineno-0-975>975</a></span>
<span class=normal><a href=#__codelineno-0-976>976</a></span>
<span class=normal><a href=#__codelineno-0-977>977</a></span>
<span class=normal><a href=#__codelineno-0-978>978</a></span>
<span class=normal><a href=#__codelineno-0-979>979</a></span>
<span class=normal><a href=#__codelineno-0-980>980</a></span>
<span class=normal><a href=#__codelineno-0-981>981</a></span>
<span class=normal><a href=#__codelineno-0-982>982</a></span>
<span class=normal><a href=#__codelineno-0-983>983</a></span>
<span class=normal><a href=#__codelineno-0-984>984</a></span>
<span class=normal><a href=#__codelineno-0-985>985</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-889 name=__codelineno-0-889></a><span class=k>def</span><span class=w> </span><span class=nf>fetch_data</span><span class=p>(</span>
<a id=__codelineno-0-890 name=__codelineno-0-890></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-891 name=__codelineno-0-891></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<a id=__codelineno-0-892 name=__codelineno-0-892></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-893 name=__codelineno-0-893></a><span class=sd>    Fetch data from the specified endpoint.</span>
<a id=__codelineno-0-894 name=__codelineno-0-894></a>
<a id=__codelineno-0-895 name=__codelineno-0-895></a><span class=sd>    Args:</span>
<a id=__codelineno-0-896 name=__codelineno-0-896></a><span class=sd>        endpoint_name: Name of the endpoint to use</span>
<a id=__codelineno-0-897 name=__codelineno-0-897></a><span class=sd>        params: Additional parameters for the request</span>
<a id=__codelineno-0-898 name=__codelineno-0-898></a>
<a id=__codelineno-0-899 name=__codelineno-0-899></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-900 name=__codelineno-0-900></a><span class=sd>        The parsed response data</span>
<a id=__codelineno-0-901 name=__codelineno-0-901></a>
<a id=__codelineno-0-902 name=__codelineno-0-902></a><span class=sd>    Raises:</span>
<a id=__codelineno-0-903 name=__codelineno-0-903></a><span class=sd>        ApiLinkerError: On API request failure with enhanced error context</span>
<a id=__codelineno-0-904 name=__codelineno-0-904></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-905 name=__codelineno-0-905></a>    <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-906 name=__codelineno-0-906></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-907 name=__codelineno-0-907></a>
<a id=__codelineno-0-908 name=__codelineno-0-908></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-909 name=__codelineno-0-909></a>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-910 name=__codelineno-0-910></a>        <span class=sa>f</span><span class=s2>&quot;Fetching data from endpoint: </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>method</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-0-911 name=__codelineno-0-911></a>    <span class=p>)</span>
<a id=__codelineno-0-912 name=__codelineno-0-912></a>
<a id=__codelineno-0-913 name=__codelineno-0-913></a>    <span class=c1># Prepare the request</span>
<a id=__codelineno-0-914 name=__codelineno-0-914></a>    <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-915 name=__codelineno-0-915></a>
<a id=__codelineno-0-916 name=__codelineno-0-916></a>    <span class=c1># Make the request with retries (note: main retries are now handled by the error recovery manager)</span>
<a id=__codelineno-0-917 name=__codelineno-0-917></a>    <span class=n>last_exception</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-918 name=__codelineno-0-918></a>    <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-0-919 name=__codelineno-0-919></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-920 name=__codelineno-0-920></a>            <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-921 name=__codelineno-0-921></a>            <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-922 name=__codelineno-0-922></a>
<a id=__codelineno-0-923 name=__codelineno-0-923></a>            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-924 name=__codelineno-0-924></a>                <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-925 name=__codelineno-0-925></a>                <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-926 name=__codelineno-0-926></a>                <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-927 name=__codelineno-0-927></a>                <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-928 name=__codelineno-0-928></a>                <span class=n>json</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;json&quot;</span><span class=p>),</span>
<a id=__codelineno-0-929 name=__codelineno-0-929></a>            <span class=p>)</span>
<a id=__codelineno-0-930 name=__codelineno-0-930></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-931 name=__codelineno-0-931></a>
<a id=__codelineno-0-932 name=__codelineno-0-932></a>            <span class=c1># Process the response</span>
<a id=__codelineno-0-933 name=__codelineno-0-933></a>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_response</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-934 name=__codelineno-0-934></a>
<a id=__codelineno-0-935 name=__codelineno-0-935></a>            <span class=c1># Handle pagination if configured</span>
<a id=__codelineno-0-936 name=__codelineno-0-936></a>            <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>pagination</span><span class=p>:</span>
<a id=__codelineno-0-937 name=__codelineno-0-937></a>                <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_pagination</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-938 name=__codelineno-0-938></a>
<a id=__codelineno-0-939 name=__codelineno-0-939></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data fetched successfully from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-940 name=__codelineno-0-940></a>            <span class=k>return</span> <span class=n>result</span>
<a id=__codelineno-0-941 name=__codelineno-0-941></a>
<a id=__codelineno-0-942 name=__codelineno-0-942></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-943 name=__codelineno-0-943></a>            <span class=n>last_exception</span> <span class=o>=</span> <span class=n>e</span>
<a id=__codelineno-0-944 name=__codelineno-0-944></a>            <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<a id=__codelineno-0-945 name=__codelineno-0-945></a>
<a id=__codelineno-0-946 name=__codelineno-0-946></a>            <span class=c1># Log the error at an appropriate level</span>
<a id=__codelineno-0-947 name=__codelineno-0-947></a>            <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=p>:</span>
<a id=__codelineno-0-948 name=__codelineno-0-948></a>                <span class=n>wait_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=n>attempt</span>
<a id=__codelineno-0-949 name=__codelineno-0-949></a>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-950 name=__codelineno-0-950></a>                    <span class=sa>f</span><span class=s2>&quot;Error fetching data (attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-951 name=__codelineno-0-951></a>                <span class=p>)</span>
<a id=__codelineno-0-952 name=__codelineno-0-952></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrying in </span><span class=si>{</span><span class=n>wait_time</span><span class=si>}</span><span class=s2> seconds...&quot;</span><span class=p>)</span>
<a id=__codelineno-0-953 name=__codelineno-0-953></a>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
<a id=__codelineno-0-954 name=__codelineno-0-954></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-955 name=__codelineno-0-955></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;All retry attempts failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-956 name=__codelineno-0-956></a>
<a id=__codelineno-0-957 name=__codelineno-0-957></a>    <span class=c1># If we get here, all retry attempts failed</span>
<a id=__codelineno-0-958 name=__codelineno-0-958></a>    <span class=k>if</span> <span class=n>last_exception</span><span class=p>:</span>
<a id=__codelineno-0-959 name=__codelineno-0-959></a>        <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span>
<a id=__codelineno-0-960 name=__codelineno-0-960></a>
<a id=__codelineno-0-961 name=__codelineno-0-961></a>        <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-962 name=__codelineno-0-962></a>        <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-963 name=__codelineno-0-963></a>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>last_exception</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-964 name=__codelineno-0-964></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-965 name=__codelineno-0-965></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=n>last_exception</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-966 name=__codelineno-0-966></a>            <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-967 name=__codelineno-0-967></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-968 name=__codelineno-0-968></a>
<a id=__codelineno-0-969 name=__codelineno-0-969></a>        <span class=c1># Create an ApiLinkerError with enhanced context</span>
<a id=__codelineno-0-970 name=__codelineno-0-970></a>        <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-971 name=__codelineno-0-971></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to fetch data from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-972 name=__codelineno-0-972></a>            <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-973 name=__codelineno-0-973></a>            <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-974 name=__codelineno-0-974></a>            <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-975 name=__codelineno-0-975></a>            <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-976 name=__codelineno-0-976></a>            <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-977 name=__codelineno-0-977></a>            <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=n>params</span><span class=p>},</span>
<a id=__codelineno-0-978 name=__codelineno-0-978></a>        <span class=p>)</span>
<a id=__codelineno-0-979 name=__codelineno-0-979></a>
<a id=__codelineno-0-980 name=__codelineno-0-980></a>    <span class=c1># Should not reach here</span>
<a id=__codelineno-0-981 name=__codelineno-0-981></a>    <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-982 name=__codelineno-0-982></a>        <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Unexpected state fetching data from </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-983 name=__codelineno-0-983></a>        <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>UNKNOWN</span><span class=p>,</span>
<a id=__codelineno-0-984 name=__codelineno-0-984></a>        <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-985 name=__codelineno-0-985></a>    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.send_data class="doc doc-heading"> <code class="highlight language-python"><span class=n>send_data</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Send data to the specified endpoint.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of the endpoint to use</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>], <span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Data to send</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>The parsed response</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=apilinker.core.error_handling.ApiLinkerError>ApiLinkerError</span></code> </td> <td> <div class=doc-md-description> <p>On API request failure with enhanced error context</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-987 name=__codelineno-0-987></a><span class=k>def</span><span class=w> </span><span class=nf>send_data</span><span class=p>(</span>
<a id=__codelineno-0-988 name=__codelineno-0-988></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span>
<a id=__codelineno-0-989 name=__codelineno-0-989></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-990 name=__codelineno-0-990></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-991 name=__codelineno-0-991></a><span class=sd>    Send data to the specified endpoint.</span>
<a id=__codelineno-0-992 name=__codelineno-0-992></a>
<a id=__codelineno-0-993 name=__codelineno-0-993></a><span class=sd>    Args:</span>
<a id=__codelineno-0-994 name=__codelineno-0-994></a><span class=sd>        endpoint_name: Name of the endpoint to use</span>
<a id=__codelineno-0-995 name=__codelineno-0-995></a><span class=sd>        data: Data to send</span>
<a id=__codelineno-0-996 name=__codelineno-0-996></a>
<a id=__codelineno-0-997 name=__codelineno-0-997></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-998 name=__codelineno-0-998></a><span class=sd>        The parsed response</span>
<a id=__codelineno-0-999 name=__codelineno-0-999></a>
<a id=__codelineno-0-1000 name=__codelineno-0-1000></a><span class=sd>    Raises:</span>
<a id=__codelineno-0-1001 name=__codelineno-0-1001></a><span class=sd>        ApiLinkerError: On API request failure with enhanced error context</span>
<a id=__codelineno-0-1002 name=__codelineno-0-1002></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-1003 name=__codelineno-0-1003></a>    <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-1004 name=__codelineno-0-1004></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1005 name=__codelineno-0-1005></a>
<a id=__codelineno-0-1006 name=__codelineno-0-1006></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-1007 name=__codelineno-0-1007></a>    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-1008 name=__codelineno-0-1008></a>        <span class=sa>f</span><span class=s2>&quot;Sending data to endpoint: </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>method</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>endpoint</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>)&quot;</span>
<a id=__codelineno-0-1009 name=__codelineno-0-1009></a>    <span class=p>)</span>
<a id=__codelineno-0-1010 name=__codelineno-0-1010></a>
<a id=__codelineno-0-1011 name=__codelineno-0-1011></a>    <span class=c1># Prepare the request</span>
<a id=__codelineno-0-1012 name=__codelineno-0-1012></a>    <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1013 name=__codelineno-0-1013></a>
<a id=__codelineno-0-1014 name=__codelineno-0-1014></a>    <span class=c1># Validate single item(s) against request schema if provided</span>
<a id=__codelineno-0-1015 name=__codelineno-0-1015></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-1016 name=__codelineno-0-1016></a>    <span class=k>if</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>request_schema</span> <span class=ow>and</span> <span class=n>is_validator_available</span><span class=p>():</span>
<a id=__codelineno-0-1017 name=__codelineno-0-1017></a>
<a id=__codelineno-0-1018 name=__codelineno-0-1018></a>        <span class=k>def</span><span class=w> </span><span class=nf>_validate_item</span><span class=p>(</span><span class=n>item</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-1019 name=__codelineno-0-1019></a>            <span class=n>valid</span><span class=p>,</span> <span class=n>diffs</span> <span class=o>=</span> <span class=n>validate_payload_against_schema</span><span class=p>(</span>
<a id=__codelineno-0-1020 name=__codelineno-0-1020></a>                <span class=n>item</span><span class=p>,</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>request_schema</span>
<a id=__codelineno-0-1021 name=__codelineno-0-1021></a>            <span class=p>)</span>
<a id=__codelineno-0-1022 name=__codelineno-0-1022></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>valid</span><span class=p>:</span>
<a id=__codelineno-0-1023 name=__codelineno-0-1023></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
<a id=__codelineno-0-1024 name=__codelineno-0-1024></a>                    <span class=s2>&quot;Request schema validation failed for </span><span class=si>%s</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1025 name=__codelineno-0-1025></a>                    <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-1026 name=__codelineno-0-1026></a>                    <span class=n>pretty_print_diffs</span><span class=p>(</span><span class=n>diffs</span><span class=p>),</span>
<a id=__codelineno-0-1027 name=__codelineno-0-1027></a>                <span class=p>)</span>
<a id=__codelineno-0-1028 name=__codelineno-0-1028></a>                <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1029 name=__codelineno-0-1029></a>                    <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Request failed schema validation&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1030 name=__codelineno-0-1030></a>                    <span class=n>error_category</span><span class=o>=</span><span class=n>ErrorCategory</span><span class=o>.</span><span class=n>VALIDATION</span><span class=p>,</span>
<a id=__codelineno-0-1031 name=__codelineno-0-1031></a>                    <span class=n>status_code</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1032 name=__codelineno-0-1032></a>                    <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=s2>&quot;diffs&quot;</span><span class=p>:</span> <span class=n>diffs</span><span class=p>},</span>
<a id=__codelineno-0-1033 name=__codelineno-0-1033></a>                <span class=p>)</span>
<a id=__codelineno-0-1034 name=__codelineno-0-1034></a>
<a id=__codelineno-0-1035 name=__codelineno-0-1035></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1036 name=__codelineno-0-1036></a>            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
<a id=__codelineno-0-1037 name=__codelineno-0-1037></a>                <span class=n>_validate_item</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a id=__codelineno-0-1038 name=__codelineno-0-1038></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1039 name=__codelineno-0-1039></a>            <span class=n>_validate_item</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<a id=__codelineno-0-1040 name=__codelineno-0-1040></a>
<a id=__codelineno-0-1041 name=__codelineno-0-1041></a>    <span class=c1># If data is a list, send each item individually</span>
<a id=__codelineno-0-1042 name=__codelineno-0-1042></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-1043 name=__codelineno-0-1043></a>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1044 name=__codelineno-0-1044></a>        <span class=n>successful</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-1045 name=__codelineno-0-1045></a>        <span class=n>failed</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-1046 name=__codelineno-0-1046></a>        <span class=n>failures</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-1047 name=__codelineno-0-1047></a>
<a id=__codelineno-0-1048 name=__codelineno-0-1048></a>        <span class=k>for</span> <span class=n>item_index</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
<a id=__codelineno-0-1049 name=__codelineno-0-1049></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1050 name=__codelineno-0-1050></a>                <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-1051 name=__codelineno-0-1051></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1052 name=__codelineno-0-1052></a>
<a id=__codelineno-0-1053 name=__codelineno-0-1053></a>                <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-1054 name=__codelineno-0-1054></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1055 name=__codelineno-0-1055></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1056 name=__codelineno-0-1056></a>                    <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1057 name=__codelineno-0-1057></a>                    <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1058 name=__codelineno-0-1058></a>                    <span class=n>json</span><span class=o>=</span><span class=n>item</span><span class=p>,</span>
<a id=__codelineno-0-1059 name=__codelineno-0-1059></a>                <span class=p>)</span>
<a id=__codelineno-0-1060 name=__codelineno-0-1060></a>                <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-1061 name=__codelineno-0-1061></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span> <span class=k>else</span> <span class=p>{}</span>
<a id=__codelineno-0-1062 name=__codelineno-0-1062></a>                <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
<a id=__codelineno-0-1063 name=__codelineno-0-1063></a>                <span class=n>successful</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-1064 name=__codelineno-0-1064></a>
<a id=__codelineno-0-1065 name=__codelineno-0-1065></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1066 name=__codelineno-0-1066></a>                <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<a id=__codelineno-0-1067 name=__codelineno-0-1067></a>
<a id=__codelineno-0-1068 name=__codelineno-0-1068></a>                <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-1069 name=__codelineno-0-1069></a>                <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1070 name=__codelineno-0-1070></a>                <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-1071 name=__codelineno-0-1071></a>                    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1072 name=__codelineno-0-1072></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>1000</span><span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-1073 name=__codelineno-0-1073></a>                    <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-1074 name=__codelineno-0-1074></a>                        <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-1075 name=__codelineno-0-1075></a>
<a id=__codelineno-0-1076 name=__codelineno-0-1076></a>                <span class=n>error</span> <span class=o>=</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1077 name=__codelineno-0-1077></a>                    <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to send data item </span><span class=si>{</span><span class=n>item_index</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1078 name=__codelineno-0-1078></a>                    <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-1079 name=__codelineno-0-1079></a>                    <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1080 name=__codelineno-0-1080></a>                    <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-1081 name=__codelineno-0-1081></a>                    <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-1082 name=__codelineno-0-1082></a>                    <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1083 name=__codelineno-0-1083></a>                    <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-0-1084 name=__codelineno-0-1084></a>                        <span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-1085 name=__codelineno-0-1085></a>                        <span class=s2>&quot;item_index&quot;</span><span class=p>:</span> <span class=n>item_index</span><span class=p>,</span>
<a id=__codelineno-0-1086 name=__codelineno-0-1086></a>                    <span class=p>},</span>
<a id=__codelineno-0-1087 name=__codelineno-0-1087></a>                <span class=p>)</span>
<a id=__codelineno-0-1088 name=__codelineno-0-1088></a>                <span class=n>failures</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
<a id=__codelineno-0-1089 name=__codelineno-0-1089></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error sending data item </span><span class=si>{</span><span class=n>item_index</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1090 name=__codelineno-0-1090></a>                <span class=n>failed</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-1091 name=__codelineno-0-1091></a>
<a id=__codelineno-0-1092 name=__codelineno-0-1092></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Sent </span><span class=si>{</span><span class=n>successful</span><span class=si>}</span><span class=s2> items successfully, </span><span class=si>{</span><span class=n>failed</span><span class=si>}</span><span class=s2> failed&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1093 name=__codelineno-0-1093></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-1094 name=__codelineno-0-1094></a>            <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=n>successful</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>failed</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-1095 name=__codelineno-0-1095></a>            <span class=s2>&quot;sent_count&quot;</span><span class=p>:</span> <span class=n>successful</span><span class=p>,</span>
<a id=__codelineno-0-1096 name=__codelineno-0-1096></a>            <span class=s2>&quot;failed_count&quot;</span><span class=p>:</span> <span class=n>failed</span><span class=p>,</span>
<a id=__codelineno-0-1097 name=__codelineno-0-1097></a>            <span class=s2>&quot;results&quot;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
<a id=__codelineno-0-1098 name=__codelineno-0-1098></a>            <span class=s2>&quot;failures&quot;</span><span class=p>:</span> <span class=n>failures</span><span class=p>,</span>
<a id=__codelineno-0-1099 name=__codelineno-0-1099></a>        <span class=p>}</span>
<a id=__codelineno-0-1100 name=__codelineno-0-1100></a>
<a id=__codelineno-0-1101 name=__codelineno-0-1101></a>    <span class=c1># If data is a single item, send it</span>
<a id=__codelineno-0-1102 name=__codelineno-0-1102></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1103 name=__codelineno-0-1103></a>        <span class=c1># Make the request with retries (note: main retries now handled by error recovery manager)</span>
<a id=__codelineno-0-1104 name=__codelineno-0-1104></a>        <span class=n>last_exception</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1105 name=__codelineno-0-1105></a>
<a id=__codelineno-0-1106 name=__codelineno-0-1106></a>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-0-1107 name=__codelineno-0-1107></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1108 name=__codelineno-0-1108></a>                <span class=c1># Apply rate limiting</span>
<a id=__codelineno-0-1109 name=__codelineno-0-1109></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-1110 name=__codelineno-0-1110></a>
<a id=__codelineno-0-1111 name=__codelineno-0-1111></a>                <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span>
<a id=__codelineno-0-1112 name=__codelineno-0-1112></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1113 name=__codelineno-0-1113></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1114 name=__codelineno-0-1114></a>                    <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1115 name=__codelineno-0-1115></a>                    <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1116 name=__codelineno-0-1116></a>                    <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
<a id=__codelineno-0-1117 name=__codelineno-0-1117></a>                <span class=p>)</span>
<a id=__codelineno-0-1118 name=__codelineno-0-1118></a>                <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-1119 name=__codelineno-0-1119></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span> <span class=k>else</span> <span class=p>{}</span>
<a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
<a id=__codelineno-0-1121 name=__codelineno-0-1121></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data sent successfully to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1122 name=__codelineno-0-1122></a>                <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-1123 name=__codelineno-0-1123></a>                    <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-1124 name=__codelineno-0-1124></a>                    <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>,</span>
<a id=__codelineno-0-1125 name=__codelineno-0-1125></a>                <span class=p>}</span>
<a id=__codelineno-0-1126 name=__codelineno-0-1126></a>
<a id=__codelineno-0-1127 name=__codelineno-0-1127></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1128 name=__codelineno-0-1128></a>                <span class=n>last_exception</span> <span class=o>=</span> <span class=n>e</span>
<a id=__codelineno-0-1129 name=__codelineno-0-1129></a>
<a id=__codelineno-0-1130 name=__codelineno-0-1130></a>                <span class=c1># Log the error at an appropriate level</span>
<a id=__codelineno-0-1131 name=__codelineno-0-1131></a>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=p>:</span>
<a id=__codelineno-0-1132 name=__codelineno-0-1132></a>                    <span class=n>wait_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=n>attempt</span>
<a id=__codelineno-0-1133 name=__codelineno-0-1133></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-1134 name=__codelineno-0-1134></a>                        <span class=sa>f</span><span class=s2>&quot;Error sending data (attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_count</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1135 name=__codelineno-0-1135></a>                    <span class=p>)</span>
<a id=__codelineno-0-1136 name=__codelineno-0-1136></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrying in </span><span class=si>{</span><span class=n>wait_time</span><span class=si>}</span><span class=s2> seconds...&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1137 name=__codelineno-0-1137></a>                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait_time</span><span class=p>)</span>
<a id=__codelineno-0-1138 name=__codelineno-0-1138></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-1139 name=__codelineno-0-1139></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;All retry attempts failed: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-1140 name=__codelineno-0-1140></a>
<a id=__codelineno-0-1141 name=__codelineno-0-1141></a>        <span class=c1># If we get here, all retry attempts failed</span>
<a id=__codelineno-0-1142 name=__codelineno-0-1142></a>        <span class=k>if</span> <span class=n>last_exception</span><span class=p>:</span>
<a id=__codelineno-0-1143 name=__codelineno-0-1143></a>            <span class=n>error_category</span><span class=p>,</span> <span class=n>status_code</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_categorize_error</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span>
<a id=__codelineno-0-1144 name=__codelineno-0-1144></a>
<a id=__codelineno-0-1145 name=__codelineno-0-1145></a>            <span class=c1># Extract response data if available</span>
<a id=__codelineno-0-1146 name=__codelineno-0-1146></a>            <span class=n>response_body</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-1147 name=__codelineno-0-1147></a>            <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>last_exception</span><span class=p>,</span> <span class=s2>&quot;response&quot;</span><span class=p>):</span>
<a id=__codelineno-0-1148 name=__codelineno-0-1148></a>                <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1149 name=__codelineno-0-1149></a>                    <span class=n>response_body</span> <span class=o>=</span> <span class=n>last_exception</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>[</span>
<a id=__codelineno-0-1150 name=__codelineno-0-1150></a>                        <span class=p>:</span><span class=mi>1000</span>
<a id=__codelineno-0-1151 name=__codelineno-0-1151></a>                    <span class=p>]</span>  <span class=c1># Limit size</span>
<a id=__codelineno-0-1152 name=__codelineno-0-1152></a>                <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-0-1153 name=__codelineno-0-1153></a>                    <span class=n>response_body</span> <span class=o>=</span> <span class=s2>&quot;&lt;Unable to read response body&gt;&quot;</span>
<a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
<a id=__codelineno-0-1155 name=__codelineno-0-1155></a>            <span class=c1># Create an ApiLinkerError with enhanced context</span>
<a id=__codelineno-0-1156 name=__codelineno-0-1156></a>            <span class=k>raise</span> <span class=n>ApiLinkerError</span><span class=p>(</span>
<a id=__codelineno-0-1157 name=__codelineno-0-1157></a>                <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Failed to send data to </span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>last_exception</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1158 name=__codelineno-0-1158></a>                <span class=n>error_category</span><span class=o>=</span><span class=n>error_category</span><span class=p>,</span>
<a id=__codelineno-0-1159 name=__codelineno-0-1159></a>                <span class=n>status_code</span><span class=o>=</span><span class=n>status_code</span><span class=p>,</span>
<a id=__codelineno-0-1160 name=__codelineno-0-1160></a>                <span class=n>response_body</span><span class=o>=</span><span class=n>response_body</span><span class=p>,</span>
<a id=__codelineno-0-1161 name=__codelineno-0-1161></a>                <span class=n>request_url</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-1162 name=__codelineno-0-1162></a>                <span class=n>request_method</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-1163 name=__codelineno-0-1163></a>                <span class=n>additional_context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;endpoint&quot;</span><span class=p>:</span> <span class=n>endpoint_name</span><span class=p>},</span>
<a id=__codelineno-0-1164 name=__codelineno-0-1164></a>            <span class=p>)</span>
<a id=__codelineno-0-1165 name=__codelineno-0-1165></a>
<a id=__codelineno-0-1166 name=__codelineno-0-1166></a>        <span class=c1># This should not be reached</span>
<a id=__codelineno-0-1167 name=__codelineno-0-1167></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=s2>&quot;Unknown error&quot;</span><span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.stream_sse class="doc doc-heading"> <code class="highlight language-python"><span class=n>stream_sse</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>max_events</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>reconnect</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>reconnect_delay</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>max_reconnect_attempts</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>read_timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>decode_json</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Stream events from an SSE endpoint.</p> <p>Supports automatic reconnection, Last-Event-ID resume, and optional JSON decoding of event payloads.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Endpoint key configured in <code>self.endpoints</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>params</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Query parameters.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>max_events</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Stop after this many dispatched events.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>reconnect</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to reconnect on disconnect/error.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td> <code>reconnect_delay</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Base reconnect delay in seconds.</p> </div> </td> <td> <code>1.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>max_reconnect_attempts</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Maximum reconnect attempts (None = unlimited).</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>read_timeout</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=float>float</span>]</code> </td> <td> <div class=doc-md-description> <p>Per-stream read timeout. Defaults to connector timeout.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>decode_json</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to decode JSON payloads automatically.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Yields:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Parsed SSE events with keys: <code>id</code>, <code>event</code>, <code>data</code>, <code>retry</code>, <code>raw_data</code>.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-583>583</a></span>
<span class=normal><a href=#__codelineno-0-584>584</a></span>
<span class=normal><a href=#__codelineno-0-585>585</a></span>
<span class=normal><a href=#__codelineno-0-586>586</a></span>
<span class=normal><a href=#__codelineno-0-587>587</a></span>
<span class=normal><a href=#__codelineno-0-588>588</a></span>
<span class=normal><a href=#__codelineno-0-589>589</a></span>
<span class=normal><a href=#__codelineno-0-590>590</a></span>
<span class=normal><a href=#__codelineno-0-591>591</a></span>
<span class=normal><a href=#__codelineno-0-592>592</a></span>
<span class=normal><a href=#__codelineno-0-593>593</a></span>
<span class=normal><a href=#__codelineno-0-594>594</a></span>
<span class=normal><a href=#__codelineno-0-595>595</a></span>
<span class=normal><a href=#__codelineno-0-596>596</a></span>
<span class=normal><a href=#__codelineno-0-597>597</a></span>
<span class=normal><a href=#__codelineno-0-598>598</a></span>
<span class=normal><a href=#__codelineno-0-599>599</a></span>
<span class=normal><a href=#__codelineno-0-600>600</a></span>
<span class=normal><a href=#__codelineno-0-601>601</a></span>
<span class=normal><a href=#__codelineno-0-602>602</a></span>
<span class=normal><a href=#__codelineno-0-603>603</a></span>
<span class=normal><a href=#__codelineno-0-604>604</a></span>
<span class=normal><a href=#__codelineno-0-605>605</a></span>
<span class=normal><a href=#__codelineno-0-606>606</a></span>
<span class=normal><a href=#__codelineno-0-607>607</a></span>
<span class=normal><a href=#__codelineno-0-608>608</a></span>
<span class=normal><a href=#__codelineno-0-609>609</a></span>
<span class=normal><a href=#__codelineno-0-610>610</a></span>
<span class=normal><a href=#__codelineno-0-611>611</a></span>
<span class=normal><a href=#__codelineno-0-612>612</a></span>
<span class=normal><a href=#__codelineno-0-613>613</a></span>
<span class=normal><a href=#__codelineno-0-614>614</a></span>
<span class=normal><a href=#__codelineno-0-615>615</a></span>
<span class=normal><a href=#__codelineno-0-616>616</a></span>
<span class=normal><a href=#__codelineno-0-617>617</a></span>
<span class=normal><a href=#__codelineno-0-618>618</a></span>
<span class=normal><a href=#__codelineno-0-619>619</a></span>
<span class=normal><a href=#__codelineno-0-620>620</a></span>
<span class=normal><a href=#__codelineno-0-621>621</a></span>
<span class=normal><a href=#__codelineno-0-622>622</a></span>
<span class=normal><a href=#__codelineno-0-623>623</a></span>
<span class=normal><a href=#__codelineno-0-624>624</a></span>
<span class=normal><a href=#__codelineno-0-625>625</a></span>
<span class=normal><a href=#__codelineno-0-626>626</a></span>
<span class=normal><a href=#__codelineno-0-627>627</a></span>
<span class=normal><a href=#__codelineno-0-628>628</a></span>
<span class=normal><a href=#__codelineno-0-629>629</a></span>
<span class=normal><a href=#__codelineno-0-630>630</a></span>
<span class=normal><a href=#__codelineno-0-631>631</a></span>
<span class=normal><a href=#__codelineno-0-632>632</a></span>
<span class=normal><a href=#__codelineno-0-633>633</a></span>
<span class=normal><a href=#__codelineno-0-634>634</a></span>
<span class=normal><a href=#__codelineno-0-635>635</a></span>
<span class=normal><a href=#__codelineno-0-636>636</a></span>
<span class=normal><a href=#__codelineno-0-637>637</a></span>
<span class=normal><a href=#__codelineno-0-638>638</a></span>
<span class=normal><a href=#__codelineno-0-639>639</a></span>
<span class=normal><a href=#__codelineno-0-640>640</a></span>
<span class=normal><a href=#__codelineno-0-641>641</a></span>
<span class=normal><a href=#__codelineno-0-642>642</a></span>
<span class=normal><a href=#__codelineno-0-643>643</a></span>
<span class=normal><a href=#__codelineno-0-644>644</a></span>
<span class=normal><a href=#__codelineno-0-645>645</a></span>
<span class=normal><a href=#__codelineno-0-646>646</a></span>
<span class=normal><a href=#__codelineno-0-647>647</a></span>
<span class=normal><a href=#__codelineno-0-648>648</a></span>
<span class=normal><a href=#__codelineno-0-649>649</a></span>
<span class=normal><a href=#__codelineno-0-650>650</a></span>
<span class=normal><a href=#__codelineno-0-651>651</a></span>
<span class=normal><a href=#__codelineno-0-652>652</a></span>
<span class=normal><a href=#__codelineno-0-653>653</a></span>
<span class=normal><a href=#__codelineno-0-654>654</a></span>
<span class=normal><a href=#__codelineno-0-655>655</a></span>
<span class=normal><a href=#__codelineno-0-656>656</a></span>
<span class=normal><a href=#__codelineno-0-657>657</a></span>
<span class=normal><a href=#__codelineno-0-658>658</a></span>
<span class=normal><a href=#__codelineno-0-659>659</a></span>
<span class=normal><a href=#__codelineno-0-660>660</a></span>
<span class=normal><a href=#__codelineno-0-661>661</a></span>
<span class=normal><a href=#__codelineno-0-662>662</a></span>
<span class=normal><a href=#__codelineno-0-663>663</a></span>
<span class=normal><a href=#__codelineno-0-664>664</a></span>
<span class=normal><a href=#__codelineno-0-665>665</a></span>
<span class=normal><a href=#__codelineno-0-666>666</a></span>
<span class=normal><a href=#__codelineno-0-667>667</a></span>
<span class=normal><a href=#__codelineno-0-668>668</a></span>
<span class=normal><a href=#__codelineno-0-669>669</a></span>
<span class=normal><a href=#__codelineno-0-670>670</a></span>
<span class=normal><a href=#__codelineno-0-671>671</a></span>
<span class=normal><a href=#__codelineno-0-672>672</a></span>
<span class=normal><a href=#__codelineno-0-673>673</a></span>
<span class=normal><a href=#__codelineno-0-674>674</a></span>
<span class=normal><a href=#__codelineno-0-675>675</a></span>
<span class=normal><a href=#__codelineno-0-676>676</a></span>
<span class=normal><a href=#__codelineno-0-677>677</a></span>
<span class=normal><a href=#__codelineno-0-678>678</a></span>
<span class=normal><a href=#__codelineno-0-679>679</a></span>
<span class=normal><a href=#__codelineno-0-680>680</a></span>
<span class=normal><a href=#__codelineno-0-681>681</a></span>
<span class=normal><a href=#__codelineno-0-682>682</a></span>
<span class=normal><a href=#__codelineno-0-683>683</a></span>
<span class=normal><a href=#__codelineno-0-684>684</a></span>
<span class=normal><a href=#__codelineno-0-685>685</a></span>
<span class=normal><a href=#__codelineno-0-686>686</a></span>
<span class=normal><a href=#__codelineno-0-687>687</a></span>
<span class=normal><a href=#__codelineno-0-688>688</a></span>
<span class=normal><a href=#__codelineno-0-689>689</a></span>
<span class=normal><a href=#__codelineno-0-690>690</a></span>
<span class=normal><a href=#__codelineno-0-691>691</a></span>
<span class=normal><a href=#__codelineno-0-692>692</a></span>
<span class=normal><a href=#__codelineno-0-693>693</a></span>
<span class=normal><a href=#__codelineno-0-694>694</a></span>
<span class=normal><a href=#__codelineno-0-695>695</a></span>
<span class=normal><a href=#__codelineno-0-696>696</a></span>
<span class=normal><a href=#__codelineno-0-697>697</a></span>
<span class=normal><a href=#__codelineno-0-698>698</a></span>
<span class=normal><a href=#__codelineno-0-699>699</a></span>
<span class=normal><a href=#__codelineno-0-700>700</a></span>
<span class=normal><a href=#__codelineno-0-701>701</a></span>
<span class=normal><a href=#__codelineno-0-702>702</a></span>
<span class=normal><a href=#__codelineno-0-703>703</a></span>
<span class=normal><a href=#__codelineno-0-704>704</a></span>
<span class=normal><a href=#__codelineno-0-705>705</a></span>
<span class=normal><a href=#__codelineno-0-706>706</a></span>
<span class=normal><a href=#__codelineno-0-707>707</a></span>
<span class=normal><a href=#__codelineno-0-708>708</a></span>
<span class=normal><a href=#__codelineno-0-709>709</a></span>
<span class=normal><a href=#__codelineno-0-710>710</a></span>
<span class=normal><a href=#__codelineno-0-711>711</a></span>
<span class=normal><a href=#__codelineno-0-712>712</a></span>
<span class=normal><a href=#__codelineno-0-713>713</a></span>
<span class=normal><a href=#__codelineno-0-714>714</a></span>
<span class=normal><a href=#__codelineno-0-715>715</a></span>
<span class=normal><a href=#__codelineno-0-716>716</a></span>
<span class=normal><a href=#__codelineno-0-717>717</a></span>
<span class=normal><a href=#__codelineno-0-718>718</a></span>
<span class=normal><a href=#__codelineno-0-719>719</a></span>
<span class=normal><a href=#__codelineno-0-720>720</a></span>
<span class=normal><a href=#__codelineno-0-721>721</a></span>
<span class=normal><a href=#__codelineno-0-722>722</a></span>
<span class=normal><a href=#__codelineno-0-723>723</a></span>
<span class=normal><a href=#__codelineno-0-724>724</a></span>
<span class=normal><a href=#__codelineno-0-725>725</a></span>
<span class=normal><a href=#__codelineno-0-726>726</a></span>
<span class=normal><a href=#__codelineno-0-727>727</a></span>
<span class=normal><a href=#__codelineno-0-728>728</a></span>
<span class=normal><a href=#__codelineno-0-729>729</a></span>
<span class=normal><a href=#__codelineno-0-730>730</a></span>
<span class=normal><a href=#__codelineno-0-731>731</a></span>
<span class=normal><a href=#__codelineno-0-732>732</a></span>
<span class=normal><a href=#__codelineno-0-733>733</a></span>
<span class=normal><a href=#__codelineno-0-734>734</a></span>
<span class=normal><a href=#__codelineno-0-735>735</a></span>
<span class=normal><a href=#__codelineno-0-736>736</a></span>
<span class=normal><a href=#__codelineno-0-737>737</a></span>
<span class=normal><a href=#__codelineno-0-738>738</a></span>
<span class=normal><a href=#__codelineno-0-739>739</a></span>
<span class=normal><a href=#__codelineno-0-740>740</a></span>
<span class=normal><a href=#__codelineno-0-741>741</a></span>
<span class=normal><a href=#__codelineno-0-742>742</a></span>
<span class=normal><a href=#__codelineno-0-743>743</a></span>
<span class=normal><a href=#__codelineno-0-744>744</a></span>
<span class=normal><a href=#__codelineno-0-745>745</a></span>
<span class=normal><a href=#__codelineno-0-746>746</a></span>
<span class=normal><a href=#__codelineno-0-747>747</a></span>
<span class=normal><a href=#__codelineno-0-748>748</a></span>
<span class=normal><a href=#__codelineno-0-749>749</a></span>
<span class=normal><a href=#__codelineno-0-750>750</a></span>
<span class=normal><a href=#__codelineno-0-751>751</a></span>
<span class=normal><a href=#__codelineno-0-752>752</a></span>
<span class=normal><a href=#__codelineno-0-753>753</a></span>
<span class=normal><a href=#__codelineno-0-754>754</a></span>
<span class=normal><a href=#__codelineno-0-755>755</a></span>
<span class=normal><a href=#__codelineno-0-756>756</a></span>
<span class=normal><a href=#__codelineno-0-757>757</a></span>
<span class=normal><a href=#__codelineno-0-758>758</a></span>
<span class=normal><a href=#__codelineno-0-759>759</a></span>
<span class=normal><a href=#__codelineno-0-760>760</a></span>
<span class=normal><a href=#__codelineno-0-761>761</a></span>
<span class=normal><a href=#__codelineno-0-762>762</a></span>
<span class=normal><a href=#__codelineno-0-763>763</a></span>
<span class=normal><a href=#__codelineno-0-764>764</a></span>
<span class=normal><a href=#__codelineno-0-765>765</a></span>
<span class=normal><a href=#__codelineno-0-766>766</a></span>
<span class=normal><a href=#__codelineno-0-767>767</a></span>
<span class=normal><a href=#__codelineno-0-768>768</a></span>
<span class=normal><a href=#__codelineno-0-769>769</a></span>
<span class=normal><a href=#__codelineno-0-770>770</a></span>
<span class=normal><a href=#__codelineno-0-771>771</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-583 name=__codelineno-0-583></a><span class=k>def</span><span class=w> </span><span class=nf>stream_sse</span><span class=p>(</span>
<a id=__codelineno-0-584 name=__codelineno-0-584></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-585 name=__codelineno-0-585></a>    <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-586 name=__codelineno-0-586></a>    <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-587 name=__codelineno-0-587></a>    <span class=n>max_events</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-588 name=__codelineno-0-588></a>    <span class=n>reconnect</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-589 name=__codelineno-0-589></a>    <span class=n>reconnect_delay</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<a id=__codelineno-0-590 name=__codelineno-0-590></a>    <span class=n>max_reconnect_attempts</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-591 name=__codelineno-0-591></a>    <span class=n>read_timeout</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-592 name=__codelineno-0-592></a>    <span class=n>decode_json</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-593 name=__codelineno-0-593></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<a id=__codelineno-0-594 name=__codelineno-0-594></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-595 name=__codelineno-0-595></a><span class=sd>    Stream events from an SSE endpoint.</span>
<a id=__codelineno-0-596 name=__codelineno-0-596></a>
<a id=__codelineno-0-597 name=__codelineno-0-597></a><span class=sd>    Supports automatic reconnection, Last-Event-ID resume, and optional</span>
<a id=__codelineno-0-598 name=__codelineno-0-598></a><span class=sd>    JSON decoding of event payloads.</span>
<a id=__codelineno-0-599 name=__codelineno-0-599></a>
<a id=__codelineno-0-600 name=__codelineno-0-600></a><span class=sd>    Args:</span>
<a id=__codelineno-0-601 name=__codelineno-0-601></a><span class=sd>        endpoint_name: Endpoint key configured in ``self.endpoints``.</span>
<a id=__codelineno-0-602 name=__codelineno-0-602></a><span class=sd>        params: Query parameters.</span>
<a id=__codelineno-0-603 name=__codelineno-0-603></a><span class=sd>        max_events: Stop after this many dispatched events.</span>
<a id=__codelineno-0-604 name=__codelineno-0-604></a><span class=sd>        reconnect: Whether to reconnect on disconnect/error.</span>
<a id=__codelineno-0-605 name=__codelineno-0-605></a><span class=sd>        reconnect_delay: Base reconnect delay in seconds.</span>
<a id=__codelineno-0-606 name=__codelineno-0-606></a><span class=sd>        max_reconnect_attempts: Maximum reconnect attempts (None = unlimited).</span>
<a id=__codelineno-0-607 name=__codelineno-0-607></a><span class=sd>        read_timeout: Per-stream read timeout. Defaults to connector timeout.</span>
<a id=__codelineno-0-608 name=__codelineno-0-608></a><span class=sd>        decode_json: Whether to decode JSON payloads automatically.</span>
<a id=__codelineno-0-609 name=__codelineno-0-609></a>
<a id=__codelineno-0-610 name=__codelineno-0-610></a><span class=sd>    Yields:</span>
<a id=__codelineno-0-611 name=__codelineno-0-611></a><span class=sd>        Parsed SSE events with keys: ``id``, ``event``, ``data``, ``retry``, ``raw_data``.</span>
<a id=__codelineno-0-612 name=__codelineno-0-612></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-613 name=__codelineno-0-613></a>    <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-614 name=__codelineno-0-614></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-615 name=__codelineno-0-615></a>
<a id=__codelineno-0-616 name=__codelineno-0-616></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-617 name=__codelineno-0-617></a>    <span class=n>sse_config</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>sse</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-618 name=__codelineno-0-618></a>
<a id=__codelineno-0-619 name=__codelineno-0-619></a>    <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_events&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-620 name=__codelineno-0-620></a>        <span class=n>max_events</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_events&quot;</span><span class=p>])</span>
<a id=__codelineno-0-621 name=__codelineno-0-621></a>
<a id=__codelineno-0-622 name=__codelineno-0-622></a>    <span class=n>reconnect</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reconnect&quot;</span><span class=p>,</span> <span class=n>reconnect</span><span class=p>))</span>
<a id=__codelineno-0-623 name=__codelineno-0-623></a>    <span class=n>reconnect_delay</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;reconnect_delay&quot;</span><span class=p>,</span> <span class=n>reconnect_delay</span><span class=p>))</span>
<a id=__codelineno-0-624 name=__codelineno-0-624></a>
<a id=__codelineno-0-625 name=__codelineno-0-625></a>    <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-626 name=__codelineno-0-626></a>        <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=kc>None</span>
<a id=__codelineno-0-627 name=__codelineno-0-627></a>        <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_reconnect_attempts&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-628 name=__codelineno-0-628></a>    <span class=p>):</span>
<a id=__codelineno-0-629 name=__codelineno-0-629></a>        <span class=n>max_reconnect_attempts</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_reconnect_attempts&quot;</span><span class=p>])</span>
<a id=__codelineno-0-630 name=__codelineno-0-630></a>
<a id=__codelineno-0-631 name=__codelineno-0-631></a>    <span class=k>if</span> <span class=n>read_timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-632 name=__codelineno-0-632></a>        <span class=n>read_timeout</span> <span class=o>=</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;read_timeout&quot;</span><span class=p>)</span>
<a id=__codelineno-0-633 name=__codelineno-0-633></a>    <span class=k>if</span> <span class=n>read_timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-634 name=__codelineno-0-634></a>        <span class=n>read_timeout</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span>
<a id=__codelineno-0-635 name=__codelineno-0-635></a>
<a id=__codelineno-0-636 name=__codelineno-0-636></a>    <span class=n>decode_json</span> <span class=o>=</span> <span class=nb>bool</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;decode_json&quot;</span><span class=p>,</span> <span class=n>decode_json</span><span class=p>))</span>
<a id=__codelineno-0-637 name=__codelineno-0-637></a>
<a id=__codelineno-0-638 name=__codelineno-0-638></a>    <span class=n>reconnect_attempts</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-639 name=__codelineno-0-639></a>    <span class=n>received_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-640 name=__codelineno-0-640></a>    <span class=n>last_event_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-641 name=__codelineno-0-641></a>    <span class=n>effective_reconnect_delay</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>reconnect_delay</span><span class=p>)</span>
<a id=__codelineno-0-642 name=__codelineno-0-642></a>
<a id=__codelineno-0-643 name=__codelineno-0-643></a>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
<a id=__codelineno-0-644 name=__codelineno-0-644></a>        <span class=n>request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_build_sse_request</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>last_event_id</span><span class=p>)</span>
<a id=__codelineno-0-645 name=__codelineno-0-645></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-646 name=__codelineno-0-646></a>            <span class=c1># Apply endpoint-level rate limiting before opening/renewing stream</span>
<a id=__codelineno-0-647 name=__codelineno-0-647></a>            <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>acquire</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>)</span>
<a id=__codelineno-0-648 name=__codelineno-0-648></a>
<a id=__codelineno-0-649 name=__codelineno-0-649></a>            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>stream</span><span class=p>(</span>
<a id=__codelineno-0-650 name=__codelineno-0-650></a>                <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-651 name=__codelineno-0-651></a>                <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-652 name=__codelineno-0-652></a>                <span class=n>headers</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;headers&quot;</span><span class=p>],</span>
<a id=__codelineno-0-653 name=__codelineno-0-653></a>                <span class=n>params</span><span class=o>=</span><span class=n>request</span><span class=p>[</span><span class=s2>&quot;params&quot;</span><span class=p>],</span>
<a id=__codelineno-0-654 name=__codelineno-0-654></a>                <span class=n>json</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;json&quot;</span><span class=p>),</span>
<a id=__codelineno-0-655 name=__codelineno-0-655></a>                <span class=n>timeout</span><span class=o>=</span><span class=n>read_timeout</span><span class=p>,</span>
<a id=__codelineno-0-656 name=__codelineno-0-656></a>            <span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
<a id=__codelineno-0-657 name=__codelineno-0-657></a>                <span class=bp>self</span><span class=o>.</span><span class=n>rate_limit_manager</span><span class=o>.</span><span class=n>update_from_response</span><span class=p>(</span>
<a id=__codelineno-0-658 name=__codelineno-0-658></a>                    <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>response</span>
<a id=__codelineno-0-659 name=__codelineno-0-659></a>                <span class=p>)</span>
<a id=__codelineno-0-660 name=__codelineno-0-660></a>                <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
<a id=__codelineno-0-661 name=__codelineno-0-661></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-662 name=__codelineno-0-662></a>                    <span class=s2>&quot;Connected to SSE endpoint: </span><span class=si>%s</span><span class=s2> (</span><span class=si>%s</span><span class=s2> </span><span class=si>%s</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-663 name=__codelineno-0-663></a>                    <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-664 name=__codelineno-0-664></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>],</span>
<a id=__codelineno-0-665 name=__codelineno-0-665></a>                    <span class=n>request</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span>
<a id=__codelineno-0-666 name=__codelineno-0-666></a>                <span class=p>)</span>
<a id=__codelineno-0-667 name=__codelineno-0-667></a>
<a id=__codelineno-0-668 name=__codelineno-0-668></a>                <span class=n>pending_lines</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-669 name=__codelineno-0-669></a>
<a id=__codelineno-0-670 name=__codelineno-0-670></a>                <span class=k>def</span><span class=w> </span><span class=nf>_dispatch_event</span><span class=p>(</span>
<a id=__codelineno-0-671 name=__codelineno-0-671></a>                    <span class=n>event</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
<a id=__codelineno-0-672 name=__codelineno-0-672></a>                <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-673 name=__codelineno-0-673></a>                    <span class=k>nonlocal</span> <span class=n>effective_reconnect_delay</span><span class=p>,</span> <span class=n>last_event_id</span><span class=p>,</span> <span class=n>received_events</span>
<a id=__codelineno-0-674 name=__codelineno-0-674></a>
<a id=__codelineno-0-675 name=__codelineno-0-675></a>                    <span class=n>retry_hint</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;retry&quot;</span><span class=p>)</span>
<a id=__codelineno-0-676 name=__codelineno-0-676></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>retry_hint</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
<a id=__codelineno-0-677 name=__codelineno-0-677></a>                        <span class=n>effective_reconnect_delay</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span>
<a id=__codelineno-0-678 name=__codelineno-0-678></a>                            <span class=mf>0.0</span><span class=p>,</span> <span class=nb>float</span><span class=p>(</span><span class=n>retry_hint</span><span class=p>)</span> <span class=o>/</span> <span class=mf>1000.0</span>
<a id=__codelineno-0-679 name=__codelineno-0-679></a>                        <span class=p>)</span>
<a id=__codelineno-0-680 name=__codelineno-0-680></a>
<a id=__codelineno-0-681 name=__codelineno-0-681></a>                    <span class=n>event_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>
<a id=__codelineno-0-682 name=__codelineno-0-682></a>                    <span class=k>if</span> <span class=n>event_id</span><span class=p>:</span>
<a id=__codelineno-0-683 name=__codelineno-0-683></a>                        <span class=n>last_event_id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>event_id</span><span class=p>)</span>
<a id=__codelineno-0-684 name=__codelineno-0-684></a>
<a id=__codelineno-0-685 name=__codelineno-0-685></a>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;has_data&quot;</span><span class=p>):</span>
<a id=__codelineno-0-686 name=__codelineno-0-686></a>                        <span class=c1># Retry/id-only control blocks are not dispatched</span>
<a id=__codelineno-0-687 name=__codelineno-0-687></a>                        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-688 name=__codelineno-0-688></a>
<a id=__codelineno-0-689 name=__codelineno-0-689></a>                    <span class=n>event</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;has_data&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-0-690 name=__codelineno-0-690></a>                    <span class=n>received_events</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-691 name=__codelineno-0-691></a>                    <span class=k>return</span> <span class=n>event</span>
<a id=__codelineno-0-692 name=__codelineno-0-692></a>
<a id=__codelineno-0-693 name=__codelineno-0-693></a>                <span class=k>for</span> <span class=n>raw_line</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>iter_lines</span><span class=p>():</span>
<a id=__codelineno-0-694 name=__codelineno-0-694></a>                    <span class=k>if</span> <span class=n>raw_line</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-695 name=__codelineno-0-695></a>                        <span class=k>continue</span>
<a id=__codelineno-0-696 name=__codelineno-0-696></a>
<a id=__codelineno-0-697 name=__codelineno-0-697></a>                    <span class=n>line</span> <span class=o>=</span> <span class=n>raw_line</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\r</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-698 name=__codelineno-0-698></a>
<a id=__codelineno-0-699 name=__codelineno-0-699></a>                    <span class=k>if</span> <span class=n>line</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
<a id=__codelineno-0-700 name=__codelineno-0-700></a>                        <span class=n>parsed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_sse_event</span><span class=p>(</span>
<a id=__codelineno-0-701 name=__codelineno-0-701></a>                            <span class=n>pending_lines</span><span class=p>,</span> <span class=n>decode_json</span><span class=o>=</span><span class=n>decode_json</span>
<a id=__codelineno-0-702 name=__codelineno-0-702></a>                        <span class=p>)</span>
<a id=__codelineno-0-703 name=__codelineno-0-703></a>                        <span class=n>pending_lines</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-704 name=__codelineno-0-704></a>
<a id=__codelineno-0-705 name=__codelineno-0-705></a>                        <span class=k>if</span> <span class=n>parsed</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-706 name=__codelineno-0-706></a>                            <span class=k>continue</span>
<a id=__codelineno-0-707 name=__codelineno-0-707></a>
<a id=__codelineno-0-708 name=__codelineno-0-708></a>                        <span class=n>event</span> <span class=o>=</span> <span class=n>_dispatch_event</span><span class=p>(</span><span class=n>parsed</span><span class=p>)</span>
<a id=__codelineno-0-709 name=__codelineno-0-709></a>                        <span class=k>if</span> <span class=n>event</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-710 name=__codelineno-0-710></a>                            <span class=k>continue</span>
<a id=__codelineno-0-711 name=__codelineno-0-711></a>
<a id=__codelineno-0-712 name=__codelineno-0-712></a>                        <span class=k>yield</span> <span class=n>event</span>
<a id=__codelineno-0-713 name=__codelineno-0-713></a>                        <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>received_events</span> <span class=o>&gt;=</span> <span class=n>max_events</span><span class=p>:</span>
<a id=__codelineno-0-714 name=__codelineno-0-714></a>                            <span class=k>return</span>
<a id=__codelineno-0-715 name=__codelineno-0-715></a>                    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-716 name=__codelineno-0-716></a>                        <span class=n>pending_lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
<a id=__codelineno-0-717 name=__codelineno-0-717></a>
<a id=__codelineno-0-718 name=__codelineno-0-718></a>                <span class=c1># Flush trailing buffered event block on connection close</span>
<a id=__codelineno-0-719 name=__codelineno-0-719></a>                <span class=k>if</span> <span class=n>pending_lines</span><span class=p>:</span>
<a id=__codelineno-0-720 name=__codelineno-0-720></a>                    <span class=n>parsed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_sse_event</span><span class=p>(</span>
<a id=__codelineno-0-721 name=__codelineno-0-721></a>                        <span class=n>pending_lines</span><span class=p>,</span> <span class=n>decode_json</span><span class=o>=</span><span class=n>decode_json</span>
<a id=__codelineno-0-722 name=__codelineno-0-722></a>                    <span class=p>)</span>
<a id=__codelineno-0-723 name=__codelineno-0-723></a>                    <span class=k>if</span> <span class=n>parsed</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-724 name=__codelineno-0-724></a>                        <span class=n>event</span> <span class=o>=</span> <span class=n>_dispatch_event</span><span class=p>(</span><span class=n>parsed</span><span class=p>)</span>
<a id=__codelineno-0-725 name=__codelineno-0-725></a>                        <span class=k>if</span> <span class=n>event</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-726 name=__codelineno-0-726></a>                            <span class=k>yield</span> <span class=n>event</span>
<a id=__codelineno-0-727 name=__codelineno-0-727></a>                            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-728 name=__codelineno-0-728></a>                                <span class=n>max_events</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-729 name=__codelineno-0-729></a>                                <span class=ow>and</span> <span class=n>received_events</span> <span class=o>&gt;=</span> <span class=n>max_events</span>
<a id=__codelineno-0-730 name=__codelineno-0-730></a>                            <span class=p>):</span>
<a id=__codelineno-0-731 name=__codelineno-0-731></a>                                <span class=k>return</span>
<a id=__codelineno-0-732 name=__codelineno-0-732></a>
<a id=__codelineno-0-733 name=__codelineno-0-733></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a id=__codelineno-0-734 name=__codelineno-0-734></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>reconnect</span><span class=p>:</span>
<a id=__codelineno-0-735 name=__codelineno-0-735></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_raise_sse_error</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
<a id=__codelineno-0-736 name=__codelineno-0-736></a>
<a id=__codelineno-0-737 name=__codelineno-0-737></a>            <span class=n>reconnect_attempts</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-738 name=__codelineno-0-738></a>            <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-739 name=__codelineno-0-739></a>                <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-740 name=__codelineno-0-740></a>                <span class=ow>and</span> <span class=n>reconnect_attempts</span> <span class=o>&gt;</span> <span class=n>max_reconnect_attempts</span>
<a id=__codelineno-0-741 name=__codelineno-0-741></a>            <span class=p>):</span>
<a id=__codelineno-0-742 name=__codelineno-0-742></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_raise_sse_error</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>endpoint_name</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
<a id=__codelineno-0-743 name=__codelineno-0-743></a>
<a id=__codelineno-0-744 name=__codelineno-0-744></a>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-745 name=__codelineno-0-745></a>                <span class=s2>&quot;SSE stream error on endpoint &#39;</span><span class=si>%s</span><span class=s2>&#39;: </span><span class=si>%s</span><span class=s2>. Reconnecting in </span><span class=si>%.2f</span><span class=s2>s (attempt </span><span class=si>%d</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-746 name=__codelineno-0-746></a>                <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-747 name=__codelineno-0-747></a>                <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>),</span>
<a id=__codelineno-0-748 name=__codelineno-0-748></a>                <span class=n>effective_reconnect_delay</span><span class=p>,</span>
<a id=__codelineno-0-749 name=__codelineno-0-749></a>                <span class=n>reconnect_attempts</span><span class=p>,</span>
<a id=__codelineno-0-750 name=__codelineno-0-750></a>            <span class=p>)</span>
<a id=__codelineno-0-751 name=__codelineno-0-751></a>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>effective_reconnect_delay</span><span class=p>)</span>
<a id=__codelineno-0-752 name=__codelineno-0-752></a>            <span class=k>continue</span>
<a id=__codelineno-0-753 name=__codelineno-0-753></a>
<a id=__codelineno-0-754 name=__codelineno-0-754></a>        <span class=c1># Reconnect when stream closes naturally, unless disabled.</span>
<a id=__codelineno-0-755 name=__codelineno-0-755></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>reconnect</span><span class=p>:</span>
<a id=__codelineno-0-756 name=__codelineno-0-756></a>            <span class=k>return</span>
<a id=__codelineno-0-757 name=__codelineno-0-757></a>
<a id=__codelineno-0-758 name=__codelineno-0-758></a>        <span class=n>reconnect_attempts</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-759 name=__codelineno-0-759></a>        <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-0-760 name=__codelineno-0-760></a>            <span class=n>max_reconnect_attempts</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a id=__codelineno-0-761 name=__codelineno-0-761></a>            <span class=ow>and</span> <span class=n>reconnect_attempts</span> <span class=o>&gt;</span> <span class=n>max_reconnect_attempts</span>
<a id=__codelineno-0-762 name=__codelineno-0-762></a>        <span class=p>):</span>
<a id=__codelineno-0-763 name=__codelineno-0-763></a>            <span class=k>return</span>
<a id=__codelineno-0-764 name=__codelineno-0-764></a>
<a id=__codelineno-0-765 name=__codelineno-0-765></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-766 name=__codelineno-0-766></a>            <span class=s2>&quot;SSE stream closed for endpoint &#39;</span><span class=si>%s</span><span class=s2>&#39;. Reconnecting in </span><span class=si>%.2f</span><span class=s2>s (attempt </span><span class=si>%d</span><span class=s2>)&quot;</span><span class=p>,</span>
<a id=__codelineno-0-767 name=__codelineno-0-767></a>            <span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-768 name=__codelineno-0-768></a>            <span class=n>effective_reconnect_delay</span><span class=p>,</span>
<a id=__codelineno-0-769 name=__codelineno-0-769></a>            <span class=n>reconnect_attempts</span><span class=p>,</span>
<a id=__codelineno-0-770 name=__codelineno-0-770></a>        <span class=p>)</span>
<a id=__codelineno-0-771 name=__codelineno-0-771></a>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>effective_reconnect_delay</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.consume_sse class="doc doc-heading"> <code class="highlight language-python"><span class=n>consume_sse</span><span class=p>(</span><span class=n>endpoint_name</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>processor</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>chunk_size</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span> <span class=n>max_events</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>backpressure_buffer_size</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>drop_policy</span><span class=o>=</span><span class=s1>&#39;block&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>stream_kwargs</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Consume SSE events in chunks with bounded in-memory buffering.</p> <p>This method adds chunked processing and explicit backpressure handling: - <code>drop_policy='block'</code>: flushes buffer chunks before accepting more data. - <code>drop_policy='drop_oldest'</code>: drops oldest buffered events when full.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>endpoint_name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Endpoint key configured in <code>self.endpoints</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>params</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Query parameters.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>processor</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Callable>Callable</span>[[<span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]], <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Optional callback invoked with each chunk.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>chunk_size</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of events per processing chunk.</p> </div> </td> <td> <code>50</code> </td> </tr> <tr class=doc-section-item> <td> <code>max_events</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Maximum number of events to consume.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>backpressure_buffer_size</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Max in-memory event buffer.</p> </div> </td> <td> <code>500</code> </td> </tr> <tr class=doc-section-item> <td> <code>drop_policy</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p><code>block</code> or <code>drop_oldest</code>.</p> </div> </td> <td> <code>&#39;block&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>**stream_kwargs</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Extra kwargs forwarded to <code>stream_sse</code>.</p> </div> </td> <td> <code>{}</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Summary dictionary with processing metrics and chunk results.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-773>773</a></span>
<span class=normal><a href=#__codelineno-0-774>774</a></span>
<span class=normal><a href=#__codelineno-0-775>775</a></span>
<span class=normal><a href=#__codelineno-0-776>776</a></span>
<span class=normal><a href=#__codelineno-0-777>777</a></span>
<span class=normal><a href=#__codelineno-0-778>778</a></span>
<span class=normal><a href=#__codelineno-0-779>779</a></span>
<span class=normal><a href=#__codelineno-0-780>780</a></span>
<span class=normal><a href=#__codelineno-0-781>781</a></span>
<span class=normal><a href=#__codelineno-0-782>782</a></span>
<span class=normal><a href=#__codelineno-0-783>783</a></span>
<span class=normal><a href=#__codelineno-0-784>784</a></span>
<span class=normal><a href=#__codelineno-0-785>785</a></span>
<span class=normal><a href=#__codelineno-0-786>786</a></span>
<span class=normal><a href=#__codelineno-0-787>787</a></span>
<span class=normal><a href=#__codelineno-0-788>788</a></span>
<span class=normal><a href=#__codelineno-0-789>789</a></span>
<span class=normal><a href=#__codelineno-0-790>790</a></span>
<span class=normal><a href=#__codelineno-0-791>791</a></span>
<span class=normal><a href=#__codelineno-0-792>792</a></span>
<span class=normal><a href=#__codelineno-0-793>793</a></span>
<span class=normal><a href=#__codelineno-0-794>794</a></span>
<span class=normal><a href=#__codelineno-0-795>795</a></span>
<span class=normal><a href=#__codelineno-0-796>796</a></span>
<span class=normal><a href=#__codelineno-0-797>797</a></span>
<span class=normal><a href=#__codelineno-0-798>798</a></span>
<span class=normal><a href=#__codelineno-0-799>799</a></span>
<span class=normal><a href=#__codelineno-0-800>800</a></span>
<span class=normal><a href=#__codelineno-0-801>801</a></span>
<span class=normal><a href=#__codelineno-0-802>802</a></span>
<span class=normal><a href=#__codelineno-0-803>803</a></span>
<span class=normal><a href=#__codelineno-0-804>804</a></span>
<span class=normal><a href=#__codelineno-0-805>805</a></span>
<span class=normal><a href=#__codelineno-0-806>806</a></span>
<span class=normal><a href=#__codelineno-0-807>807</a></span>
<span class=normal><a href=#__codelineno-0-808>808</a></span>
<span class=normal><a href=#__codelineno-0-809>809</a></span>
<span class=normal><a href=#__codelineno-0-810>810</a></span>
<span class=normal><a href=#__codelineno-0-811>811</a></span>
<span class=normal><a href=#__codelineno-0-812>812</a></span>
<span class=normal><a href=#__codelineno-0-813>813</a></span>
<span class=normal><a href=#__codelineno-0-814>814</a></span>
<span class=normal><a href=#__codelineno-0-815>815</a></span>
<span class=normal><a href=#__codelineno-0-816>816</a></span>
<span class=normal><a href=#__codelineno-0-817>817</a></span>
<span class=normal><a href=#__codelineno-0-818>818</a></span>
<span class=normal><a href=#__codelineno-0-819>819</a></span>
<span class=normal><a href=#__codelineno-0-820>820</a></span>
<span class=normal><a href=#__codelineno-0-821>821</a></span>
<span class=normal><a href=#__codelineno-0-822>822</a></span>
<span class=normal><a href=#__codelineno-0-823>823</a></span>
<span class=normal><a href=#__codelineno-0-824>824</a></span>
<span class=normal><a href=#__codelineno-0-825>825</a></span>
<span class=normal><a href=#__codelineno-0-826>826</a></span>
<span class=normal><a href=#__codelineno-0-827>827</a></span>
<span class=normal><a href=#__codelineno-0-828>828</a></span>
<span class=normal><a href=#__codelineno-0-829>829</a></span>
<span class=normal><a href=#__codelineno-0-830>830</a></span>
<span class=normal><a href=#__codelineno-0-831>831</a></span>
<span class=normal><a href=#__codelineno-0-832>832</a></span>
<span class=normal><a href=#__codelineno-0-833>833</a></span>
<span class=normal><a href=#__codelineno-0-834>834</a></span>
<span class=normal><a href=#__codelineno-0-835>835</a></span>
<span class=normal><a href=#__codelineno-0-836>836</a></span>
<span class=normal><a href=#__codelineno-0-837>837</a></span>
<span class=normal><a href=#__codelineno-0-838>838</a></span>
<span class=normal><a href=#__codelineno-0-839>839</a></span>
<span class=normal><a href=#__codelineno-0-840>840</a></span>
<span class=normal><a href=#__codelineno-0-841>841</a></span>
<span class=normal><a href=#__codelineno-0-842>842</a></span>
<span class=normal><a href=#__codelineno-0-843>843</a></span>
<span class=normal><a href=#__codelineno-0-844>844</a></span>
<span class=normal><a href=#__codelineno-0-845>845</a></span>
<span class=normal><a href=#__codelineno-0-846>846</a></span>
<span class=normal><a href=#__codelineno-0-847>847</a></span>
<span class=normal><a href=#__codelineno-0-848>848</a></span>
<span class=normal><a href=#__codelineno-0-849>849</a></span>
<span class=normal><a href=#__codelineno-0-850>850</a></span>
<span class=normal><a href=#__codelineno-0-851>851</a></span>
<span class=normal><a href=#__codelineno-0-852>852</a></span>
<span class=normal><a href=#__codelineno-0-853>853</a></span>
<span class=normal><a href=#__codelineno-0-854>854</a></span>
<span class=normal><a href=#__codelineno-0-855>855</a></span>
<span class=normal><a href=#__codelineno-0-856>856</a></span>
<span class=normal><a href=#__codelineno-0-857>857</a></span>
<span class=normal><a href=#__codelineno-0-858>858</a></span>
<span class=normal><a href=#__codelineno-0-859>859</a></span>
<span class=normal><a href=#__codelineno-0-860>860</a></span>
<span class=normal><a href=#__codelineno-0-861>861</a></span>
<span class=normal><a href=#__codelineno-0-862>862</a></span>
<span class=normal><a href=#__codelineno-0-863>863</a></span>
<span class=normal><a href=#__codelineno-0-864>864</a></span>
<span class=normal><a href=#__codelineno-0-865>865</a></span>
<span class=normal><a href=#__codelineno-0-866>866</a></span>
<span class=normal><a href=#__codelineno-0-867>867</a></span>
<span class=normal><a href=#__codelineno-0-868>868</a></span>
<span class=normal><a href=#__codelineno-0-869>869</a></span>
<span class=normal><a href=#__codelineno-0-870>870</a></span>
<span class=normal><a href=#__codelineno-0-871>871</a></span>
<span class=normal><a href=#__codelineno-0-872>872</a></span>
<span class=normal><a href=#__codelineno-0-873>873</a></span>
<span class=normal><a href=#__codelineno-0-874>874</a></span>
<span class=normal><a href=#__codelineno-0-875>875</a></span>
<span class=normal><a href=#__codelineno-0-876>876</a></span>
<span class=normal><a href=#__codelineno-0-877>877</a></span>
<span class=normal><a href=#__codelineno-0-878>878</a></span>
<span class=normal><a href=#__codelineno-0-879>879</a></span>
<span class=normal><a href=#__codelineno-0-880>880</a></span>
<span class=normal><a href=#__codelineno-0-881>881</a></span>
<span class=normal><a href=#__codelineno-0-882>882</a></span>
<span class=normal><a href=#__codelineno-0-883>883</a></span>
<span class=normal><a href=#__codelineno-0-884>884</a></span>
<span class=normal><a href=#__codelineno-0-885>885</a></span>
<span class=normal><a href=#__codelineno-0-886>886</a></span>
<span class=normal><a href=#__codelineno-0-887>887</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-773 name=__codelineno-0-773></a><span class=k>def</span><span class=w> </span><span class=nf>consume_sse</span><span class=p>(</span>
<a id=__codelineno-0-774 name=__codelineno-0-774></a>    <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-775 name=__codelineno-0-775></a>    <span class=n>endpoint_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-776 name=__codelineno-0-776></a>    <span class=n>params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-777 name=__codelineno-0-777></a>    <span class=n>processor</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>[[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-778 name=__codelineno-0-778></a>    <span class=n>chunk_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>50</span><span class=p>,</span>
<a id=__codelineno-0-779 name=__codelineno-0-779></a>    <span class=n>max_events</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-780 name=__codelineno-0-780></a>    <span class=n>backpressure_buffer_size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>500</span><span class=p>,</span>
<a id=__codelineno-0-781 name=__codelineno-0-781></a>    <span class=n>drop_policy</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;block&quot;</span><span class=p>,</span>
<a id=__codelineno-0-782 name=__codelineno-0-782></a>    <span class=o>**</span><span class=n>stream_kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-783 name=__codelineno-0-783></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-784 name=__codelineno-0-784></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-785 name=__codelineno-0-785></a><span class=sd>    Consume SSE events in chunks with bounded in-memory buffering.</span>
<a id=__codelineno-0-786 name=__codelineno-0-786></a>
<a id=__codelineno-0-787 name=__codelineno-0-787></a><span class=sd>    This method adds chunked processing and explicit backpressure handling:</span>
<a id=__codelineno-0-788 name=__codelineno-0-788></a><span class=sd>    - ``drop_policy=&#39;block&#39;``: flushes buffer chunks before accepting more data.</span>
<a id=__codelineno-0-789 name=__codelineno-0-789></a><span class=sd>    - ``drop_policy=&#39;drop_oldest&#39;``: drops oldest buffered events when full.</span>
<a id=__codelineno-0-790 name=__codelineno-0-790></a>
<a id=__codelineno-0-791 name=__codelineno-0-791></a><span class=sd>    Args:</span>
<a id=__codelineno-0-792 name=__codelineno-0-792></a><span class=sd>        endpoint_name: Endpoint key configured in ``self.endpoints``.</span>
<a id=__codelineno-0-793 name=__codelineno-0-793></a><span class=sd>        params: Query parameters.</span>
<a id=__codelineno-0-794 name=__codelineno-0-794></a><span class=sd>        processor: Optional callback invoked with each chunk.</span>
<a id=__codelineno-0-795 name=__codelineno-0-795></a><span class=sd>        chunk_size: Number of events per processing chunk.</span>
<a id=__codelineno-0-796 name=__codelineno-0-796></a><span class=sd>        max_events: Maximum number of events to consume.</span>
<a id=__codelineno-0-797 name=__codelineno-0-797></a><span class=sd>        backpressure_buffer_size: Max in-memory event buffer.</span>
<a id=__codelineno-0-798 name=__codelineno-0-798></a><span class=sd>        drop_policy: ``block`` or ``drop_oldest``.</span>
<a id=__codelineno-0-799 name=__codelineno-0-799></a><span class=sd>        **stream_kwargs: Extra kwargs forwarded to ``stream_sse``.</span>
<a id=__codelineno-0-800 name=__codelineno-0-800></a>
<a id=__codelineno-0-801 name=__codelineno-0-801></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-802 name=__codelineno-0-802></a><span class=sd>        Summary dictionary with processing metrics and chunk results.</span>
<a id=__codelineno-0-803 name=__codelineno-0-803></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-804 name=__codelineno-0-804></a>    <span class=k>if</span> <span class=n>endpoint_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>:</span>
<a id=__codelineno-0-805 name=__codelineno-0-805></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Endpoint &#39;</span><span class=si>{</span><span class=n>endpoint_name</span><span class=si>}</span><span class=s2>&#39; not found in configuration&quot;</span><span class=p>)</span>
<a id=__codelineno-0-806 name=__codelineno-0-806></a>
<a id=__codelineno-0-807 name=__codelineno-0-807></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoints</span><span class=p>[</span><span class=n>endpoint_name</span><span class=p>]</span>
<a id=__codelineno-0-808 name=__codelineno-0-808></a>    <span class=n>sse_config</span> <span class=o>=</span> <span class=n>endpoint</span><span class=o>.</span><span class=n>sse</span> <span class=ow>or</span> <span class=p>{}</span>
<a id=__codelineno-0-809 name=__codelineno-0-809></a>
<a id=__codelineno-0-810 name=__codelineno-0-810></a>    <span class=k>if</span> <span class=n>max_events</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_events&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-811 name=__codelineno-0-811></a>        <span class=n>max_events</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=p>[</span><span class=s2>&quot;max_events&quot;</span><span class=p>])</span>
<a id=__codelineno-0-812 name=__codelineno-0-812></a>
<a id=__codelineno-0-813 name=__codelineno-0-813></a>    <span class=n>chunk_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;chunk_size&quot;</span><span class=p>,</span> <span class=n>chunk_size</span><span class=p>))</span>
<a id=__codelineno-0-814 name=__codelineno-0-814></a>    <span class=n>backpressure_buffer_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span>
<a id=__codelineno-0-815 name=__codelineno-0-815></a>        <span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;backpressure_buffer_size&quot;</span><span class=p>,</span> <span class=n>backpressure_buffer_size</span><span class=p>)</span>
<a id=__codelineno-0-816 name=__codelineno-0-816></a>    <span class=p>)</span>
<a id=__codelineno-0-817 name=__codelineno-0-817></a>    <span class=n>drop_policy</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>sse_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;drop_policy&quot;</span><span class=p>,</span> <span class=n>drop_policy</span><span class=p>))</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
<a id=__codelineno-0-818 name=__codelineno-0-818></a>
<a id=__codelineno-0-819 name=__codelineno-0-819></a>    <span class=k>if</span> <span class=n>chunk_size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-820 name=__codelineno-0-820></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;chunk_size must be &gt; 0&quot;</span><span class=p>)</span>
<a id=__codelineno-0-821 name=__codelineno-0-821></a>    <span class=k>if</span> <span class=n>backpressure_buffer_size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-822 name=__codelineno-0-822></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;backpressure_buffer_size must be &gt; 0&quot;</span><span class=p>)</span>
<a id=__codelineno-0-823 name=__codelineno-0-823></a>    <span class=k>if</span> <span class=n>drop_policy</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>{</span><span class=s2>&quot;block&quot;</span><span class=p>,</span> <span class=s2>&quot;drop_oldest&quot;</span><span class=p>}:</span>
<a id=__codelineno-0-824 name=__codelineno-0-824></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;drop_policy must be either &#39;block&#39; or &#39;drop_oldest&#39;&quot;</span><span class=p>)</span>
<a id=__codelineno-0-825 name=__codelineno-0-825></a>
<a id=__codelineno-0-826 name=__codelineno-0-826></a>    <span class=n>buffer</span><span class=p>:</span> <span class=n>Deque</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>deque</span><span class=p>(</span><span class=n>maxlen</span><span class=o>=</span><span class=n>backpressure_buffer_size</span><span class=p>)</span>
<a id=__codelineno-0-827 name=__codelineno-0-827></a>    <span class=n>dropped_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-828 name=__codelineno-0-828></a>    <span class=n>processed_events</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-829 name=__codelineno-0-829></a>    <span class=n>chunks_processed</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-830 name=__codelineno-0-830></a>    <span class=n>chunk_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-831 name=__codelineno-0-831></a>
<a id=__codelineno-0-832 name=__codelineno-0-832></a>    <span class=k>def</span><span class=w> </span><span class=nf>_flush</span><span class=p>(</span><span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-0-833 name=__codelineno-0-833></a>        <span class=k>nonlocal</span> <span class=n>processed_events</span><span class=p>,</span> <span class=n>chunks_processed</span>
<a id=__codelineno-0-834 name=__codelineno-0-834></a>        <span class=n>flushed</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-835 name=__codelineno-0-835></a>
<a id=__codelineno-0-836 name=__codelineno-0-836></a>        <span class=k>while</span> <span class=n>buffer</span> <span class=ow>and</span> <span class=p>(</span><span class=n>force</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>chunk_size</span><span class=p>):</span>
<a id=__codelineno-0-837 name=__codelineno-0-837></a>            <span class=n>current_chunk_size</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-0-838 name=__codelineno-0-838></a>                <span class=n>chunk_size</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>chunk_size</span> <span class=k>else</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span>
<a id=__codelineno-0-839 name=__codelineno-0-839></a>            <span class=p>)</span>
<a id=__codelineno-0-840 name=__codelineno-0-840></a>            <span class=n>chunk</span> <span class=o>=</span> <span class=p>[</span><span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>current_chunk_size</span><span class=p>)]</span>
<a id=__codelineno-0-841 name=__codelineno-0-841></a>            <span class=n>chunks_processed</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-842 name=__codelineno-0-842></a>            <span class=n>processed_events</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
<a id=__codelineno-0-843 name=__codelineno-0-843></a>            <span class=n>flushed</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-844 name=__codelineno-0-844></a>
<a id=__codelineno-0-845 name=__codelineno-0-845></a>            <span class=k>if</span> <span class=n>processor</span><span class=p>:</span>
<a id=__codelineno-0-846 name=__codelineno-0-846></a>                <span class=n>chunk_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>processor</span><span class=p>(</span><span class=n>chunk</span><span class=p>))</span>
<a id=__codelineno-0-847 name=__codelineno-0-847></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-848 name=__codelineno-0-848></a>                <span class=n>chunk_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
<a id=__codelineno-0-849 name=__codelineno-0-849></a>
<a id=__codelineno-0-850 name=__codelineno-0-850></a>            <span class=c1># In non-force mode we flush at most one chunk each step.</span>
<a id=__codelineno-0-851 name=__codelineno-0-851></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
<a id=__codelineno-0-852 name=__codelineno-0-852></a>                <span class=k>break</span>
<a id=__codelineno-0-853 name=__codelineno-0-853></a>
<a id=__codelineno-0-854 name=__codelineno-0-854></a>        <span class=k>return</span> <span class=n>flushed</span>
<a id=__codelineno-0-855 name=__codelineno-0-855></a>
<a id=__codelineno-0-856 name=__codelineno-0-856></a>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>stream_sse</span><span class=p>(</span>
<a id=__codelineno-0-857 name=__codelineno-0-857></a>        <span class=n>endpoint_name</span><span class=o>=</span><span class=n>endpoint_name</span><span class=p>,</span>
<a id=__codelineno-0-858 name=__codelineno-0-858></a>        <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span>
<a id=__codelineno-0-859 name=__codelineno-0-859></a>        <span class=n>max_events</span><span class=o>=</span><span class=n>max_events</span><span class=p>,</span>
<a id=__codelineno-0-860 name=__codelineno-0-860></a>        <span class=o>**</span><span class=n>stream_kwargs</span><span class=p>,</span>
<a id=__codelineno-0-861 name=__codelineno-0-861></a>    <span class=p>):</span>
<a id=__codelineno-0-862 name=__codelineno-0-862></a>        <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>backpressure_buffer_size</span><span class=p>:</span>
<a id=__codelineno-0-863 name=__codelineno-0-863></a>            <span class=k>if</span> <span class=n>drop_policy</span> <span class=o>==</span> <span class=s2>&quot;drop_oldest&quot;</span><span class=p>:</span>
<a id=__codelineno-0-864 name=__codelineno-0-864></a>                <span class=n>buffer</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
<a id=__codelineno-0-865 name=__codelineno-0-865></a>                <span class=n>dropped_events</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-866 name=__codelineno-0-866></a>                <span class=k>break</span>
<a id=__codelineno-0-867 name=__codelineno-0-867></a>
<a id=__codelineno-0-868 name=__codelineno-0-868></a>            <span class=c1># Block strategy: process buffered data before accepting more.</span>
<a id=__codelineno-0-869 name=__codelineno-0-869></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a id=__codelineno-0-870 name=__codelineno-0-870></a>                <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-0-871 name=__codelineno-0-871></a>                <span class=k>break</span>
<a id=__codelineno-0-872 name=__codelineno-0-872></a>
<a id=__codelineno-0-873 name=__codelineno-0-873></a>        <span class=n>buffer</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
<a id=__codelineno-0-874 name=__codelineno-0-874></a>        <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-0-875 name=__codelineno-0-875></a>
<a id=__codelineno-0-876 name=__codelineno-0-876></a>    <span class=c1># Process any trailing events.</span>
<a id=__codelineno-0-877 name=__codelineno-0-877></a>    <span class=n>_flush</span><span class=p>(</span><span class=n>force</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-0-878 name=__codelineno-0-878></a>
<a id=__codelineno-0-879 name=__codelineno-0-879></a>    <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-880 name=__codelineno-0-880></a>        <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-881 name=__codelineno-0-881></a>        <span class=s2>&quot;processed_events&quot;</span><span class=p>:</span> <span class=n>processed_events</span><span class=p>,</span>
<a id=__codelineno-0-882 name=__codelineno-0-882></a>        <span class=s2>&quot;chunks_processed&quot;</span><span class=p>:</span> <span class=n>chunks_processed</span><span class=p>,</span>
<a id=__codelineno-0-883 name=__codelineno-0-883></a>        <span class=s2>&quot;dropped_events&quot;</span><span class=p>:</span> <span class=n>dropped_events</span><span class=p>,</span>
<a id=__codelineno-0-884 name=__codelineno-0-884></a>        <span class=s2>&quot;chunk_size&quot;</span><span class=p>:</span> <span class=n>chunk_size</span><span class=p>,</span>
<a id=__codelineno-0-885 name=__codelineno-0-885></a>        <span class=s2>&quot;buffer_max_size&quot;</span><span class=p>:</span> <span class=n>backpressure_buffer_size</span><span class=p>,</span>
<a id=__codelineno-0-886 name=__codelineno-0-886></a>        <span class=s2>&quot;results&quot;</span><span class=p>:</span> <span class=n>chunk_results</span><span class=p>,</span>
<a id=__codelineno-0-887 name=__codelineno-0-887></a>    <span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.connector.ApiConnector.check_health class="doc doc-heading"> <code class="highlight language-python"><span class=n>check_health</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Check the health of the API connection.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=apilinker.core.monitoring.HealthCheckResult>HealthCheckResult</span></code> </td> <td> <div class=doc-md-description> <p>HealthCheckResult indicating the status.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/connector.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span>
<span class=normal><a href=#__codelineno-0-1175>1175</a></span>
<span class=normal><a href=#__codelineno-0-1176>1176</a></span>
<span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span>
<span class=normal><a href=#__codelineno-0-1190>1190</a></span>
<span class=normal><a href=#__codelineno-0-1191>1191</a></span>
<span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span>
<span class=normal><a href=#__codelineno-0-1194>1194</a></span>
<span class=normal><a href=#__codelineno-0-1195>1195</a></span>
<span class=normal><a href=#__codelineno-0-1196>1196</a></span>
<span class=normal><a href=#__codelineno-0-1197>1197</a></span>
<span class=normal><a href=#__codelineno-0-1198>1198</a></span>
<span class=normal><a href=#__codelineno-0-1199>1199</a></span>
<span class=normal><a href=#__codelineno-0-1200>1200</a></span>
<span class=normal><a href=#__codelineno-0-1201>1201</a></span>
<span class=normal><a href=#__codelineno-0-1202>1202</a></span>
<span class=normal><a href=#__codelineno-0-1203>1203</a></span>
<span class=normal><a href=#__codelineno-0-1204>1204</a></span>
<span class=normal><a href=#__codelineno-0-1205>1205</a></span>
<span class=normal><a href=#__codelineno-0-1206>1206</a></span>
<span class=normal><a href=#__codelineno-0-1207>1207</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1169 name=__codelineno-0-1169></a><span class=k>def</span><span class=w> </span><span class=nf>check_health</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>HealthCheckResult</span><span class=p>:</span>
<a id=__codelineno-0-1170 name=__codelineno-0-1170></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-1171 name=__codelineno-0-1171></a><span class=sd>    Check the health of the API connection.</span>
<a id=__codelineno-0-1172 name=__codelineno-0-1172></a>
<a id=__codelineno-0-1173 name=__codelineno-0-1173></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-1174 name=__codelineno-0-1174></a><span class=sd>        HealthCheckResult indicating the status.</span>
<a id=__codelineno-0-1175 name=__codelineno-0-1175></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-1176 name=__codelineno-0-1176></a>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-1177 name=__codelineno-0-1177></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-1178 name=__codelineno-0-1178></a>        <span class=c1># Try to hit the base URL or a specific health endpoint if we had one configured</span>
<a id=__codelineno-0-1179 name=__codelineno-0-1179></a>        <span class=c1># For now, just check if we can connect to the base URL</span>
<a id=__codelineno-0-1180 name=__codelineno-0-1180></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>5.0</span><span class=p>)</span>
<a id=__codelineno-0-1181 name=__codelineno-0-1181></a>
<a id=__codelineno-0-1182 name=__codelineno-0-1182></a>        <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-1183 name=__codelineno-0-1183></a>
<a id=__codelineno-0-1184 name=__codelineno-0-1184></a>        <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>HEALTHY</span>
<a id=__codelineno-0-1185 name=__codelineno-0-1185></a>        <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Connected to </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1186 name=__codelineno-0-1186></a>
<a id=__codelineno-0-1187 name=__codelineno-0-1187></a>        <span class=c1># If we get a 5xx error, the server is definitely having issues</span>
<a id=__codelineno-0-1188 name=__codelineno-0-1188></a>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>&gt;=</span> <span class=mi>500</span><span class=p>:</span>
<a id=__codelineno-0-1189 name=__codelineno-0-1189></a>            <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-1190 name=__codelineno-0-1190></a>            <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Server returned </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-1191 name=__codelineno-0-1191></a>
<a id=__codelineno-0-1192 name=__codelineno-0-1192></a>        <span class=k>return</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-1193 name=__codelineno-0-1193></a>            <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
<a id=__codelineno-0-1194 name=__codelineno-0-1194></a>            <span class=n>component</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;connector:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1195 name=__codelineno-0-1195></a>            <span class=n>message</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-1196 name=__codelineno-0-1196></a>            <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-1197 name=__codelineno-0-1197></a>            <span class=n>details</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status_code&quot;</span><span class=p>:</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>},</span>
<a id=__codelineno-0-1198 name=__codelineno-0-1198></a>        <span class=p>)</span>
<a id=__codelineno-0-1199 name=__codelineno-0-1199></a>
<a id=__codelineno-0-1200 name=__codelineno-0-1200></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-1201 name=__codelineno-0-1201></a>        <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-1202 name=__codelineno-0-1202></a>        <span class=k>return</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-1203 name=__codelineno-0-1203></a>            <span class=n>status</span><span class=o>=</span><span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span><span class=p>,</span>
<a id=__codelineno-0-1204 name=__codelineno-0-1204></a>            <span class=n>component</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;connector:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-1205 name=__codelineno-0-1205></a>            <span class=n>message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-0-1206 name=__codelineno-0-1206></a>            <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-1207 name=__codelineno-0-1207></a>        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h3 id=fieldmapper>FieldMapper</h3> <p>Data transformation and field mapping engine.</p> <div class="doc doc-object doc-class"> <h2 id=apilinker.core.mapper.FieldMapper class="doc doc-heading"> <code>apilinker.core.mapper.FieldMapper</code> </h2> <div class="doc doc-contents first"> <p>Maps fields between source and target APIs, including transformations.</p> <p>This class handles the mapping of fields from source to target format, including nested fields, transformations, and filtering.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/mapper.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-13> 13</a></span>
<span class=normal><a href=#__codelineno-0-14> 14</a></span>
<span class=normal><a href=#__codelineno-0-15> 15</a></span>
<span class=normal><a href=#__codelineno-0-16> 16</a></span>
<span class=normal><a href=#__codelineno-0-17> 17</a></span>
<span class=normal><a href=#__codelineno-0-18> 18</a></span>
<span class=normal><a href=#__codelineno-0-19> 19</a></span>
<span class=normal><a href=#__codelineno-0-20> 20</a></span>
<span class=normal><a href=#__codelineno-0-21> 21</a></span>
<span class=normal><a href=#__codelineno-0-22> 22</a></span>
<span class=normal><a href=#__codelineno-0-23> 23</a></span>
<span class=normal><a href=#__codelineno-0-24> 24</a></span>
<span class=normal><a href=#__codelineno-0-25> 25</a></span>
<span class=normal><a href=#__codelineno-0-26> 26</a></span>
<span class=normal><a href=#__codelineno-0-27> 27</a></span>
<span class=normal><a href=#__codelineno-0-28> 28</a></span>
<span class=normal><a href=#__codelineno-0-29> 29</a></span>
<span class=normal><a href=#__codelineno-0-30> 30</a></span>
<span class=normal><a href=#__codelineno-0-31> 31</a></span>
<span class=normal><a href=#__codelineno-0-32> 32</a></span>
<span class=normal><a href=#__codelineno-0-33> 33</a></span>
<span class=normal><a href=#__codelineno-0-34> 34</a></span>
<span class=normal><a href=#__codelineno-0-35> 35</a></span>
<span class=normal><a href=#__codelineno-0-36> 36</a></span>
<span class=normal><a href=#__codelineno-0-37> 37</a></span>
<span class=normal><a href=#__codelineno-0-38> 38</a></span>
<span class=normal><a href=#__codelineno-0-39> 39</a></span>
<span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span>
<span class=normal><a href=#__codelineno-0-395>395</a></span>
<span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=k>class</span><span class=w> </span><span class=nc>FieldMapper</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>    Maps fields between source and target APIs, including transformations.</span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a>
<a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>    This class handles the mapping of fields from source to target format,</span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>    including nested fields, transformations, and filtering.</span>
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a>
<a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_register_built_in_transformers</span><span class=p>()</span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Initialized FieldMapper&quot;</span><span class=p>)</span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a>
<a id=__codelineno-0-26 name=__codelineno-0-26></a>    <span class=k>def</span><span class=w> </span><span class=nf>_register_built_in_transformers</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]:</span>
<a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Register built-in transformation functions.&quot;&quot;&quot;</span>
<a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a>            <span class=c1># Date/time transformations</span>
<a id=__codelineno-0-30 name=__codelineno-0-30></a>            <span class=s2>&quot;iso_to_timestamp&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=p>(</span>
<a id=__codelineno-0-31 name=__codelineno-0-31></a>                <span class=nb>int</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>(</span><span class=n>v</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;Z&quot;</span><span class=p>,</span> <span class=s2>&quot;+00:00&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>timestamp</span><span class=p>())</span>
<a id=__codelineno-0-32 name=__codelineno-0-32></a>                <span class=k>if</span> <span class=n>v</span>
<a id=__codelineno-0-33 name=__codelineno-0-33></a>                <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-34 name=__codelineno-0-34></a>            <span class=p>),</span>
<a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=s2>&quot;timestamp_to_iso&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=p>(</span>
<a id=__codelineno-0-36 name=__codelineno-0-36></a>                <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>v</span><span class=p>))</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-37 name=__codelineno-0-37></a>            <span class=p>),</span>
<a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=c1># String transformations</span>
<a id=__codelineno-0-39 name=__codelineno-0-39></a>            <span class=s2>&quot;lowercase&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-40 name=__codelineno-0-40></a>            <span class=s2>&quot;uppercase&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=s2>&quot;strip&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-42 name=__codelineno-0-42></a>            <span class=c1># Type conversions</span>
<a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=s2>&quot;to_string&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=s2>&quot;to_int&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=n>v</span><span class=p>))</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-45 name=__codelineno-0-45></a>            <span class=s2>&quot;to_float&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=mf>0.0</span><span class=p>,</span>
<a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=s2>&quot;to_bool&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=nb>bool</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=k>if</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-0-47 name=__codelineno-0-47></a>            <span class=c1># Null handling</span>
<a id=__codelineno-0-48 name=__codelineno-0-48></a>            <span class=s2>&quot;default_empty_string&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span> <span class=k>if</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=s2>&quot;default_zero&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span> <span class=k>if</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-0-50 name=__codelineno-0-50></a>            <span class=s2>&quot;none_if_empty&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>v</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=p>}</span>
<a id=__codelineno-0-52 name=__codelineno-0-52></a>
<a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=k>def</span><span class=w> </span><span class=nf>register_transformer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=sd>        Register a custom transformation function.</span>
<a id=__codelineno-0-56 name=__codelineno-0-56></a>
<a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=sd>        Args:</span>
<a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=sd>            name: Name of the transformer</span>
<a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=sd>            func: Function that performs the transformation</span>
<a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>if</span> <span class=n>name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span>
<a id=__codelineno-0-62 name=__codelineno-0-62></a>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Overwriting existing transformer: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>func</span>
<a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Registered transformer: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-65 name=__codelineno-0-65></a>
<a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>transformer</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=sd>        Convenience wrapper to apply a single transformer to a value.</span>
<a id=__codelineno-0-69 name=__codelineno-0-69></a>
<a id=__codelineno-0-70 name=__codelineno-0-70></a><span class=sd>        Args:</span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=sd>            value: Input value</span>
<a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=sd>            transformer: Transformer name or transformer dict {name, params}</span>
<a id=__codelineno-0-73 name=__codelineno-0-73></a>
<a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-75 name=__codelineno-0-75></a><span class=sd>            Transformed value</span>
<a id=__codelineno-0-76 name=__codelineno-0-76></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transform</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>transformer</span><span class=p>)</span>
<a id=__codelineno-0-78 name=__codelineno-0-78></a>
<a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=k>def</span><span class=w> </span><span class=nf>load_custom_transformer</span><span class=p>(</span>
<a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>module_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>function_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>alias</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-82 name=__codelineno-0-82></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-83 name=__codelineno-0-83></a><span class=sd>        Load a custom transformer function from a Python module.</span>
<a id=__codelineno-0-84 name=__codelineno-0-84></a>
<a id=__codelineno-0-85 name=__codelineno-0-85></a><span class=sd>        Args:</span>
<a id=__codelineno-0-86 name=__codelineno-0-86></a><span class=sd>            module_path: Import path for the module</span>
<a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=sd>            function_name: Name of the function in the module</span>
<a id=__codelineno-0-88 name=__codelineno-0-88></a><span class=sd>            alias: Optional alternative name to register the transformer under</span>
<a id=__codelineno-0-89 name=__codelineno-0-89></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-91 name=__codelineno-0-91></a>            <span class=n>module</span> <span class=o>=</span> <span class=n>importlib</span><span class=o>.</span><span class=n>import_module</span><span class=p>(</span><span class=n>module_path</span><span class=p>)</span>
<a id=__codelineno-0-92 name=__codelineno-0-92></a>            <span class=n>func</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=n>function_name</span><span class=p>)</span>
<a id=__codelineno-0-93 name=__codelineno-0-93></a>
<a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=c1># Register with the provided alias or the original function name</span>
<a id=__codelineno-0-95 name=__codelineno-0-95></a>            <span class=n>name</span> <span class=o>=</span> <span class=n>alias</span> <span class=ow>or</span> <span class=n>function_name</span>
<a id=__codelineno-0-96 name=__codelineno-0-96></a>            <span class=bp>self</span><span class=o>.</span><span class=n>register_transformer</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>func</span><span class=p>)</span>
<a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
<a id=__codelineno-0-98 name=__codelineno-0-98></a>                <span class=sa>f</span><span class=s2>&quot;Loaded custom transformer from </span><span class=si>{</span><span class=n>module_path</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2> as </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=p>)</span>
<a id=__codelineno-0-100 name=__codelineno-0-100></a>
<a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=k>except</span> <span class=p>(</span><span class=ne>ImportError</span><span class=p>,</span> <span class=ne>AttributeError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-102 name=__codelineno-0-102></a>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error loading custom transformer: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=sa>f</span><span class=s2>&quot;Failed to load transformer from </span><span class=si>{</span><span class=n>module_path</span><span class=si>}</span><span class=s2>.</span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-105 name=__codelineno-0-105></a>            <span class=p>)</span>
<a id=__codelineno-0-106 name=__codelineno-0-106></a>
<a id=__codelineno-0-107 name=__codelineno-0-107></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_mapping</span><span class=p>(</span>
<a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>fields</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-110 name=__codelineno-0-110></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-111 name=__codelineno-0-111></a><span class=sd>        Add a field mapping between source and target endpoints.</span>
<a id=__codelineno-0-112 name=__codelineno-0-112></a>
<a id=__codelineno-0-113 name=__codelineno-0-113></a><span class=sd>        Args:</span>
<a id=__codelineno-0-114 name=__codelineno-0-114></a><span class=sd>            source: Source endpoint name</span>
<a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=sd>            target: Target endpoint name</span>
<a id=__codelineno-0-116 name=__codelineno-0-116></a><span class=sd>            fields: List of field mappings (dicts with source, target, and optional transform)</span>
<a id=__codelineno-0-117 name=__codelineno-0-117></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=c1># Validate that required fields are present</span>
<a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>fields</span><span class=p>:</span>
<a id=__codelineno-0-120 name=__codelineno-0-120></a>            <span class=k>if</span> <span class=s2>&quot;source&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>field</span> <span class=ow>or</span> <span class=s2>&quot;target&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>field</span><span class=p>:</span>
<a id=__codelineno-0-121 name=__codelineno-0-121></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-122 name=__codelineno-0-122></a>                    <span class=s2>&quot;Field mapping must contain &#39;source&#39; and &#39;target&#39; keys&quot;</span>
<a id=__codelineno-0-123 name=__codelineno-0-123></a>                <span class=p>)</span>
<a id=__codelineno-0-124 name=__codelineno-0-124></a>
<a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span> <span class=s2>&quot;target&quot;</span><span class=p>:</span> <span class=n>target</span><span class=p>,</span> <span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=n>fields</span><span class=p>})</span>
<a id=__codelineno-0-126 name=__codelineno-0-126></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
<a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=sa>f</span><span class=s2>&quot;Added mapping from </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>fields</span><span class=p>)</span><span class=si>}</span><span class=s2> fields&quot;</span>
<a id=__codelineno-0-128 name=__codelineno-0-128></a>        <span class=p>)</span>
<a id=__codelineno-0-129 name=__codelineno-0-129></a>
<a id=__codelineno-0-130 name=__codelineno-0-130></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_mappings</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-131 name=__codelineno-0-131></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all defined mappings.&quot;&quot;&quot;</span>
<a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span>
<a id=__codelineno-0-133 name=__codelineno-0-133></a>
<a id=__codelineno-0-134 name=__codelineno-0-134></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_first_mapping</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-0-135 name=__codelineno-0-135></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the first mapping if any exists.&quot;&quot;&quot;</span>
<a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span> <span class=k>else</span> <span class=kc>None</span>
<a id=__codelineno-0-137 name=__codelineno-0-137></a>
<a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_value_from_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-139 name=__codelineno-0-139></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=sd>        Extract a value from nested dictionary using dot notation.</span>
<a id=__codelineno-0-141 name=__codelineno-0-141></a>
<a id=__codelineno-0-142 name=__codelineno-0-142></a><span class=sd>        Args:</span>
<a id=__codelineno-0-143 name=__codelineno-0-143></a><span class=sd>            data: Source data dictionary</span>
<a id=__codelineno-0-144 name=__codelineno-0-144></a><span class=sd>            path: Path to the value using dot notation (e.g., &quot;user.address.city&quot;)</span>
<a id=__codelineno-0-145 name=__codelineno-0-145></a>
<a id=__codelineno-0-146 name=__codelineno-0-146></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-147 name=__codelineno-0-147></a><span class=sd>            The value at the specified path or None if not found</span>
<a id=__codelineno-0-148 name=__codelineno-0-148></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>path</span><span class=p>:</span>
<a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=k>return</span> <span class=n>data</span>
<a id=__codelineno-0-151 name=__codelineno-0-151></a>
<a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=c1># Handle array indexing in path (e.g., &quot;items[0].name&quot;)</span>
<a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=n>parts</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=n>current_part</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
<a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=k>if</span> <span class=n>path</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;[&quot;</span><span class=p>:</span>
<a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=k>if</span> <span class=n>current_part</span><span class=p>:</span>
<a id=__codelineno-0-159 name=__codelineno-0-159></a>                    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_part</span><span class=p>)</span>
<a id=__codelineno-0-160 name=__codelineno-0-160></a>                    <span class=n>current_part</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-161 name=__codelineno-0-161></a>
<a id=__codelineno-0-162 name=__codelineno-0-162></a>                <span class=c1># Extract the array index</span>
<a id=__codelineno-0-163 name=__codelineno-0-163></a>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-164 name=__codelineno-0-164></a>                <span class=n>index_str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-165 name=__codelineno-0-165></a>                <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=ow>and</span> <span class=n>path</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=s2>&quot;]&quot;</span><span class=p>:</span>
<a id=__codelineno-0-166 name=__codelineno-0-166></a>                    <span class=n>index_str</span> <span class=o>+=</span> <span class=n>path</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
<a id=__codelineno-0-167 name=__codelineno-0-167></a>                    <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-168 name=__codelineno-0-168></a>
<a id=__codelineno-0-169 name=__codelineno-0-169></a>                <span class=c1># Add the index as a separate part</span>
<a id=__codelineno-0-170 name=__codelineno-0-170></a>                <span class=k>if</span> <span class=n>index_str</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
<a id=__codelineno-0-171 name=__codelineno-0-171></a>                    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>index_str</span><span class=p>))</span>
<a id=__codelineno-0-172 name=__codelineno-0-172></a>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># Skip the closing bracket</span>
<a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=k>elif</span> <span class=n>path</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;.&quot;</span><span class=p>:</span>
<a id=__codelineno-0-174 name=__codelineno-0-174></a>                <span class=k>if</span> <span class=n>current_part</span><span class=p>:</span>
<a id=__codelineno-0-175 name=__codelineno-0-175></a>                    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_part</span><span class=p>)</span>
<a id=__codelineno-0-176 name=__codelineno-0-176></a>                    <span class=n>current_part</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-177 name=__codelineno-0-177></a>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-179 name=__codelineno-0-179></a>                <span class=n>current_part</span> <span class=o>+=</span> <span class=n>path</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
<a id=__codelineno-0-180 name=__codelineno-0-180></a>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-0-181 name=__codelineno-0-181></a>
<a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=k>if</span> <span class=n>current_part</span><span class=p>:</span>
<a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_part</span><span class=p>)</span>
<a id=__codelineno-0-184 name=__codelineno-0-184></a>
<a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=c1># Navigate through the path</span>
<a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=n>current</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=n>data</span>
<a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>parts</span><span class=p>:</span>
<a id=__codelineno-0-188 name=__codelineno-0-188></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>part</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-0-189 name=__codelineno-0-189></a>                <span class=k>if</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>current</span><span class=p>:</span>
<a id=__codelineno-0-190 name=__codelineno-0-190></a>                    <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-192 name=__codelineno-0-192></a>                    <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>part</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
<a id=__codelineno-0-194 name=__codelineno-0-194></a>                <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>part</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>current</span><span class=p>):</span>
<a id=__codelineno-0-195 name=__codelineno-0-195></a>                    <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-196 name=__codelineno-0-196></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-197 name=__codelineno-0-197></a>                    <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-198 name=__codelineno-0-198></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-199 name=__codelineno-0-199></a>                <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-200 name=__codelineno-0-200></a>
<a id=__codelineno-0-201 name=__codelineno-0-201></a>        <span class=k>return</span> <span class=n>current</span>
<a id=__codelineno-0-202 name=__codelineno-0-202></a>
<a id=__codelineno-0-203 name=__codelineno-0-203></a>    <span class=k>def</span><span class=w> </span><span class=nf>set_value_at_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-204 name=__codelineno-0-204></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-205 name=__codelineno-0-205></a><span class=sd>        Set a value in a nested dictionary using dot notation.</span>
<a id=__codelineno-0-206 name=__codelineno-0-206></a>
<a id=__codelineno-0-207 name=__codelineno-0-207></a><span class=sd>        Args:</span>
<a id=__codelineno-0-208 name=__codelineno-0-208></a><span class=sd>            data: Target data dictionary</span>
<a id=__codelineno-0-209 name=__codelineno-0-209></a><span class=sd>            path: Path where to set the value using dot notation</span>
<a id=__codelineno-0-210 name=__codelineno-0-210></a><span class=sd>            value: Value to set</span>
<a id=__codelineno-0-211 name=__codelineno-0-211></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>path</span><span class=p>:</span>
<a id=__codelineno-0-213 name=__codelineno-0-213></a>            <span class=k>return</span>
<a id=__codelineno-0-214 name=__codelineno-0-214></a>
<a id=__codelineno-0-215 name=__codelineno-0-215></a>        <span class=n>parts</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
<a id=__codelineno-0-216 name=__codelineno-0-216></a>
<a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=c1># Navigate to the parent of the leaf node</span>
<a id=__codelineno-0-218 name=__codelineno-0-218></a>        <span class=n>current</span> <span class=o>=</span> <span class=n>data</span>
<a id=__codelineno-0-219 name=__codelineno-0-219></a>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>part</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>parts</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]):</span>
<a id=__codelineno-0-220 name=__codelineno-0-220></a>            <span class=k>if</span> <span class=n>part</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>current</span><span class=p>:</span>
<a id=__codelineno-0-221 name=__codelineno-0-221></a>                <span class=n>current</span><span class=p>[</span><span class=n>part</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-222 name=__codelineno-0-222></a>            <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>[</span><span class=n>part</span><span class=p>]</span>
<a id=__codelineno-0-223 name=__codelineno-0-223></a>
<a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=c1># Set the value at the leaf node</span>
<a id=__codelineno-0-225 name=__codelineno-0-225></a>        <span class=n>current</span><span class=p>[</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>value</span>
<a id=__codelineno-0-226 name=__codelineno-0-226></a>
<a id=__codelineno-0-227 name=__codelineno-0-227></a>    <span class=k>def</span><span class=w> </span><span class=nf>apply_transform</span><span class=p>(</span>
<a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-229 name=__codelineno-0-229></a>        <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
<a id=__codelineno-0-230 name=__codelineno-0-230></a>        <span class=n>transform</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
<a id=__codelineno-0-231 name=__codelineno-0-231></a>        <span class=n>params</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-232 name=__codelineno-0-232></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-233 name=__codelineno-0-233></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-234 name=__codelineno-0-234></a><span class=sd>        Apply a transformation to a value.</span>
<a id=__codelineno-0-235 name=__codelineno-0-235></a>
<a id=__codelineno-0-236 name=__codelineno-0-236></a><span class=sd>        Args:</span>
<a id=__codelineno-0-237 name=__codelineno-0-237></a><span class=sd>            value: The value to transform</span>
<a id=__codelineno-0-238 name=__codelineno-0-238></a><span class=sd>            transform: The transformation to apply (string name or list of transforms)</span>
<a id=__codelineno-0-239 name=__codelineno-0-239></a><span class=sd>            params: Optional parameters for the transformer</span>
<a id=__codelineno-0-240 name=__codelineno-0-240></a>
<a id=__codelineno-0-241 name=__codelineno-0-241></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-242 name=__codelineno-0-242></a><span class=sd>            Transformed value</span>
<a id=__codelineno-0-243 name=__codelineno-0-243></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-244 name=__codelineno-0-244></a>        <span class=c1># Handle None values</span>
<a id=__codelineno-0-245 name=__codelineno-0-245></a>        <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-246 name=__codelineno-0-246></a>            <span class=c1># Special case transformers that handle None</span>
<a id=__codelineno-0-247 name=__codelineno-0-247></a>            <span class=k>if</span> <span class=n>transform</span> <span class=o>==</span> <span class=s2>&quot;default_empty_string&quot;</span><span class=p>:</span>
<a id=__codelineno-0-248 name=__codelineno-0-248></a>                <span class=k>return</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-0-249 name=__codelineno-0-249></a>            <span class=k>elif</span> <span class=n>transform</span> <span class=o>==</span> <span class=s2>&quot;default_zero&quot;</span><span class=p>:</span>
<a id=__codelineno-0-250 name=__codelineno-0-250></a>                <span class=k>return</span> <span class=mi>0</span>
<a id=__codelineno-0-251 name=__codelineno-0-251></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-252 name=__codelineno-0-252></a>                <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-253 name=__codelineno-0-253></a>
<a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=c1># Handle empty params</span>
<a id=__codelineno-0-255 name=__codelineno-0-255></a>        <span class=k>if</span> <span class=n>params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-256 name=__codelineno-0-256></a>            <span class=n>params</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-257 name=__codelineno-0-257></a>
<a id=__codelineno-0-258 name=__codelineno-0-258></a>        <span class=c1># Handle list of transformations</span>
<a id=__codelineno-0-259 name=__codelineno-0-259></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transform</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-260 name=__codelineno-0-260></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>value</span>
<a id=__codelineno-0-261 name=__codelineno-0-261></a>            <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>transform</span><span class=p>:</span>
<a id=__codelineno-0-262 name=__codelineno-0-262></a>                <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transform</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
<a id=__codelineno-0-263 name=__codelineno-0-263></a>            <span class=k>return</span> <span class=n>result</span>
<a id=__codelineno-0-264 name=__codelineno-0-264></a>
<a id=__codelineno-0-265 name=__codelineno-0-265></a>        <span class=c1># Handle transformation with parameters</span>
<a id=__codelineno-0-266 name=__codelineno-0-266></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transform</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-0-267 name=__codelineno-0-267></a>            <span class=n>name</span> <span class=o>=</span> <span class=n>transform</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
<a id=__codelineno-0-268 name=__codelineno-0-268></a>            <span class=n>transform_params</span> <span class=o>=</span> <span class=n>transform</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;params&quot;</span><span class=p>,</span> <span class=p>{})</span>
<a id=__codelineno-0-269 name=__codelineno-0-269></a>
<a id=__codelineno-0-270 name=__codelineno-0-270></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>name</span> <span class=ow>or</span> <span class=n>name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span>
<a id=__codelineno-0-271 name=__codelineno-0-271></a>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unknown transformer: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-272 name=__codelineno-0-272></a>                <span class=k>return</span> <span class=n>value</span>
<a id=__codelineno-0-273 name=__codelineno-0-273></a>
<a id=__codelineno-0-274 name=__codelineno-0-274></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>name</span><span class=p>](</span><span class=n>value</span><span class=p>,</span> <span class=o>**</span><span class=n>transform_params</span><span class=p>)</span>
<a id=__codelineno-0-275 name=__codelineno-0-275></a>
<a id=__codelineno-0-276 name=__codelineno-0-276></a>        <span class=c1># Simple string transformer name</span>
<a id=__codelineno-0-277 name=__codelineno-0-277></a>        <span class=k>if</span> <span class=n>transform</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span>
<a id=__codelineno-0-278 name=__codelineno-0-278></a>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unknown transformer: </span><span class=si>{</span><span class=n>transform</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-279 name=__codelineno-0-279></a>            <span class=k>return</span> <span class=n>value</span>
<a id=__codelineno-0-280 name=__codelineno-0-280></a>
<a id=__codelineno-0-281 name=__codelineno-0-281></a>        <span class=c1># Special handling for list inputs with certain transforms</span>
<a id=__codelineno-0-282 name=__codelineno-0-282></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=n>transform</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;lowercase&quot;</span><span class=p>,</span> <span class=s2>&quot;uppercase&quot;</span><span class=p>,</span> <span class=s2>&quot;strip&quot;</span><span class=p>]:</span>
<a id=__codelineno-0-283 name=__codelineno-0-283></a>            <span class=k>return</span> <span class=p>[</span>
<a id=__codelineno-0-284 name=__codelineno-0-284></a>                <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>transform</span><span class=p>](</span><span class=n>item</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=k>else</span> <span class=n>item</span>
<a id=__codelineno-0-285 name=__codelineno-0-285></a>                <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>value</span>
<a id=__codelineno-0-286 name=__codelineno-0-286></a>            <span class=p>]</span>
<a id=__codelineno-0-287 name=__codelineno-0-287></a>
<a id=__codelineno-0-288 name=__codelineno-0-288></a>        <span class=c1># Apply the transformation with parameters if provided</span>
<a id=__codelineno-0-289 name=__codelineno-0-289></a>        <span class=k>if</span> <span class=n>params</span><span class=p>:</span>
<a id=__codelineno-0-290 name=__codelineno-0-290></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>transform</span><span class=p>](</span><span class=n>value</span><span class=p>,</span> <span class=o>**</span><span class=n>params</span><span class=p>)</span>
<a id=__codelineno-0-291 name=__codelineno-0-291></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-292 name=__codelineno-0-292></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>transform</span><span class=p>](</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-0-293 name=__codelineno-0-293></a>
<a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=k>def</span><span class=w> </span><span class=nf>map_data</span><span class=p>(</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>source_endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=n>target_endpoint</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=n>data</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]],</span>
<a id=__codelineno-0-299 name=__codelineno-0-299></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<a id=__codelineno-0-300 name=__codelineno-0-300></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-301 name=__codelineno-0-301></a><span class=sd>        Map data from source format to target format.</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>
<a id=__codelineno-0-303 name=__codelineno-0-303></a><span class=sd>        Args:</span>
<a id=__codelineno-0-304 name=__codelineno-0-304></a><span class=sd>            source_endpoint: Source endpoint name</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a><span class=sd>            target_endpoint: Target endpoint name</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a><span class=sd>            data: Data to map</span>
<a id=__codelineno-0-307 name=__codelineno-0-307></a>
<a id=__codelineno-0-308 name=__codelineno-0-308></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-309 name=__codelineno-0-309></a><span class=sd>            Mapped data in target format</span>
<a id=__codelineno-0-310 name=__codelineno-0-310></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a>        <span class=c1># Find the appropriate mapping</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>        <span class=n>mapping</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-313 name=__codelineno-0-313></a>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span><span class=p>:</span>
<a id=__codelineno-0-314 name=__codelineno-0-314></a>            <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>source_endpoint</span> <span class=ow>and</span> <span class=n>m</span><span class=p>[</span><span class=s2>&quot;target&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>target_endpoint</span><span class=p>:</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a>                <span class=n>mapping</span> <span class=o>=</span> <span class=n>m</span>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>                <span class=k>break</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a>
<a id=__codelineno-0-318 name=__codelineno-0-318></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>mapping</span><span class=p>:</span>
<a id=__codelineno-0-319 name=__codelineno-0-319></a>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>                <span class=sa>f</span><span class=s2>&quot;No mapping found for </span><span class=si>{</span><span class=n>source_endpoint</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target_endpoint</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-0-321 name=__codelineno-0-321></a>            <span class=p>)</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a>            <span class=k>return</span> <span class=n>data</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a>
<a id=__codelineno-0-324 name=__codelineno-0-324></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Mapping data using </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>mapping</span><span class=p>[</span><span class=s1>&#39;fields&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> field mappings&quot;</span><span class=p>)</span>
<a id=__codelineno-0-325 name=__codelineno-0-325></a>
<a id=__codelineno-0-326 name=__codelineno-0-326></a>        <span class=c1># Handle list of items</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>            <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_map_item</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;fields&quot;</span><span class=p>])</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>]</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>        <span class=c1># Handle single item</span>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_map_item</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>mapping</span><span class=p>[</span><span class=s2>&quot;fields&quot;</span><span class=p>])</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>    <span class=k>def</span><span class=w> </span><span class=nf>_map_item</span><span class=p>(</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>fields</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-337 name=__codelineno-0-337></a><span class=sd>        Map a single data item according to field mappings.</span>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>
<a id=__codelineno-0-339 name=__codelineno-0-339></a><span class=sd>        Args:</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a><span class=sd>            item: Source data item</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a><span class=sd>            fields: Field mapping configurations</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>
<a id=__codelineno-0-343 name=__codelineno-0-343></a><span class=sd>        Returns:</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a><span class=sd>            Mapped data item</span>
<a id=__codelineno-0-345 name=__codelineno-0-345></a><span class=sd>        &quot;&quot;&quot;</span>
<a id=__codelineno-0-346 name=__codelineno-0-346></a>        <span class=n>result</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>
<a id=__codelineno-0-348 name=__codelineno-0-348></a>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>fields</span><span class=p>:</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a>            <span class=n>source_path</span> <span class=o>=</span> <span class=n>field</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a>            <span class=n>target_path</span> <span class=o>=</span> <span class=n>field</span><span class=p>[</span><span class=s2>&quot;target&quot;</span><span class=p>]</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>
<a id=__codelineno-0-352 name=__codelineno-0-352></a>            <span class=c1># Get source value</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a>            <span class=n>source_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_value_from_path</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>source_path</span><span class=p>)</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a>
<a id=__codelineno-0-355 name=__codelineno-0-355></a>            <span class=c1># Apply transformation if specified</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a>            <span class=k>if</span> <span class=s2>&quot;transform&quot;</span> <span class=ow>in</span> <span class=n>field</span> <span class=ow>and</span> <span class=n>field</span><span class=p>[</span><span class=s2>&quot;transform&quot;</span><span class=p>]:</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>                <span class=n>transform</span> <span class=o>=</span> <span class=n>field</span><span class=p>[</span><span class=s2>&quot;transform&quot;</span><span class=p>]</span>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transform</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>                    <span class=c1># Single transformation</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>                    <span class=n>source_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transform</span><span class=p>(</span><span class=n>source_value</span><span class=p>,</span> <span class=n>transform</span><span class=p>)</span>
<a id=__codelineno-0-361 name=__codelineno-0-361></a>                <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>transform</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-0-362 name=__codelineno-0-362></a>                    <span class=c1># Multiple transformations in sequence</span>
<a id=__codelineno-0-363 name=__codelineno-0-363></a>                    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>transform</span><span class=p>:</span>
<a id=__codelineno-0-364 name=__codelineno-0-364></a>                        <span class=n>source_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transform</span><span class=p>(</span><span class=n>source_value</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
<a id=__codelineno-0-365 name=__codelineno-0-365></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-366 name=__codelineno-0-366></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unknown transform format: </span><span class=si>{</span><span class=n>transform</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-367 name=__codelineno-0-367></a>
<a id=__codelineno-0-368 name=__codelineno-0-368></a>            <span class=c1># Check conditions if specified</span>
<a id=__codelineno-0-369 name=__codelineno-0-369></a>            <span class=k>if</span> <span class=s2>&quot;condition&quot;</span> <span class=ow>in</span> <span class=n>field</span><span class=p>:</span>
<a id=__codelineno-0-370 name=__codelineno-0-370></a>                <span class=n>condition</span> <span class=o>=</span> <span class=n>field</span><span class=p>[</span><span class=s2>&quot;condition&quot;</span><span class=p>]</span>
<a id=__codelineno-0-371 name=__codelineno-0-371></a>                <span class=k>if</span> <span class=n>condition</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;field&quot;</span><span class=p>):</span>
<a id=__codelineno-0-372 name=__codelineno-0-372></a>                    <span class=n>condition_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_value_from_path</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>condition</span><span class=p>[</span><span class=s2>&quot;field&quot;</span><span class=p>])</span>
<a id=__codelineno-0-373 name=__codelineno-0-373></a>                    <span class=n>operator</span> <span class=o>=</span> <span class=n>condition</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;operator&quot;</span><span class=p>,</span> <span class=s2>&quot;eq&quot;</span><span class=p>)</span>
<a id=__codelineno-0-374 name=__codelineno-0-374></a>                    <span class=n>compare_value</span> <span class=o>=</span> <span class=n>condition</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;value&quot;</span><span class=p>)</span>
<a id=__codelineno-0-375 name=__codelineno-0-375></a>
<a id=__codelineno-0-376 name=__codelineno-0-376></a>                    <span class=n>skip</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-0-377 name=__codelineno-0-377></a>                    <span class=k>if</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;eq&quot;</span> <span class=ow>and</span> <span class=n>condition_value</span> <span class=o>!=</span> <span class=n>compare_value</span><span class=p>:</span>
<a id=__codelineno-0-378 name=__codelineno-0-378></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-379 name=__codelineno-0-379></a>                    <span class=k>elif</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;ne&quot;</span> <span class=ow>and</span> <span class=n>condition_value</span> <span class=o>==</span> <span class=n>compare_value</span><span class=p>:</span>
<a id=__codelineno-0-380 name=__codelineno-0-380></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-381 name=__codelineno-0-381></a>                    <span class=k>elif</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;gt&quot;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=p>(</span><span class=n>condition_value</span> <span class=o>&gt;</span> <span class=n>compare_value</span><span class=p>):</span>
<a id=__codelineno-0-382 name=__codelineno-0-382></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-383 name=__codelineno-0-383></a>                    <span class=k>elif</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;lt&quot;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=p>(</span><span class=n>condition_value</span> <span class=o>&lt;</span> <span class=n>compare_value</span><span class=p>):</span>
<a id=__codelineno-0-384 name=__codelineno-0-384></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-385 name=__codelineno-0-385></a>                    <span class=k>elif</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;exists&quot;</span> <span class=ow>and</span> <span class=n>condition_value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-386 name=__codelineno-0-386></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-387 name=__codelineno-0-387></a>                    <span class=k>elif</span> <span class=n>operator</span> <span class=o>==</span> <span class=s2>&quot;not_exists&quot;</span> <span class=ow>and</span> <span class=n>condition_value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-388 name=__codelineno-0-388></a>                        <span class=n>skip</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-0-389 name=__codelineno-0-389></a>
<a id=__codelineno-0-390 name=__codelineno-0-390></a>                    <span class=k>if</span> <span class=n>skip</span><span class=p>:</span>
<a id=__codelineno-0-391 name=__codelineno-0-391></a>                        <span class=k>continue</span>
<a id=__codelineno-0-392 name=__codelineno-0-392></a>
<a id=__codelineno-0-393 name=__codelineno-0-393></a>            <span class=c1># Set value in result</span>
<a id=__codelineno-0-394 name=__codelineno-0-394></a>            <span class=k>if</span> <span class=n>source_value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>field</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;include_nulls&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
<a id=__codelineno-0-395 name=__codelineno-0-395></a>                <span class=bp>self</span><span class=o>.</span><span class=n>set_value_at_path</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>target_path</span><span class=p>,</span> <span class=n>source_value</span><span class=p>)</span>
<a id=__codelineno-0-396 name=__codelineno-0-396></a>
<a id=__codelineno-0-397 name=__codelineno-0-397></a>        <span class=k>return</span> <span class=n>result</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.mapper.FieldMapper.add_mapping class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_mapping</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>fields</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add a field mapping between source and target endpoints.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>source</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Source endpoint name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>target</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Target endpoint name</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fields</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>List of field mappings (dicts with source, target, and optional transform)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/mapper.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-107 name=__codelineno-0-107></a><span class=k>def</span><span class=w> </span><span class=nf>add_mapping</span><span class=p>(</span>
<a id=__codelineno-0-108 name=__codelineno-0-108></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>fields</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
<a id=__codelineno-0-109 name=__codelineno-0-109></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-110 name=__codelineno-0-110></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-111 name=__codelineno-0-111></a><span class=sd>    Add a field mapping between source and target endpoints.</span>
<a id=__codelineno-0-112 name=__codelineno-0-112></a>
<a id=__codelineno-0-113 name=__codelineno-0-113></a><span class=sd>    Args:</span>
<a id=__codelineno-0-114 name=__codelineno-0-114></a><span class=sd>        source: Source endpoint name</span>
<a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=sd>        target: Target endpoint name</span>
<a id=__codelineno-0-116 name=__codelineno-0-116></a><span class=sd>        fields: List of field mappings (dicts with source, target, and optional transform)</span>
<a id=__codelineno-0-117 name=__codelineno-0-117></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=c1># Validate that required fields are present</span>
<a id=__codelineno-0-119 name=__codelineno-0-119></a>    <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>fields</span><span class=p>:</span>
<a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=k>if</span> <span class=s2>&quot;source&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>field</span> <span class=ow>or</span> <span class=s2>&quot;target&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>field</span><span class=p>:</span>
<a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-122 name=__codelineno-0-122></a>                <span class=s2>&quot;Field mapping must contain &#39;source&#39; and &#39;target&#39; keys&quot;</span>
<a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=p>)</span>
<a id=__codelineno-0-124 name=__codelineno-0-124></a>
<a id=__codelineno-0-125 name=__codelineno-0-125></a>    <span class=bp>self</span><span class=o>.</span><span class=n>mappings</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span> <span class=s2>&quot;target&quot;</span><span class=p>:</span> <span class=n>target</span><span class=p>,</span> <span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=n>fields</span><span class=p>})</span>
<a id=__codelineno-0-126 name=__codelineno-0-126></a>    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
<a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=sa>f</span><span class=s2>&quot;Added mapping from </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2> to </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>fields</span><span class=p>)</span><span class=si>}</span><span class=s2> fields&quot;</span>
<a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.mapper.FieldMapper.transform class="doc doc-heading"> <code class="highlight language-python"><span class=n>transform</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>transformer</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Convenience wrapper to apply a single transformer to a value.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>value</code> </td> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Input value</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>transformer</code> </td> <td> <code><span title=typing.Union>Union</span>[<span title=str>str</span>, <span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Transformer name or transformer dict {name, params}</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Any>Any</span></code> </td> <td> <div class=doc-md-description> <p>Transformed value</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/mapper.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>transformer</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=sd>    Convenience wrapper to apply a single transformer to a value.</span>
<a id=__codelineno-0-69 name=__codelineno-0-69></a>
<a id=__codelineno-0-70 name=__codelineno-0-70></a><span class=sd>    Args:</span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=sd>        value: Input value</span>
<a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=sd>        transformer: Transformer name or transformer dict {name, params}</span>
<a id=__codelineno-0-73 name=__codelineno-0-73></a>
<a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-75 name=__codelineno-0-75></a><span class=sd>        Transformed value</span>
<a id=__codelineno-0-76 name=__codelineno-0-76></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>apply_transform</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>transformer</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.mapper.FieldMapper.register_transformer class="doc doc-heading"> <code class="highlight language-python"><span class=n>register_transformer</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>func</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Register a custom transformation function.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>name</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Name of the transformer</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>func</code> </td> <td> <code><span title=typing.Callable>Callable</span></code> </td> <td> <div class=doc-md-description> <p>Function that performs the transformation</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/mapper.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-53 name=__codelineno-0-53></a><span class=k>def</span><span class=w> </span><span class=nf>register_transformer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=sd>    Register a custom transformation function.</span>
<a id=__codelineno-0-56 name=__codelineno-0-56></a>
<a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=sd>    Args:</span>
<a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=sd>        name: Name of the transformer</span>
<a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=sd>        func: Function that performs the transformation</span>
<a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>if</span> <span class=n>name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>:</span>
<a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Overwriting existing transformer: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-63 name=__codelineno-0-63></a>    <span class=bp>self</span><span class=o>.</span><span class=n>transformers</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>func</span>
<a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Registered transformer: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h3 id=monitoring-alerting>Monitoring &amp; Alerting</h3> <p>System monitoring and health checks.</p> <div class="doc doc-object doc-class"> <h2 id=apilinker.core.monitoring.MonitoringManager class="doc doc-heading"> <code>apilinker.core.monitoring.MonitoringManager</code> </h2> <div class="doc doc-contents first"> <p>Manages health checks and alerts.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-289 name=__codelineno-0-289></a><span class=k>class</span><span class=w> </span><span class=nc>MonitoringManager</span><span class=p>:</span>
<a id=__codelineno-0-290 name=__codelineno-0-290></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-291 name=__codelineno-0-291></a><span class=sd>    Manages health checks and alerts.</span>
<a id=__codelineno-0-292 name=__codelineno-0-292></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-293 name=__codelineno-0-293></a>
<a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>        <span class=bp>self</span><span class=o>.</span><span class=n>integrations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>AlertIntegration</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=bp>self</span><span class=o>.</span><span class=n>rules</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>AlertRule</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=bp>self</span><span class=o>.</span><span class=n>alert_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Alert</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]]]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-299 name=__codelineno-0-299></a>
<a id=__codelineno-0-300 name=__codelineno-0-300></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_integration</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>integration</span><span class=p>:</span> <span class=n>AlertIntegration</span><span class=p>):</span>
<a id=__codelineno-0-301 name=__codelineno-0-301></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add an alert integration.&quot;&quot;&quot;</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>        <span class=bp>self</span><span class=o>.</span><span class=n>integrations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>integration</span><span class=p>)</span>
<a id=__codelineno-0-303 name=__codelineno-0-303></a>
<a id=__codelineno-0-304 name=__codelineno-0-304></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_rule</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rule</span><span class=p>:</span> <span class=n>AlertRule</span><span class=p>):</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add an alert rule.&quot;&quot;&quot;</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a>        <span class=bp>self</span><span class=o>.</span><span class=n>rules</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>rule</span><span class=p>)</span>
<a id=__codelineno-0-307 name=__codelineno-0-307></a>
<a id=__codelineno-0-308 name=__codelineno-0-308></a>    <span class=k>def</span><span class=w> </span><span class=nf>register_health_check</span><span class=p>(</span>
<a id=__codelineno-0-309 name=__codelineno-0-309></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>component</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>check_func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]]</span>
<a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Register a health check function for a component.&quot;&quot;&quot;</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>        <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>check_func</span>
<a id=__codelineno-0-313 name=__codelineno-0-313></a>
<a id=__codelineno-0-314 name=__codelineno-0-314></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_health_checks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]:</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run all registered health checks.&quot;&quot;&quot;</span>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>        <span class=n>results</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a>        <span class=n>context</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-318 name=__codelineno-0-318></a>
<a id=__codelineno-0-319 name=__codelineno-0-319></a>        <span class=k>for</span> <span class=n>component</span><span class=p>,</span> <span class=n>check_func</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-321 name=__codelineno-0-321></a>                <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>check_func</span><span class=p>()</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a>                <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-324 name=__codelineno-0-324></a>
<a id=__codelineno-0-325 name=__codelineno-0-325></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
<a id=__codelineno-0-326 name=__codelineno-0-326></a>                    <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>HEALTHY</span> <span class=k>if</span> <span class=n>result</span> <span class=k>else</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a>                    <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;OK&quot;</span> <span class=k>if</span> <span class=n>result</span> <span class=k>else</span> <span class=s2>&quot;Check failed&quot;</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>                    <span class=n>details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>                    <span class=c1># result is HealthCheckResult</span>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>                    <span class=n>status</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>status</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>                    <span class=n>message</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>message</span>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>                    <span class=n>details</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>details</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>                    <span class=c1># Use the latency from the result if provided, or the measured one</span>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>                    <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>latency_ms</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a>                        <span class=n>latency</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>latency_ms</span>
<a id=__codelineno-0-337 name=__codelineno-0-337></a>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>                <span class=n>results</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-339 name=__codelineno-0-339></a>                    <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a>                    <span class=n>component</span><span class=o>=</span><span class=n>component</span><span class=p>,</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a>                    <span class=n>message</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>                    <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-343 name=__codelineno-0-343></a>                    <span class=n>details</span><span class=o>=</span><span class=n>details</span><span class=p>,</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a>                <span class=p>)</span>
<a id=__codelineno-0-345 name=__codelineno-0-345></a>                <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>status</span>
<a id=__codelineno-0-346 name=__codelineno-0-346></a>                <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_latency_ms&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>latency</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>
<a id=__codelineno-0-348 name=__codelineno-0-348></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Health check failed for </span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a>                <span class=n>results</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>                    <span class=n>status</span><span class=o>=</span><span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span><span class=p>,</span>
<a id=__codelineno-0-352 name=__codelineno-0-352></a>                    <span class=n>component</span><span class=o>=</span><span class=n>component</span><span class=p>,</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a>                    <span class=n>message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a>                    <span class=n>latency_ms</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
<a id=__codelineno-0-355 name=__codelineno-0-355></a>                <span class=p>)</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a>                <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>        <span class=c1># Evaluate alert rules</span>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_evaluate_rules</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>
<a id=__codelineno-0-361 name=__codelineno-0-361></a>        <span class=k>return</span> <span class=n>results</span>
<a id=__codelineno-0-362 name=__codelineno-0-362></a>
<a id=__codelineno-0-363 name=__codelineno-0-363></a>    <span class=k>def</span><span class=w> </span><span class=nf>_evaluate_rules</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
<a id=__codelineno-0-364 name=__codelineno-0-364></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Evaluate all alert rules against the current context.&quot;&quot;&quot;</span>
<a id=__codelineno-0-365 name=__codelineno-0-365></a>        <span class=k>for</span> <span class=n>rule</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>rules</span><span class=p>:</span>
<a id=__codelineno-0-366 name=__codelineno-0-366></a>            <span class=k>if</span> <span class=n>rule</span><span class=o>.</span><span class=n>should_trigger</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
<a id=__codelineno-0-367 name=__codelineno-0-367></a>                <span class=n>alert</span> <span class=o>=</span> <span class=n>Alert</span><span class=p>(</span>
<a id=__codelineno-0-368 name=__codelineno-0-368></a>                    <span class=nb>id</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>rule</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
<a id=__codelineno-0-369 name=__codelineno-0-369></a>                    <span class=n>rule_name</span><span class=o>=</span><span class=n>rule</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
<a id=__codelineno-0-370 name=__codelineno-0-370></a>                    <span class=n>severity</span><span class=o>=</span><span class=n>rule</span><span class=o>.</span><span class=n>severity</span><span class=p>,</span>
<a id=__codelineno-0-371 name=__codelineno-0-371></a>                    <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Alert rule &#39;</span><span class=si>{</span><span class=n>rule</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39; triggered&quot;</span><span class=p>,</span>
<a id=__codelineno-0-372 name=__codelineno-0-372></a>                    <span class=n>details</span><span class=o>=</span><span class=n>context</span><span class=p>,</span>
<a id=__codelineno-0-373 name=__codelineno-0-373></a>                <span class=p>)</span>
<a id=__codelineno-0-374 name=__codelineno-0-374></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_trigger_alert</span><span class=p>(</span><span class=n>alert</span><span class=p>)</span>
<a id=__codelineno-0-375 name=__codelineno-0-375></a>
<a id=__codelineno-0-376 name=__codelineno-0-376></a>    <span class=k>def</span><span class=w> </span><span class=nf>_trigger_alert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>alert</span><span class=p>:</span> <span class=n>Alert</span><span class=p>):</span>
<a id=__codelineno-0-377 name=__codelineno-0-377></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Trigger an alert across all integrations.&quot;&quot;&quot;</span>
<a id=__codelineno-0-378 name=__codelineno-0-378></a>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Triggering alert: </span><span class=si>{</span><span class=n>alert</span><span class=o>.</span><span class=n>rule_name</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>alert</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-379 name=__codelineno-0-379></a>        <span class=bp>self</span><span class=o>.</span><span class=n>alert_history</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>alert</span><span class=p>)</span>
<a id=__codelineno-0-380 name=__codelineno-0-380></a>
<a id=__codelineno-0-381 name=__codelineno-0-381></a>        <span class=c1># Deduplication check (simple version: check if same rule triggered recently)</span>
<a id=__codelineno-0-382 name=__codelineno-0-382></a>        <span class=c1># Note: Real deduplication is complex, this is a basic implementation</span>
<a id=__codelineno-0-383 name=__codelineno-0-383></a>
<a id=__codelineno-0-384 name=__codelineno-0-384></a>        <span class=k>for</span> <span class=n>integration</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>integrations</span><span class=p>:</span>
<a id=__codelineno-0-385 name=__codelineno-0-385></a>            <span class=n>integration</span><span class=o>.</span><span class=n>send_alert</span><span class=p>(</span><span class=n>alert</span><span class=p>)</span>
<a id=__codelineno-0-386 name=__codelineno-0-386></a>
<a id=__codelineno-0-387 name=__codelineno-0-387></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_alert_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Alert</span><span class=p>]:</span>
<a id=__codelineno-0-388 name=__codelineno-0-388></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the history of triggered alerts.&quot;&quot;&quot;</span>
<a id=__codelineno-0-389 name=__codelineno-0-389></a>        <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>alert_history</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)[</span>
<a id=__codelineno-0-390 name=__codelineno-0-390></a>            <span class=p>:</span><span class=n>limit</span>
<a id=__codelineno-0-391 name=__codelineno-0-391></a>        <span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.__init__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__init__</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-294 name=__codelineno-0-294></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-0-295 name=__codelineno-0-295></a>    <span class=bp>self</span><span class=o>.</span><span class=n>integrations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>AlertIntegration</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-296 name=__codelineno-0-296></a>    <span class=bp>self</span><span class=o>.</span><span class=n>rules</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>AlertRule</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-297 name=__codelineno-0-297></a>    <span class=bp>self</span><span class=o>.</span><span class=n>alert_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Alert</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-298 name=__codelineno-0-298></a>    <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]]]</span> <span class=o>=</span> <span class=p>{}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.register_health_check class="doc doc-heading"> <code class="highlight language-python"><span class=n>register_health_check</span><span class=p>(</span><span class=n>component</span><span class=p>,</span> <span class=n>check_func</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Register a health check function for a component.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-308 name=__codelineno-0-308></a><span class=k>def</span><span class=w> </span><span class=nf>register_health_check</span><span class=p>(</span>
<a id=__codelineno-0-309 name=__codelineno-0-309></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>component</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>check_func</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[],</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]]</span>
<a id=__codelineno-0-310 name=__codelineno-0-310></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-311 name=__codelineno-0-311></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Register a health check function for a component.&quot;&quot;&quot;</span>
<a id=__codelineno-0-312 name=__codelineno-0-312></a>    <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>check_func</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.add_rule class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_rule</span><span class=p>(</span><span class=n>rule</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add an alert rule.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-304 name=__codelineno-0-304></a><span class=k>def</span><span class=w> </span><span class=nf>add_rule</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rule</span><span class=p>:</span> <span class=n>AlertRule</span><span class=p>):</span>
<a id=__codelineno-0-305 name=__codelineno-0-305></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add an alert rule.&quot;&quot;&quot;</span>
<a id=__codelineno-0-306 name=__codelineno-0-306></a>    <span class=bp>self</span><span class=o>.</span><span class=n>rules</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>rule</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.add_integration class="doc doc-heading"> <code class="highlight language-python"><span class=n>add_integration</span><span class=p>(</span><span class=n>integration</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Add an alert integration.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-300 name=__codelineno-0-300></a><span class=k>def</span><span class=w> </span><span class=nf>add_integration</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>integration</span><span class=p>:</span> <span class=n>AlertIntegration</span><span class=p>):</span>
<a id=__codelineno-0-301 name=__codelineno-0-301></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add an alert integration.&quot;&quot;&quot;</span>
<a id=__codelineno-0-302 name=__codelineno-0-302></a>    <span class=bp>self</span><span class=o>.</span><span class=n>integrations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>integration</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.run_health_checks class="doc doc-heading"> <code class="highlight language-python"><span class=n>run_health_checks</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Run all registered health checks.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-314 name=__codelineno-0-314></a><span class=k>def</span><span class=w> </span><span class=nf>run_health_checks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]:</span>
<a id=__codelineno-0-315 name=__codelineno-0-315></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run all registered health checks.&quot;&quot;&quot;</span>
<a id=__codelineno-0-316 name=__codelineno-0-316></a>    <span class=n>results</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>HealthCheckResult</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-317 name=__codelineno-0-317></a>    <span class=n>context</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-318 name=__codelineno-0-318></a>
<a id=__codelineno-0-319 name=__codelineno-0-319></a>    <span class=k>for</span> <span class=n>component</span><span class=p>,</span> <span class=n>check_func</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>health_checks</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-320 name=__codelineno-0-320></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-321 name=__codelineno-0-321></a>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<a id=__codelineno-0-322 name=__codelineno-0-322></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>check_func</span><span class=p>()</span>
<a id=__codelineno-0-323 name=__codelineno-0-323></a>            <span class=n>latency</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span>
<a id=__codelineno-0-324 name=__codelineno-0-324></a>
<a id=__codelineno-0-325 name=__codelineno-0-325></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
<a id=__codelineno-0-326 name=__codelineno-0-326></a>                <span class=n>status</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>HEALTHY</span> <span class=k>if</span> <span class=n>result</span> <span class=k>else</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-327 name=__codelineno-0-327></a>                <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;OK&quot;</span> <span class=k>if</span> <span class=n>result</span> <span class=k>else</span> <span class=s2>&quot;Check failed&quot;</span>
<a id=__codelineno-0-328 name=__codelineno-0-328></a>                <span class=n>details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-0-329 name=__codelineno-0-329></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-330 name=__codelineno-0-330></a>                <span class=c1># result is HealthCheckResult</span>
<a id=__codelineno-0-331 name=__codelineno-0-331></a>                <span class=n>status</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>status</span>
<a id=__codelineno-0-332 name=__codelineno-0-332></a>                <span class=n>message</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>message</span>
<a id=__codelineno-0-333 name=__codelineno-0-333></a>                <span class=n>details</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>details</span>
<a id=__codelineno-0-334 name=__codelineno-0-334></a>                <span class=c1># Use the latency from the result if provided, or the measured one</span>
<a id=__codelineno-0-335 name=__codelineno-0-335></a>                <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>latency_ms</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-0-336 name=__codelineno-0-336></a>                    <span class=n>latency</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>latency_ms</span>
<a id=__codelineno-0-337 name=__codelineno-0-337></a>
<a id=__codelineno-0-338 name=__codelineno-0-338></a>            <span class=n>results</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-339 name=__codelineno-0-339></a>                <span class=n>status</span><span class=o>=</span><span class=n>status</span><span class=p>,</span>
<a id=__codelineno-0-340 name=__codelineno-0-340></a>                <span class=n>component</span><span class=o>=</span><span class=n>component</span><span class=p>,</span>
<a id=__codelineno-0-341 name=__codelineno-0-341></a>                <span class=n>message</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
<a id=__codelineno-0-342 name=__codelineno-0-342></a>                <span class=n>latency_ms</span><span class=o>=</span><span class=n>latency</span><span class=p>,</span>
<a id=__codelineno-0-343 name=__codelineno-0-343></a>                <span class=n>details</span><span class=o>=</span><span class=n>details</span><span class=p>,</span>
<a id=__codelineno-0-344 name=__codelineno-0-344></a>            <span class=p>)</span>
<a id=__codelineno-0-345 name=__codelineno-0-345></a>            <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>status</span>
<a id=__codelineno-0-346 name=__codelineno-0-346></a>            <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_latency_ms&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>latency</span>
<a id=__codelineno-0-347 name=__codelineno-0-347></a>
<a id=__codelineno-0-348 name=__codelineno-0-348></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-0-349 name=__codelineno-0-349></a>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Health check failed for </span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-0-350 name=__codelineno-0-350></a>            <span class=n>results</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthCheckResult</span><span class=p>(</span>
<a id=__codelineno-0-351 name=__codelineno-0-351></a>                <span class=n>status</span><span class=o>=</span><span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span><span class=p>,</span>
<a id=__codelineno-0-352 name=__codelineno-0-352></a>                <span class=n>component</span><span class=o>=</span><span class=n>component</span><span class=p>,</span>
<a id=__codelineno-0-353 name=__codelineno-0-353></a>                <span class=n>message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
<a id=__codelineno-0-354 name=__codelineno-0-354></a>                <span class=n>latency_ms</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
<a id=__codelineno-0-355 name=__codelineno-0-355></a>            <span class=p>)</span>
<a id=__codelineno-0-356 name=__codelineno-0-356></a>            <span class=n>context</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>component</span><span class=si>}</span><span class=s2>_status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>HealthStatus</span><span class=o>.</span><span class=n>UNHEALTHY</span>
<a id=__codelineno-0-357 name=__codelineno-0-357></a>
<a id=__codelineno-0-358 name=__codelineno-0-358></a>    <span class=c1># Evaluate alert rules</span>
<a id=__codelineno-0-359 name=__codelineno-0-359></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_evaluate_rules</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
<a id=__codelineno-0-360 name=__codelineno-0-360></a>
<a id=__codelineno-0-361 name=__codelineno-0-361></a>    <span class=k>return</span> <span class=n>results</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=apilinker.core.monitoring.MonitoringManager.get_alert_history class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_alert_history</span><span class=p>(</span><span class=n>limit</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get the history of triggered alerts.</p> <details class=mkdocstrings-source> <summary>Source code in <code>apilinker/core/monitoring.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-387 name=__codelineno-0-387></a><span class=k>def</span><span class=w> </span><span class=nf>get_alert_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Alert</span><span class=p>]:</span>
<a id=__codelineno-0-388 name=__codelineno-0-388></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the history of triggered alerts.&quot;&quot;&quot;</span>
<a id=__codelineno-0-389 name=__codelineno-0-389></a>    <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>alert_history</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>timestamp</span><span class=p>,</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)[</span>
<a id=__codelineno-0-390 name=__codelineno-0-390></a>        <span class=p>:</span><span class=n>limit</span>
<a id=__codelineno-0-391 name=__codelineno-0-391></a>    <span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div><h2 id=research-connectors>Research Connectors</h2> <p>For research connector documentation, see <a href=../../user-guide/research-connectors/ >Research Connectors Guide</a>.</p> <h3 id=available-connectors>Available Connectors</h3> <ul> <li><strong>NCBIConnector</strong>: PubMed and GenBank</li> <li><strong>ArXivConnector</strong>: arXiv preprints </li> <li><strong>CrossRefConnector</strong>: Citation data</li> <li><strong>SemanticScholarConnector</strong>: AI-powered search</li> <li><strong>PubChemConnector</strong>: Chemical compounds</li> <li><strong>ORCIDConnector</strong>: Researcher profiles</li> <li><strong>GitHubConnector</strong>: Code repositories</li> <li><strong>NASAConnector</strong>: Earth/space data</li> <li><strong>SSEConnector</strong>: Real-time Server-Sent Events streams</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 9, 2026 11:26:21 UTC">February 9, 2026</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 9, 2026 11:26:21 UTC">February 9, 2026</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>