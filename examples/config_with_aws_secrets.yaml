# Example configuration using AWS Secrets Manager

# Secret Management Configuration
secrets:
  provider: aws
  aws:
    region_name: "us-east-1"
    # Option 1: Use IAM role (recommended for EC2/ECS/Lambda)
    # No credentials needed - uses instance profile or execution role
    
    # Option 2: Use explicit credentials (not recommended for production)
    # aws_access_key_id: "AKIA..."
    # aws_secret_access_key: "secret..."
    # aws_session_token: "token..."  # Optional for temporary credentials
    
    cache_ttl_seconds: 300  # Cache secrets for 5 minutes
  rotation_strategy: "auto"  # Use AWS automatic rotation
  rotation_interval_days: 30
  enable_least_privilege: true

# Source API with secret references
source:
  type: rest
  base_url: "https://api.source.com"
  auth:
    type: oauth2
    # Reference secrets stored in AWS Secrets Manager
    client_id: "secret://apilinker/source-oauth-client-id"
    client_secret: "secret://apilinker/source-oauth-client-secret"
    token_url: "https://auth.source.com/oauth/token"
    scopes:
      - "read:items"
  endpoints:
    list:
      path: "/v1/items"
      method: "GET"

# Target API with secret references
target:
  type: rest
  base_url: "https://api.target.com"
  auth:
    type: basic
    # Basic auth credentials from AWS Secrets Manager
    # The secret should be stored as JSON: {"username": "user", "password": "pass"}
    username: "secret://apilinker/target-basic-username"
    password: "secret://apilinker/target-basic-password"
  endpoints:
    create:
      path: "/v1/items"
      method: "POST"

# Field Mapping
mapping:
  source: list
  target: create
  fields:
    - source_field: id
      target_field: external_id
    - source_field: name
      target_field: title

# IAM Policy for Least Privilege Access (attach to your EC2/ECS role):
# {
#   "Version": "2012-10-17",
#   "Statement": [
#     {
#       "Effect": "Allow",
#       "Action": [
#         "secretsmanager:GetSecretValue",
#         "secretsmanager:DescribeSecret"
#       ],
#       "Resource": [
#         "arn:aws:secretsmanager:us-east-1:ACCOUNT_ID:secret:apilinker/*"
#       ]
#     }
#   ]
# }
