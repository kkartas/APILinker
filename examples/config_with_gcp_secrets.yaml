# Example configuration using Google Secret Manager

# Secret Management Configuration
secrets:
  provider: gcp
  gcp:
    project_id: "my-gcp-project"
    
    # Option 1: Use Workload Identity / Application Default Credentials (recommended)
    # No credentials needed - uses workload identity or GOOGLE_APPLICATION_CREDENTIALS env var
    
    # Option 2: Use Service Account Key File
    # credentials_path: "/path/to/service-account-key.json"
    
    cache_ttl_seconds: 300  # Cache secrets for 5 minutes
  rotation_strategy: "manual"
  rotation_interval_days: 90
  enable_least_privilege: true

# Source API with secret references
source:
  type: rest
  base_url: "https://api.source.com"
  auth:
    type: api_key
    # Reference a secret stored in Google Secret Manager
    key: "secret://source-api-key"
    header: "X-API-Key"
  endpoints:
    list:
      path: "/v1/items"
      method: "GET"

# Target API with secret references
target:
  type: rest
  base_url: "https://api.target.com"
  auth:
    type: oauth2
    # OAuth2 credentials from Secret Manager
    client_id: "secret://target-oauth-client-id"
    client_secret: "secret://target-oauth-client-secret"
    token_url: "https://auth.target.com/oauth/token"
    scopes:
      - "write:items"
  endpoints:
    create:
      path: "/v1/items"
      method: "POST"

# Field Mapping
mapping:
  source: list
  target: create
  fields:
    - source_field: id
      target_field: external_id
    - source_field: name
      target_field: title

# GCP IAM Permissions Required (assign to your service account or workload identity):
# roles/secretmanager.secretAccessor (predefined role)
# OR custom role with these permissions:
# - secretmanager.versions.access
# - secretmanager.versions.get
# - secretmanager.secrets.get
#
# Grant at project level or individual secret level for least privilege:
# gcloud secrets add-iam-policy-binding SECRET_NAME \
#   --member="serviceAccount:SA_EMAIL" \
#   --role="roles/secretmanager.secretAccessor"
